[{"title":"Docekr部署项目","url":"/p/fa8a.html","content":"<h2 id=\"一、打包SpringBoot项目\"><a href=\"#一、打包SpringBoot项目\" class=\"headerlink\" title=\"一、打包SpringBoot项目\"></a>一、打包SpringBoot项目</h2><p>◇这里的项目以<a href=\"https://gamest.link/p/ea75.html\">医点通</a>项目中的service-cmn服务模块为例，首先在需要进行打包的模块(即有启动类的服务模块和网关模块)中进行打包的配置，注意统一的实体类等不需要打包的模块不要配置。配置如下：</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!--在build中配置resource,来防止资源导出失败问题--&gt;</span></span><br><span class=\"line\">   <span class=\"tag\">&lt;<span class=\"name\">build</span>&gt;</span></span><br><span class=\"line\">       <span class=\"comment\">&lt;!--配置springboot打包插件--&gt;</span></span><br><span class=\"line\">       <span class=\"tag\">&lt;<span class=\"name\">plugins</span>&gt;</span></span><br><span class=\"line\">           <span class=\"tag\">&lt;<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\">               <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">               <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">           <span class=\"tag\">&lt;/<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\">       <span class=\"tag\">&lt;/<span class=\"name\">plugins</span>&gt;</span></span><br><span class=\"line\">       <span class=\"tag\">&lt;<span class=\"name\">resources</span>&gt;</span></span><br><span class=\"line\">           <span class=\"tag\">&lt;<span class=\"name\">resource</span>&gt;</span></span><br><span class=\"line\">               <span class=\"tag\">&lt;<span class=\"name\">directory</span>&gt;</span>src/main/java<span class=\"tag\">&lt;/<span class=\"name\">directory</span>&gt;</span></span><br><span class=\"line\">               <span class=\"tag\">&lt;<span class=\"name\">includes</span>&gt;</span></span><br><span class=\"line\">                   <span class=\"tag\">&lt;<span class=\"name\">include</span>&gt;</span>**/*.yml<span class=\"tag\">&lt;/<span class=\"name\">include</span>&gt;</span></span><br><span class=\"line\">                   <span class=\"tag\">&lt;<span class=\"name\">include</span>&gt;</span>**/*.properties<span class=\"tag\">&lt;/<span class=\"name\">include</span>&gt;</span></span><br><span class=\"line\">                   <span class=\"tag\">&lt;<span class=\"name\">include</span>&gt;</span>**/*.xml<span class=\"tag\">&lt;/<span class=\"name\">include</span>&gt;</span></span><br><span class=\"line\">               <span class=\"tag\">&lt;/<span class=\"name\">includes</span>&gt;</span></span><br><span class=\"line\">               <span class=\"tag\">&lt;<span class=\"name\">filtering</span>&gt;</span>false<span class=\"tag\">&lt;/<span class=\"name\">filtering</span>&gt;</span></span><br><span class=\"line\">           <span class=\"tag\">&lt;/<span class=\"name\">resource</span>&gt;</span></span><br><span class=\"line\">           <span class=\"tag\">&lt;<span class=\"name\">resource</span>&gt;</span></span><br><span class=\"line\">               <span class=\"tag\">&lt;<span class=\"name\">directory</span>&gt;</span>src/main/resources<span class=\"tag\">&lt;/<span class=\"name\">directory</span>&gt;</span></span><br><span class=\"line\">               <span class=\"tag\">&lt;<span class=\"name\">includes</span>&gt;</span> <span class=\"tag\">&lt;<span class=\"name\">include</span>&gt;</span>**/*.yml<span class=\"tag\">&lt;/<span class=\"name\">include</span>&gt;</span></span><br><span class=\"line\">                   <span class=\"tag\">&lt;<span class=\"name\">include</span>&gt;</span>**/*.properties<span class=\"tag\">&lt;/<span class=\"name\">include</span>&gt;</span></span><br><span class=\"line\">                   <span class=\"tag\">&lt;<span class=\"name\">include</span>&gt;</span>**/*.xml<span class=\"tag\">&lt;/<span class=\"name\">include</span>&gt;</span></span><br><span class=\"line\">               <span class=\"tag\">&lt;/<span class=\"name\">includes</span>&gt;</span></span><br><span class=\"line\">               <span class=\"tag\">&lt;<span class=\"name\">filtering</span>&gt;</span>false<span class=\"tag\">&lt;/<span class=\"name\">filtering</span>&gt;</span></span><br><span class=\"line\">           <span class=\"tag\">&lt;/<span class=\"name\">resource</span>&gt;</span></span><br><span class=\"line\">       <span class=\"tag\">&lt;/<span class=\"name\">resources</span>&gt;</span></span><br><span class=\"line\">   <span class=\"tag\">&lt;/<span class=\"name\">build</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>◇然后点击在IDEA右侧的Maven-&gt;找到service-cmn模块-&gt;双击package或install进行单独打包(可以在父项目中一次性打包多个子模块)。<br><img src=\"/p/fa8a/1646983118953-0fdee5bd-9075-4d2f-89bb-9ff74757b54c.png\" class=\"lazyload\" data-srcset=\"/p/fa8a/1646983118953-0fdee5bd-9075-4d2f-89bb-9ff74757b54c.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"><br>◇package打包成功后可以看到如下提示：</p>\n<figure class=\"highlight properties\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">[INFO]</span> <span class=\"string\">--- spring-boot-maven-plugin:2.2.12.RELEASE:repackage (repackage) @ service_cmn ---</span></span><br><span class=\"line\"><span class=\"meta\">[INFO]</span> <span class=\"string\">Replacing main artifact with repackaged archive</span></span><br><span class=\"line\"><span class=\"meta\">[INFO]</span> <span class=\"string\">------------------------------------------------------------------------</span></span><br><span class=\"line\"><span class=\"meta\">[INFO]</span> <span class=\"string\">BUILD SUCCESS</span></span><br><span class=\"line\"><span class=\"meta\">[INFO]</span> <span class=\"string\">------------------------------------------------------------------------</span></span><br><span class=\"line\"><span class=\"meta\">[INFO]</span> <span class=\"string\">Total time: 24.464 s</span></span><br><span class=\"line\"><span class=\"meta\">[INFO]</span> <span class=\"string\">Finished at: 2022-03-11T15:58:24+08:00</span></span><br><span class=\"line\"><span class=\"meta\">[INFO]</span> <span class=\"string\">Final Memory: 64M/454M</span></span><br><span class=\"line\"><span class=\"meta\">[INFO]</span> <span class=\"string\">------------------------------------------------------------------------</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"二、Docker部署\"><a href=\"#二、Docker部署\" class=\"headerlink\" title=\"二、Docker部署\"></a>二、Docker部署</h2><p>◇Docker的安装见前面的文章：<a href=\"https://gamest.link/p/e1be.html\">Docekr应用</a>。<br>◇由于service-cmn模块使用到了MySQL数据库，如果在虚拟机中运行该服务的话，就需要更改服务配置MySQL数据库的部分，将localhost改为Windows主机的ip地址，并且修改MySQL为允许远程连接，具体操作请看<a href=\"https://blog.csdn.net/mingxin95/article/details/78832129\">虚拟机连接主机MySQL</a>。<br>◇也可以直接在Docker中拉取一个MySQL的镜像，这样数据库配置可以直接写localhost。</p>\n<figure class=\"highlight properties\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#启动docker</span></span><br><span class=\"line\"><span class=\"attr\">systemctl</span> <span class=\"string\">start docker</span></span><br><span class=\"line\"><span class=\"comment\">#搜索mysql镜像</span></span><br><span class=\"line\"><span class=\"attr\">docker</span> <span class=\"string\">search mysql</span></span><br><span class=\"line\"><span class=\"comment\">#下载5.7的版本</span></span><br><span class=\"line\"><span class=\"attr\">docker</span> <span class=\"string\">pull mysql:5.7</span></span><br><span class=\"line\"><span class=\"comment\">#根据镜像创建mysql容器,密码为123456</span></span><br><span class=\"line\"><span class=\"attr\">docker</span> <span class=\"string\">run -p 3306:3306 --name mysql -v $PWD/conf:/etc/mysql/conf.d -v $PWD/logs:/logs -v $PWD/data:/var/lib/mysql -e MYSQL_ROOT_PASSWORD=123456 -d mysql:5.7</span></span><br></pre></td></tr></table></figure>\n<p>◇在主机的Navicat数据库管理工具中连接到虚拟机中的数据库，并将service-cmn服务对应的数据库appointment-cmn复制到虚拟机中。<br><img src=\"/p/fa8a/1646995120902-67a47c9f-66bd-41f1-bfa1-efc084e3fb10.png\" class=\"lazyload\" data-srcset=\"/p/fa8a/1646995120902-67a47c9f-66bd-41f1-bfa1-efc084e3fb10.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"><br>◇在docker目录中新建一个service目录，将前面打好的jar包上传到虚拟机的service中。使用xftp，如果没有权限，使用命令chmod 777 service授权。</p>\n<figure class=\"highlight properties\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#进入docker目录</span></span><br><span class=\"line\"><span class=\"meta\">[root@master</span> <span class=\"string\">docker]# cd /var/lib/docker</span></span><br><span class=\"line\"><span class=\"comment\">#创建service目录</span></span><br><span class=\"line\"><span class=\"attr\">mkdir</span> <span class=\"string\">service</span></span><br><span class=\"line\"><span class=\"comment\">#开启权限(在docker的上一级目录lib中)</span></span><br><span class=\"line\"><span class=\"meta\">[root@master</span> <span class=\"string\">lib]# chmod 777 service</span></span><br></pre></td></tr></table></figure>\n<p>◇然后创建Dockerfile文件（vim Dockerfile），内容如下:</p>\n<figure class=\"highlight properties\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">FROM</span> <span class=\"string\">java:8 </span></span><br><span class=\"line\"><span class=\"comment\"># 将jar包添加到容器中并更名为app.jar</span></span><br><span class=\"line\"><span class=\"attr\">ADD</span> <span class=\"string\">service_cmn-0.0.1-SNAPSHOT.jar app.jar </span></span><br><span class=\"line\"><span class=\"comment\"># 设置端口号，此处只开放一个端口8202</span></span><br><span class=\"line\"><span class=\"attr\">EXPOSE</span> <span class=\"string\">8202</span></span><br><span class=\"line\"><span class=\"comment\"># 执行命令，此处运行app.jar</span></span><br><span class=\"line\"><span class=\"attr\">RUN</span> <span class=\"string\">bash -c &#x27;touch /app.jar&#x27;</span></span><br><span class=\"line\"><span class=\"attr\">ENTRYPOINT</span> <span class=\"string\">[&quot;java&quot;,&quot;-jar&quot;,&quot;/app.jar&quot;]  </span></span><br></pre></td></tr></table></figure>\n<p>◇查看Dockerfile文件</p>\n<figure class=\"highlight properties\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">[root@master</span> <span class=\"string\">service]# vim Dockerfile</span></span><br><span class=\"line\"><span class=\"meta\">[root@master</span> <span class=\"string\">service]# cat Dockerfile</span></span><br><span class=\"line\"><span class=\"attr\">FROM</span> <span class=\"string\">java:8 </span></span><br><span class=\"line\"><span class=\"attr\">ADD</span> <span class=\"string\">service_cmn-0.0.1-SNAPSHOT.jar app.jar </span></span><br><span class=\"line\"><span class=\"attr\">EXPOSE</span> <span class=\"string\">8202</span></span><br><span class=\"line\"><span class=\"attr\">RUN</span> <span class=\"string\">bash -c &#x27;touch /app.jar&#x27;</span></span><br><span class=\"line\"><span class=\"attr\">ENTRYPOINT</span> <span class=\"string\">[&quot;java&quot;,&quot;-jar&quot;,&quot;/app.jar&quot;]</span></span><br><span class=\"line\"><span class=\"meta\">[root@master</span> <span class=\"string\">service]# </span></span><br></pre></td></tr></table></figure>\n<p>◇为什么要在docker目录下新建一个目录存放jar包和Dockerfile呢? 是因为如果直接在docker目录下构建镜像的话，会使生成的发送给Docker守护进程的上下文过大。上下文是根据Dockerfile文件所在目录生成的，而docker目录下本来就有很多子目录，这就导致问题产生。</p>\n<figure class=\"highlight properties\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">Sending</span> <span class=\"string\">build context to Docker daemon 4.309 GB</span></span><br></pre></td></tr></table></figure>\n<p>◇如果不想新建子目录的话，就要创建一个.dockerignore文件，在里面配置生成忽略的目录：</p>\n<figure class=\"highlight properties\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">./builder</span></span><br><span class=\"line\"><span class=\"attr\">./containerd</span></span><br><span class=\"line\"><span class=\"attr\">./image</span></span><br><span class=\"line\"><span class=\"comment\">#...这样显然过于麻烦</span></span><br></pre></td></tr></table></figure>\n<p>◇最后先启动cmn模块需要的一些服务，如nacos、redis，然后构建cmn的镜像并生成容器启动。</p>\n<figure class=\"highlight properties\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#构建镜像,镜像名为:service_cmn,v1.0表示版本,可省略; .表示当前路径,不可省;</span></span><br><span class=\"line\"><span class=\"meta\">[root@master</span> <span class=\"string\">service]# docker build -f Dockerfile -t service_cmn:v1.0 .</span></span><br><span class=\"line\"><span class=\"attr\">Sending</span> <span class=\"string\">build context to Docker daemon  75.16MB</span></span><br><span class=\"line\"><span class=\"attr\">Step</span> <span class=\"string\">1/5 : FROM java:8</span></span><br><span class=\"line\"> <span class=\"meta\">---&gt;</span> <span class=\"string\">d23bdf5b1b1b</span></span><br><span class=\"line\"><span class=\"attr\">Step</span> <span class=\"string\">2/5 : ADD service_cmn-0.0.1-SNAPSHOT.jar app.jar</span></span><br><span class=\"line\"> <span class=\"meta\">---&gt;</span> <span class=\"string\">c7cafd276296</span></span><br><span class=\"line\"><span class=\"attr\">Step</span> <span class=\"string\">3/5 : EXPOSE 8202</span></span><br><span class=\"line\"> <span class=\"meta\">---&gt;</span> <span class=\"string\">Running in 002409c6c02b</span></span><br><span class=\"line\"><span class=\"attr\">Removing</span> <span class=\"string\">intermediate container 002409c6c02b</span></span><br><span class=\"line\"> <span class=\"meta\">---&gt;</span> <span class=\"string\">b184e8ae5522</span></span><br><span class=\"line\"><span class=\"attr\">Step</span> <span class=\"string\">4/5 : RUN bash -c &#x27;touch /app.jar&#x27;</span></span><br><span class=\"line\"> <span class=\"meta\">---&gt;</span> <span class=\"string\">Running in 891f96a44e21</span></span><br><span class=\"line\"><span class=\"attr\">Removing</span> <span class=\"string\">intermediate container 891f96a44e21</span></span><br><span class=\"line\"> <span class=\"meta\">---&gt;</span> <span class=\"string\">d1a1996ba764</span></span><br><span class=\"line\"><span class=\"attr\">Step</span> <span class=\"string\">5/5 : ENTRYPOINT [&quot;java&quot;,&quot;-jar&quot;,&quot;/app.jar&quot;]</span></span><br><span class=\"line\"> <span class=\"meta\">---&gt;</span> <span class=\"string\">Running in d18f642aaab4</span></span><br><span class=\"line\"><span class=\"attr\">Removing</span> <span class=\"string\">intermediate container d18f642aaab4</span></span><br><span class=\"line\"> <span class=\"meta\">---&gt;</span> <span class=\"string\">a0e08a0ced11</span></span><br><span class=\"line\"><span class=\"attr\">Successfully</span> <span class=\"string\">built a0e08a0ced11</span></span><br><span class=\"line\"><span class=\"attr\">Successfully</span> <span class=\"string\">tagged service_cmn:v1.0</span></span><br><span class=\"line\"><span class=\"comment\">#查看镜像列表</span></span><br><span class=\"line\"><span class=\"meta\">[root@master</span> <span class=\"string\">service]# docker images</span></span><br><span class=\"line\"><span class=\"attr\">REPOSITORY</span>          <span class=\"string\">TAG                 IMAGE ID            CREATED             SIZE</span></span><br><span class=\"line\"><span class=\"attr\">service_cmn</span>         <span class=\"string\">v1.0                a0e08a0ced11        12 minutes ago      794MB</span></span><br><span class=\"line\"><span class=\"attr\">mysql</span>               <span class=\"string\">5.7                 11d8667108c2        2 days ago          450MB</span></span><br><span class=\"line\"><span class=\"attr\">rabbitmq</span>            <span class=\"string\">management          799381c528ac        5 weeks ago         254MB</span></span><br><span class=\"line\"><span class=\"attr\">mongo</span>               <span class=\"string\">latest              ee13a1eacac9        2 months ago        696MB</span></span><br><span class=\"line\"><span class=\"attr\">java</span>                <span class=\"string\">8                   d23bdf5b1b1b        5 years ago         643MB</span></span><br><span class=\"line\"><span class=\"meta\">[root@master</span> <span class=\"string\">service]# </span></span><br><span class=\"line\"><span class=\"comment\"># --net=host表示和宿主机共用网络,-d表示后台运行 -p后面有两个端口,分别是:宿主机端口:容器端口</span></span><br><span class=\"line\"><span class=\"comment\"># 即用主机8202端口映射容器端口，这里容器端口要和cmn服务中配置的端口一致</span></span><br><span class=\"line\"><span class=\"comment\"># --name=cmn 表示容器名称,最后面为容器使用的镜像</span></span><br><span class=\"line\"><span class=\"meta\">[root@master</span> <span class=\"string\">service]# docker run    --net=host  --name=cmn -d -p 8202:8202 service_cmn:v1.0</span></span><br><span class=\"line\"><span class=\"attr\">WARNING</span>: <span class=\"string\">Published ports are discarded when using host network mode</span></span><br><span class=\"line\"><span class=\"attr\">55f440226120da0097961fc87e36a8c86555eff580308f8491ad3515f1e32292</span></span><br><span class=\"line\"><span class=\"comment\">#查看运行的容器</span></span><br><span class=\"line\"><span class=\"meta\">[root@master</span> <span class=\"string\">service]# docker ps</span></span><br><span class=\"line\"><span class=\"attr\">CONTAINER</span> <span class=\"string\">ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                               NAMES</span></span><br><span class=\"line\"><span class=\"attr\">55f440226120</span>        <span class=\"string\">service_cmn:v1.0    &quot;java -jar /app.jar&quot;     40 seconds ago      Up 39 seconds                                           cmn</span></span><br><span class=\"line\"><span class=\"attr\">a807a6c90bec</span>        <span class=\"string\">mysql:5.7           &quot;docker-entrypoint.s…&quot;   About an hour ago   Up About an hour    0.0.0.0:3306-&gt;3306/tcp, 33060/tcp   mysql</span></span><br><span class=\"line\"><span class=\"attr\">d9a024b9bffc</span>        <span class=\"string\">mongo               &quot;docker-entrypoint.s…&quot;   6 weeks ago         Up About an hour    0.0.0.0:27017-&gt;27017/tcp            mymongo</span></span><br><span class=\"line\"><span class=\"meta\">[root@master</span> <span class=\"string\">service]# </span></span><br></pre></td></tr></table></figure>\n<p>◇然后在主机浏览器中通过swagger进行测试，访问:<a href=\"http://192.168.222.137:8202/swagger-ui.html#/\">http://192.168.222.137:8202/swagger-ui.html#/</a> 查看服务是否正常启动。<br><img src=\"/p/fa8a/1647000064738-737f863a-ceb2-4260-b8b3-3fcaaf71e576.png\" class=\"lazyload\" data-srcset=\"/p/fa8a/1647000064738-737f863a-ceb2-4260-b8b3-3fcaaf71e576.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"><br>◇可以发现项目成功启动了，那下面测试方法能否调用成功。我们根据findByDictCode()方法查询所有省级地区数据。<br><img src=\"/p/fa8a/1647000366843-bff5d73e-9db9-48b2-9549-b560be3b4cab.png\" class=\"lazyload\" data-srcset=\"/p/fa8a/1647000366843-bff5d73e-9db9-48b2-9549-b560be3b4cab.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"><br>◇至此，service-cmn服务已经成功部署在docker中了，对于其他的服务模块采用同样的方法部署即可。<br>◇如果要删除镜像，则需要先停止容器并删除容器，最后删除镜像。</p>\n<figure class=\"highlight properties\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#查看容器</span></span><br><span class=\"line\"><span class=\"meta\">[root@master</span> <span class=\"string\">service]# docker ps</span></span><br><span class=\"line\"><span class=\"attr\">CONTAINER</span> <span class=\"string\">ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                               NAMES</span></span><br><span class=\"line\"><span class=\"attr\">b69ba027734a</span>        <span class=\"string\">service_cmn:v1.0    &quot;java -jar /app.jar&quot;     29 minutes ago      Up 29 minutes                                           cmn</span></span><br><span class=\"line\"><span class=\"comment\">#停止容器</span></span><br><span class=\"line\"><span class=\"meta\">[root@master</span> <span class=\"string\">service]# docker stop b69ba027734a</span></span><br><span class=\"line\"><span class=\"attr\">b69ba027734a</span></span><br><span class=\"line\"><span class=\"comment\">#根据容器ID删除容器</span></span><br><span class=\"line\"><span class=\"meta\">[root@master</span> <span class=\"string\">service]# docker rm b69ba027734a</span></span><br><span class=\"line\"><span class=\"comment\">#查看镜像</span></span><br><span class=\"line\"><span class=\"meta\">[root@master</span> <span class=\"string\">service]# docker images</span></span><br><span class=\"line\"><span class=\"attr\">REPOSITORY</span>          <span class=\"string\">TAG                 IMAGE ID            CREATED             SIZE</span></span><br><span class=\"line\"><span class=\"attr\">service_cmn</span>         <span class=\"string\">v1.0                9d61dae6888c        32 minutes ago      794MB</span></span><br><span class=\"line\"><span class=\"comment\">#根据镜像ID删除镜像</span></span><br><span class=\"line\"><span class=\"meta\">[root@master</span> <span class=\"string\">service]# docker rmi 9d61dae6888c</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"三、需要注意的地方\"><a href=\"#三、需要注意的地方\" class=\"headerlink\" title=\"三、需要注意的地方\"></a>三、需要注意的地方</h2><p>◇整体搭建过程比较简单，但也有一些要注意的点:<br>1.容器的端口号要和我们在服务中配置的端口号一致，最好容器的宿主机映射的端口号也保持一致。</p>\n<p>2.注意实例化容器的时候需要采用host的方式去启动项目容器，否则会连接不上MySQL数据库，这是因为docker会自动给每个容器分配ip，但是项目里配置的mysql地址是localhost，在容器内连接localhost是连接容器本身而不是宿主机的localhost，所以一直找不到mysql。因此采用host的网络方式将容器与宿主机共用一个Network Namespace,这样容器内localhost就是宿主机的localhost了。</p>\n<p>3.注意不要将Dockerfile文件直接放在docker目录下，否则有可能生成过大的context。</p>\n<p>4.如果成功启动镜像后无法访问虚拟机，则需要使用防火墙放行相关端口，如这里需要放行8202端口。</p>\n<figure class=\"highlight properties\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#启动防火墙</span></span><br><span class=\"line\"><span class=\"meta\">[root@master</span> <span class=\"string\">service]# systemctl start firewalld</span></span><br><span class=\"line\"><span class=\"comment\">#查看端口是否放行,no表示未放行</span></span><br><span class=\"line\"><span class=\"meta\">[root@master</span> <span class=\"string\">service]# firewall-cmd --query-port=8202/tcp</span></span><br><span class=\"line\"><span class=\"attr\">no</span></span><br><span class=\"line\"><span class=\"comment\">#放行端口</span></span><br><span class=\"line\"><span class=\"meta\">[root@master</span> <span class=\"string\">service]# firewall-cmd --add-port=8202/tcp --permanent</span></span><br><span class=\"line\"><span class=\"attr\">success</span></span><br><span class=\"line\"><span class=\"comment\">#重启防火墙服务</span></span><br><span class=\"line\"><span class=\"meta\">[root@master</span> <span class=\"string\">service]# firewall-cmd --reload</span></span><br><span class=\"line\"><span class=\"attr\">success</span></span><br><span class=\"line\"><span class=\"meta\">[root@master</span> <span class=\"string\">service]# firewall-cmd --query-port=8202/tcp</span></span><br><span class=\"line\"><span class=\"attr\">yes</span></span><br></pre></td></tr></table></figure>\n\n<p>5.最后，对于微服务项目而言，由于有多个服务需要多个docker容器，可以将这多个容器由Docker Compose来统一配置，Docker Compose通过一个配置文件来管理多个Docker容器，在配置文件中，所有的容器通过services来定义，然后使用docker-compose脚本来启动，停止和重启应用，和应用中的服务以及所有依赖服务的容器，非常适合组合使用多个容器进行开发的场景。</p>\n","categories":["技术杂谈"],"tags":["Docker"]},{"title":"Docker应用","url":"/p/e1be.html","content":"<h2 id=\"简介\"><a href=\"#简介\" class=\"headerlink\" title=\"简介\"></a>简介</h2><ol>\n<li>基本概念、用途、核心思想 </li>\n<li>Docker的组成、架构、重要概念 </li>\n<li>Docker的安装  </li>\n<li>第一个Docker容器 </li>\n<li>运行Nginx镜像，并访问到Docker容器内部 </li>\n<li>制作自己的Docker容器，dockerfile实战  <h2 id=\"Docker的基本概念、用途、核心思想\"><a href=\"#Docker的基本概念、用途、核心思想\" class=\"headerlink\" title=\"Docker的基本概念、用途、核心思想\"></a>Docker的基本概念、用途、核心思想</h2><h3 id=\"Docker应用广泛\"><a href=\"#Docker应用广泛\" class=\"headerlink\" title=\"Docker应用广泛\"></a>Docker应用广泛</h3>◇京东618：15万个Docker实例，所有业务全部容器化；<br>◇蘑菇街等等<h3 id=\"Docker是什么？\"><a href=\"#Docker是什么？\" class=\"headerlink\" title=\"Docker是什么？\"></a>Docker是什么？</h3>◇ Docker是一个用来装程序及其环境的容器，属于Linux容器的 一种封装，提供简单易用的容器使用接口。它是目前最流行的 Linux容器解决方案。<br>◇在之前其实更多的是对一个程序进行打包，比如只把jar包上传到服务器上 ；但是Docker不仅打包程序，还将程序所需要的环境依赖一起打包；<br>◇通过简单的接口就可以和Docker进行交互，将程序及其环境放入Docker容器中；</li>\n</ol>\n<h3 id=\"为什么需要Docker\"><a href=\"#为什么需要Docker\" class=\"headerlink\" title=\"为什么需要Docker\"></a>为什么需要Docker</h3><p>◇没有Docker之前：环境配置的难题，如程序在本机可运行但到了其他主机无法正常运行；<br>◇虚拟机来解决配置难题，但是虚拟机资源占用很多，且虚拟机运行的是一整套操作系统；使用虚拟机之前还需要用户登录之类的步骤，而这些步骤对于我们应用程序运行来讲都不是必须的；且虚拟机启动较慢；<br>◇Docker的基础-Linux容器；Linux容器和虚拟机不一样，仅仅是对进程进行隔离，即在正常运行的进程外面套一个保护层；相比于虚拟机，Linux容器启动更快、占用资源更少，体积更小；</p>\n<h3 id=\"Docker的用途\"><a href=\"#Docker的用途\" class=\"headerlink\" title=\"Docker的用途\"></a>Docker的用途</h3><p>◇提供统一的环境<br>◇提供快速拓展、弹性伸缩的云服务；如当双十一来的时候需要快速扩展服务器；<br>◇防止其他用户的进程把服务器资源占用过多；比如说，在宿舍使用同一个共享网络时，一个在打游戏而另一个在看电影占了大部分网络资源，就会造成游戏网络卡；当服务器跑两个不同的服务时，一个服务陷入死循环，就有可能把CPU全部占满，或者是由于其他问题导致占取大量服务器资源，导致正常的服务无法运行；那么通过Docker能够很好的解决；每一个Docker运行一个服务，来进行服务间的隔离；</p>\n<h3 id=\"Docker的特点\"><a href=\"#Docker的特点\" class=\"headerlink\" title=\"Docker的特点\"></a>Docker的特点</h3><p>◇标准化：<br>运输方式（把程序和环境从一个机器运到另一个机器的方式）标准化<br>存储方式  (程序和环境的存储)标准化；<br>API接口标准化（不需要Tomcat等应用的命令，都标准化了）<br>◇灵活：即使是最复杂的应用也可以集装箱化；<br>◇轻量级：容器利用并共享主机内核；<br>◇便携式：可以在本地构建，部署到云，并放在任何地方运行；</p>\n<h3 id=\"Docker带来的好处\"><a href=\"#Docker带来的好处\" class=\"headerlink\" title=\"Docker带来的好处\"></a>Docker带来的好处</h3><p>◇开发团队得到和好处，可以完全的控制我们的运行环境；降低开发风险，因为开发的应用程序会在同一个镜像运行；<br>◇如下图，左侧是我们的容器对象，这个镜像会被推到镜像仓库中；测试人员会对程序进行各种测试，而这些测试都是基于同一个镜像实现的；<br><img src=\"/p/e1be/1636360800370-3412ac44-8665-43a1-90fa-d300f5a3f435.png\" class=\"lazyload\" data-srcset=\"/p/e1be/1636360800370-3412ac44-8665-43a1-90fa-d300f5a3f435.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"></p>\n<h2 id=\"Docker的组成、架构、重要概念\"><a href=\"#Docker的组成、架构、重要概念\" class=\"headerlink\" title=\"Docker的组成、架构、重要概念\"></a>Docker的组成、架构、重要概念</h2><p>◇整体架构图<br><img src=\"/p/e1be/1636361288481-65ced84d-6279-4a2c-a280-7041e21aaff7.png\" class=\"lazyload\" data-srcset=\"/p/e1be/1636361288481-65ced84d-6279-4a2c-a280-7041e21aaff7.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"><br>◇DOCKER_HOST可以理解为Docker服务，最左侧是指我们的客户端；客户端会连接到Docker服务并进行一系列操作；docker build、docker pull、docker run即前面所提到的API接口，利用这些统一的API去对Docker进行操作；最右侧就是我们的镜像仓库；这个仓库有各种各样的镜像；作为Docker服务，需要什么类型的镜像就从镜像仓库中获取，然后对镜像生成Container(容器)；<br>◇三者关系<br><img src=\"/p/e1be/1636361805251-ea9ee177-b3d3-48c4-be01-dae675544586.png\" class=\"lazyload\" data-srcset=\"/p/e1be/1636361805251-ea9ee177-b3d3-48c4-be01-dae675544586.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"></p>\n<h3 id=\"image镜像\"><a href=\"#image镜像\" class=\"headerlink\" title=\"image镜像\"></a>image镜像</h3><p>◇镜像本质是一系列文件；<br>◇Linux存储技术：联合文件系统，UnionFS；可以把不同的目录挂到同一个虚拟系统下；把多个文件夹或者是多个文件集合起来，通过这种方式实现文件的分层；<br>◇下图就描绘了Docker镜像分层的情况；最下面一层是操作系统的引导；Debian是一种操作系统，再往上就是我们自己的应用；<br><img src=\"/p/e1be/1636362797320-f690aa0e-ba68-4d00-aa37-fb5a05601273.png\" class=\"lazyload\" data-srcset=\"/p/e1be/1636362797320-f690aa0e-ba68-4d00-aa37-fb5a05601273.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"><br>◇上一层是以下一层作为基础的；最终多层共同组成了一个文件系统；不同的镜像可能有相同的底层(如操作系统，JDK)等；<br><img src=\"/p/e1be/1636362964075-09a20eb4-0ad4-4ef0-ae78-4ba9d2851874.png\" class=\"lazyload\" data-srcset=\"/p/e1be/1636362964075-09a20eb4-0ad4-4ef0-ae78-4ba9d2851874.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"></p>\n<h3 id=\"容器\"><a href=\"#容器\" class=\"headerlink\" title=\"容器\"></a>容器</h3><p>◇镜像类似于java中的类，而容器就是实例；<br>◇在java中有很多很多的类，比如说我们自己写的一个person类，有两个属性：姓名和年龄；在没有实例化类之前，这些属性都是固定的；如前面的镜像分层图：最上面一层有一个writeable，表示可写的；说明在镜像中只有最上层可写，其它层都是只读的；这是因为底层环境需要完整性，所以不可写，而对于一些环境的配置却需要修改，所以容器就在镜像的最上层创建了一个可读可写的系统；这样在程序运行的时候如果要写镜像里的文件就会写在最上层；比如说我修改了系统的一个文件，而此文件本身是属于Apache的，那么就有可能有两份这个文件(一个在最上层，一个在Apache环境层)；容器在找这个文件的时候，会先从最上层开始找，如果最上层没有就会往下一层找，找到之后由于之前对于Apache的文件进行了修改，所以实际上这个修改就是将该文件复制到最上层，那么最上层就有了一个已经修改过的副本；因此容器的这一层是可以修改的，而镜像是不可以修改的；只不过我们在把镜像运行起来(实例化)之后，上面会增加一个可读可写的层；<br>◇同一个镜像可以生成多个容器独立运行，而他们之间没有任何的干扰；</p>\n<h3 id=\"仓库\"><a href=\"#仓库\" class=\"headerlink\" title=\"仓库\"></a>仓库</h3><p>◇构建镜像的目的就是让别人的电脑拥有和自己本地项目一样的运行环境；仓库作为我们镜像传输的中转站；<br>◇Docker官方仓库<a href=\"https://hub.docker.com/\">hub.docker.com</a><br>◇仓库的备选方案：<a href=\"https://c.163yun.com/hub/#/m/home/\">https://c.163yun.com/hub/#/m/home/</a><br>◇仓库有公有和私有两种；</p>\n<h3 id=\"client和deamon\"><a href=\"#client和deamon\" class=\"headerlink\" title=\"client和deamon\"></a>client和deamon</h3><p>◇client：提供给用户一个终端，用户输入Docker提供的命令来管理本地或者远程的服务器；<br>◇deamon：服务端守护进程，接收Client发送的命令并执行相应的操作；</p>\n<h2 id=\"Docker的安装\"><a href=\"#Docker的安装\" class=\"headerlink\" title=\"Docker的安装\"></a>Docker的安装</h2><p>◇Linux (Centos)<br>◇安装命令：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">#进入管理员权限</span><br><span class=\"line\">su root</span><br><span class=\"line\">#查看版本</span><br><span class=\"line\">cat /etc/redhat-release</span><br><span class=\"line\">#配置国内yum源,wget是从网络上获取资源,/etc/yum.repos.d 是放入资源的地址,CentOS-Base.repo</span><br><span class=\"line\">是源的基础配置文件,将这个文件替换为来自国内阿里云的C7版本的配置文件;</span><br><span class=\"line\">wget -O /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repo</span><br><span class=\"line\">#清理原来的软件源</span><br><span class=\"line\">yum clean all</span><br><span class=\"line\">#读取新的软件源</span><br><span class=\"line\">yum makecache</span><br><span class=\"line\">#卸载旧版本,下面全部复制即可</span><br><span class=\"line\">yum remove docker \\</span><br><span class=\"line\">                  docker-client \\</span><br><span class=\"line\">                  docker-client-latest \\</span><br><span class=\"line\">                  docker-common \\</span><br><span class=\"line\">                  docker-latest \\</span><br><span class=\"line\">                  docker-latest-logrotate \\</span><br><span class=\"line\">                  docker-logrotate \\</span><br><span class=\"line\">                  docker-engine</span><br><span class=\"line\">#更新yum</span><br><span class=\"line\">yum check-update #查看哪些需要更新</span><br><span class=\"line\">yum update #执行更新</span><br><span class=\"line\">#安装Docker所需的软件包</span><br><span class=\"line\">yum install -y yum-utils \\</span><br><span class=\"line\">  device-mapper-persistent-data \\</span><br><span class=\"line\">  lvm2</span><br><span class=\"line\">#使用以下命令来设置稳定的存储库</span><br><span class=\"line\">sudo yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span><br><span class=\"line\">#查看Docker可以安装的版本</span><br><span class=\"line\">yum list docker-ce --showduplicates | sort -r</span><br><span class=\"line\">#安装指定的版本</span><br><span class=\"line\">yum install docker-ce-18.09.0 docker-ce-cli-18.09.0 containerd.io</span><br><span class=\"line\">#Docker是服务器----客户端架构。命令行运行docker命令的时候，需要本机有 Docker 服务。用下面的命令启动</span><br><span class=\"line\">systemctl start docker #systemctl是linux中关于服务的命令,执行后开启Docker服务而不会有提示</span><br><span class=\"line\">#安装完成后，运行下面的命令，验证是否安装成功</span><br><span class=\"line\">docker version #查看版本</span><br><span class=\"line\">#或者</span><br><span class=\"line\">docker info </span><br></pre></td></tr></table></figure>\n<h2 id=\"第一个Docker容器\"><a href=\"#第一个Docker容器\" class=\"headerlink\" title=\"第一个Docker容器\"></a>第一个Docker容器</h2><p>◇下载镜像：docker pull [OPTIONS] NAME[:TAG]  //TAG代表一个标记；<br>◇docker images [OPTIONS] [REPOSITORY[:TAG]] //显示本机有哪些镜像,[]代表可选项<br>◇执行docker pull hello-world命令</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">Using <span class=\"keyword\">default</span> tag: latest   <span class=\"comment\">//使用默认的tag</span></span><br><span class=\"line\">latest: Pulling from library/hello-world <span class=\"comment\">//路径</span></span><br><span class=\"line\">2db29710123e: Pull complete </span><br><span class=\"line\">Digest: sha256:37a0b92b08d4919615c3ee023f7ddb068d12b8387475d64c622ac30f45c29c51</span><br><span class=\"line\">Status: Downloaded newer image <span class=\"keyword\">for</span> hello-world:latest</span><br></pre></td></tr></table></figure>\n<p>◇执行docker images</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE</span><br><span class=\"line\">hello-world         latest              feb5d9fea6a5        <span class=\"number\">6</span> weeks ago         <span class=\"number\">13.</span>3kB</span><br></pre></td></tr></table></figure>\n<p>◇运行镜像：docker run     [OPTIONS] IMAGE [COMMAND] [ARG…]<br>◇执行命令 docekr run hello-world</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">Hello from Docker!</span><br><span class=\"line\">This message shows that your installation appears to be working correctly.</span><br><span class=\"line\"></span><br><span class=\"line\">To generate <span class=\"keyword\">this</span> message, Docker took the following steps:</span><br><span class=\"line\"> <span class=\"number\">1.</span> The Docker client contacted the Docker daemon.</span><br><span class=\"line\"> <span class=\"number\">2.</span> The Docker daemon pulled the <span class=\"string\">&quot;hello-world&quot;</span> image from the Docker Hub.</span><br><span class=\"line\">    (amd64)</span><br><span class=\"line\"> <span class=\"number\">3.</span> The Docker daemon created a <span class=\"keyword\">new</span> container from that image which runs the</span><br><span class=\"line\">    executable that produces the output you are currently reading.</span><br><span class=\"line\"> <span class=\"number\">4.</span> The Docker daemon streamed that output to the Docker client, which sent it</span><br><span class=\"line\">    to your terminal.</span><br><span class=\"line\"></span><br><span class=\"line\">To <span class=\"keyword\">try</span> something more ambitious, you can run an Ubuntu container with:</span><br><span class=\"line\"> $ docker run -it ubuntu bash</span><br><span class=\"line\"></span><br><span class=\"line\">Share images, automate workflows, and more with a free Docker ID:</span><br><span class=\"line\"> https:<span class=\"comment\">//hub.docker.com/</span></span><br><span class=\"line\"></span><br><span class=\"line\">For more examples and ideas, visit:</span><br><span class=\"line\"> https:<span class=\"comment\">//docs.docker.com/get-started/</span></span><br></pre></td></tr></table></figure>\n<p>◇Client 执行docker run hello-world命令，Docker daemon收到命令后就会在images中找到hello-world这个镜像（前提是已经从仓库中将该镜像下载到本地了）,然后生成实例容器，最后将hello-world的信息打印到终端；</p>\n<h2 id=\"运行Nginx镜像访问到Docker容器内部\"><a href=\"#运行Nginx镜像访问到Docker容器内部\" class=\"headerlink\" title=\"运行Nginx镜像访问到Docker容器内部\"></a>运行Nginx镜像访问到Docker容器内部</h2><p>◇前台，后台；<br>◇拉取Nginx镜像: docker pull hub.c.163.com/library/nginx:1.13.0<br>◇运行镜像：docker run hub.c.163.com/library/nginx：1.13.0<br>◇在另一个控制台中，查看容器列表：docker ps<br>◇如果要停止运行镜像，则按Ctrl+C；或者：docker stop 容器ID<br>◇后台运行Nginx镜像：docker run -d hub.c.163.com/library/nginx:1.13.0<br>◇另一个终端，进入容器内部：docker exec [OPTIONS] CONTAINER COMMAND [ARG…]<br>// i的意思是让我们的容器输入有效，t表示分配一个终端，那么it的意思就是把容器内部的终端映射到我们当前的终端，这样我们在这个窗口输入的命令就会到创建容器的那个窗口去；后面跟着的是容器id，而且容器的id不一定要全部输入，一般输入前几位能够区分其他容器就行了；bash对应COMMAND，意思是启动终端，执行以后会发现开头的提示符已经改变；变为root@a5cef18b0d8f:/# ，说明进入了容器内部；<br>eg：docker exec -it a5cef18b0d8f bash<br>◇进入容器内部后就可以执行以下命令，如 touch 1//新建名为1的文件； ls查看文件列表；<br>◇root@a5cef18b0d8f:/# which nginx //查看nginx的目录<br>◇exit //退出并关闭容器</p>\n<h2 id=\"Docker的网络模式\"><a href=\"#Docker的网络模式\" class=\"headerlink\" title=\"Docker的网络模式\"></a>Docker的网络模式</h2><h3 id=\"三种模式\"><a href=\"#三种模式\" class=\"headerlink\" title=\"三种模式\"></a>三种模式</h3><p>◇Bridge；最常用的一种模式；相当于在Docker容器里面和外面的宿主机搭建了一座桥，容器和外部是独立的，使用这座桥进行连接；<br>◇Host；这种模式下容器不会获得独立的网络，而是和主机使用同一个网络；<br>◇None；即无网络连接</p>\n<h3 id=\"实操\"><a href=\"#实操\" class=\"headerlink\" title=\"实操\"></a>实操</h3><p>◇端口映射：对于Bridge模式，有可能内部和外部的端口不一致，这时候就需要进行端口映射；<br>◇访问nginx内部；<br>◇docker run -d -p 8088:80 hub.c.163.com/library/nginx:1.13.0  //表示在本机的8080端口映射到容器的80端口<br>◇然后ps查看容器列表时可以看到PORTS将映射关系也打印了出来；<br>◇在宿主机上查看端口是否生效了: netstat -na|grep 8088<br>◇在浏览器上访问ip地址+8088如果是阿里云服务器的话还需要进行网络安全组的配置才能进行访问；即添加安全组规则，方向：入方向；端口范围：8088；授权对象：0.0.0.0/0(表示所有的IP都可以访问)；其他均默认<br>◇访问成功页面：<br><img src=\"/p/e1be/1636462684735-79b1a320-b0ef-44b9-a8a9-327d4a6e604f.png\" class=\"lazyload\" data-srcset=\"/p/e1be/1636462684735-79b1a320-b0ef-44b9-a8a9-327d4a6e604f.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"><br>◇docker run -d -P hub.c.163.com/library/nginx:1.13.0//这里会吧容器内部的所有端口都进行映射，即随机产生一个宿主机的端口来对容器内部端口进行映射；当然Nginx只有80一个端口；</p>\n<h2 id=\"制作自己的Docker容器\"><a href=\"#制作自己的Docker容器\" class=\"headerlink\" title=\"制作自己的Docker容器\"></a>制作自己的Docker容器</h2><h3 id=\"dockerfile作用\"><a href=\"#dockerfile作用\" class=\"headerlink\" title=\"dockerfile作用\"></a>dockerfile作用</h3><p>◇dockerfile就是用来告诉docker我们要怎么制作镜像，制作镜像的每一个步骤是什么；即dockerfile是用来配置镜像的；我们制作镜像往往是在已有的镜像上去添砖加瓦，加上个性化的配置形成我们自己的镜像；</p>\n<h3 id=\"使用dockerfile的好处\"><a href=\"#使用dockerfile的好处\" class=\"headerlink\" title=\"使用dockerfile的好处\"></a>使用dockerfile的好处</h3><p>◇使用dockerfile来描述我们的环境有以下好处：可以把文件放在版本控制之下，这样我们对于环境所做的修改就可以被追踪到，总是知道一个程序运行在什么样的环境之下；而且，有了这个dockerfile之后，我们可以知道程序的运行需要什么样的环境，里面装了哪些软件，怎么配置的；通过dockerfile来维护环境而不是自己配置的话，可以保证该文件始终是新的，这样如果有新的同事加入后，只需要看这个文件就了解到项目的配置情况；</p>\n<h3 id=\"写自己的dockerfile\"><a href=\"#写自己的dockerfile\" class=\"headerlink\" title=\"写自己的dockerfile\"></a>写自己的dockerfile</h3><p>◇FROM alpine:latest //创建一个新的镜像，FROM后是一个基础的镜像；alpine是专门针对Docker来做的一个极小型的Linux环境；<br>◇MAINTAINER lcg// 表示这个镜像的维护者；<br>◇CMD echo ‘hello my dockerfile’//终端中打印’’里的语句；<br>◇具体步骤</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">cd /root</span><br><span class=\"line\">touch Dockerfile</span><br><span class=\"line\">vim Dockerfile</span><br><span class=\"line\">在Dockerfile中： 按i进入编辑模式</span><br><span class=\"line\">FROM alpine:latest</span><br><span class=\"line\">MAINTAINER lcg</span><br><span class=\"line\">CMD echo <span class=\"string\">&#x27;hello lcg&#x27;</span></span><br><span class=\"line\">Esc退出编辑模式；键入:wq 保存;</span><br><span class=\"line\">cat Docekrfile 查看文件</span><br><span class=\"line\"><span class=\"comment\">//下面制作镜像;-t指定名字; .代表就在当前路径下创建</span></span><br><span class=\"line\">docker build -t hello_docker .</span><br><span class=\"line\">docker images<span class=\"comment\">//查看镜像是否创建成功</span></span><br></pre></td></tr></table></figure>\n<p>◇运行镜像 docker run hello_docker 查看终端是否打印信息；</p>\n","categories":["分布式与微服务"],"tags":["Docker"]},{"title":"IDEA开发工具入门","url":"/p/5708.html","content":"<h2 id=\"导学\"><a href=\"#导学\" class=\"headerlink\" title=\"导学\"></a>导学</h2><p>◇IntelliJ IDEA开发工具<br>![image.png](IntelliJ IDEA开发工具入门/1627031307362-df459f62-a437-412b-98d4-032af338ced4.png)<br>◇JDBC<br>![image.png](IntelliJ IDEA开发工具入门/1627031379177-38c40c23-926b-4f28-b27e-d9b05895bdf0.png)</p>\n<p>◇数据库连接池与DBUtils<br>![image.png](IntelliJ IDEA开发工具入门/1627031423402-2d5357f4-8868-460e-bdf3-e131bba797d5.png)</p>\n<h2 id=\"IDEA开发工具入门\"><a href=\"#IDEA开发工具入门\" class=\"headerlink\" title=\"IDEA开发工具入门\"></a>IDEA开发工具入门</h2><h3 id=\"IntelliJ-IDEA\"><a href=\"#IntelliJ-IDEA\" class=\"headerlink\" title=\"IntelliJ IDEA\"></a>IntelliJ IDEA</h3><p>◇IDEA全称IntelliJ IDEA ,是Java编程公认的最好的IDE<br>◇IDEA提供了大量的智能工具，例如语法提示，代码分析，格式化等<br>◇IDEA最核心的特色是它的快捷键，利用快捷键可以极大提高开发效率</p>\n<h3 id=\"IDEA的特点\"><a href=\"#IDEA的特点\" class=\"headerlink\" title=\"IDEA的特点\"></a>IDEA的特点</h3><p>◇沉浸式开发体验<br>◇超强的快捷键体系<br>◇智能的代码助手<br>◇全栈开发环境<br>◇丰富的模板支持</p>\n<h2 id=\"IDEA快捷键\"><a href=\"#IDEA快捷键\" class=\"headerlink\" title=\"IDEA快捷键\"></a>IDEA快捷键</h2><h3 id=\"IDEA窗口快捷键\"><a href=\"#IDEA窗口快捷键\" class=\"headerlink\" title=\"IDEA窗口快捷键\"></a>IDEA窗口快捷键</h3><p>◇Find Action即模糊查询所有的功能<br>![image.png](IntelliJ IDEA开发工具入门/1627034483641-291f75af-d7ad-48a5-a4d5-fd4466b7a384.png)</p>\n<h3 id=\"代码快捷键\"><a href=\"#代码快捷键\" class=\"headerlink\" title=\"代码快捷键\"></a>代码快捷键</h3><p>![image.png](IntelliJ IDEA开发工具入门/1627035810111-7868b20d-b5b8-44c3-b520-f7fe08cb09e9.png)<br>![image.png](IntelliJ IDEA开发工具入门/1627035825273-6cfd6292-c04a-4cfa-ac9a-38797269ca46.png)</p>\n<h3 id=\"代码快速定位\"><a href=\"#代码快速定位\" class=\"headerlink\" title=\"代码快速定位\"></a>代码快速定位</h3><p>![image.png](IntelliJ IDEA开发工具入门/1627045126097-c1703455-f245-4358-b636-0bebf19ac62e.png)</p>\n<h3 id=\"Live-Template\"><a href=\"#Live-Template\" class=\"headerlink\" title=\"Live Template\"></a>Live Template</h3><p>◇也可以自定义，自定义方法为：settings-&gt;Editor-&gt;Live Template-&gt;’+’ 2-&gt;’+’1;<br>​</p>\n<p>![image.png](IntelliJ IDEA开发工具入门/1627045672656-22d16bcf-8e69-4516-9915-68c68efec231.png)</p>\n<h3 id=\"运行与打包\"><a href=\"#运行与打包\" class=\"headerlink\" title=\"运行与打包\"></a>运行与打包</h3><p>◇打包方法：File-&gt;Project Structure-&gt;Artifacts-&gt;’+’ -&gt;JAR-&gt;empty-&gt;Create Manifest(定义入口类)-&gt;默认选中-&gt;OK-&gt;选择入口类-&gt;将右侧的compile output双击添加到左侧(即将编译后的类打入JAR包)-&gt;OK-&gt;.MF文件创建成功-&gt;Build-&gt;Build Artifacts -&gt;Action:Bulid-&gt;生成jar包<br>在生成的jar包上右键选中Open in File path( Show in explore在文件管理器中打开)-&gt;在地址栏中删掉地址然后直接输入cmd进入命令行(会自动定位到目录地址)-&gt;键入java -jar 文件名.jar<br>![image.png](IntelliJ IDEA开发工具入门/1627046432804-188ee97a-c21c-4cd5-b9b4-fa4f47c59270.png)</p>\n<h3 id=\"其他快捷键\"><a href=\"#其他快捷键\" class=\"headerlink\" title=\"其他快捷键\"></a>其他快捷键</h3><p>◇查看方法返回类型：Ctrl+q<br>◇查看方法的具体实现：Ctrl+Alt<br>◇方法或类注释：在一个方法或类的开头，输入/**，然后按回车,自动根据参数和返回值生成注释模板</p>\n<h2 id=\"IDEA开发Web应用\"><a href=\"#IDEA开发Web应用\" class=\"headerlink\" title=\"IDEA开发Web应用\"></a>IDEA开发Web应用</h2><p>◇NewProjece-&gt; Java Enterprise -&gt;服务器选择Tomcat -&gt;勾选WebApplication 3.1-&gt;勾选create web.xml-&gt;Next-&gt;输入工程名称-&gt;finish;<br>◇如何更改URL的上下文路径: 点击Tomcat下拉框-&gt;Edit Configurations -&gt;Deployment-&gt;Application context-&gt;修改-&gt;OK<br>◇热部署(即修改项目后在浏览器能直接查看，只支持在DeBug模式下)：点击Tomcat下拉框-&gt;Edit Configurations -&gt;Server-&gt;On frame deactivation-&gt;Update classes and resources-&gt;OK<br>◇打包Web项目：File-&gt;Project Structure-&gt;Artifacts-&gt;’+’Web Application:Archive-&gt;Empty-&gt;双击compile output添加到左侧war包中-&gt;双击Web facet resource将静态资源放入左侧-&gt;OK-&gt;Build-&gt;Build Artifact -&gt;选择打包文件-&gt;Build -&gt;复制.war文件将其放到Tomcat实际运行环境的webapps目录下-&gt;在Tomcat/bin目录中双击startup.bat文件启动Tomcat-&gt;浏览器输入路径即可<br>![image.png](IntelliJ IDEA开发工具入门/1627096260390-f697c0eb-8644-4516-bc22-fa9ba432d2e0.png)</p>\n","categories":["Java数据库","Java数据库开发基础"],"tags":["开发"]},{"title":"JDBC入门","url":"/p/8791.html","content":"<h2 id=\"课程介绍\"><a href=\"#课程介绍\" class=\"headerlink\" title=\"课程介绍\"></a>课程介绍</h2><p>◇JDBC快速入门<br>◇精讲JDBC开发细节<br>◇连接池与JDBC进阶使用  </p>\n<h2 id=\"主要知识点\"><a href=\"#主要知识点\" class=\"headerlink\" title=\"主要知识点\"></a>主要知识点</h2><p>◇JDBC使用步骤<br>◇数据库查询方法<br>◇数据库写入方法<br>◇SQL注入攻击的应对<br>◇连接池的使用<br>◇Apache Commons DBUtils  </p>\n<h2 id=\"什么是JDBC\"><a href=\"#什么是JDBC\" class=\"headerlink\" title=\"什么是JDBC\"></a>什么是JDBC</h2><p>◇Java数据库连接-Java DataBase Connectivity<br>◇JDBC可让Java通过程序操作关系型数据库<br>◇JDBC基于驱动程序实现与数据库的连接与操作  </p>\n<h2 id=\"什么是驱动程序\"><a href=\"#什么是驱动程序\" class=\"headerlink\" title=\"什么是驱动程序\"></a>什么是驱动程序</h2><p><img src=\"/p/8791/1627277427089-85c466be-a249-4635-97bc-01d3aadddf7e.png\" class=\"lazyload\" data-srcset=\"/p/8791/1627277427089-85c466be-a249-4635-97bc-01d3aadddf7e.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"><br> ◇JDBC驱动程序<br><img src=\"/p/8791/1627277734522-eff71526-c749-4218-918b-9c681fa21208.png\" class=\"lazyload\" data-srcset=\"/p/8791/1627277734522-eff71526-c749-4218-918b-9c681fa21208.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"></p>\n<h2 id=\"JDBC的优点\"><a href=\"#JDBC的优点\" class=\"headerlink\" title=\"JDBC的优点\"></a>JDBC的优点</h2><p>◇统一的API,提供一致的开发过程<br>◇易于学习,容易上手,代码结构稳定<br>◇功能强大,执行效率高,可处理海量数据  </p>\n<h2 id=\"JDBC开发简要流程\"><a href=\"#JDBC开发简要流程\" class=\"headerlink\" title=\"JDBC开发简要流程\"></a>JDBC开发简要流程</h2><p><strong>0.Navicat创建数据库</strong>：字符集采用utf8mb4</p>\n<h3 id=\"1-加载并注册JDBC驱动\"><a href=\"#1-加载并注册JDBC驱动\" class=\"headerlink\" title=\"1. 加载并注册JDBC驱动\"></a>1. 加载并注册JDBC驱动</h3><p>◇将MySQL驱动的jar包复制到工程的lib目录-&gt;File-&gt;Project Structure-&gt;Modules(模块)-&gt;Dependencies(依赖)-&gt;’+’-&gt;1-&gt;选择lib目录下的jar包，OK-&gt;勾选Export-&gt;OK</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\">Class.forName(&quot;com.mysql.cj.jdbc.Driver&quot;);</span><br></pre></td></tr></table></figure>\n<h3 id=\"2-创建数据库连接\"><a href=\"#2-创建数据库连接\" class=\"headerlink\" title=\"2. 创建数据库连接\"></a>2. 创建数据库连接</h3><figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\">&quot;jdbc:mysql://localhost:3306/gamest?useSSL=false&amp;useUnicode=true&amp;characterEncoding=UTF-8&amp;serverTimezone=Asia/Shanghai&quot;,</span><br><span class=\"line\">               &quot;root&quot;,&quot;www.LCG.com&quot;</span><br></pre></td></tr></table></figure>\n<h3 id=\"3-创建Statement对象\"><a href=\"#3-创建Statement对象\" class=\"headerlink\" title=\"3. 创建Statement对象\"></a>3. 创建Statement对象</h3><figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\">Statement stmt <span class=\"operator\">=</span> conn.createStatement();</span><br><span class=\"line\">        ResultSet rs <span class=\"operator\">=</span> stmt.executeQuery(&quot;select * from employee&quot;);</span><br></pre></td></tr></table></figure>\n<h3 id=\"4-遍历查询结果\"><a href=\"#4-遍历查询结果\" class=\"headerlink\" title=\"4. 遍历查询结果\"></a>4. 遍历查询结果</h3><figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\">while (rs.next()) &#123;</span><br><span class=\"line\">         <span class=\"type\">Integer</span> eno <span class=\"operator\">=</span> rs.getInt(<span class=\"number\">1</span>);<span class=\"operator\">/</span><span class=\"operator\">/</span>获取当前行第一列的数据（数据为<span class=\"type\">int</span>型）,按位置</span><br><span class=\"line\">         String ename <span class=\"operator\">=</span> rs.getString(&quot;ename&quot;);<span class=\"operator\">/</span><span class=\"operator\">/</span>获取ename列的数据（数据为String型），按名称</span><br><span class=\"line\">         <span class=\"type\">Float</span> salary <span class=\"operator\">=</span> rs.getFloat(&quot;salary&quot;);</span><br><span class=\"line\">         String dname <span class=\"operator\">=</span> rs.getString(&quot;dname&quot;);</span><br><span class=\"line\">         System.out.println(dname <span class=\"operator\">+</span> &quot;-&quot; <span class=\"operator\">+</span> eno <span class=\"operator\">+</span> &quot;-&quot; <span class=\"operator\">+</span> ename <span class=\"operator\">+</span> &quot;-&quot; <span class=\"operator\">+</span> salary);</span><br></pre></td></tr></table></figure>\n<h3 id=\"5-关闭连接-释放资源\"><a href=\"#5-关闭连接-释放资源\" class=\"headerlink\" title=\"5. 关闭连接,释放资源\"></a>5. 关闭连接,释放资源</h3><figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\">if (conn<span class=\"operator\">!=</span><span class=\"keyword\">null</span><span class=\"operator\">&amp;&amp;</span>conn.isClosed()<span class=\"operator\">=</span><span class=\"operator\">=</span><span class=\"literal\">false</span>)&#123;<span class=\"operator\">/</span><span class=\"operator\">/</span>防止空指针异常</span><br><span class=\"line\">         <span class=\"operator\">/</span><span class=\"operator\">/</span><span class=\"number\">5.</span> 关闭连接,释放资源</span><br><span class=\"line\">         conn.close();<span class=\"operator\">/</span><span class=\"operator\">/</span>如果conn为空，则会出现空指针异常，如执行<span class=\"number\">1.</span>就报错后，conn为空&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"JDBC开发详细流程\"><a href=\"#JDBC开发详细流程\" class=\"headerlink\" title=\"JDBC开发详细流程\"></a>JDBC开发详细流程</h2><h3 id=\"如何获取JDBC驱动Jar\"><a href=\"#如何获取JDBC驱动Jar\" class=\"headerlink\" title=\"如何获取JDBC驱动Jar\"></a>如何获取JDBC驱动Jar</h3><p>◇<a href=\"https://www.mysql.com/cn/products/connector/\">Mysql官网下载</a>MySQL Connectors -&gt;JDBC Driver for MySQL-&gt;由于是跨平台的，选择任意版本即可Ubuntu Linux-&gt;直接下载</p>\n<h3 id=\"创建数据库连接代码\"><a href=\"#创建数据库连接代码\" class=\"headerlink\" title=\"创建数据库连接代码\"></a>创建数据库连接代码</h3><figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\">String dbDriver <span class=\"operator\">=</span> &quot;com.mysql.cj.jdbc.Driver&quot;; <span class=\"operator\">/</span><span class=\"operator\">/</span>JDBC驱动类</span><br><span class=\"line\">String dbURL <span class=\"operator\">=</span> &quot;jdbc:mysql://localhost:3306/gamest&quot; ; <span class=\"operator\">/</span><span class=\"operator\">/</span>连接字</span><br><span class=\"line\">符串</span><br><span class=\"line\">String dbUsername <span class=\"operator\">=</span> &quot;root&quot;; <span class=\"operator\">/</span><span class=\"operator\">/</span>数据库用户名</span><br><span class=\"line\">String dbPassword <span class=\"operator\">=</span> &quot;123456&quot;; <span class=\"operator\">/</span><span class=\"operator\">/</span>数据库密码</span><br><span class=\"line\"><span class=\"operator\">/</span><span class=\"operator\">/</span><span class=\"number\">1.</span>加载并初始化JDBC驱动</span><br><span class=\"line\">Class.forName(dbDriver);</span><br><span class=\"line\"><span class=\"operator\">/</span><span class=\"operator\">/</span><span class=\"number\">2.</span>创建数据库连接</span><br><span class=\"line\">Connection connection <span class=\"operator\">=</span> DriverManager.getConnection(dbURL, dbUsername, dbPassword);</span><br></pre></td></tr></table></figure>\n<h3 id=\"Class-forName的作用\"><a href=\"#Class-forName的作用\" class=\"headerlink\" title=\"Class.forName的作用\"></a>Class.forName的作用</h3><p>◇Class.forName用于加载指定的JDBC驱动类<br>◇Class.forName本质是通知JDBC注册这个驱动类<br>◇驱动由数据库厂商自行开发,连接字符串也不同  </p>\n<h3 id=\"数据库与连接字符串\"><a href=\"#数据库与连接字符串\" class=\"headerlink\" title=\"数据库与连接字符串\"></a>数据库与连接字符串</h3><p><img src=\"/p/8791/1627288444741-e2147775-ca39-4693-88c7-0f545847efb5.png\" class=\"lazyload\" data-srcset=\"/p/8791/1627288444741-e2147775-ca39-4693-88c7-0f545847efb5.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"></p>\n<h3 id=\"DriverManager\"><a href=\"#DriverManager\" class=\"headerlink\" title=\"DriverManager\"></a>DriverManager</h3><p>◇DriverManager用于注册/管理JDBC驱动程序<br>◇DriverManager.getConnection(连接字符串,用户名,密码)<br>◇返回值Connection对象,对应数据库的物理网络连接  </p>\n<h3 id=\"Connection对象\"><a href=\"#Connection对象\" class=\"headerlink\" title=\"Connection对象\"></a>Connection对象</h3><p>◇Connection对象用于JDBC与数据库的网络通信对象<br>◇java.sql.Connection是一个接口，具体由驱动厂商实现<br>◇所有数据库的操作都建立在Connection基础上<br><img src=\"/p/8791/1627311314818-03c42582-5f5a-4798-8a3a-8062442ab49f.png\" class=\"lazyload\" data-srcset=\"/p/8791/1627311314818-03c42582-5f5a-4798-8a3a-8062442ab49f.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"></p>\n<h3 id=\"MySQL连接字符串\"><a href=\"#MySQL连接字符串\" class=\"headerlink\" title=\"MySQL连接字符串\"></a>MySQL连接字符串</h3><p>◇格式: jdbc:mysql://[主机ip][:端口]/数据库名?参数列表<br>◇主机ip与端口是可选设置,默认值为127.0.0.1与3306<br>◇参数列表采用url编码,格式:参数1=值1&amp;参数2=值2&amp;…  </p>\n<h3 id=\"MySQL连接字符串常用参数\"><a href=\"#MySQL连接字符串常用参数\" class=\"headerlink\" title=\"MySQL连接字符串常用参数\"></a>MySQL连接字符串常用参数</h3><p><img src=\"/p/8791/1627311449343-e094739a-3298-4553-8e3e-ad1ee903c721.png\" class=\"lazyload\" data-srcset=\"/p/8791/1627311449343-e094739a-3298-4553-8e3e-ad1ee903c721.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"></p>\n<h3 id=\"连接数据库的常见问题\"><a href=\"#连接数据库的常见问题\" class=\"headerlink\" title=\"连接数据库的常见问题\"></a>连接数据库的常见问题</h3><p>◇ClassNotFoundException - 类未找到异常<br>◇Connection refuse - 数据库连接被拒绝异常<br>◇Access denied for user - 用户名与密码错误异常  </p>\n<h2 id=\"数据库查询操作\"><a href=\"#数据库查询操作\" class=\"headerlink\" title=\"数据库查询操作\"></a>数据库查询操作</h2><p>◇部分代码</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"operator\">/</span><span class=\"operator\">/</span><span class=\"number\">4.</span> 遍历查询结果</span><br><span class=\"line\">            <span class=\"comment\">/*rs.next()返回布尔值，代表是否存在下一条记录，若有，返回true</span></span><br><span class=\"line\"><span class=\"comment\">            同时提取下一条记录；如果没有，返回false，循环就会停止*/</span></span><br><span class=\"line\">         while (rs.next())&#123;</span><br><span class=\"line\">           <span class=\"type\">Integer</span> eno <span class=\"operator\">=</span> rs.getInt(<span class=\"number\">1</span>);<span class=\"operator\">/</span><span class=\"operator\">/</span>JDBC中字段索引从<span class=\"number\">1</span>开始</span><br><span class=\"line\">           String ename <span class=\"operator\">=</span> rs.getString(&quot;ename&quot;);<span class=\"operator\">/</span><span class=\"operator\">/</span>获取ename列的数据（数据为String型），按名称</span><br><span class=\"line\">           <span class=\"type\">Float</span> salary <span class=\"operator\">=</span> rs.getFloat(&quot;salary&quot;);</span><br><span class=\"line\">           String dname <span class=\"operator\">=</span> rs.getString(&quot;dname&quot;);</span><br><span class=\"line\">           System.out.println(dname <span class=\"operator\">+</span> &quot;-&quot; <span class=\"operator\">+</span> eno <span class=\"operator\">+</span> &quot;-&quot; <span class=\"operator\">+</span> ename <span class=\"operator\">+</span> &quot;-&quot; <span class=\"operator\">+</span> salary);</span><br><span class=\"line\">           &#125;</span><br><span class=\"line\">         <span class=\"operator\">/</span><span class=\"operator\">/</span><span class=\"number\">5.</span>关闭连接，释放资源</span><br><span class=\"line\">            try &#123;</span><br><span class=\"line\">                if(rs<span class=\"operator\">!=</span><span class=\"keyword\">null</span>)&#123;</span><br><span class=\"line\">                    rs.close();</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125; catch (<span class=\"keyword\">SQLException</span> e) &#123;</span><br><span class=\"line\">                e.printStackTrace();</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            try &#123;</span><br><span class=\"line\">                if(stmt<span class=\"operator\">!=</span><span class=\"keyword\">null</span>)&#123;</span><br><span class=\"line\">                    stmt.close();</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125; catch (<span class=\"keyword\">SQLException</span> e) &#123;</span><br><span class=\"line\">                e.printStackTrace();</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            try &#123;</span><br><span class=\"line\">                if(conn<span class=\"operator\">!=</span><span class=\"keyword\">null</span><span class=\"operator\">&amp;&amp;</span><span class=\"operator\">!</span>conn.isClosed())&#123;<span class=\"operator\">/</span><span class=\"operator\">/</span>不为空并且没有关闭</span><br><span class=\"line\">                    conn.close();</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125; catch (<span class=\"keyword\">SQLException</span> e) &#123;</span><br><span class=\"line\">                e.printStackTrace();</span><br><span class=\"line\">            &#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"Statement对象\"><a href=\"#Statement对象\" class=\"headerlink\" title=\"Statement对象\"></a>Statement对象</h3><p>◇Statement是用于执行SQL的工具<br>◇查询方法: ResultSet executeQuery(String sql)<br>◇注意: sql参数必须是SELECT 查询SQL语句 </p>\n<h3 id=\"ResultSet对象\"><a href=\"#ResultSet对象\" class=\"headerlink\" title=\"ResultSet对象\"></a>ResultSet对象</h3><p>◇ResultSet结果集对象,保存查询结果<br>◇ResultSet采用迭代方式逐行获取每一行表数据<br>◇每一次迭代,使用ResultSet对象的getXXX()方法获取列数据  </p>\n<h2 id=\"SQL注入攻击\"><a href=\"#SQL注入攻击\" class=\"headerlink\" title=\"SQL注入攻击\"></a>SQL注入攻击</h2><p>◇SQL注入攻击是指利用SQL漏洞越权获取数据的黑客行为<br>◇SQL注入攻击根源是未对原始SQL中的敏感字符做特殊处理<br>◇解决方法:放弃Statement改用PreparedStatement处理SQL  </p>\n<h3 id=\"PreparedStatement\"><a href=\"#PreparedStatement\" class=\"headerlink\" title=\"PreparedStatement\"></a>PreparedStatement</h3><p>◇PreparedStatement 预编译Statement是Statement接口的子接口<br>◇PreparedStatement对SQL进行参数化,预防SQL注入攻击<br>◇PreparedStatement比Statement执行效率更高<br>◇原始代码  </p>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"operator\">/</span><span class=\"operator\">/</span> 存在<span class=\"keyword\">SQL</span>注入风险</span><br><span class=\"line\"><span class=\"operator\">/</span><span class=\"operator\">/</span> pdname值为<span class=\"string\">&#x27; or 1=1 or 1=&#x27;</span>时,所有筛选条件均失效</span><br><span class=\"line\"><span class=\"operator\">/</span><span class=\"operator\">/</span> <span class=\"keyword\">SQL</span>: <span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> employee <span class=\"keyword\">where</span> pdname<span class=\"operator\">=</span><span class=\"string\">&#x27;&#x27;</span> <span class=\"keyword\">or</span> <span class=\"number\">1</span><span class=\"operator\">=</span><span class=\"number\">1</span> <span class=\"keyword\">or</span> <span class=\"number\">1</span><span class=\"operator\">=</span><span class=\"string\">&#x27;&#x27;</span> ;单引号没有处理</span><br><span class=\"line\">String <span class=\"keyword\">sql</span> <span class=\"operator\">=</span> &quot;select * from employee where dname=&#x27;&quot; <span class=\"operator\">+</span> pdname <span class=\"operator\">+</span> &quot;&#x27;&quot; ;</span><br><span class=\"line\">Statement stmt <span class=\"operator\">=</span> conn.createStatement();</span><br><span class=\"line\">ResultSet rs <span class=\"operator\">=</span> stmt.executeQuery(<span class=\"keyword\">sql</span>);</span><br><span class=\"line\">while(rs.next())&#123;</span><br><span class=\"line\">....</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p> ◇PreparedStatement  </p>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"operator\">/</span><span class=\"operator\">/</span> 利用PreparedStatement预防<span class=\"keyword\">SQL</span>注入风险</span><br><span class=\"line\"><span class=\"operator\">/</span><span class=\"operator\">/</span> 当dname值为<span class=\"string\">&#x27; or 1=1 or 1=&#x27;</span>时 , 查询不到任何结果</span><br><span class=\"line\"><span class=\"operator\">/</span><span class=\"operator\">/</span> <span class=\"keyword\">SQL</span>: <span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> employee <span class=\"keyword\">where</span> dname<span class=\"operator\">=</span><span class=\"string\">&#x27;\\&#x27;</span> <span class=\"keyword\">or</span> <span class=\"number\">1</span><span class=\"operator\">=</span><span class=\"number\">1</span> <span class=\"keyword\">or</span> <span class=\"number\">1</span><span class=\"operator\">=</span>\\<span class=\"string\">&#x27;&#x27;</span> ;单引号被处理</span><br><span class=\"line\">String <span class=\"keyword\">sql</span> <span class=\"operator\">=</span> &quot;select * from employee where dname=?&quot;;</span><br><span class=\"line\">PreparedStatement pstmt <span class=\"operator\">=</span> conn.prepareStatement(<span class=\"keyword\">sql</span>);</span><br><span class=\"line\">pstmt.setString(<span class=\"number\">1</span>,dname); <span class=\"operator\">/</span><span class=\"operator\">/</span>设置<span class=\"keyword\">SQL</span>参数,参数从<span class=\"number\">1</span>开始</span><br><span class=\"line\">ResultSet rs <span class=\"operator\">=</span> pstmt.executeQuery();</span><br><span class=\"line\">while(rs.next())&#123;</span><br><span class=\"line\">....</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>◇示例代码</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.lcg.jdbc.hrapp.command;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.sql.*;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.Scanner;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * PreparedStatement对象使用方法</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">PstmtQueryCommand</span> <span class=\"keyword\">implements</span> <span class=\"title\">Command</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">execute</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        System.out.print(<span class=\"string\">&quot;请输入部门名称：&quot;</span>);</span><br><span class=\"line\">        Scanner in = <span class=\"keyword\">new</span> Scanner(System.in);</span><br><span class=\"line\">        String pdname = in.nextLine();</span><br><span class=\"line\">        Connection conn = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">        <span class=\"comment\">//Statement stmt = null;</span></span><br><span class=\"line\">        PreparedStatement pstmt = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">        ResultSet rs = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            <span class=\"comment\">//1. 加载并注册JDBC驱动</span></span><br><span class=\"line\">            Class.forName(<span class=\"string\">&quot;com.mysql.cj.jdbc.Driver&quot;</span>);</span><br><span class=\"line\">            <span class=\"comment\">//2. 创建数据库连接</span></span><br><span class=\"line\">            conn = DriverManager.getConnection(<span class=\"string\">&quot;jdbc:mysql://localhost:3306/imooc?useSSL=false&amp;useUnicode=true&amp;characterEncoding=UTF-8&amp;serverTimezone=Asia/Shanghai&amp;allowPublicKeyRetrieval=true&quot;</span>, <span class=\"string\">&quot;root&quot;</span>, <span class=\"string\">&quot;root&quot;</span>);</span><br><span class=\"line\">            <span class=\"comment\">//3. 创建PreparedStatement对象</span></span><br><span class=\"line\">            String sql = <span class=\"string\">&quot;select * from employee where dname=? and eno &gt; ?&quot;</span>;</span><br><span class=\"line\">            pstmt = conn.prepareStatement(sql);</span><br><span class=\"line\">            pstmt.setString(<span class=\"number\">1</span>, pdname); <span class=\"comment\">//注意:参数索引从1开始</span></span><br><span class=\"line\">            pstmt.setInt(<span class=\"number\">2</span>, <span class=\"number\">3500</span>);<span class=\"comment\">//2,即第二个参数</span></span><br><span class=\"line\">            <span class=\"comment\">//结果集</span></span><br><span class=\"line\">            rs = pstmt.executeQuery();</span><br><span class=\"line\">            <span class=\"comment\">//4. 遍历查询结果</span></span><br><span class=\"line\">            <span class=\"comment\">//rs.next()返回布尔值，代表是否存在下一条记录</span></span><br><span class=\"line\">            <span class=\"comment\">//如果有，返回true,同时结果集提取下一条记录</span></span><br><span class=\"line\">            <span class=\"comment\">//如果没有，返回false，循环就会停止</span></span><br><span class=\"line\">            <span class=\"keyword\">while</span> (rs.next()) &#123;</span><br><span class=\"line\">                Integer eno = rs.getInt(<span class=\"number\">1</span>);<span class=\"comment\">//JDBC中字段索引从1开始，而非0</span></span><br><span class=\"line\">                String ename = rs.getString(<span class=\"string\">&quot;ename&quot;</span>);</span><br><span class=\"line\">                Float salary = rs.getFloat(<span class=\"string\">&quot;salary&quot;</span>);</span><br><span class=\"line\">                String dname = rs.getString(<span class=\"string\">&quot;dname&quot;</span>);</span><br><span class=\"line\">                System.out.println(dname + <span class=\"string\">&quot;-&quot;</span> + eno + <span class=\"string\">&quot;-&quot;</span> + ename + <span class=\"string\">&quot;-&quot;</span> + salary);</span><br><span class=\"line\"></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (ClassNotFoundException e) &#123;</span><br><span class=\"line\">            e.printStackTrace();</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (SQLException e) &#123;</span><br><span class=\"line\">            e.printStackTrace();</span><br><span class=\"line\">        &#125; <span class=\"keyword\">finally</span> &#123;</span><br><span class=\"line\">            <span class=\"comment\">//5. 关闭连接,释放资源</span></span><br><span class=\"line\">            <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (rs != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">                    rs.close();</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125; <span class=\"keyword\">catch</span> (SQLException e) &#123;</span><br><span class=\"line\">                e.printStackTrace();</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (pstmt != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">                    pstmt.close();</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125; <span class=\"keyword\">catch</span> (SQLException e) &#123;</span><br><span class=\"line\">                e.printStackTrace();</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (conn != <span class=\"keyword\">null</span> &amp;&amp; !conn.isClosed()) &#123;</span><br><span class=\"line\">                    conn.close();</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125; <span class=\"keyword\">catch</span> (SQLException e) &#123;</span><br><span class=\"line\">                e.printStackTrace();</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"错误的使用方式\"><a href=\"#错误的使用方式\" class=\"headerlink\" title=\"错误的使用方式\"></a>错误的使用方式</h3><p>◇select * from employee where ?=’abc’<br>◇select * from employee where salary = ?+100<br>◇select ? from employee where ename = ?  </p>\n<h2 id=\"JDBC实现写数据\"><a href=\"#JDBC实现写数据\" class=\"headerlink\" title=\"JDBC实现写数据\"></a>JDBC实现写数据</h2><h3 id=\"封装DbUtils工具类\"><a href=\"#封装DbUtils工具类\" class=\"headerlink\" title=\"封装DbUtils工具类\"></a>封装DbUtils工具类</h3><p>◇工具类代码</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\">public class DbUtils &#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 在一个方法或类的开头，输入/**，然后按回车,自动根据参数和返回值生成注释模板</span></span><br><span class=\"line\"><span class=\"comment\">     * 创建新的数据库连接</span></span><br><span class=\"line\"><span class=\"comment\">     * @return 新的Connection对象</span></span><br><span class=\"line\"><span class=\"comment\">     * @throws SQLException</span></span><br><span class=\"line\"><span class=\"comment\">     * @throws ClassNotFoundException</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    public <span class=\"keyword\">static</span> Connection getConnection() throws <span class=\"keyword\">SQLException</span>, ClassNotFoundException &#123;</span><br><span class=\"line\">        <span class=\"operator\">/</span><span class=\"operator\">/</span><span class=\"number\">1.</span> 加载并注册JDBC驱动</span><br><span class=\"line\">        Class.forName(&quot;com.mysql.cj.jdbc.Driver&quot;);</span><br><span class=\"line\">        <span class=\"operator\">/</span><span class=\"operator\">/</span><span class=\"number\">2.</span> 创建数据库连接</span><br><span class=\"line\">        Connection conn <span class=\"operator\">=</span> DriverManager.getConnection(</span><br><span class=\"line\">                &quot;jdbc:mysql://localhost:3306/gamest?useSSL=false&amp;useUnicode=true&amp;characterEncoding=UTF-8&amp;serverTimezone=Asia/Shanghai&quot;,</span><br><span class=\"line\">                &quot;root&quot;, &quot;www.LCG.com&quot;</span><br><span class=\"line\">        );</span><br><span class=\"line\">        <span class=\"keyword\">return</span> conn;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 关闭连接，释放资源</span></span><br><span class=\"line\"><span class=\"comment\">     * @param rs 结果集对象</span></span><br><span class=\"line\"><span class=\"comment\">     * @param pstmt Statement对象</span></span><br><span class=\"line\"><span class=\"comment\">     * @param conn Connection对象</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    public <span class=\"keyword\">static</span> void closeConnection(ResultSet rs, PreparedStatement pstmt,Connection conn)&#123;</span><br><span class=\"line\">        try &#123;</span><br><span class=\"line\">            if(rs<span class=\"operator\">!=</span><span class=\"keyword\">null</span>)&#123;</span><br><span class=\"line\">                rs.close();</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125; catch (<span class=\"keyword\">SQLException</span> e) &#123;</span><br><span class=\"line\">            e.printStackTrace();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        try &#123;</span><br><span class=\"line\">            if(pstmt<span class=\"operator\">!=</span><span class=\"keyword\">null</span>)&#123;</span><br><span class=\"line\">                pstmt.close();</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125; catch (<span class=\"keyword\">SQLException</span> e) &#123;</span><br><span class=\"line\">            e.printStackTrace();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        try &#123;</span><br><span class=\"line\">            if(conn<span class=\"operator\">!=</span><span class=\"keyword\">null</span><span class=\"operator\">&amp;&amp;</span><span class=\"operator\">!</span>conn.isClosed())&#123;</span><br><span class=\"line\">                conn.close();</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125; catch (<span class=\"keyword\">SQLException</span> e) &#123;</span><br><span class=\"line\">            e.printStackTrace();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"JDBC执行INSERT语句\"><a href=\"#JDBC执行INSERT语句\" class=\"headerlink\" title=\"JDBC执行INSERT语句\"></a>JDBC执行INSERT语句</h3><figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\">String <span class=\"keyword\">sql</span><span class=\"operator\">=</span> &quot;insert into employee(eno,ename) values(?,?)&quot;;</span><br><span class=\"line\">PreparedStatement pstmt <span class=\"operator\">=</span> conn.prepareStatement(<span class=\"keyword\">sql</span>);</span><br><span class=\"line\">pstmt.setInt(<span class=\"number\">1</span>,<span class=\"number\">10</span>);</span><br><span class=\"line\">pstmt.setString(<span class=\"number\">2</span>,&quot;张三&quot;);</span><br><span class=\"line\"><span class=\"operator\">/</span><span class=\"operator\">/</span>executeUpdate方法返回记录数</span><br><span class=\"line\"><span class=\"type\">int</span> cnt <span class=\"operator\">=</span> pstmt.executeUpdate(); <span class=\"operator\">/</span><span class=\"operator\">/</span>cnt<span class=\"operator\">=</span><span class=\"number\">1</span>,表示<span class=\"keyword\">sql</span>语句所影响的数据库的行数</span><br><span class=\"line\">System.out.println(&quot;数据新增成功&quot;);</span><br></pre></td></tr></table></figure>\n<p>◇新增员工数据</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\">public class InsertCommand implements Command&#123;</span><br><span class=\"line\">    <span class=\"variable\">@Override</span></span><br><span class=\"line\">    public void <span class=\"keyword\">execute</span>()&#123;</span><br><span class=\"line\">        Scanner <span class=\"keyword\">in</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> Scanner(System.in);</span><br><span class=\"line\">        System.out.println(&quot;请输入员工编号&quot;);</span><br><span class=\"line\">        <span class=\"type\">int</span> eno <span class=\"operator\">=</span> in.nextInt();</span><br><span class=\"line\">        System.out.println(&quot;请输入员姓名&quot;);</span><br><span class=\"line\">        String ename <span class=\"operator\">=</span> in.next();</span><br><span class=\"line\">        System.out.println(&quot;请输入员工薪资&quot;);</span><br><span class=\"line\">        <span class=\"type\">float</span> salary <span class=\"operator\">=</span> in.nextFloat();</span><br><span class=\"line\">        System.out.println(&quot;请输入隶属部门&quot;);</span><br><span class=\"line\">        String dname <span class=\"operator\">=</span> in.next();</span><br><span class=\"line\">        Connection conn <span class=\"operator\">=</span> <span class=\"keyword\">null</span>;</span><br><span class=\"line\">        PreparedStatement pstmt <span class=\"operator\">=</span> <span class=\"keyword\">null</span>;</span><br><span class=\"line\">        try &#123;</span><br><span class=\"line\">            conn <span class=\"operator\">=</span> DbUtils.getConnection();</span><br><span class=\"line\">            String <span class=\"keyword\">sql</span> <span class=\"operator\">=</span> &quot;insert into employee(eno,ename,salary,dname) values(?,?,?,?)&quot;;</span><br><span class=\"line\">            pstmt <span class=\"operator\">=</span> conn.prepareStatement(<span class=\"keyword\">sql</span>);</span><br><span class=\"line\">            pstmt.setInt(<span class=\"number\">1</span>, eno);</span><br><span class=\"line\">            pstmt.setString(<span class=\"number\">2</span>, ename);</span><br><span class=\"line\">            pstmt.setFloat(<span class=\"number\">3</span>, salary);</span><br><span class=\"line\">            pstmt.setString(<span class=\"number\">4</span>, dname);</span><br><span class=\"line\">            <span class=\"type\">int</span> cnt <span class=\"operator\">=</span> pstmt.executeUpdate();<span class=\"operator\">/</span><span class=\"operator\">/</span>所有写操作都使用executeUpdate</span><br><span class=\"line\">            System.out.println(&quot;cnt:&quot;<span class=\"operator\">+</span>cnt);</span><br><span class=\"line\">            System.out.println(ename<span class=\"operator\">+</span>&quot;员工入职手续办理成功&quot;);</span><br><span class=\"line\">        &#125; catch (<span class=\"keyword\">SQLException</span> e) &#123;</span><br><span class=\"line\">            e.printStackTrace();</span><br><span class=\"line\">        &#125; catch (ClassNotFoundException e) &#123;</span><br><span class=\"line\">            e.printStackTrace();</span><br><span class=\"line\">        &#125;finally &#123;</span><br><span class=\"line\">            DbUtils.closeConnection(<span class=\"keyword\">null</span>,pstmt,conn);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"JDBC执行UPDATE语句\"><a href=\"#JDBC执行UPDATE语句\" class=\"headerlink\" title=\"JDBC执行UPDATE语句\"></a>JDBC执行UPDATE语句</h3><figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\">String <span class=\"keyword\">sql</span><span class=\"operator\">=</span> &quot;update employee set salary=salary + 1000 where dname=?&quot;;</span><br><span class=\"line\">PreparedStatement pstmt <span class=\"operator\">=</span> conn.prepareStatement(<span class=\"keyword\">sql</span>);</span><br><span class=\"line\">pstmt.setString(<span class=\"number\">1</span>,&quot;研发部&quot;);</span><br><span class=\"line\"><span class=\"operator\">/</span><span class=\"operator\">/</span>executeUpdate方法返回记录数</span><br><span class=\"line\"><span class=\"type\">int</span> cnt <span class=\"operator\">=</span> pstmt.executeUpdate();</span><br><span class=\"line\">System.out.println(&quot;研发部&quot; <span class=\"operator\">+</span> cnt <span class=\"operator\">+</span> &quot;名员工提薪1000元&quot;);</span><br></pre></td></tr></table></figure>\n<h3 id=\"JDBC执行DELETE语句\"><a href=\"#JDBC执行DELETE语句\" class=\"headerlink\" title=\"JDBC执行DELETE语句\"></a>JDBC执行DELETE语句</h3><figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\">String <span class=\"keyword\">sql</span><span class=\"operator\">=</span> &quot;delete from employee where eno = ?&quot;;</span><br><span class=\"line\">PreparedStatement pstmt <span class=\"operator\">=</span> conn.prepareStatement(<span class=\"keyword\">sql</span>);</span><br><span class=\"line\">pstmt.setInt(<span class=\"number\">1</span>, <span class=\"number\">3395</span>);</span><br><span class=\"line\"><span class=\"operator\">/</span><span class=\"operator\">/</span>executeUpdate方法返回记录数</span><br><span class=\"line\"><span class=\"type\">int</span> cnt <span class=\"operator\">=</span> pstmt.executeUpdate();</span><br><span class=\"line\">System.out.println(cnt<span class=\"operator\">+</span>&quot;名员工数据已被删除&quot;);</span><br></pre></td></tr></table></figure>\n<h2 id=\"JDBC中的事务管理\"><a href=\"#JDBC中的事务管理\" class=\"headerlink\" title=\"JDBC中的事务管理\"></a>JDBC中的事务管理</h2><h3 id=\"什么是事务\"><a href=\"#什么是事务\" class=\"headerlink\" title=\"什么是事务\"></a>什么是事务</h3><p>◇事务是以一种可靠的、一致的方式，访问和操作数据库的程序单元<br>◇说人话：要么把事情做完，要么什么都不做，不要做一半<br>◇事务依赖于数据库实现,MySQL通过事务区作为数据缓冲地带  </p>\n<h3 id=\"事务的提交操作\"><a href=\"#事务的提交操作\" class=\"headerlink\" title=\"事务的提交操作\"></a>事务的提交操作</h3><p><img src=\"/p/8791/1627462586528-28cc5fc3-1e3f-465e-9968-8e89b86516eb.png\" class=\"lazyload\" data-srcset=\"/p/8791/1627462586528-28cc5fc3-1e3f-465e-9968-8e89b86516eb.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"></p>\n<h3 id=\"事务的回滚操作\"><a href=\"#事务的回滚操作\" class=\"headerlink\" title=\"事务的回滚操作\"></a>事务的回滚操作</h3><p><img src=\"/p/8791/1627462637835-0f24ab7b-4905-4827-9f32-f494780da680.png\" class=\"lazyload\" data-srcset=\"/p/8791/1627462637835-0f24ab7b-4905-4827-9f32-f494780da680.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"></p>\n<h3 id=\"JDBC两种事务模式\"><a href=\"#JDBC两种事务模式\" class=\"headerlink\" title=\"JDBC两种事务模式\"></a>JDBC两种事务模式</h3><p>◇JDBC允许两种事务模式<br>◇自动提交事务模式<br>◇手动提交事务模式  </p>\n<h4 id=\"自动提交事务模式\"><a href=\"#自动提交事务模式\" class=\"headerlink\" title=\"自动提交事务模式\"></a>自动提交事务模式</h4><p>◇自动提交模式是指每执行一次写操作SQL,自动提交事务<br>◇自动提交开启方法: conn.setAutoCommit(true)<br>◇自动事务是JDBC默认行为,此模式无法保证多数据一致性  </p>\n<h4 id=\"手动提交事务模式\"><a href=\"#手动提交事务模式\" class=\"headerlink\" title=\"手动提交事务模式\"></a>手动提交事务模式</h4><p>◇手动提交模式是指显式调用commit()与rollback()方法管理事务<br>◇手动提交开启方法: conn.setAutoCommit(false)<br>◇手动提交事务可保证多数据一致性,但必须手动调用提交/回滚方法  </p>\n<h3 id=\"实现批量增加员工\"><a href=\"#实现批量增加员工\" class=\"headerlink\" title=\"实现批量增加员工\"></a>实现批量增加员工</h3><figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * JDBC中的事务机制</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\">public class TransactionSample &#123;</span><br><span class=\"line\">    public <span class=\"keyword\">static</span> void main(String[] args) &#123;</span><br><span class=\"line\">        Connection conn <span class=\"operator\">=</span> <span class=\"keyword\">null</span>;</span><br><span class=\"line\">        PreparedStatement pstmt <span class=\"operator\">=</span> <span class=\"keyword\">null</span>;</span><br><span class=\"line\">        try &#123;</span><br><span class=\"line\">            conn <span class=\"operator\">=</span> DbUtils.getConnection();</span><br><span class=\"line\">            <span class=\"operator\">/</span><span class=\"operator\">/</span>JDBC默认使用自动提交模式</span><br><span class=\"line\">            conn.setAutoCommit(<span class=\"literal\">false</span>);<span class=\"operator\">/</span><span class=\"operator\">/</span>设置手动提交</span><br><span class=\"line\">            String <span class=\"keyword\">sql</span> <span class=\"operator\">=</span> &quot;insert into employee(eno,ename,salary,dname) values(?,?,?,?)&quot;;</span><br><span class=\"line\">            <span class=\"keyword\">for</span>(<span class=\"type\">int</span> i<span class=\"operator\">=</span><span class=\"number\">100</span>;i<span class=\"operator\">&lt;</span><span class=\"number\">200</span>;i<span class=\"operator\">+</span><span class=\"operator\">+</span>)&#123;</span><br><span class=\"line\"><span class=\"comment\">/*                if(i==105)&#123;</span></span><br><span class=\"line\"><span class=\"comment\">                    throw new RuntimeException(&quot;插入失败&quot;);//模拟抛出异常</span></span><br><span class=\"line\"><span class=\"comment\">                &#125;*/</span></span><br><span class=\"line\">                pstmt <span class=\"operator\">=</span> conn.prepareStatement(<span class=\"keyword\">sql</span>);</span><br><span class=\"line\">                pstmt.setInt(<span class=\"number\">1</span>,i);</span><br><span class=\"line\">                pstmt.setString(<span class=\"number\">2</span>, &quot;员工&quot; <span class=\"operator\">+</span> i);</span><br><span class=\"line\">                pstmt.setFloat(<span class=\"number\">3</span>, <span class=\"number\">5000</span>);</span><br><span class=\"line\">                pstmt.setString(<span class=\"number\">4</span>, &quot;市场部&quot;);</span><br><span class=\"line\">                pstmt.executeUpdate();</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            conn.commit();<span class=\"operator\">/</span><span class=\"operator\">/</span>当<span class=\"keyword\">for</span>循环全部完成后，才开始进行提交</span><br><span class=\"line\">        &#125; catch (Exception e) &#123;</span><br><span class=\"line\">            e.printStackTrace();</span><br><span class=\"line\">            try &#123;</span><br><span class=\"line\">                if (conn<span class=\"operator\">!=</span><span class=\"keyword\">null</span><span class=\"operator\">&amp;&amp;</span><span class=\"operator\">!</span>conn.isClosed()) &#123;</span><br><span class=\"line\">                    conn.rollback();<span class=\"operator\">/</span><span class=\"operator\">/</span>发生异常回滚</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125; catch (<span class=\"keyword\">SQLException</span> e1) &#123;</span><br><span class=\"line\">                e1.printStackTrace();</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125; finally &#123;</span><br><span class=\"line\">            DbUtils.closeConnection(<span class=\"keyword\">null</span>,pstmt,conn);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"基于实体类实现分页数据封装\"><a href=\"#基于实体类实现分页数据封装\" class=\"headerlink\" title=\"基于实体类实现分页数据封装\"></a>基于实体类实现分页数据封装</h2><p>◇实体类代码</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 员工实体类</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\">public class Employee &#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 需符合javabean的要求</span></span><br><span class=\"line\"><span class=\"comment\">     * 1.具备默认构造函数</span></span><br><span class=\"line\"><span class=\"comment\">     * 2.属性私有</span></span><br><span class=\"line\"><span class=\"comment\">     * 3.存在getter与setter</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    public Employee()&#123;&#125;</span><br><span class=\"line\">    private <span class=\"type\">Integer</span> eno;</span><br><span class=\"line\">    private String ename;</span><br><span class=\"line\">    private <span class=\"type\">Float</span> salary;</span><br><span class=\"line\">    private String dname;</span><br><span class=\"line\"></span><br><span class=\"line\">    public <span class=\"type\">Integer</span> getEno() &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> eno;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    public void setEno(<span class=\"type\">Integer</span> eno) &#123;</span><br><span class=\"line\">        this.eno <span class=\"operator\">=</span> eno;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    public String getEname() &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> ename;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    public void setEname(String ename) &#123;</span><br><span class=\"line\">        this.ename <span class=\"operator\">=</span> ename;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    public <span class=\"type\">Float</span> getSalary() &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> salary;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    public void setSalary(<span class=\"type\">Float</span> salary) &#123;</span><br><span class=\"line\">        this.salary <span class=\"operator\">=</span> salary;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    public String getDname() &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> dname;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    public void setDname(String dname) &#123;</span><br><span class=\"line\">        this.dname <span class=\"operator\">=</span> dname;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>◇分页命令代码</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 分页查询员工数据</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\">public class PaginationCommand implements Command &#123;</span><br><span class=\"line\">    <span class=\"variable\">@Override</span></span><br><span class=\"line\">    public void <span class=\"keyword\">execute</span>()&#123;</span><br><span class=\"line\">        Scanner <span class=\"keyword\">in</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> Scanner(System.in);</span><br><span class=\"line\">        System.out.println(&quot;请输入页号：&quot;);</span><br><span class=\"line\">        <span class=\"type\">int</span> page <span class=\"operator\">=</span> in.nextInt();</span><br><span class=\"line\">        Connection conn <span class=\"operator\">=</span> <span class=\"keyword\">null</span>;</span><br><span class=\"line\">        PreparedStatement pstmt <span class=\"operator\">=</span> <span class=\"keyword\">null</span>;</span><br><span class=\"line\">        ResultSet rs <span class=\"operator\">=</span> <span class=\"keyword\">null</span>;</span><br><span class=\"line\">        List<span class=\"operator\">&lt;</span>Employee<span class=\"operator\">&gt;</span> list <span class=\"operator\">=</span> <span class=\"keyword\">new</span> ArrayList();<span class=\"operator\">/</span><span class=\"operator\">/</span>存储查询结果</span><br><span class=\"line\">        try &#123;</span><br><span class=\"line\">            conn <span class=\"operator\">=</span> DbUtils.getConnection();</span><br><span class=\"line\">            String <span class=\"keyword\">sql</span> <span class=\"operator\">=</span> &quot;select * from employee limit ?,10&quot;;<span class=\"operator\">/</span><span class=\"operator\">/</span><span class=\"number\">10</span>代表从？开始往后取<span class=\"number\">10</span>条记录</span><br><span class=\"line\">            pstmt <span class=\"operator\">=</span> conn.prepareStatement(<span class=\"keyword\">sql</span>);</span><br><span class=\"line\">            pstmt.setInt(<span class=\"number\">1</span>,(page<span class=\"number\">-1</span>)<span class=\"operator\">*</span><span class=\"number\">10</span>);<span class=\"operator\">/</span><span class=\"operator\">/</span>分页公式</span><br><span class=\"line\">            rs <span class=\"operator\">=</span> pstmt.executeQuery();</span><br><span class=\"line\">            while (rs.next())&#123;</span><br><span class=\"line\">                <span class=\"type\">Integer</span> eno <span class=\"operator\">=</span> rs.getInt(&quot;eno&quot;);</span><br><span class=\"line\">                String ename <span class=\"operator\">=</span> rs.getString(&quot;ename&quot;);</span><br><span class=\"line\">                <span class=\"type\">Float</span> salary <span class=\"operator\">=</span> rs.getFloat(&quot;salary&quot;);</span><br><span class=\"line\">                String dname <span class=\"operator\">=</span> rs.getString(&quot;dname&quot;);</span><br><span class=\"line\">                Employee emp <span class=\"operator\">=</span> <span class=\"keyword\">new</span> Employee();</span><br><span class=\"line\">                emp.setEno(eno);</span><br><span class=\"line\">                emp.setEname(ename);</span><br><span class=\"line\">                emp.setSalary(salary);</span><br><span class=\"line\">                emp.setDname(dname);</span><br><span class=\"line\">                list.add(emp);<span class=\"operator\">/</span><span class=\"operator\">/</span>将emp实体加到list集合中</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            System.out.println(list.size());</span><br><span class=\"line\">        &#125; catch (<span class=\"keyword\">SQLException</span> e) &#123;</span><br><span class=\"line\">            e.printStackTrace();</span><br><span class=\"line\">        &#125; catch (ClassNotFoundException e) &#123;</span><br><span class=\"line\">            e.printStackTrace();</span><br><span class=\"line\">        &#125;finally &#123;</span><br><span class=\"line\">            DbUtils.closeConnection(rs, pstmt, conn);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"JDBC中Date日期对象的处理\"><a href=\"#JDBC中Date日期对象的处理\" class=\"headerlink\" title=\"JDBC中Date日期对象的处理\"></a>JDBC中Date日期对象的处理</h2><p>◇实体类中添加日期</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\">private <span class=\"type\">Date</span> hiredate;</span><br><span class=\"line\">public <span class=\"type\">Date</span> getHiredate() &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> hiredate;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">public void setHiredata(<span class=\"type\">Date</span> hiredate) &#123;</span><br><span class=\"line\">        this.hiredate <span class=\"operator\">=</span> hiredate;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n<p>◇分页命令添加日期</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"operator\">/</span><span class=\"operator\">/</span>JDBC获取日期使用java.sql.Date,其继承自java.util.Date</span><br><span class=\"line\"><span class=\"operator\">/</span><span class=\"operator\">/</span>所以两者互相兼容</span><br><span class=\"line\"><span class=\"type\">Date</span> hiredata <span class=\"operator\">=</span> rs.getDate(&quot;hiredate&quot;);</span><br><span class=\"line\"> emp.setHiredate(hiredate);</span><br></pre></td></tr></table></figure>\n<p>◇向数据库中写入日期时需要使用java.sql.Date</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\">System.out.println(&quot;请输入入职日期&quot;);</span><br><span class=\"line\">        String strHiredate <span class=\"operator\">=</span> in.next();</span><br><span class=\"line\">        <span class=\"operator\">/</span><span class=\"operator\">/</span>String 到java.sql.Date分为两步</span><br><span class=\"line\">        <span class=\"operator\">/</span><span class=\"operator\">/</span><span class=\"number\">1.</span>将String转为java.util.Date</span><br><span class=\"line\">        SimpleDateFormat sdf <span class=\"operator\">=</span> <span class=\"keyword\">new</span> SimpleDateFormat(&quot;yyyy-MM-dd&quot;);</span><br><span class=\"line\">        java.util.Date udHiredate <span class=\"operator\">=</span> <span class=\"keyword\">null</span>;</span><br><span class=\"line\">        try &#123;</span><br><span class=\"line\">             udHiredate <span class=\"operator\">=</span> sdf.parse(strHiredate);</span><br><span class=\"line\">        &#125; catch (ParseException e) &#123;</span><br><span class=\"line\">            e.printStackTrace();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"operator\">/</span><span class=\"operator\">/</span><span class=\"number\">2.</span>将util转为<span class=\"keyword\">sql</span></span><br><span class=\"line\">        long <span class=\"type\">time</span> <span class=\"operator\">=</span> udHiredate.getTime();<span class=\"operator\">/</span><span class=\"operator\">/</span>获取<span class=\"number\">1970</span>年到现在的毫秒数</span><br><span class=\"line\">        java.sql.Date sdHiredate <span class=\"operator\">=</span> <span class=\"keyword\">new</span> java.sql.Date(<span class=\"type\">time</span>);</span><br><span class=\"line\">        </span><br><span class=\"line\">pstmt.setDate(<span class=\"number\">5</span>,sdHiredate);<span class=\"operator\">/</span><span class=\"operator\">/</span>java.sql.Date</span><br></pre></td></tr></table></figure>\n<h2 id=\"JDBC数据批处理\"><a href=\"#JDBC数据批处理\" class=\"headerlink\" title=\"JDBC数据批处理\"></a>JDBC数据批处理</h2><p>◇批处理部分代码</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\">pstmt <span class=\"operator\">=</span> conn.prepareStatement(<span class=\"keyword\">sql</span>);</span><br><span class=\"line\">            <span class=\"keyword\">for</span>(<span class=\"type\">int</span> i<span class=\"operator\">=</span><span class=\"number\">100000</span>;i<span class=\"operator\">&lt;</span><span class=\"number\">200000</span>;i<span class=\"operator\">+</span><span class=\"operator\">+</span>)&#123;</span><br><span class=\"line\">                pstmt.setInt(<span class=\"number\">1</span>,i);</span><br><span class=\"line\">                pstmt.setString(<span class=\"number\">2</span>, &quot;员工&quot; <span class=\"operator\">+</span> i);</span><br><span class=\"line\">                pstmt.setFloat(<span class=\"number\">3</span>, <span class=\"number\">5000</span>f);</span><br><span class=\"line\">                pstmt.setString(<span class=\"number\">4</span>, &quot;市场部&quot;);</span><br><span class=\"line\">                pstmt.addBatch();<span class=\"operator\">/</span><span class=\"operator\">/</span>将参数加入批处理任务</span><br><span class=\"line\">                <span class=\"operator\">/</span><span class=\"operator\">/</span>pstmt.executeUpdate();</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            pstmt.executeBatch();<span class=\"operator\">/</span><span class=\"operator\">/</span>执行批处理任务</span><br><span class=\"line\">            conn.commit();<span class=\"operator\">/</span><span class=\"operator\">/</span>当<span class=\"keyword\">for</span>循环全部完成后，才开始进行提交</span><br></pre></td></tr></table></figure>\n<p>◇批处理效率高的原因：在标准方法中，创建了十万个prepareStatement对象，每一个对象都是新增一条数据；而在批处理方法中，是用一个对象新增十万条数据；</p>\n<h2 id=\"连接池与JDBC进阶使用\"><a href=\"#连接池与JDBC进阶使用\" class=\"headerlink\" title=\"连接池与JDBC进阶使用\"></a>连接池与JDBC进阶使用</h2><p>◇连接池是创建和管理一个连接的缓冲池的技术，这些连接准备好被任何需要它们的线程使用</p>\n<h3 id=\"阿里巴巴Druid连接池\"><a href=\"#阿里巴巴Druid连接池\" class=\"headerlink\" title=\"阿里巴巴Druid连接池\"></a>阿里巴巴Druid连接池</h3><p>◇Druid是阿里巴巴开源连接池组件,是最好的连接池之一<br>◇Druid对数据库连接进行有效管理与重用,最大化程序执行效率<br>◇连接池负责创建管理连接,程序只负责取用与归还<br><img src=\"/p/8791/1627542621734-d1f41e8f-ec79-4286-910d-86feb455549d.png\" class=\"lazyload\" data-srcset=\"/p/8791/1627542621734-d1f41e8f-ec79-4286-910d-86feb455549d.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"></p>\n<h3 id=\"Druid连接池配置与使用\"><a href=\"#Druid连接池配置与使用\" class=\"headerlink\" title=\"Druid连接池配置与使用\"></a>Druid连接池配置与使用</h3><p>◇配置.properties文件</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//不需要引号和分号,将初始尺寸和最大尺寸设为一致可便于维护</span></span><br><span class=\"line\">driverClassName=</span><br><span class=\"line\">url=</span><br><span class=\"line\">username=</span><br><span class=\"line\">password=</span><br><span class=\"line\">initialSize=<span class=\"number\">10</span>  <span class=\"comment\">//初始尺寸:连接池默认创建10个数据库连接</span></span><br><span class=\"line\">maxActive=<span class=\"number\">20</span> <span class=\"comment\">//最大尺寸:数据库不够用时，创建的最大连接数，还不够用则需等待</span></span><br></pre></td></tr></table></figure>\n<p>◇使用连接池</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * Druid连接池配置与使用</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">DruidSample</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">//1.加载属性文件</span></span><br><span class=\"line\">        Properties properties = <span class=\"keyword\">new</span> Properties();</span><br><span class=\"line\">        <span class=\"comment\">//作用：获取当前类(DruidSample)路径下对应文件的路径，因为配置文件会随着代码运行而发布到运行文件夹中</span></span><br><span class=\"line\">        String propertyFile = DruidSample.class.getResource(<span class=\"string\">&quot;/druid-cofig.properties&quot;</span>).getPath();</span><br><span class=\"line\">        <span class=\"comment\">//在上面获取的路径中getPath方法会进行URL编码:空格-&gt;%20</span></span><br><span class=\"line\">        <span class=\"comment\">// 如：原始路径：c:\\java code 转换后的路径：c:\\java%20code;</span></span><br><span class=\"line\">        <span class=\"comment\">// 使用URLDecoder().decode()方法进行容错，将%20还原为空格</span></span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            propertyFile = <span class=\"keyword\">new</span> URLDecoder().decode(propertyFile, <span class=\"string\">&quot;UTF-8&quot;</span>);</span><br><span class=\"line\">            properties.load(<span class=\"keyword\">new</span> FileInputStream(propertyFile));<span class=\"comment\">//加载,load参数为文件流</span></span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</span><br><span class=\"line\">            e.printStackTrace();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        Connection conn = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">        PreparedStatement psmt = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">        ResultSet rs = <span class=\"keyword\">null</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            <span class=\"comment\">//2.获取DataSource数据源对象</span></span><br><span class=\"line\">            DataSource dataSource = DruidDataSourceFactory.createDataSource(properties);<span class=\"comment\">//DataSource选择sql</span></span><br><span class=\"line\">            <span class=\"comment\">//3.创建数据库连接</span></span><br><span class=\"line\">            conn = dataSource.getConnection();</span><br><span class=\"line\">            psmt = conn.prepareStatement(<span class=\"string\">&quot;select * from employee limit 0,10&quot;</span>);</span><br><span class=\"line\">            rs = psmt.executeQuery();</span><br><span class=\"line\">            <span class=\"keyword\">while</span> (rs.next()) &#123;</span><br><span class=\"line\">                Integer eno = rs.getInt(<span class=\"number\">1</span>);<span class=\"comment\">//获取当前行第一列的数据（数据为int型）,按位置</span></span><br><span class=\"line\">                String ename = rs.getString(<span class=\"string\">&quot;ename&quot;</span>);<span class=\"comment\">//获取ename列的数据（数据为String型），按名称</span></span><br><span class=\"line\">                Float salary = rs.getFloat(<span class=\"string\">&quot;salary&quot;</span>);</span><br><span class=\"line\">                String dname = rs.getString(<span class=\"string\">&quot;dname&quot;</span>);</span><br><span class=\"line\">                System.out.println(dname + <span class=\"string\">&quot;-&quot;</span> + eno + <span class=\"string\">&quot;-&quot;</span> + ename + <span class=\"string\">&quot;-&quot;</span> + salary);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</span><br><span class=\"line\">            e.printStackTrace();</span><br><span class=\"line\">        &#125;<span class=\"keyword\">finally</span> &#123;</span><br><span class=\"line\">            <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">             * 不使用连接池：conn.close()关闭连接</span></span><br><span class=\"line\"><span class=\"comment\">             * 使用连接池：conn.close()将连接回收至连接池</span></span><br><span class=\"line\"><span class=\"comment\">             */</span></span><br><span class=\"line\">            DbUtils.closeConnection(rs,psmt,conn);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"扩展知识-C3P0连接池\"><a href=\"#扩展知识-C3P0连接池\" class=\"headerlink\" title=\"扩展知识:C3P0连接池\"></a>扩展知识:C3P0连接池</h3><p>◇配置文件，使用xml且文件名必须为：c3p0-config.xml</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">&lt;?xml version=<span class=\"string\">&quot;1.0&quot;</span> encoding=<span class=\"string\">&quot;UTF-8&quot;</span> ?&gt;</span><br><span class=\"line\">&lt;c3p0-config&gt;</span><br><span class=\"line\">    &lt;<span class=\"keyword\">default</span>-config&gt;</span><br><span class=\"line\">        &lt;property name=<span class=\"string\">&quot;driveClass&quot;</span>&gt;com.mysql.cj.jdbc.Driver&lt;/property&gt;</span><br><span class=\"line\">        &lt;property name=<span class=\"string\">&quot;jdbcUrl&quot;</span>&gt;jdbc:mysql:<span class=\"comment\">//localhost:3306/gamest?useSSL=false&amp;amp;useUnicode=true&amp;amp;characterEncoding=UTF-8&amp;amp;serverTimezone=Asia/Shanghai&lt;/property&gt;</span></span><br><span class=\"line\">        &lt;property name=<span class=\"string\">&quot;user&quot;</span>&gt;root&lt;/property&gt;</span><br><span class=\"line\">        &lt;property name=<span class=\"string\">&quot;password&quot;</span>&gt;www.LCG.com&lt;/property&gt;</span><br><span class=\"line\">        &lt;property name=<span class=\"string\">&quot;initialPoolSize&quot;</span>&gt;<span class=\"number\">10</span>&lt;/property&gt;</span><br><span class=\"line\">        &lt;property name=<span class=\"string\">&quot;maxPoolSize&quot;</span>&gt;<span class=\"number\">20</span>&lt;/property&gt;</span><br><span class=\"line\">    &lt;/<span class=\"keyword\">default</span>-config&gt;</span><br><span class=\"line\">&lt;/c3p0-config&gt;</span><br></pre></td></tr></table></figure>\n<p>◇使用</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">C3P0Sample</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">//1.加载配置文件</span></span><br><span class=\"line\">        <span class=\"comment\">//2.创建DataSource</span></span><br><span class=\"line\">        DataSource dataSource = <span class=\"keyword\">new</span> ComboPooledDataSource();</span><br><span class=\"line\">        <span class=\"comment\">//3.得到数据库连接</span></span><br><span class=\"line\">        Connection conn = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">        PreparedStatement psmt = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">        ResultSet rs = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">        .....</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"Apache-Commons-DBUtils\"><a href=\"#Apache-Commons-DBUtils\" class=\"headerlink\" title=\"Apache Commons DBUtils\"></a>Apache Commons DBUtils</h3><p>◇commons-dbutils是Apache提供的开源JDBC工具类库<br>◇它是对JDBC的简单封装,学习成本极低<br>◇使用commons-dbutils可以极大简化JDBC编码工作量  </p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * Apache DBUtils + Druid联合使用</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">DbUtilsSample</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">query</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">        Properties properties = <span class=\"keyword\">new</span> Properties();</span><br><span class=\"line\">        String propertyFile = </span><br><span class=\"line\">            DruidSample.class.getResource(<span class=\"string\">&quot;/druid-config.properties&quot;</span>).getPath();</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            propertyFile = <span class=\"keyword\">new</span> URLDecoder().decode(propertyFile, <span class=\"string\">&quot;UTF-8&quot;</span>);</span><br><span class=\"line\">            properties.load(<span class=\"keyword\">new</span> FileInputStream(propertyFile));</span><br><span class=\"line\">            DataSource dataSource = DruidDataSourceFactory.createDataSource(properties);</span><br><span class=\"line\">            <span class=\"comment\">//利用Apache DbUtils大幅简化了数据的提取过程</span></span><br><span class=\"line\">            <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">             * BeanListHandler将结果集包装成list对象</span></span><br><span class=\"line\"><span class=\"comment\">             * Object[]&#123;1&#125;用来传递参数，这里表示？=1</span></span><br><span class=\"line\"><span class=\"comment\">             */</span></span><br><span class=\"line\">            QueryRunner qr = <span class=\"keyword\">new</span> QueryRunner(dataSource);</span><br><span class=\"line\">            List&lt;Employee&gt; list =  qr.query(<span class=\"string\">&quot;select * from employee limit ?,10&quot;</span>,</span><br><span class=\"line\">                    <span class=\"keyword\">new</span> BeanListHandler&lt;&gt;(Employee.class),</span><br><span class=\"line\">                    <span class=\"keyword\">new</span> Object[]&#123;<span class=\"number\">1</span>&#125;);</span><br><span class=\"line\">            <span class=\"keyword\">for</span> (Employee emp : list) &#123;</span><br><span class=\"line\">                System.out.println(emp.getEname()+<span class=\"string\">&quot;--&quot;</span>+emp.getSalary());</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</span><br><span class=\"line\">            e.printStackTrace();</span><br><span class=\"line\">        &#125;<span class=\"comment\">//自动关闭数据库连接</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">update</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">        Properties properties = <span class=\"keyword\">new</span> Properties();</span><br><span class=\"line\">        String propertyFile = </span><br><span class=\"line\">            DruidSample.class.getResource(<span class=\"string\">&quot;/druid-config.properties&quot;</span>).getPath();</span><br><span class=\"line\">        Connection conn = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            propertyFile = <span class=\"keyword\">new</span> URLDecoder().decode(propertyFile, <span class=\"string\">&quot;UTF-8&quot;</span>);</span><br><span class=\"line\">            properties.load(<span class=\"keyword\">new</span> FileInputStream(propertyFile));</span><br><span class=\"line\">            DataSource dataSource = DruidDataSourceFactory.createDataSource(properties);</span><br><span class=\"line\">            conn = dataSource.getConnection();<span class=\"comment\">//创建连接</span></span><br><span class=\"line\">            conn.setAutoCommit(<span class=\"keyword\">false</span>);<span class=\"comment\">//关闭自动提交</span></span><br><span class=\"line\">            String sql1 = <span class=\"string\">&quot;update employee set salary=salary+10000 where eno=?&quot;</span>;</span><br><span class=\"line\">            String sql2 = <span class=\"string\">&quot;update employee set salary=salary-1000 where eno=?&quot;</span>;</span><br><span class=\"line\">            QueryRunner qr = <span class=\"keyword\">new</span> QueryRunner();</span><br><span class=\"line\">            qr.update(conn,sql1,<span class=\"keyword\">new</span> Object[]&#123;<span class=\"number\">1</span>&#125;);</span><br><span class=\"line\">            qr.update(conn, sql2, <span class=\"keyword\">new</span> Object[]&#123;<span class=\"number\">100</span>&#125;);</span><br><span class=\"line\">            conn.commit();</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</span><br><span class=\"line\">            e.printStackTrace();</span><br><span class=\"line\">            <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (conn!=<span class=\"keyword\">null</span>&amp;&amp;!conn.isClosed())&#123;</span><br><span class=\"line\">                    conn.rollback();</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125; <span class=\"keyword\">catch</span> (SQLException e1) &#123;</span><br><span class=\"line\">                e1.printStackTrace();</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;<span class=\"keyword\">finally</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span>(conn!=<span class=\"keyword\">null</span>&amp;&amp;!conn.isClosed())&#123;</span><br><span class=\"line\">                    conn.close();<span class=\"comment\">//对数据库连接进行回收，前面手动创建了连接</span></span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125; <span class=\"keyword\">catch</span> (SQLException e) &#123;</span><br><span class=\"line\">                e.printStackTrace();</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> </span>&#123;</span><br><span class=\"line\">        query();</span><br><span class=\"line\">        <span class=\"comment\">//update();</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n","categories":["Java数据库","Java数据库开发基础"],"tags":["数据库"]},{"title":"Java反射","url":"/p/7c7c.html","content":"<h2 id=\"课程介绍\"><a href=\"#课程介绍\" class=\"headerlink\" title=\"课程介绍\"></a>课程介绍</h2><p>◇介绍反射及作用<br>◇讲解反射四个核心类<br>◇反射在项目中的应用 </p>\n<h2 id=\"主要知识点\"><a href=\"#主要知识点\" class=\"headerlink\" title=\"主要知识点\"></a>主要知识点</h2><p>◇反射的作用<br>◇Class类<br>◇Constructor构造方法类<br>◇Method方法类<br>◇Field成员变量类  </p>\n<h2 id=\"什么是反射Reflect\"><a href=\"#什么是反射Reflect\" class=\"headerlink\" title=\"什么是反射Reflect\"></a>什么是反射Reflect</h2><p>◇反射(Reflect)是在运行时动态访问类与对象的技术<br>◇反射是JDK1.2版本后的高级特性,隶属于java.lang.reflect<br>◇大多数Java框架都基于反射实现参数配置、动态注入等特性<br>◇反射方法与传统方法对比,传统方法要增加乘法类时需要再写一个if else而反射方法支持动态增加方法的功能</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">    * 传统的创建对象方式</span></span><br><span class=\"line\"><span class=\"comment\">    */</span></span><br><span class=\"line\">   <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">case1</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">       Scanner scanner = <span class=\"keyword\">new</span> Scanner(System.in);</span><br><span class=\"line\">       System.out.print(<span class=\"string\">&quot;请输入计算类名:&quot;</span>);</span><br><span class=\"line\">       String op = scanner.next();</span><br><span class=\"line\">       System.out.print(<span class=\"string\">&quot;请输入a:&quot;</span>);</span><br><span class=\"line\">       <span class=\"keyword\">int</span> a = scanner.nextInt();</span><br><span class=\"line\">       System.out.print(<span class=\"string\">&quot;请输入b:&quot;</span>);</span><br><span class=\"line\">       <span class=\"keyword\">int</span> b = scanner.nextInt();</span><br><span class=\"line\">       MathOperation mathOperation = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">       <span class=\"keyword\">if</span>(op.equals(<span class=\"string\">&quot;Addition&quot;</span>))&#123;</span><br><span class=\"line\">           mathOperation = <span class=\"keyword\">new</span> Addition();</span><br><span class=\"line\">       &#125;<span class=\"keyword\">else</span> <span class=\"keyword\">if</span>(op.equals(<span class=\"string\">&quot;Subtraction&quot;</span>)) &#123;</span><br><span class=\"line\">           mathOperation = <span class=\"keyword\">new</span> Subtraction();</span><br><span class=\"line\">       &#125;<span class=\"keyword\">else</span> <span class=\"keyword\">if</span>(op.equals(<span class=\"string\">&quot;Multiplication&quot;</span>))&#123;</span><br><span class=\"line\">           mathOperation = <span class=\"keyword\">new</span> Multiplication();</span><br><span class=\"line\">       &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">           System.out.println(<span class=\"string\">&quot;无效的计算类&quot;</span>);</span><br><span class=\"line\">           <span class=\"keyword\">return</span>;</span><br><span class=\"line\">       &#125;</span><br><span class=\"line\">       <span class=\"keyword\">float</span> result = mathOperation.operate(a, b);</span><br><span class=\"line\">       System.out.println(result);</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">   <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">    * 利用反射创建对象更加灵活</span></span><br><span class=\"line\"><span class=\"comment\">    */</span></span><br><span class=\"line\">   <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">case2</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">       Scanner scanner = <span class=\"keyword\">new</span> Scanner(System.in);</span><br><span class=\"line\">       System.out.print(<span class=\"string\">&quot;请输入计算类名:&quot;</span>);</span><br><span class=\"line\">       String op = scanner.next();</span><br><span class=\"line\">       System.out.print(<span class=\"string\">&quot;请输入a:&quot;</span>);</span><br><span class=\"line\">       <span class=\"keyword\">int</span> a = scanner.nextInt();</span><br><span class=\"line\">       System.out.print(<span class=\"string\">&quot;请输入b:&quot;</span>);</span><br><span class=\"line\">       <span class=\"keyword\">int</span> b = scanner.nextInt();</span><br><span class=\"line\">       MathOperation mathOperation = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">       <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">           mathOperation = </span><br><span class=\"line\">               (MathOperation) Class.forName(<span class=\"string\">&quot;com.lcg.reflect.&quot;</span> + op).newInstance();</span><br><span class=\"line\">       &#125;<span class=\"keyword\">catch</span>(Exception e)&#123;</span><br><span class=\"line\">           System.out.println(<span class=\"string\">&quot;无效的计算类&quot;</span>);</span><br><span class=\"line\">           <span class=\"keyword\">return</span>;</span><br><span class=\"line\">       &#125;</span><br><span class=\"line\">       <span class=\"keyword\">float</span> result = mathOperation.operate(a, b);</span><br><span class=\"line\">       System.out.println(result);</span><br><span class=\"line\">   &#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"反射的核心类\"><a href=\"#反射的核心类\" class=\"headerlink\" title=\"反射的核心类\"></a>反射的核心类</h2><p>◇Class类<br>◇Constructor构造方法类<br>◇Method方法类<br>◇Field成员变量类 </p>\n<h2 id=\"Class类\"><a href=\"#Class类\" class=\"headerlink\" title=\"Class类\"></a>Class类</h2><p>◇Class是JVM中代表”类和接口”的类<br>◇Class对象具体包含了某个特定类的结构信息<br>◇通过Class对象可获取对应类的构造方法/方法/成员变量  </p>\n<h3 id=\"Class核心方法\"><a href=\"#Class核心方法\" class=\"headerlink\" title=\"Class核心方法\"></a>Class核心方法</h3><p><img src=\"/p/7c7c/1627994260419-a7f327ff-16ef-4c68-82b0-f4bf86f15749.png\" class=\"lazyload\" data-srcset=\"/p/7c7c/1627994260419-a7f327ff-16ef-4c68-82b0-f4bf86f15749.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"></p>\n<h3 id=\"利用Class创建对象\"><a href=\"#利用Class创建对象\" class=\"headerlink\" title=\"利用Class创建对象\"></a>利用Class创建对象</h3><figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ClassSample</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            <span class=\"comment\">//Class.forName()方法将指定的类加载到jvm,并返回对应Class对象(得到员工类对象)</span></span><br><span class=\"line\">            Class employeeClass = Class.forName(<span class=\"string\">&quot;com.imooc.reflect.entity.Employee&quot;</span>);</span><br><span class=\"line\">            System.out.println(<span class=\"string\">&quot;Employee已被加载到jvm&quot;</span>);</span><br><span class=\"line\">            <span class=\"comment\">//newInstance通过默认构造方法创建新的对象(实例化),返回Object对象，需要强制转换</span></span><br><span class=\"line\">            Employee emp = (Employee)employeeClass.newInstance();</span><br><span class=\"line\">            System.out.println(emp);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (ClassNotFoundException e) &#123;</span><br><span class=\"line\">            <span class=\"comment\">//类名与类路径书写错误是抛出&quot;类无法找到&quot;异常</span></span><br><span class=\"line\">            e.printStackTrace();</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (IllegalAccessException e) &#123;</span><br><span class=\"line\">            <span class=\"comment\">//非法访问异常,当在作用域外访问对象方法或成员变量时抛出</span></span><br><span class=\"line\">            e.printStackTrace();</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (InstantiationException e) &#123;</span><br><span class=\"line\">            <span class=\"comment\">//对象无法被实例化,抛出&quot;实例化异常&quot;</span></span><br><span class=\"line\">            e.printStackTrace();<span class=\"comment\">//抽象类(abstract)无法被实例化</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"Constructor构造方法类\"><a href=\"#Constructor构造方法类\" class=\"headerlink\" title=\"Constructor构造方法类\"></a>Constructor构造方法类</h2><p>◇Constructor类是对Java类中的构造方法的抽象<br>◇Contructor对象包含了具体类的某个具体构造方法的声明<br>◇通过Constructor对象调用带参构造方法创建对象  </p>\n<h3 id=\"Constructor类核心方法\"><a href=\"#Constructor类核心方法\" class=\"headerlink\" title=\"Constructor类核心方法\"></a>Constructor类核心方法</h3><p><img src=\"/p/7c7c/1627996525920-b349474c-5ebe-4cda-a6fa-dcf70573d893.png\" class=\"lazyload\" data-srcset=\"/p/7c7c/1627996525920-b349474c-5ebe-4cda-a6fa-dcf70573d893.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"></p>\n<h3 id=\"利用Constructor创建对象\"><a href=\"#利用Constructor创建对象\" class=\"headerlink\" title=\"利用Constructor创建对象\"></a>利用Constructor创建对象</h3><figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ConstructorSample</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            <span class=\"comment\">//得到员工类的类对象</span></span><br><span class=\"line\">            Class employeeClass = Class.forName(<span class=\"string\">&quot;com.lcg.reflect.entity.Employee&quot;</span>);</span><br><span class=\"line\">            <span class=\"comment\">//得到Employee类中包含有四个参数的构造方法对象,Class[]类型数组</span></span><br><span class=\"line\">            Constructor constructor = employeeClass.getConstructor(<span class=\"keyword\">new</span> Class[]&#123;</span><br><span class=\"line\">                    Integer.class,String.class,Float.class,String.class</span><br><span class=\"line\">            &#125;);</span><br><span class=\"line\">            <span class=\"comment\">//通过指定构造方法传入数据,创建对象</span></span><br><span class=\"line\">            Employee employee = (Employee) constructor.newInstance(<span class=\"keyword\">new</span> Object[]&#123;</span><br><span class=\"line\">                    <span class=\"number\">100</span>,<span class=\"string\">&quot;李磊&quot;</span>,<span class=\"number\">3000f</span>,<span class=\"string\">&quot;研发部&quot;</span></span><br><span class=\"line\">            &#125;);</span><br><span class=\"line\">            System.out.println(employee);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (ClassNotFoundException e) &#123;</span><br><span class=\"line\">            e.printStackTrace();</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (NoSuchMethodException e) &#123;</span><br><span class=\"line\">            <span class=\"comment\">//没有找到与之对应格式的方法</span></span><br><span class=\"line\">            e.printStackTrace();</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (IllegalAccessException e) &#123;</span><br><span class=\"line\">            e.printStackTrace();</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (InstantiationException e) &#123;</span><br><span class=\"line\">            e.printStackTrace();</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (InvocationTargetException e) &#123;</span><br><span class=\"line\">            <span class=\"comment\">//当被调用的方法的内部抛出了异常而没有被捕获时</span></span><br><span class=\"line\">            e.printStackTrace();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"Method方法类\"><a href=\"#Method方法类\" class=\"headerlink\" title=\"Method方法类\"></a>Method方法类</h2><p>◇Method对象指代某个类中的方法的描述<br>◇Method对象使用classObj.getMethod()方法获取<br>◇通过Method对象调用指定对象的对应方法  </p>\n<h3 id=\"Method类核心方法\"><a href=\"#Method类核心方法\" class=\"headerlink\" title=\"Method类核心方法\"></a>Method类核心方法</h3><p><img src=\"/p/7c7c/1627996618023-85940d99-f781-4daf-8279-76c4a76ff3c6.png\" class=\"lazyload\" data-srcset=\"/p/7c7c/1627996618023-85940d99-f781-4daf-8279-76c4a76ff3c6.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"></p>\n<h3 id=\"利用Method执行方法\"><a href=\"#利用Method执行方法\" class=\"headerlink\" title=\"利用Method执行方法\"></a>利用Method执行方法</h3><figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 利用Method方法类调用</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MethodSample</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            Class employeeClass = Class.forName(<span class=\"string\">&quot;com.lcg.reflect.entity.Employee&quot;</span>);</span><br><span class=\"line\">            Constructor constructor = employeeClass.getConstructor(<span class=\"keyword\">new</span> Class[]&#123;</span><br><span class=\"line\">                    Integer.class, String.class, Float.class, String.class</span><br><span class=\"line\">            &#125;);</span><br><span class=\"line\">            <span class=\"comment\">//传入参数时用Object[]对象数组</span></span><br><span class=\"line\">            Employee employee = (Employee) constructor.newInstance(<span class=\"keyword\">new</span> Object[]&#123;</span><br><span class=\"line\">                    <span class=\"number\">100</span>, <span class=\"string\">&quot;李磊&quot;</span>, <span class=\"number\">3000f</span>, <span class=\"string\">&quot;研发部&quot;</span></span><br><span class=\"line\">            &#125;);</span><br><span class=\"line\">            Method updateSalaryMethod = employeeClass.getMethod(<span class=\"string\">&quot;updateSalary&quot;</span>, <span class=\"keyword\">new</span> Class[]&#123;</span><br><span class=\"line\">                    Float.class</span><br><span class=\"line\">            &#125;);</span><br><span class=\"line\">            Employee employee1 = (Employee) updateSalaryMethod.invoke(employee, <span class=\"keyword\">new</span> Object[]&#123;<span class=\"number\">1000f</span>&#125;);</span><br><span class=\"line\">            System.out.println(employee1);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (ClassNotFoundException e) &#123;</span><br><span class=\"line\">            e.printStackTrace();</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (NoSuchMethodException e) &#123;</span><br><span class=\"line\">            e.printStackTrace();</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (IllegalAccessException e) &#123;</span><br><span class=\"line\">            e.printStackTrace();</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (InstantiationException e) &#123;</span><br><span class=\"line\">            e.printStackTrace();</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (InvocationTargetException e) &#123;</span><br><span class=\"line\">            e.printStackTrace();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"Field成员变量类\"><a href=\"#Field成员变量类\" class=\"headerlink\" title=\"Field成员变量类\"></a>Field成员变量类</h2><p>◇Field对应某个具体类中的成员变量的声明<br>◇Field对象使用classObj.getField()方法获取<br>◇通过Field对象可为某对象成员变量赋值/取值  </p>\n<h3 id=\"Field类核心方法\"><a href=\"#Field类核心方法\" class=\"headerlink\" title=\"Field类核心方法\"></a>Field类核心方法</h3><p><img src=\"/p/7c7c/1627996714885-1ad3a503-3276-4d82-aa14-3ed8abf131de.png\" class=\"lazyload\" data-srcset=\"/p/7c7c/1627996714885-1ad3a503-3276-4d82-aa14-3ed8abf131de.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"></p>\n<h3 id=\"利用Field赋值与取值\"><a href=\"#利用Field赋值与取值\" class=\"headerlink\" title=\"利用Field赋值与取值\"></a>利用Field赋值与取值</h3><figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">...</span><br><span class=\"line\"><span class=\"comment\">//获取员工姓名Field成员变量对象</span></span><br><span class=\"line\">Field enameField = employeeClass.getField(<span class=\"string\">&quot;ename&quot;</span>);</span><br><span class=\"line\"><span class=\"comment\">//成员变量赋值</span></span><br><span class=\"line\">enameField.set(employee,<span class=\"string\">&quot;李雷&quot;</span>);</span><br><span class=\"line\"><span class=\"comment\">//成员变量取值，参数为对象名</span></span><br><span class=\"line\">String ename = (String)enameField.get(employee);</span><br></pre></td></tr></table></figure>\n<h2 id=\"getDeclared系列方法\"><a href=\"#getDeclared系列方法\" class=\"headerlink\" title=\"getDeclared系列方法\"></a>getDeclared系列方法</h2><p>◇getDeclaredConstructor(s)|Method(s)|Field(s)获取对应对象(构造方法，方法，成员变量) ,+s表示获取所有(多个)<br>◇getConstructor(s)|Method(s)|Field(s)只能获取public对象<br>◇访问非作用域内构造方法、方法、成员变量,会抛出异常<br>◇public变量.get()直接获取，非public变量先通过类对象获取到get方法再来调用get方法获取</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">Class employeeClass = Class.forName(<span class=\"string\">&quot;com.lcg.reflect.entity.Employee&quot;</span>);</span><br><span class=\"line\">Constructor constructor = employeeClass.getConstructor(<span class=\"keyword\">new</span> Class[]&#123;</span><br><span class=\"line\">    Integer.class, String.class, Float.class, String.class</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">Employee employee = (Employee) constructor.newInstance(<span class=\"keyword\">new</span> Object[]&#123;</span><br><span class=\"line\">    <span class=\"number\">100</span>, <span class=\"string\">&quot;李磊&quot;</span>, <span class=\"number\">3000f</span>, <span class=\"string\">&quot;研发部&quot;</span></span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\"><span class=\"comment\">//获取当前类所有成员变量</span></span><br><span class=\"line\">Field[] fields = employeeClass.getDeclaredFields();</span><br><span class=\"line\"><span class=\"keyword\">for</span>(Field field : fields)&#123;</span><br><span class=\"line\">    <span class=\"comment\">//System.out.println(field.getName());</span></span><br><span class=\"line\">    <span class=\"comment\">//对成员变量区分对待</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span>(field.getModifiers() == <span class=\"number\">1</span>)&#123; <span class=\"comment\">//pubilc修饰</span></span><br><span class=\"line\">        Object val = field.get(employee);</span><br><span class=\"line\">        System.out.println(field.getName() + <span class=\"string\">&quot;:&quot;</span> + val);</span><br><span class=\"line\">    &#125;<span class=\"keyword\">else</span> <span class=\"keyword\">if</span>(field.getModifiers() == <span class=\"number\">2</span>)&#123; <span class=\"comment\">//private修饰</span></span><br><span class=\"line\">        <span class=\"comment\">//构造出get方法名,eg: getSalary();</span></span><br><span class=\"line\">        String methodName = <span class=\"string\">&quot;get&quot;</span> + field.getName().substring(<span class=\"number\">0</span>,<span class=\"number\">1</span>).toUpperCase()</span><br><span class=\"line\">            + field.getName().substring(<span class=\"number\">1</span>);</span><br><span class=\"line\">        Method getMethod = employeeClass.getMethod(methodName);<span class=\"comment\">//获取类的get方法;</span></span><br><span class=\"line\">        Object ret = getMethod.invoke(employee);<span class=\"comment\">//执行get方法</span></span><br><span class=\"line\">        System.out.println(field.getName() + <span class=\"string\">&quot;:&quot;</span> + ret);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"反射在项目中的应用\"><a href=\"#反射在项目中的应用\" class=\"headerlink\" title=\"反射在项目中的应用\"></a>反射在项目中的应用</h2><p>◇网站的国际化</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Application</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">say</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">        Properties properties = <span class=\"keyword\">new</span> Properties();<span class=\"comment\">//加载指定配置文件</span></span><br><span class=\"line\">        <span class=\"comment\">//获取配置文件路径</span></span><br><span class=\"line\">        String configPath = Application.class.getResource(<span class=\"string\">&quot;/config.properties&quot;</span>).getPath();</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            configPath = <span class=\"keyword\">new</span> URLDecoder().decode(configPath,<span class=\"string\">&quot;UTF-8&quot;</span>);</span><br><span class=\"line\">            properties.load(<span class=\"keyword\">new</span> FileInputStream(configPath));</span><br><span class=\"line\">            <span class=\"comment\">//用 Properties.getProperty来读取配置文件里面的(language属性)的属性值</span></span><br><span class=\"line\">            String language = properties.getProperty(<span class=\"string\">&quot;language&quot;</span>);</span><br><span class=\"line\">            <span class=\"comment\">//利用language告知Class获取哪一个指定类并实例化</span></span><br><span class=\"line\">            I18N i18n = (I18N)Class.forName(language).newInstance();</span><br><span class=\"line\">            System.out.println(i18n.say());</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</span><br><span class=\"line\">            e.printStackTrace();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> </span>&#123;</span><br><span class=\"line\">        Application.say();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n","categories":["Java数据库","框架前置知识"],"tags":["反射"]},{"title":"Linux基础和Java环境搭建","url":"/p/c40f.html","content":"<h2 id=\"内容简介\"><a href=\"#内容简介\" class=\"headerlink\" title=\"内容简介\"></a>内容简介</h2><p>◇Linux基础入门<br><img src=\"/p/c40f/1629881600929-861c5540-c71f-4186-b9f5-ae2f5453bf19.png\" class=\"lazyload\" data-srcset=\"/p/c40f/1629881600929-861c5540-c71f-4186-b9f5-ae2f5453bf19.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"><br>◇Linux进阶应用<br><img src=\"/p/c40f/1629902441633-e553b490-a782-4a8c-bf13-112f3324acb5.png\" class=\"lazyload\" data-srcset=\"/p/c40f/1629902441633-e553b490-a782-4a8c-bf13-112f3324acb5.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"><br>◇Redis应用入门<br><img src=\"/p/c40f/1629902552805-78f40e53-3374-43dc-8d18-b673821de5ad.png\" class=\"lazyload\" data-srcset=\"/p/c40f/1629902552805-78f40e53-3374-43dc-8d18-b673821de5ad.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"></p>\n<h2 id=\"主要知识点\"><a href=\"#主要知识点\" class=\"headerlink\" title=\"主要知识点\"></a>主要知识点</h2><p>◇介绍Linux与CentOS      ◇讲解Linux基础命令<br>◇yum应用安装与卸载     ◇CentOS的权限与系统安全<br>◇Linux文本工具与命令   ◇部署OA项目至Linux服务器  </p>\n<h2 id=\"操作系统\"><a href=\"#操作系统\" class=\"headerlink\" title=\"操作系统\"></a>操作系统</h2><h3 id=\"什么是操作系统\"><a href=\"#什么是操作系统\" class=\"headerlink\" title=\"什么是操作系统\"></a>什么是操作系统</h3><p>◇操作系统(Operating System)是应用程序运行的基础支撑环境<br>◇操作系统作用是管理和控制计算机系统的硬件与软件资源<br>◇Intel x86架构上常见的操作系统:Windows、Linux、Unix…  </p>\n<h3 id=\"Linux操作系统\"><a href=\"#Linux操作系统\" class=\"headerlink\" title=\"Linux操作系统\"></a>Linux操作系统</h3><p>◇Linux是开源的基于Intel x86架构的类Unix多用户操作系统<br>◇Linux是目前最主要的服务器端操作系统<br>◇互联网大厂都在使用Linux作为服务器主要操作系统  </p>\n<h3 id=\"Linux为什么受欢迎\"><a href=\"#Linux为什么受欢迎\" class=\"headerlink\" title=\"Linux为什么受欢迎\"></a>Linux为什么受欢迎</h3><p>◇免费使用，自由传播    ◇支持多任务、多用户、多CPU<br>◇高效而灵活                  ◇兼容任意x86架构计算机<br>◇强大易用的系统命令    ◇完整的应用软件生态  </p>\n<h3 id=\"Linux发行版本\"><a href=\"#Linux发行版本\" class=\"headerlink\" title=\"Linux发行版本\"></a>Linux发行版本</h3><p>◇Linux系统内核(kernel)提供了Linux操作系统的核心功能<br>◇不同开发商在内核基础上扩展封装,形成了不同发行版本<br>◇常见发行版：Red Hat Linux、CentOS、Ubuntu、SUSE…  </p>\n<h3 id=\"Linux发行版选择建议\"><a href=\"#Linux发行版选择建议\" class=\"headerlink\" title=\"Linux发行版选择建议\"></a>Linux发行版选择建议</h3><p>◇桌面系统:Ubuntu<br>◇服务器操作系统: CentOS（免费）、Red Hat Linux（收费）<br>◇特定需求: Debian(稳定性)、Fedora(新特性)、麒麟Linux(国产)  </p>\n<h2 id=\"CentOS-社区企业操作系统\"><a href=\"#CentOS-社区企业操作系统\" class=\"headerlink\" title=\"CentOS - 社区企业操作系统\"></a>CentOS - 社区企业操作系统</h2><h3 id=\"简介\"><a href=\"#简介\" class=\"headerlink\" title=\"简介\"></a>简介</h3><p>◇基于Red Hat Enterprice Linux 的开源企业级Linux发行版本<br>◇各版本CentOS都会获得十年的支持,与RHEL保持同步更新<br>◇CentOS采用社区支持,同时修正了RHEL许多BUG   </p>\n<h3 id=\"CentOS版本选择\"><a href=\"#CentOS版本选择\" class=\"headerlink\" title=\"CentOS版本选择\"></a>CentOS版本选择</h3><p>◇CentOS 5/6 : 历史版本,已被淘汰<br>◇CentOS 7 : 主流版本,稳定成熟,大多数服务器的首选版本<br>◇CentOS 8 : 全新版本,基于最新内核,不排除存在漏洞隐患  </p>\n<h2 id=\"安装CentOS-7-7\"><a href=\"#安装CentOS-7-7\" class=\"headerlink\" title=\"安装CentOS 7.7\"></a>安装CentOS 7.7</h2><h3 id=\"CentOS-7-运行要求\"><a href=\"#CentOS-7-运行要求\" class=\"headerlink\" title=\"CentOS 7 运行要求\"></a>CentOS 7 运行要求</h3><p>◇CPU : 1核,建议2核以上<br>◇内存 : 1G,建议2G以上<br>◇硬盘 : 预留20G可用空间  </p>\n<h3 id=\"开启CPU虚拟化\"><a href=\"#开启CPU虚拟化\" class=\"headerlink\" title=\"开启CPU虚拟化\"></a>开启CPU虚拟化</h3><p>◇Ctrl+Alt+Delete打开任务管理器-&gt;性能-&gt;查看右下角虚拟化是否已启用<br>◇若未启动,则应开启CPU虚拟化，由于电脑型号不同，具体方法可百度</p>\n<h3 id=\"安装VMware-Workstation虚拟机\"><a href=\"#安装VMware-Workstation虚拟机\" class=\"headerlink\" title=\"安装VMware Workstation虚拟机\"></a>安装VMware Workstation虚拟机</h3><p>◇<a href=\"https://blog.csdn.net/weixin_36522099/article/details/106959969\">在VMware中搭建CentOS </a> </p>\n<h2 id=\"Linux系统目录\"><a href=\"#Linux系统目录\" class=\"headerlink\" title=\"Linux系统目录\"></a>Linux系统目录</h2><p>Linux倒挂树形目录结构<br><img src=\"/p/c40f/1629975406516-bb1ea1f7-fab0-4da8-8303-a12633159db2.png\" class=\"lazyload\" data-srcset=\"/p/c40f/1629975406516-bb1ea1f7-fab0-4da8-8303-a12633159db2.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"><br>◇”/“是所有目录的顶点,称为”根目录”<br>◇不同目录下的数据可分布在不同磁盘,所有目录按规则组织与命名<br>◇Linux也区分绝对路径与相对路径  </p>\n<h3 id=\"常见系统目录\"><a href=\"#常见系统目录\" class=\"headerlink\" title=\"常见系统目录\"></a>常见系统目录</h3><p><img src=\"/p/c40f/1629975580379-b983d605-acc6-4e15-be66-c7eb638aea3d.png\" class=\"lazyload\" data-srcset=\"/p/c40f/1629975580379-b983d605-acc6-4e15-be66-c7eb638aea3d.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"><br><img src=\"/p/c40f/1629975605738-db5bbc1c-10c7-45fa-a10f-b3dda57685e7.png\" class=\"lazyload\" data-srcset=\"/p/c40f/1629975605738-db5bbc1c-10c7-45fa-a10f-b3dda57685e7.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"></p>\n<h2 id=\"Linux远程管理\"><a href=\"#Linux远程管理\" class=\"headerlink\" title=\"Linux远程管理\"></a>Linux远程管理</h2><h3 id=\"SSH客户端\"><a href=\"#SSH客户端\" class=\"headerlink\" title=\"SSH客户端\"></a>SSH客户端</h3><p> ◇SSH是专为远程登录和其他网络服务提供的安全性协议<br>◇SSH分为两个不兼容版本1.x与2.x,默认通过SSH2.x连接<br>◇基于SSH远程连接工具有很多,最常见的是Xshell与SecureCRT </p>\n<h3 id=\"Xshell与Xftp\"><a href=\"#Xshell与Xftp\" class=\"headerlink\" title=\"Xshell与Xftp\"></a>Xshell与Xftp</h3><p>◇Xshell是著名的Linux客户端,常用于在Windows下远程访问<br>◇Xshell同时还支持Telent、RLogin、Serial等其他连接方式<br>◇Xftp是Xshell配套组件，用于向服务器上传/下载文件  </p>\n<h3 id=\"Xshell与Xftp安装与配置\"><a href=\"#Xshell与Xftp安装与配置\" class=\"headerlink\" title=\"Xshell与Xftp安装与配置\"></a>Xshell与Xftp安装与配置</h3><p>◇在官方网站安装个人版<br>◇在虚拟机终端输入ifconfig查看虚拟机的ip地址<br>◇新建xshell会话，连接后输入用户名和密码即可<br><img src=\"/p/c40f/1629978963671-fd31e45c-c4c0-4fc0-b4eb-a66bd9787a1c.png\" class=\"lazyload\" data-srcset=\"/p/c40f/1629978963671-fd31e45c-c4c0-4fc0-b4eb-a66bd9787a1c.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\" style=\"zoom: 67%;\"><br>◇在Xshell顶部绿色的新建文件传输打开，可以进行文件的传输<br><img src=\"/p/c40f/1629979354707-b035a667-88ab-4732-b0de-37ad49bfbcb7.png\" class=\"lazyload\" data-srcset=\"/p/c40f/1629979354707-b035a667-88ab-4732-b0de-37ad49bfbcb7.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"></p>\n<h2 id=\"Linux文件操作命令\"><a href=\"#Linux文件操作命令\" class=\"headerlink\" title=\"Linux文件操作命令\"></a>Linux文件操作命令</h2><h3 id=\"Linux命令格式\"><a href=\"#Linux命令格式\" class=\"headerlink\" title=\"Linux命令格式\"></a>Linux命令格式</h3><p>◇命令 [参数选项] [文件或路径] </p>\n<h3 id=\"Linux文件操作核心命令\"><a href=\"#Linux文件操作核心命令\" class=\"headerlink\" title=\"Linux文件操作核心命令\"></a>Linux文件操作核心命令</h3><p><img src=\"/p/c40f/1629979553331-35a0fe9d-22c7-4753-a083-a1a9916b591d.png\" class=\"lazyload\" data-srcset=\"/p/c40f/1629979553331-35a0fe9d-22c7-4753-a083-a1a9916b591d.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"><br>◇clear     清屏   ◇rmdir 删除空目录<br>◇cd时输入某个路径的前一个字母后可以按Tab进行自动补全<br>◇命令 –help可以查看命令的参数等相关信息<br>◇mv 重命名格式：mv old.c  new.c ;移动格式：mv old.c /xx/xx 也可以移动整个文件夹<br>◇不要轻易使用rm -rf，这样会强制迭代删除而不进行询问，rm -r迭代删除进行询问</p>\n<h3 id=\"vim文本编辑器\"><a href=\"#vim文本编辑器\" class=\"headerlink\" title=\"vim文本编辑器\"></a>vim文本编辑器</h3><p>◇vi是Linux重要的文字编辑工具,vim是它的增强版<br>◇vim用于在远程环境下用命令形式对文本进行在线编辑<br>◇用法格式: vim [选项] [文件] </p>\n<h3 id=\"vim三种模式\"><a href=\"#vim三种模式\" class=\"headerlink\" title=\"vim三种模式\"></a>vim三种模式</h3><p>◇普通模式:默认模式,文本只读,不可编辑<br>◇编辑模式:编辑文本模式,普通模式按i键进入,Esc键退出<br>◇命令模式:执行保存、搜索、退出等操作</p>\n<h3 id=\"vim重要快捷键\"><a href=\"#vim重要快捷键\" class=\"headerlink\" title=\"vim重要快捷键\"></a>vim重要快捷键</h3><p><img src=\"/p/c40f/1629980002766-5c22ebbf-1dc8-4840-9a9b-44410e4e2520.png\" class=\"lazyload\" data-srcset=\"/p/c40f/1629980002766-5c22ebbf-1dc8-4840-9a9b-44410e4e2520.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"></p>\n<h2 id=\"Linux文本工具\"><a href=\"#Linux文本工具\" class=\"headerlink\" title=\"Linux文本工具\"></a>Linux文本工具</h2><h3 id=\"常用文本工具\"><a href=\"#常用文本工具\" class=\"headerlink\" title=\"常用文本工具\"></a>常用文本工具</h3><p><img src=\"/p/c40f/1630068704114-ec0a4e45-4072-42bc-8618-ee730f5ffd2e.png\" class=\"lazyload\" data-srcset=\"/p/c40f/1630068704114-ec0a4e45-4072-42bc-8618-ee730f5ffd2e.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"></p>\n<h3 id=\"文件输入与输出\"><a href=\"#文件输入与输出\" class=\"headerlink\" title=\"文件输入与输出\"></a>文件输入与输出</h3><p>◇文件输入：&lt; (重写) 或者 &lt;&lt; (追加)          ◇文件输出：&gt; (重写) 或者 &gt;&gt; (追加)<br>◇echo “xxxx” &gt;&gt; log.txt 将xxxx文本追加写入到log.txt文件中<br>◇合并文件：cat hello.txt myname.txt &gt;&gt; full.txt<br>◇tail full.txt –显示文件尾部内容;   tail -n 2 full.txt –显示文件最后两行<br>◇tail -f full.txt –动态监测文件末尾所产生的新行; ctrl+c退出<br>◇grep lcg test.txt –查找test.txt文件中包含lcg字符串的文本行,字符串可以是正则表达式<br>◇grep -v lcg test.txt –查找test.txt文件中不包含lcg字符串的文本行<br>◇ll | grep -E “log[0-9]{1,5}.txt” –进行文件的筛选，查看所有日志文件 -E表示使用扩展正则表达式；{1,5}表示数字位数为1~5；</p>\n<h2 id=\"文件打包与压缩\"><a href=\"#文件打包与压缩\" class=\"headerlink\" title=\"文件打包与压缩\"></a>文件打包与压缩</h2><h3 id=\"Linux压缩程序-gzip\"><a href=\"#Linux压缩程序-gzip\" class=\"headerlink\" title=\"Linux压缩程序-gzip\"></a>Linux压缩程序-gzip</h3><p>◇gzip是Linux系统的文件压缩程序<br>◇gzip压缩包文件扩展名.gz<br>◇大流量的网站默认都在使用gzip进行数据压缩传输   </p>\n<h3 id=\"tar打包与压缩\"><a href=\"#tar打包与压缩\" class=\"headerlink\" title=\"tar打包与压缩\"></a>tar打包与压缩</h3><p>◇tar是Linux系统将多个文件打包和压缩的工具<br>◇tar本质是打包软件，扩展名.tar<br>◇tar可结合gzip或其他压缩工具实现打包压缩，扩展名.tar.gz<br>◇压缩命令: tar zcvf tomcat.tar.gz /usr/local/tomcat<br>◇解压缩命令: tar zxvf tomcat.tar.gz -C /usr/local/tomcat   </p>\n<h3 id=\"tar常用可选项\"><a href=\"#tar常用可选项\" class=\"headerlink\" title=\"tar常用可选项\"></a>tar常用可选项</h3><img src=\"/p/c40f/1630068871801-23d4fefb-c44f-409e-bb11-51dd710ab2f9.png\" class=\"lazyload\" data-srcset=\"/p/c40f/1630068871801-23d4fefb-c44f-409e-bb11-51dd710ab2f9.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\">\n\n<h2 id=\"安装与卸载应用程序\"><a href=\"#安装与卸载应用程序\" class=\"headerlink\" title=\"安装与卸载应用程序\"></a>安装与卸载应用程序</h2><h3 id=\"为CentOS安装应用程序\"><a href=\"#为CentOS安装应用程序\" class=\"headerlink\" title=\"为CentOS安装应用程序\"></a>为CentOS安装应用程序</h3><p>◇在CentOS中安装第三方应用程序包含两种方式:<br>◇rpm:Red Hat软件包管理器,相当于应用程序安装文件的执行者<br>◇编译安装:用户自己从网站下载程序源码进行编译安装 </p>\n<h3 id=\"yum与rpm的关系\"><a href=\"#yum与rpm的关系\" class=\"headerlink\" title=\"yum与rpm的关系\"></a>yum与rpm的关系</h3><p>◇rpm安装过程中,需要用户自己解决依赖问题<br>◇yum通过引入软件仓库,联网下载rpm包及依赖,并依次自动安装<br>◇yum是rpm的前端程序,其目的就是简化rpm的安装过程</p>\n<h3 id=\"yum常用命令\"><a href=\"#yum常用命令\" class=\"headerlink\" title=\"yum常用命令\"></a>yum常用命令</h3><p>◇yum search 应用名 #在仓库中查询是否存在指定应用<br>◇yum install -y 应用名 #全自动下载安装应用及其依赖<br>◇yum info 应用名 #查看软件详细信息<br>◇yum list installed 应用名 #查看已安装的应用程序<br>◇rpm -ql 应用名 #查看安装后输出的文件清单<br>◇yum remove -y 应用名 #全自动卸载指定应用  ，-y表示遇到询问都用y</p>\n<h2 id=\"编译方式安装\"><a href=\"#编译方式安装\" class=\"headerlink\" title=\"编译方式安装\"></a>编译方式安装</h2><h3 id=\"编译方式安装应用程序\"><a href=\"#编译方式安装应用程序\" class=\"headerlink\" title=\"编译方式安装应用程序\"></a>编译方式安装应用程序</h3><p>◇如yum仓库未提供rpm,往往需要采用编译安装方式<br>◇编译安装是指从应用官网下载源码后,对源码进行编译后使用<br>◇编译命令: make #使用对应编译器对源码编译生成可执行文件  </p>\n<h3 id=\"yum与编译安装比较\"><a href=\"#yum与编译安装比较\" class=\"headerlink\" title=\"yum与编译安装比较\"></a>yum与编译安装比较</h3><p><img src=\"/p/c40f/1630070373099-9af554f6-920f-4c76-9782-70dc5c1dc783.png\" class=\"lazyload\" data-srcset=\"/p/c40f/1630070373099-9af554f6-920f-4c76-9782-70dc5c1dc783.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"></p>\n<h3 id=\"编译安装Redis\"><a href=\"#编译安装Redis\" class=\"headerlink\" title=\"编译安装Redis\"></a>编译安装Redis</h3><p>◇利用xftp将下载好的压缩包文件上传到linux；然后解压；进入redis-4.0.14目录；安装gcc编译器：yum install -y gcc;<br>◇有时候第一次make编译出错后，可能改变了原来的文件结构，因此纠正错误后下一次编译时需要将解压后的目录删除重新解压；当出现Hint: It’s a good idea to run ‘make test’ ;)时代表编译成功；<br>◇编译安装后的应用程序redis-server存放在src中，在启动redis-server前需要加载上一级目录下的redis.conf配置文件;即启动命令为:./src/redis-server redis.conf  启动后ctrl+c退回命令状态</p>\n<h2 id=\"Linux进阶应用\"><a href=\"#Linux进阶应用\" class=\"headerlink\" title=\"Linux进阶应用\"></a>Linux进阶应用</h2><h3 id=\"Linux系统管理命令\"><a href=\"#Linux系统管理命令\" class=\"headerlink\" title=\"Linux系统管理命令\"></a>Linux系统管理命令</h3><p>◇使用ifconfig查看网卡ip<br><img src=\"/p/c40f/1630146548264-3229c8fc-d16f-4ace-9c4b-4d140a726bc0.png\" class=\"lazyload\" data-srcset=\"/p/c40f/1630146548264-3229c8fc-d16f-4ace-9c4b-4d140a726bc0.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"><br>◇netstat 查看网络端口号：netstat -tulpn 或 netstat -ano<br>◇Recv-Q:接收队列；Send-Q:发送队列; LISTEN表示网络状态正在被监听;PID:进程编号；Program name创建网络连接的应用<br><img src=\"/p/c40f/1630146738224-1f08c511-0871-4f93-8fdc-1b45678b64a5.png\" class=\"lazyload\" data-srcset=\"/p/c40f/1630146738224-1f08c511-0871-4f93-8fdc-1b45678b64a5.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"><br>◇netstat 常用选项<br><img src=\"/p/c40f/1630146946866-e7e838d8-a463-417b-9b9c-0603f83dfba4.png\" class=\"lazyload\" data-srcset=\"/p/c40f/1630146946866-e7e838d8-a463-417b-9b9c-0603f83dfba4.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"><br>◇查看进程: ps -ef ，箭头处5412指PID；杀掉进程：kill -9 PID<br>◇一般使用应用程序退出来关闭进程，而不是强制杀掉进程，因为可能造成数据丢失<br>◇ps -ef | grep vim ; | 表示通道，即ps -ef查询产生的数据像通过通道一样送入到后一个指令<br><img src=\"/p/c40f/1630147070833-32dca895-ace6-45ad-a972-0cb3f0471b45.png\" class=\"lazyload\" data-srcset=\"/p/c40f/1630147070833-32dca895-ace6-45ad-a972-0cb3f0471b45.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"></p>\n<h2 id=\"应用服务化\"><a href=\"#应用服务化\" class=\"headerlink\" title=\"应用服务化\"></a>应用服务化</h2><h3 id=\"简介-1\"><a href=\"#简介-1\" class=\"headerlink\" title=\"简介\"></a>简介</h3><p>◇ 应用服务化是指让应用程序以服务方式在系统后台运行<br>◇ Linux系统对服务化应用进行统一管理<br>◇ 服务管理命令：systemctl    </p>\n<h3 id=\"systemctl\"><a href=\"#systemctl\" class=\"headerlink\" title=\"systemctl\"></a>systemctl</h3><p><img src=\"/p/c40f/1630147494122-9ac16bd2-3b54-497a-be4c-2ef65b16ca12.png\" class=\"lazyload\" data-srcset=\"/p/c40f/1630147494122-9ac16bd2-3b54-497a-be4c-2ef65b16ca12.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"><br>◇.pid文件用来保存进程编号<br>◇将redis服务化，需要在/usr/lib/systemd/system目录下创建 vim redis.service；在文件中写入配置：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">[Unit]</span><br><span class=\"line\">Description=Redis</span><br><span class=\"line\">After=syslog.target network.target remote-fs.target nss-lookup.target #表示在这些服务启动以后才能启动redis</span><br><span class=\"line\"></span><br><span class=\"line\">[Service]</span><br><span class=\"line\">Type=forking #forking代表后台运行</span><br><span class=\"line\">PIDFile=/run/redis_6379.pid</span><br><span class=\"line\">#说明启动时执行server，加载配置文件</span><br><span class=\"line\">ExecStart=/home/lcg/0/redis-4.0.14/src/redis-server /home/lcg/0/redis-4.0.14/redis.conf</span><br><span class=\"line\">#关闭,-s采用正常流程进行退出；-9表示强制退出</span><br><span class=\"line\">ExecStop=/bin/kill -s QUIT $MAINPID</span><br><span class=\"line\">PrivateTmp=True #为每一个服务设置私有的Tmp临时文件目录</span><br><span class=\"line\"></span><br><span class=\"line\">[Install]</span><br><span class=\"line\">WantedBy=multi-user.target #将当前的redis服务分配到multi-user服务组上；</span><br></pre></td></tr></table></figure>\n<p>◇systemctl daemon-reload #对所有service进行重载;<br>◇systemctl start redis #启动服务； systemctl status redis #查看状态</p>\n<h2 id=\"Linux用户与权限\"><a href=\"#Linux用户与权限\" class=\"headerlink\" title=\"Linux用户与权限\"></a>Linux用户与权限</h2><h3 id=\"用户\"><a href=\"#用户\" class=\"headerlink\" title=\"用户\"></a>用户</h3><p>◇ Linux是多用户多任务系统,包含两个概念:用户与用户组<br>◇ 用户与账户是同一概念,用于登录系统与区分资源权限<br>◇ 用户让系统变的更安全,同时也保护了用户的个人数字资产</p>\n<h3 id=\"用户组\"><a href=\"#用户组\" class=\"headerlink\" title=\"用户组\"></a>用户组</h3><p>◇ 用户组就是将用户分组,隶属用户自动拥有组权限<br>◇ 一个用户可隶属于多个组,用户可任意切换当前组<br>◇ 用户组的出现让用户权限管理变更轻松 </p>\n<h3 id=\"用户与用户组常用命令\"><a href=\"#用户与用户组常用命令\" class=\"headerlink\" title=\"用户与用户组常用命令\"></a>用户与用户组常用命令</h3><p><img src=\"/p/c40f/1630152748335-c52d7d9a-f0cc-4e31-a1ef-204bfebbaead.png\" class=\"lazyload\" data-srcset=\"/p/c40f/1630152748335-c52d7d9a-f0cc-4e31-a1ef-204bfebbaead.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"><br>◇分组：usermod -g [组名] [用户名]<br>◇让用户拥有多个组： usermod -G [组名1],[组名2] [用户名];通过newgrp进行切换<br>◇将用户连接系统: 打开-&gt;创建系统副本：然后用新建的用户密码登录<br>◇groups #查看用户隶属于哪个组<br>◇chown用法：chown [用户名]:[组名] [文件名]</p>\n<h2 id=\"项目内部文件权限管理实践\"><a href=\"#项目内部文件权限管理实践\" class=\"headerlink\" title=\"项目内部文件权限管理实践\"></a>项目内部文件权限管理实践</h2><h3 id=\"文件权限代码表\"><a href=\"#文件权限代码表\" class=\"headerlink\" title=\"文件权限代码表\"></a>文件权限代码表</h3><p><img src=\"/p/c40f/1630153162614-19019fff-aa2c-483e-83e3-46715e47ab51.png\" class=\"lazyload\" data-srcset=\"/p/c40f/1630153162614-19019fff-aa2c-483e-83e3-46715e47ab51.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"><br>◇每个颜色表示一组，共三组；eg:drwxr-xr-x; 其中-代表没有对应属性，此处即没有w(完整的一组是rwx)<br>◇在目录上r-x不允许写是指不准修改目录名</p>\n<h3 id=\"chmod命令\"><a href=\"#chmod命令\" class=\"headerlink\" title=\"chmod命令\"></a>chmod命令</h3><p>◇ chmod 750: 组用户可读写，其他用户不允许访问<br>◇ chmod 777: 所有用户拥有完整权限<br>◇ chmod 700: 只有属主拥有完整权限<br>◇chmod  750 dev-document/(文件名/) #示例操作，</p>\n<h3 id=\"sudo超级管理员命令\"><a href=\"#sudo超级管理员命令\" class=\"headerlink\" title=\"sudo超级管理员命令\"></a>sudo超级管理员命令</h3><p>◇ sudo可以让普通用户拥有超级管理员的执行权限<br>◇ 普通用户要进行经过超级管理员授权才能使用<br>◇ 授权命令：visudo<br>◇普通模式下输入：100gg 快速定位到100行,无法再屏幕上看到命令；在此处的root ALL-(ALL) ALL下增加一行：<br>[用户名] ALL-(ALL) ALL 即可授权用户拥有sudo命令；第一个ALL代表用户可以从任意计算机进行连接；第二个ALL表示切换用户，最后一个ALL代表运行执行所有命令；<br>◇:wq保存文件后，使用命令visudo -c进行文件的格式检查;</p>\n<h2 id=\"CentOS7防火墙firewall\"><a href=\"#CentOS7防火墙firewall\" class=\"headerlink\" title=\"CentOS7防火墙firewall\"></a>CentOS7防火墙firewall</h2><h3 id=\"什么是防火墙\"><a href=\"#什么是防火墙\" class=\"headerlink\" title=\"什么是防火墙\"></a>什么是防火墙</h3><p>◇ 防火墙是借助硬件和软件对内外部网络环境的保护措施<br>◇ CentOS 7基于firewall实现应用层防火墙,CentOS6基于iptables<br>◇ firewall-cmd是firewall的核心命令 </p>\n<h3 id=\"firwall-cmd\"><a href=\"#firwall-cmd\" class=\"headerlink\" title=\"firwall-cmd\"></a>firwall-cmd</h3><p>◇ systemctl start|restart firewalld #启动防火墙<br>◇ firewall-cmd –state | –reload #查看状态,重载防火墙<br>◇ firewall-cmd –zone=public –permanent –add-port=8502/tcp  </p>\n<h3 id=\"对外开放Tomcat\"><a href=\"#对外开放Tomcat\" class=\"headerlink\" title=\"对外开放Tomcat\"></a>对外开放Tomcat</h3><p>◇解压apache-tomcat-9.0.34.tar.gz；进入apache-tomcat-9.0.34/bin目录启动startup.sh文件：./startup.sh<br>◇增加放行端口：firewall-cmd –zone=public –permanent –add-port=8080/tcp #zone代表区域；permanent表示永久更改；将add改成remove即可去除端口;8000-9000可以用来进行端口范围的设置<br>◇将防火墙进行重载</p>\n<h2 id=\"Bash-Shell\"><a href=\"#Bash-Shell\" class=\"headerlink\" title=\"Bash Shell\"></a>Bash Shell</h2><h3 id=\"什么是Shell\"><a href=\"#什么是Shell\" class=\"headerlink\" title=\"什么是Shell\"></a>什么是Shell</h3><p>◇ Shell是一个用c语言编写的脚本解释器,是用户通过代码操作 Linux的桥梁<br>◇ Shell脚本描述要执行的任务,完成系列复杂操作,文件通常以.sh后缀<br>◇ Shell脚本通过Shell解释器执行,按解释器分类分为多种类型  </p>\n<h3 id=\"Linux-Shell-分类\"><a href=\"#Linux-Shell-分类\" class=\"headerlink\" title=\"Linux Shell 分类\"></a>Linux Shell 分类</h3><p><img src=\"/p/c40f/1630222283043-b5cd5a06-bbf9-4590-96b0-7028756802c4.png\" class=\"lazyload\" data-srcset=\"/p/c40f/1630222283043-b5cd5a06-bbf9-4590-96b0-7028756802c4.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"></p>\n<h3 id=\"一键发布Tomcat应用程序\"><a href=\"#一键发布Tomcat应用程序\" class=\"headerlink\" title=\"一键发布Tomcat应用程序\"></a>一键发布Tomcat应用程序</h3><p>◇vim deploy_tomcat.sh创建脚本</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">echo &quot;准备下载Tomcat9&quot;</span><br><span class=\"line\">wget https://mirrors.tuna.tsinghua.edu.cn/apache/tomcat/tomcat-9/v9.0.52/bin/apache-tomcat-9.0.52.tar.gz</span><br><span class=\"line\">echo &quot;正在解压Tomcat9&quot;</span><br><span class=\"line\">tar zxf apache-tomcat-9.0.52.tar.gz</span><br><span class=\"line\">echo &quot;防火墙开放8080端口&quot;</span><br><span class=\"line\">firewall-cmd --zone=public --permanent --add-port=8080/tcp</span><br><span class=\"line\">firewall-cmd --reload</span><br><span class=\"line\">echo &quot;启动Tomact&quot;</span><br><span class=\"line\">cd ./apache-tomcat-9.0.52/bin</span><br><span class=\"line\">./startup.sh</span><br></pre></td></tr></table></figure>\n<p>◇启动脚本文件：/bin/bash deploy_tomcat.sh;或./deploy.tomcat.sh</p>\n<h2 id=\"部署OA项目\"><a href=\"#部署OA项目\" class=\"headerlink\" title=\"部署OA项目\"></a>部署OA项目</h2><h3 id=\"部署架构\"><a href=\"#部署架构\" class=\"headerlink\" title=\"部署架构\"></a>部署架构</h3><p><img src=\"/p/c40f/1630243029737-67057a7c-0650-4d8c-b630-bd8eab42b589.png\" class=\"lazyload\" data-srcset=\"/p/c40f/1630243029737-67057a7c-0650-4d8c-b630-bd8eab42b589.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"><br>◇创建两个虚拟机CentosDB,CentosWEB，均最小化安装(不要图形界面);然后在界面输入: yum install -y net-tools.x86_64 #安装ifconfig等命令;<br>◇使用Xshell进行远程连接；</p>\n<h3 id=\"Centos安装MySQL8\"><a href=\"#Centos安装MySQL8\" class=\"headerlink\" title=\"Centos安装MySQL8\"></a>Centos安装MySQL8</h3><p>◇yum search mysql-community #查看是否安装了mysql社区版<br>◇mkdir mysql #在/usr/local目录下新建目录存放mysql<br>◇wget <a href=\"https://dev.mysql.com/get/mysql80-community-release-el7-3.noarch.rpm\">https://dev.mysql.com/get/mysql80-community-release-el7-3.noarch.rpm</a> #获取下载<br>◇yum install -y wget #安装wget 命令<br>◇yum localinstall -y mysql80-community-release-el7-3.noarch.rpm #从本地安装rpm文件<br>◇以上只是安装了mysql的安装源，还没有完成mysql的安装；<br>◇yum install -y mysql-community-server #进行安装   ctrl+c可以停止安装<br>◇cd /var/cache/yum/x86_64/7/mysql80-community/packages/ #进入yum下载的缓存路径<br>◇进入官网找到Mysql Red Hat Enterprise Linux/ Oracle Linux；选择系统版本Linux 7 X86_64； 下载RPM Bundle；然后将这一组rpm文件传到缓存路径中；此时重新执行yum install -y mysql-community-server命令；以此可解决跨国服务器下载缓慢问题；<br>◇systemctl start mysqld #启动服务  systemctl status mysqld #查看服务状态<br>◇systemctl enable mysqld #设置为开机启动</p>\n<h3 id=\"初始化MySQL8\"><a href=\"#初始化MySQL8\" class=\"headerlink\" title=\"初始化MySQL8\"></a>初始化MySQL8</h3><p>◇vi  /var/log/mysqld.log #进入mysql日志 在第3~4行可以看到自动生成的密码<br>◇mysql -uroot -p #输入密码进行登录<br>◇alter user ‘root‘@’localhost’ identified with mysql_native_password by ‘newpassword’(需要包含字母大小写以及数字，特殊符号，长度大于8位) 回车加上’;’ 即可修改，with mysql_native_password做与navicat的兼容考虑；<br>◇默认的root用户只能从本机登录；use mysql #使用数据库； select host,user from user;#查询主机和用户<br>◇update user set host=’%’ where user=’root’;#将root用户的host改为%,即任意设备都可以使用root用户连接mysql服务器; flush privileges #使刚才修改的权限立即生效<br>◇exit #退出mysql<br>◇放行3306端口并重载，使之能够远程访问mysql；<br>◇打开Navicat，新建连接：主机即虚拟机的IP地址；</p>\n<h3 id=\"部署配置Web应用服务\"><a href=\"#部署配置Web应用服务\" class=\"headerlink\" title=\"部署配置Web应用服务\"></a>部署配置Web应用服务</h3><p>◇yum search jdk #查看仓库中包含哪些版本的jdk;openjdk表示开源jdk<br>◇yum install -y java-1.8.0-openjdk #安装jdk<br>◇java -version #查看<br>◇安装Tomcat;<br>◇将oa项目的war包传到虚拟机中，解压；<br>◇将解压后的oa目录移动：mv lcg_oa ./apache-tomcat-9.0.34/webapps/<br>◇进入webapps目录，vim ./lcg_oa/WEB-INF/classes/mybatis-config.xml(yum install vim-common#安装vim基础包，yum install vim-enhanced#安装增强包)<br>◇/root全文查找，在连接字符串的地方进行调整；将localhost改为mysql服务器的IP地址，密码改为相应的密码<br>◇回到上一层目录进行Tomcat的配置: vim ./conf/server.xml -&gt;搜索/8080-&gt;将端口改为80-&gt;按pagedown跳到最后<br>-&gt;在Host标签上增加<Context path=\"/\" docbase=\"lcg_oa\">#将oa这个web应用映射的上下文路径指向根路径-&gt;:wq保存<br>◇启动tomcat：./bin/startup.sh<br>◇放行80端口，并重载<br>◇在虚拟机DB中，屏蔽掉任意主机都能访问的3306端口；重载；<br>◇firewall-cmd –permanent –zone=public –add-rich-rule=”rule family=”ipv4” source address=”web服务器的IP地址” port protocol=”tcp” port=”3306” accept” #-rich-rule利用规则放行端口，这样就能放行指定主机指定端口的访问;</Context></p>\n","categories":["Java数据库","Linux与Redis基础"],"tags":["Linux"]},{"title":"Lambda表达式","url":"/p/8609.html","content":"<h2 id=\"课程介绍\"><a href=\"#课程介绍\" class=\"headerlink\" title=\"课程介绍\"></a>课程介绍</h2><p>◇实例讲解Lambda语法<br>◇基于Lambda实现函数式编程<br>◇Stream流式处理  </p>\n<h2 id=\"初识Lambda表达式\"><a href=\"#初识Lambda表达式\" class=\"headerlink\" title=\"初识Lambda表达式\"></a>初识Lambda表达式</h2><h3 id=\"什么是Lambda表达式\"><a href=\"#什么是Lambda表达式\" class=\"headerlink\" title=\"什么是Lambda表达式\"></a>什么是Lambda表达式</h3><p>◇JDK8开始支持Lambda表达式,用来让程序编写更优雅<br>◇利用Lambda可以更简洁的实现匿名内部类与函数声明与调用<br>◇基于Lambda提供stream流式处理极大简化对集合的操作  </p>\n<h3 id=\"传统代码\"><a href=\"#传统代码\" class=\"headerlink\" title=\"传统代码\"></a>传统代码</h3><figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">List&lt;String&gt; names = Arrays.asList(<span class=\"string\">&quot;peter&quot;</span>, <span class=\"string\">&quot;anna&quot;</span>, <span class=\"string\">&quot;mike&quot;</span>, <span class=\"string\">&quot;xenia&quot;</span>);</span><br><span class=\"line\"><span class=\"comment\">//实现集合排序</span></span><br><span class=\"line\">Collections.sort(names, <span class=\"keyword\">new</span> Comparator&lt;String&gt;() &#123;</span><br><span class=\"line\"><span class=\"meta\">@Override</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">int</span> <span class=\"title\">compare</span><span class=\"params\">(String a, String b)</span> </span>&#123;</span><br><span class=\"line\"><span class=\"keyword\">return</span> b.compareTo(a);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<h3 id=\"使用Lambda表达式\"><a href=\"#使用Lambda表达式\" class=\"headerlink\" title=\"使用Lambda表达式\"></a>使用Lambda表达式</h3><figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">List&lt;String&gt; names = Arrays.asList(<span class=\"string\">&quot;peter&quot;</span>, <span class=\"string\">&quot;anna&quot;</span>, <span class=\"string\">&quot;mike&quot;</span>, <span class=\"string\">&quot;xenia&quot;</span>);</span><br><span class=\"line\"><span class=\"comment\">//通过lambda表达式简化匿名类的编写</span></span><br><span class=\"line\">Collections.sort(names, (a,b) -&gt; b.compareTo(a));</span><br></pre></td></tr></table></figure>\n<h2 id=\"Lambda表达式语法\"><a href=\"#Lambda表达式语法\" class=\"headerlink\" title=\"Lambda表达式语法\"></a>Lambda表达式语法</h2><h3 id=\"Lambda语法格式\"><a href=\"#Lambda语法格式\" class=\"headerlink\" title=\"Lambda语法格式\"></a>Lambda语法格式</h3><p><img src=\"/p/8609/1628129093309-0703436d-3189-4b06-a49a-3dd455c97aa9.png\" class=\"lazyload\" data-srcset=\"/p/8609/1628129093309-0703436d-3189-4b06-a49a-3dd455c97aa9.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"></p>\n<h3 id=\"Lambda表达式示例\"><a href=\"#Lambda表达式示例\" class=\"headerlink\" title=\"Lambda表达式示例\"></a>Lambda表达式示例</h3><figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//四则运算接口</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">interface</span> <span class=\"title\">MathOperation</span> </span>&#123;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">operation</span><span class=\"params\">(<span class=\"keyword\">int</span> a, <span class=\"keyword\">int</span> b)</span></span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">LambdaSample</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">//1.标准使用方式</span></span><br><span class=\"line\">        <span class=\"comment\">//约束条件：Lambda表达式只能实现有且仅有一个抽象方法的接口，java称为&quot;函数式接口&quot;</span></span><br><span class=\"line\">        MathOperation addition = (Integer a,Integer b)-&gt;&#123;</span><br><span class=\"line\">            System.out.println(<span class=\"string\">&quot;加法运算&quot;</span>);</span><br><span class=\"line\">            <span class=\"keyword\">return</span> a + b + <span class=\"number\">0f</span>;<span class=\"comment\">//加上0f隐式的将结果转换为浮点型，与接口数据类型对应</span></span><br><span class=\"line\">        &#125;;</span><br><span class=\"line\">        System.out.println(addition.operation(<span class=\"number\">3</span>,<span class=\"number\">9</span>));</span><br><span class=\"line\">        <span class=\"comment\">//2.Lambda允许参数类型忽略</span></span><br><span class=\"line\">        MathOperation substraction = (a,b)-&gt;&#123;</span><br><span class=\"line\">            System.out.println(<span class=\"string\">&quot;减法运算&quot;</span>);</span><br><span class=\"line\">            <span class=\"keyword\">return</span> a-b+<span class=\"number\">0f</span>;</span><br><span class=\"line\">        &#125;;</span><br><span class=\"line\">        <span class=\"comment\">//3.单行实现代码可以省略大括号和return</span></span><br><span class=\"line\">        MathOperation multiplication = (a,b)-&gt;a*b+<span class=\"number\">0f</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">//传统方法：新建一个class类，在类中定义运算方法，然后再实例化进行运算</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"函数式编程\"><a href=\"#函数式编程\" class=\"headerlink\" title=\"函数式编程\"></a>函数式编程</h2><h3 id=\"什么是函数式编程\"><a href=\"#什么是函数式编程\" class=\"headerlink\" title=\"什么是函数式编程\"></a>什么是函数式编程</h3><p>◇函数式编程是基于函数式接口并使用lambda表达的编程方式<br>◇函数式编程理念是将代码作为可重用数据代入到程序运行中<br>◇函数式编程强调”你想做什么”,而不是”你想怎么做”  </p>\n<h3 id=\"什么是函数式接口\"><a href=\"#什么是函数式接口\" class=\"headerlink\" title=\"什么是函数式接口\"></a>什么是函数式接口</h3><p>◇函数式接口是有且只有一个抽象方法的接口<br>◇Java中拥有大量函数式接口,如java.lang.Runnable<br>◇JDK8后提供了一系列新的函数式接口,位于java.util.function<br>◇函数式接口的注解@FunctionInterface用来进行抽象方法检查，防止接口中存在多个方法</p>\n<h3 id=\"函数式接口Predicate\"><a href=\"#函数式接口Predicate\" class=\"headerlink\" title=\"函数式接口Predicate\"></a>函数式接口Predicate</h3><p>◇Predicate是新增的函数式接口,位于java.util.function<br>◇Predicate用于测试传入的数据是否满足判断要求<br>◇Predicate接口需要实现test()方法进行逻辑判断  </p>\n<h3 id=\"函数式编程示例\"><a href=\"#函数式编程示例\" class=\"headerlink\" title=\"函数式编程示例\"></a>函数式编程示例</h3><p>◇示例一</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">PredicateSample</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> </span>&#123;</span><br><span class=\"line\">        Predicate&lt;Integer&gt; predicate = n-&gt;n&gt;<span class=\"number\">4</span>;</span><br><span class=\"line\">        <span class=\"keyword\">boolean</span> result = predicate.test(<span class=\"number\">5</span>);</span><br><span class=\"line\">        System.out.println(result);</span><br><span class=\"line\">        List&lt;Integer&gt; list = Arrays.asList(<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, <span class=\"number\">4</span>, <span class=\"number\">5</span>, <span class=\"number\">6</span>, <span class=\"number\">7</span>, <span class=\"number\">8</span>, <span class=\"number\">9</span>, <span class=\"number\">10</span>);</span><br><span class=\"line\">    <span class=\"comment\">/*   传统方法判断奇数，代码写死，不灵活</span></span><br><span class=\"line\"><span class=\"comment\">         for(Integer num:list)&#123;</span></span><br><span class=\"line\"><span class=\"comment\">            if(num%2==1)&#123;</span></span><br><span class=\"line\"><span class=\"comment\">                System.out.println(num);</span></span><br><span class=\"line\"><span class=\"comment\">            &#125;</span></span><br><span class=\"line\"><span class=\"comment\">        &#125;*/</span></span><br><span class=\"line\">        filter(list,n-&gt;n%<span class=\"number\">2</span>==<span class=\"number\">1</span>);<span class=\"comment\">//判断奇数，直接传参数即可</span></span><br><span class=\"line\">        filter(list,n-&gt;n%<span class=\"number\">2</span>==<span class=\"number\">0</span>);<span class=\"comment\">//判断偶数</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">filter</span><span class=\"params\">(List&lt;Integer&gt; list,Predicate&lt;Integer&gt; predicate)</span></span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">for</span>(Integer num:list)&#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span>(predicate.test(num))&#123;</span><br><span class=\"line\">                System.out.print(num + <span class=\"string\">&quot; &quot;</span>);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"函数式编程与面向对象编程比较\"><a href=\"#函数式编程与面向对象编程比较\" class=\"headerlink\" title=\"函数式编程与面向对象编程比较\"></a>函数式编程与面向对象编程比较</h3><p><img src=\"/p/8609/1628129379547-304e9c37-fd96-4baf-9943-4bd9c4eb18d7.png\" class=\"lazyload\" data-srcset=\"/p/8609/1628129379547-304e9c37-fd96-4baf-9943-4bd9c4eb18d7.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"></p>\n<h2 id=\"函数式接口\"><a href=\"#函数式接口\" class=\"headerlink\" title=\"函数式接口\"></a>函数式接口</h2><h3 id=\"JDK8常用函数式接口\"><a href=\"#JDK8常用函数式接口\" class=\"headerlink\" title=\"JDK8常用函数式接口\"></a>JDK8常用函数式接口</h3><p><img src=\"/p/8609/1628129449949-b8221a19-cc47-4028-8504-49abae762bf2.png\" class=\"lazyload\" data-srcset=\"/p/8609/1628129449949-b8221a19-cc47-4028-8504-49abae762bf2.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"></p>\n<h3 id=\"函数式接口的应用\"><a href=\"#函数式接口的应用\" class=\"headerlink\" title=\"函数式接口的应用\"></a>函数式接口的应用</h3><figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//Function函数式接口说明闭包要求输入参数并返回数据</span></span><br><span class=\"line\">Function&lt;String, String&gt; fn = (str) -&gt; str.toUpperCase();</span><br><span class=\"line\">String result = fn.apply(<span class=\"string\">&quot;admin&quot;</span>); <span class=\"comment\">//apply用于执行方法返回结果</span></span><br><span class=\"line\">System.out.println(result);</span><br><span class=\"line\"><span class=\"comment\">//Consumer函数式接口说明闭包只要求输入参数,但不会返回数据</span></span><br><span class=\"line\">Consumer&lt;String&gt; c = arg -&gt; &#123;</span><br><span class=\"line\">System.out.println(arg);</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\">c.accept(<span class=\"string\">&quot;hello&quot;</span>); <span class=\"comment\">//accept只接受参数,没有任何结果返回</span></span><br></pre></td></tr></table></figure>\n<p>◇利用Function函数式接口生成定长随机字符串</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">FunctionSample</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> </span>&#123;</span><br><span class=\"line\">        Function&lt;Integer,String&gt; randomStringFunction = len-&gt;&#123;</span><br><span class=\"line\">            String chars=<span class=\"string\">&quot;abcdefghijklmnopqrstuvwxyz0123456789&quot;</span>;</span><br><span class=\"line\">            StringBuffer stringBuffer = <span class=\"keyword\">new</span> StringBuffer();</span><br><span class=\"line\">            Random random = <span class=\"keyword\">new</span> Random();</span><br><span class=\"line\">            <span class=\"keyword\">for</span>(<span class=\"keyword\">int</span> i=<span class=\"number\">0</span>;i&lt;len;i++)&#123;</span><br><span class=\"line\">                <span class=\"comment\">//截取某一个字符的位置</span></span><br><span class=\"line\">                <span class=\"keyword\">int</span> position = random.nextInt(chars.length());</span><br><span class=\"line\">                <span class=\"comment\">//charAt方法按照指定位置将字符提取出来</span></span><br><span class=\"line\">                stringBuffer.append(chars.charAt(position));</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> stringBuffer.toString();</span><br><span class=\"line\">        &#125;;</span><br><span class=\"line\">        String randomString = randomStringFunction.apply(<span class=\"number\">5</span>);</span><br><span class=\"line\">        System.out.println(randomString);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"Stream流式处理\"><a href=\"#Stream流式处理\" class=\"headerlink\" title=\"Stream流式处理\"></a>Stream流式处理</h2><p>◇Stream流式处理是建立在Lambda基础上的多数据处理技术<br>◇Stream对集合数据处理进行高度抽象,极大简化代码量<br>◇Stream可对集合进行迭代,去重,筛选,排序,聚合等一系列处理  </p>\n<h3 id=\"Stream示例\"><a href=\"#Stream示例\" class=\"headerlink\" title=\"Stream示例\"></a>Stream示例</h3><figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//获取List集合中最大的偶数</span></span><br><span class=\"line\">Optional&lt;Integer&gt; op = Arrays.asList(<span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">3</span>,<span class=\"number\">4</span>,<span class=\"number\">5</span>,<span class=\"number\">6</span>).stream()</span><br><span class=\"line\">.filter(x -&gt; x%<span class=\"number\">2</span> == <span class=\"number\">0</span>)<span class=\"comment\">//先进行筛选,得到偶数</span></span><br><span class=\"line\">.sorted((a,b) -&gt; b-a)<span class=\"comment\">//b-a表示降序,a-b表示升序</span></span><br><span class=\"line\">.findFirst();<span class=\"comment\">//取第一个,这里即最大的</span></span><br><span class=\"line\">System.out.println(op.get());</span><br></pre></td></tr></table></figure>\n<h3 id=\"Stream常用方法\"><a href=\"#Stream常用方法\" class=\"headerlink\" title=\"Stream常用方法\"></a>Stream常用方法</h3><p><img src=\"/p/8609/1628129577239-b2769d4b-57df-4c3d-9ddf-edc3c57fabb9.png\" class=\"lazyload\" data-srcset=\"/p/8609/1628129577239-b2769d4b-57df-4c3d-9ddf-edc3c57fabb9.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"></p>\n<h3 id=\"Stream操作实例\"><a href=\"#Stream操作实例\" class=\"headerlink\" title=\"Stream操作实例\"></a>Stream操作实例</h3><p>◇Stream流的五种创建方式；最常用的为1,2两种  </p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">StreamGenerator</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">//1.基于数组创建</span></span><br><span class=\"line\">    <span class=\"meta\">@Test</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">generator1</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">        String[] arr = &#123;<span class=\"string\">&quot;莉莉&quot;</span>, <span class=\"string\">&quot;安迪&quot;</span>, <span class=\"string\">&quot;明明&quot;</span>, <span class=\"string\">&quot;牛牛&quot;</span>&#125;;</span><br><span class=\"line\">        Stream&lt;String&gt; stream = Stream.of(arr);</span><br><span class=\"line\">        stream.forEach(s-&gt;System.out.println(s));</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">//2.基于集合创建</span></span><br><span class=\"line\">    <span class=\"meta\">@Test</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">generator2</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">        List&lt;String&gt; list = <span class=\"keyword\">new</span> ArrayList&lt;&gt;();</span><br><span class=\"line\">        list.add(<span class=\"string\">&quot;莉莉&quot;</span>);</span><br><span class=\"line\">        list.add(<span class=\"string\">&quot;安迪&quot;</span>);</span><br><span class=\"line\">        list.add(<span class=\"string\">&quot;马马&quot;</span>);</span><br><span class=\"line\">        list.add(<span class=\"string\">&quot;牛牛&quot;</span>);</span><br><span class=\"line\">        Stream&lt;String&gt; stream = list.stream();</span><br><span class=\"line\">        stream.forEach(s-&gt; System.out.println(s));</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">//3.利用generate方法创建无限长度流</span></span><br><span class=\"line\">    <span class=\"meta\">@Test</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">generator3</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">//bound限制产生的随机数小于其参数</span></span><br><span class=\"line\">        Stream&lt;Integer&gt; stream = Stream.generate(() -&gt; <span class=\"keyword\">new</span> Random().nextInt(<span class=\"number\">1000</span>));</span><br><span class=\"line\">        <span class=\"comment\">//limit用来限制流的最大长度，不设置则为无限</span></span><br><span class=\"line\">        stream.limit(<span class=\"number\">10</span>).forEach(i-&gt; System.out.println(i));</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">//4.基于迭代器创建</span></span><br><span class=\"line\">    <span class=\"meta\">@Test</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">generator4</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">//seed：起始的数据；n+1表示每一次循环步长为1</span></span><br><span class=\"line\">        Stream&lt;Integer&gt; stream = Stream.iterate(<span class=\"number\">1</span>, n -&gt; n + <span class=\"number\">1</span>);</span><br><span class=\"line\">        stream.limit(<span class=\"number\">100</span>).forEach(i-&gt; System.out.println(i));</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">//5.基于字符序列创建</span></span><br><span class=\"line\">    <span class=\"meta\">@Test</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">generator5</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">        String str = <span class=\"string\">&quot;hello你好&quot;</span>;</span><br><span class=\"line\">        IntStream stream = str.chars();</span><br><span class=\"line\">        <span class=\"comment\">//输出为字母的ASCII码或者汉字的Unicode编码;将c强制转换成char类型即可输出原字符</span></span><br><span class=\"line\">        stream.forEach(c -&gt; System.out.println((<span class=\"keyword\">char</span>)c));</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>◇Stream流的常用方法</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">StreamMethod</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">//1.提取集合中所有偶数并求和</span></span><br><span class=\"line\">    <span class=\"meta\">@Test</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">case1</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">//List的泛型设为String类型,否则编译器默认s为object,而parseInt不支持object类型</span></span><br><span class=\"line\">        List&lt;String&gt; list = Arrays.asList(<span class=\"string\">&quot;1&quot;</span>, <span class=\"string\">&quot;2&quot;</span>, <span class=\"string\">&quot;3&quot;</span>, <span class=\"string\">&quot;4&quot;</span>, <span class=\"string\">&quot;5&quot;</span>);</span><br><span class=\"line\">        <span class=\"keyword\">int</span> sum = list.stream() <span class=\"comment\">//获取stream对象</span></span><br><span class=\"line\">            .mapToInt(s-&gt;Integer.parseInt(s)) <span class=\"comment\">//mapToInt将流中的每一个数据转换为整数</span></span><br><span class=\"line\">            .filter(n-&gt;n%<span class=\"number\">2</span>==<span class=\"number\">0</span>)<span class=\"comment\">//对流中数据进行过滤</span></span><br><span class=\"line\">            .sum();<span class=\"comment\">//将所有数据进行求和，数据只能为整数</span></span><br><span class=\"line\">        System.out.println(sum);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">//2.所有名字首字母大写</span></span><br><span class=\"line\">    <span class=\"meta\">@Test</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">case2</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">        List&lt;String&gt; list = Arrays.asList(<span class=\"string\">&quot;lily&quot;</span>,<span class=\"string\">&quot;smith&quot;</span>,<span class=\"string\">&quot;jackson&quot;</span>,<span class=\"string\">&quot;bob&quot;</span>);</span><br><span class=\"line\">        List newList = list.stream()</span><br><span class=\"line\">                <span class=\"comment\">/*substring()截取位置为a到b的字符串，</span></span><br><span class=\"line\"><span class=\"comment\">                若只有一个参数，则此参数表示从该位置截取</span></span><br><span class=\"line\"><span class=\"comment\">                到最后*/</span></span><br><span class=\"line\">                .map(s -&gt; s.substring(<span class=\"number\">0</span>, <span class=\"number\">1</span>).toUpperCase()+s.substring(<span class=\"number\">1</span>))</span><br><span class=\"line\">                <span class=\"comment\">//.forEach(s -&gt; System.out.println(s));只能进行打印，没有保存</span></span><br><span class=\"line\">                <span class=\"comment\">//collect对流数据进行收集，生成新的List/Set(Set可以将重复数据自动清除)</span></span><br><span class=\"line\">                .collect(Collectors.toList());<span class=\"comment\">//可以将转换后的结果保存到新的List中</span></span><br><span class=\"line\">        System.out.println(newList);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">//3.将所有奇数从大到小进行排序，且不许出现重复</span></span><br><span class=\"line\">    <span class=\"comment\">//Set方法可以清楚重复数据，但没有顺序，排序功能会失效</span></span><br><span class=\"line\">    <span class=\"meta\">@Test</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">case3</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">        List&lt;Integer&gt; list = Arrays.asList(<span class=\"number\">1</span>,<span class=\"number\">60</span>,<span class=\"number\">38</span>,<span class=\"number\">21</span>,<span class=\"number\">51</span>,<span class=\"number\">60</span>,<span class=\"number\">51</span>,<span class=\"number\">73</span>);</span><br><span class=\"line\">        List newList = list.stream().distinct()<span class=\"comment\">//去除重复的流数据</span></span><br><span class=\"line\">                .filter(n-&gt;n%<span class=\"number\">2</span>==<span class=\"number\">1</span>)</span><br><span class=\"line\">                .sorted((a,b)-&gt;b-a)</span><br><span class=\"line\">                .collect(Collectors.toList());</span><br><span class=\"line\">        System.out.println(newList);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"如何通过oracle官网学习Stream流的方法\"><a href=\"#如何通过oracle官网学习Stream流的方法\" class=\"headerlink\" title=\"如何通过oracle官网学习Stream流的方法\"></a>如何通过oracle官网学习Stream流的方法</h3><p>◇<a href=\"https://docs.oracle.com/javase/8/docs/api/java/util/stream/package-summary.html\">官网地址</a>:百度java.util.stream<br>◇查看每一个方法的作用<br>​</p>\n","categories":["Java数据库","框架前置知识"],"tags":["Lambda"]},{"title":"Maven项目管理","url":"/p/316f.html","content":"<h3 id=\"课程介绍\"><a href=\"#课程介绍\" class=\"headerlink\" title=\"课程介绍\"></a>课程介绍</h3><p> ◇ 介绍Maven的核心特性<br> ◇ 掌握Maven的依赖管理<br> ◇ 掌握Maven的打包方式  </p>\n<h3 id=\"Maven介绍\"><a href=\"#Maven介绍\" class=\"headerlink\" title=\"Maven介绍\"></a>Maven介绍</h3><p> ◇ Maven 是项目管理工具,对软件项目提供构建与依赖管理<br> ◇ Maven是Apache下的Java开源项目<br> ◇ Maven为Java项目提供了统一的管理方式，已成为业界标准  </p>\n<h3 id=\"Maven核心特性\"><a href=\"#Maven核心特性\" class=\"headerlink\" title=\"Maven核心特性\"></a>Maven核心特性</h3><p>◇ 项目设置遵循统一的规则，保证不同开发环境的兼容性 Maven核心特性<br>◇ 强大的依赖管理，项目依赖组件自动下载、自动更新<br>◇ 可扩展的插件机制，使用简单，功能丰富  </p>\n<h3 id=\"Maven的安装与配置\"><a href=\"#Maven的安装与配置\" class=\"headerlink\" title=\"Maven的安装与配置\"></a>Maven的安装与配置</h3><h3 id=\"Maven的坐标\"><a href=\"#Maven的坐标\" class=\"headerlink\" title=\"Maven的坐标\"></a>Maven的坐标</h3><p> ◇ GroupId：机构或者团体的英文，采用”逆向域名”形式书写<br> ◇ ArtifactId：项目名称,说明其用途，例如：cms、oa…<br> ◇ Version：版本号，一般采用”版本+单词”形式，例如：1.0.0.RELEASE  </p>\n<h3 id=\"Maven项目标准结构\"><a href=\"#Maven项目标准结构\" class=\"headerlink\" title=\"Maven项目标准结构\"></a>Maven项目标准结构</h3><p><img src=\"/p/316f/1627634963647-8798bed9-4a2c-4e9b-8873-7bb418fdba6d.png\" class=\"lazyload\" data-srcset=\"/p/316f/1627634963647-8798bed9-4a2c-4e9b-8873-7bb418fdba6d.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"></p>\n<h3 id=\"Maven依赖管理\"><a href=\"#Maven依赖管理\" class=\"headerlink\" title=\"Maven依赖管理\"></a>Maven依赖管理</h3><p>◇Maven利用dependency(依赖)自动下载、管理第三发jar<br>◇在pom.xml文件中配置项目依赖的第三方组件<br>◇maven自动将依赖从远程仓库下载至本地仓库，并在工程中引用<br>◇<a href=\"https://search.maven.org/\">maven中央仓库检索网站</a><br>◇pinyin4j将汉字转换为拼音<br> 配置</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.belerweb<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>pinyin4j<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>2.5.1<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p> 代码</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> </span>&#123;</span><br><span class=\"line\">\t\tScanner scan = <span class=\"keyword\">new</span> Scanner(System.in);</span><br><span class=\"line\">\t\tString str = scan.nextLine();</span><br><span class=\"line\">\t\tString[] pinyin = PinyinHelper.toHanyuPinyinStringArray(<span class=\"string\">&#x27;李&#x27;</span>); </span><br><span class=\"line\">\t\t<span class=\"keyword\">for</span>(String py : pinyin) &#123;</span><br><span class=\"line\">\t\t\tSystem.out.println(py);</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br></pre></td></tr></table></figure>\n<p>◇配置多个jar包:依赖本身也依赖于底层jar包，因此有多个jar包</p>\n<h3 id=\"本地仓库与中央仓库\"><a href=\"#本地仓库与中央仓库\" class=\"headerlink\" title=\"本地仓库与中央仓库\"></a>本地仓库与中央仓库</h3><p><img src=\"/p/316f/1627635052884-beae7764-b69b-40ff-8215-a112d76dbd79.png\" class=\"lazyload\" data-srcset=\"/p/316f/1627635052884-beae7764-b69b-40ff-8215-a112d76dbd79.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"></p>\n<p> 本地仓库目录</p>\n<p><img src=\"/p/316f/1627733946275-eab3e214-a8aa-4a33-aa28-3b7371428144.png\" class=\"lazyload\" data-srcset=\"/p/316f/1627733946275-eab3e214-a8aa-4a33-aa28-3b7371428144.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"><br>◇创建备份服务器，提高下载速度</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">&lt;repositories&gt;</span><br><span class=\"line\">  &lt;repository&gt;</span><br><span class=\"line\">    &lt;!-- 创建私服的地址 --&gt;</span><br><span class=\"line\">    &lt;id&gt;aliyun&lt;/id&gt;</span><br><span class=\"line\">    &lt;name&gt;aliyun&lt;/name&gt;</span><br><span class=\"line\">    &lt;url&gt;https:<span class=\"comment\">//maven.aliyun.com/repository/public&lt;/url&gt;</span></span><br><span class=\"line\">  &lt;/repository&gt;</span><br><span class=\"line\">&lt;/repositories&gt;</span><br></pre></td></tr></table></figure>\n<h3 id=\"项目打包\"><a href=\"#项目打包\" class=\"headerlink\" title=\"项目打包\"></a>项目打包</h3><p> ◇ Maven可将Java项目打包为jar、war包<br> ◇ Maven项目打包是通过Plugins（插件）技术实现<br> ◇ Maven输出Jar包插件：maven-assembly-plugin<br> ◇ 配置文件</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">&lt;build&gt;</span><br><span class=\"line\">  &lt;!-- 配置插件 --&gt;</span><br><span class=\"line\">    &lt;plugins&gt;</span><br><span class=\"line\">      &lt;plugin&gt;</span><br><span class=\"line\">        &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;</span><br><span class=\"line\">        &lt;artifactId&gt;maven-assembly-plugin&lt;/artifactId&gt;</span><br><span class=\"line\">        &lt;version&gt;<span class=\"number\">2.5</span><span class=\"number\">.5</span>&lt;/version&gt;</span><br><span class=\"line\">        &lt;configuration&gt;</span><br><span class=\"line\">          &lt;archive&gt;</span><br><span class=\"line\">            &lt;mainfest&gt;</span><br><span class=\"line\">              &lt;mainClass&gt;com.lcg.maven.PinyinTestor&lt;/mainClass&gt;</span><br><span class=\"line\">            &lt;/mainfest&gt;</span><br><span class=\"line\">          &lt;/archive&gt;</span><br><span class=\"line\">          &lt;descriptorRefs&gt;</span><br><span class=\"line\">          &lt;!--  all in one 在打包时会将所有引用的jar合并到输出的jar文件中 --&gt;</span><br><span class=\"line\">            &lt;descriptorRef&gt;jar-with-dependencies&lt;/descriptorRef&gt;</span><br><span class=\"line\">          &lt;/descriptorRefs&gt;</span><br><span class=\"line\">        &lt;/configuration&gt;</span><br><span class=\"line\">      &lt;/plugin&gt;</span><br><span class=\"line\">    &lt;/plugins&gt;</span><br><span class=\"line\">  &lt;/build&gt;</span><br></pre></td></tr></table></figure>\n<p> ◇ 配置运行<br><img src=\"/p/316f/1627738334274-d9101c2e-e3dd-43be-b703-6cc97ac65fc9.png\" class=\"lazyload\" data-srcset=\"/p/316f/1627738334274-d9101c2e-e3dd-43be-b703-6cc97ac65fc9.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"><br>◇ 打包成功后的运行命令</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">java -jar maven-<span class=\"number\">1</span>-<span class=\"number\">1.0</span><span class=\"number\">.0</span>-RELEASE-jar-with-dependencies.jar</span><br></pre></td></tr></table></figure>\n<h3 id=\"Maven构建Web工程\"><a href=\"#Maven构建Web工程\" class=\"headerlink\" title=\"Maven构建Web工程\"></a>Maven构建Web工程</h3><p>◇创建maven项目-&gt;配置JRE：JRE System Library-&gt;properties-&gt;Workspace default JRE-&gt;Apply and Close<br>◇修改JDK编译级别：工程名-&gt;properties-&gt;Java Compiler-&gt;Compiler compliance level(编译级别):1.8-OK<br>◇在src/main目录下创建webapp文件夹<br>◇工程名-&gt;properties-&gt;Project Facets-&gt;Convert to faceted form-&gt;勾选Dynamic Web Module 3.1-&gt;Runtimes:指定Apache Tomcat-&gt;Further configuration available-&gt;Content directory:src/main/webapp-&gt;勾选web.xml-OK-&gt;Apply and Close</p>\n<h3 id=\"Web工程打包\"><a href=\"#Web工程打包\" class=\"headerlink\" title=\"Web工程打包\"></a>Web工程打包</h3><p>◇<a href=\"https://blog.csdn.net/cx1110162/article/details/78110277?spm=1001.2014.3001.5506\">遇见错误</a>：将jar文件复制到工程的WEB-INF/lib目录即可<br>◇配置：RunConfigurations-&gt;MavenBuild-&gt;NewConfiguration-&gt;Name:build-war-&gt;Base directory:指向工程-&gt;Goals:package-&gt;Apply-&gt;Run<br>◇pom.xml</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">&lt;project xmlns=<span class=\"string\">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> </span><br><span class=\"line\">    xmlns:xsi=<span class=\"string\">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span> </span><br><span class=\"line\">        xsi:schemaLocation=</span><br><span class=\"line\">          <span class=\"string\">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span><br><span class=\"line\">  &lt;modelVersion&gt;<span class=\"number\">4.0</span><span class=\"number\">.0</span>&lt;/modelVersion&gt;</span><br><span class=\"line\">  &lt;groupId&gt;com.lcg&lt;/groupId&gt;</span><br><span class=\"line\">  &lt;artifactId&gt;maven&lt;/artifactId&gt;</span><br><span class=\"line\">  &lt;version&gt;<span class=\"number\">1.0</span><span class=\"number\">.0</span>-RELEASE&lt;/version&gt;</span><br><span class=\"line\">    &lt;!-- packaging代表输出的格式 --&gt;</span><br><span class=\"line\">  &lt;packaging&gt;war&lt;/packaging&gt;</span><br><span class=\"line\">  &lt;dependencies&gt;</span><br><span class=\"line\">    &lt;dependency&gt;</span><br><span class=\"line\">\t  &lt;groupId&gt;javax.servlet&lt;/groupId&gt;</span><br><span class=\"line\">\t  &lt;artifactId&gt;jstl&lt;/artifactId&gt;</span><br><span class=\"line\">\t  &lt;version&gt;<span class=\"number\">1.2</span>&lt;/version&gt;</span><br><span class=\"line\">    &lt;/dependency&gt;</span><br><span class=\"line\">  &lt;/dependencies&gt;</span><br><span class=\"line\">  &lt;!-- 自定义解压文件名 --&gt;</span><br><span class=\"line\">  &lt;build&gt;</span><br><span class=\"line\">  \t&lt;finalName&gt;maven-web&lt;/finalName&gt;</span><br><span class=\"line\">  \t&lt;plugins&gt;</span><br><span class=\"line\">  \t\t&lt;plugin&gt;</span><br><span class=\"line\">  \t\t\t&lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;</span><br><span class=\"line\">  \t\t\t&lt;artifactId&gt;maven-war-plugin&lt;/artifactId&gt;</span><br><span class=\"line\">  \t\t\t&lt;version&gt;<span class=\"number\">3.2</span><span class=\"number\">.2</span>&lt;/version&gt;</span><br><span class=\"line\">  \t\t&lt;/plugin&gt;</span><br><span class=\"line\">  \t&lt;/plugins&gt;</span><br><span class=\"line\">  &lt;/build&gt;</span><br><span class=\"line\">&lt;/project&gt;</span><br></pre></td></tr></table></figure>\n<h3 id=\"Maven常用命令\"><a href=\"#Maven常用命令\" class=\"headerlink\" title=\"Maven常用命令\"></a>Maven常用命令</h3><p>◇需要配置环境变量<br>◇在cmd中使用<br><img src=\"/p/316f/1627635155092-1aa7242a-e588-4d42-81df-c93b29c0ceb3.png\" class=\"lazyload\" data-srcset=\"/p/316f/1627635155092-1aa7242a-e588-4d42-81df-c93b29c0ceb3.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"></p>\n<h3 id=\"修改本地仓库地址\"><a href=\"#修改本地仓库地址\" class=\"headerlink\" title=\"修改本地仓库地址\"></a>修改本地仓库地址</h3><p>◇打开F:\\JAVA\\tool\\apache-maven-3.6.0\\conf中的settings.xml文件<br>◇修改49-52处的代码</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">修改前 </span><br><span class=\"line\">&lt;!-- localRepository</span><br><span class=\"line\">   | The path to the local repository maven will use to store artifacts.</span><br><span class=\"line\">   |</span><br><span class=\"line\">   | Default: $&#123;user.home&#125;/.m2/repository</span><br><span class=\"line\">  &lt;localRepository&gt;/path/to/local/repo&lt;/localRepository&gt;</span><br><span class=\"line\">  --&gt;</span><br><span class=\"line\">  修改后</span><br><span class=\"line\">    &lt;!-- localRepository</span><br><span class=\"line\">   | The path to the local repository maven will use to store artifacts.</span><br><span class=\"line\">   |</span><br><span class=\"line\">   | Default: $&#123;user.home&#125;/.m2/repository  --&gt;</span><br><span class=\"line\">  &lt;localRepository&gt;G:/maven-repo&lt;/localRepository&gt;</span><br></pre></td></tr></table></figure>\n<p>◇Eclipse中配置：Window-&gt;Preferences-&gt;Maven-&gt;User Settings:选择apache-maven-3.6.0\\conf中的settings.xml文件-&gt;Reindex-Apply and Close</p>\n<h3 id=\"在IDEA中配置Maven\"><a href=\"#在IDEA中配置Maven\" class=\"headerlink\" title=\"在IDEA中配置Maven\"></a>在IDEA中配置Maven</h3><p>◇Settings-&gt;Build,Execution-&gt;Build Tools-&gt;Maven-&gt;Maven home directory: ;User settings file: ;Local repository:<br><img src=\"/p/316f/1627914341482-b8b8d144-9206-48d8-82e5-94b3fa017a28.png\" class=\"lazyload\" data-srcset=\"/p/316f/1627914341482-b8b8d144-9206-48d8-82e5-94b3fa017a28.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"><br>◇创建Maven项目：New Project-&gt;Maven-&gt;Next-&gt;GroupID;ArtifactID;Version-&gt;Next-&gt;Finish<br>◇IDEA关于Maven的快捷键:点击右边的Maven弹出界面,即Maven的常用命令<br><img src=\"/p/316f/1627915088171-0ea5f377-320d-4db9-90c8-30e2f2f06f5b.png\" class=\"lazyload\" data-srcset=\"/p/316f/1627915088171-0ea5f377-320d-4db9-90c8-30e2f2f06f5b.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"></p>\n","categories":["Java数据库","框架前置知识"],"tags":["Maven"]},{"title":"MyBaits入门","url":"/p/f37d.html","content":"<h2 id=\"MyBatis课程介绍\"><a href=\"#MyBatis课程介绍\" class=\"headerlink\" title=\"MyBatis课程介绍\"></a>MyBatis课程介绍</h2><h3 id=\"MyBatis入门使用\"><a href=\"#MyBatis入门使用\" class=\"headerlink\" title=\"MyBatis入门使用\"></a>MyBatis入门使用</h3><p><img src=\"/p/f37d/1628238899331-11e1e3ae-ea4c-48e1-b933-0cece45283b9.png\" class=\"lazyload\" data-srcset=\"/p/f37d/1628238899331-11e1e3ae-ea4c-48e1-b933-0cece45283b9.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"></p>\n<h3 id=\"MyBatis高级特性\"><a href=\"#MyBatis高级特性\" class=\"headerlink\" title=\"MyBatis高级特性\"></a>MyBatis高级特性</h3><p><img src=\"/p/f37d/1628239064225-a53dd20e-0d65-4c5e-acc9-0dc429a8d32e.png\" class=\"lazyload\" data-srcset=\"/p/f37d/1628239064225-a53dd20e-0d65-4c5e-acc9-0dc429a8d32e.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"></p>\n<h2 id=\"认识框架-Framework\"><a href=\"#认识框架-Framework\" class=\"headerlink\" title=\"认识框架-Framework\"></a>认识框架-Framework</h2><h3 id=\"生活中的框架\"><a href=\"#生活中的框架\" class=\"headerlink\" title=\"生活中的框架\"></a>生活中的框架</h3><p><img src=\"/p/f37d/1628239313228-062756fe-2b58-4e3b-902e-c73bf87d0331.png\" class=\"lazyload\" data-srcset=\"/p/f37d/1628239313228-062756fe-2b58-4e3b-902e-c73bf87d0331.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"><br><img src=\"/p/f37d/1628239334642-ca21d0cd-4c30-4653-8811-2537f6edd963.png\" class=\"lazyload\" data-srcset=\"/p/f37d/1628239334642-ca21d0cd-4c30-4653-8811-2537f6edd963.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"></p>\n<h3 id=\"软件开发中框架\"><a href=\"#软件开发中框架\" class=\"headerlink\" title=\"软件开发中框架\"></a>软件开发中框架</h3><p>◇框架是可被应用开发者定制的应用骨架<br>◇框架是一种规则,保证开发者遵循相同的方式开发程序<br>◇框架提倡”不要重复造轮子”,对基础功能进行封装  </p>\n<h3 id=\"框架的优点\"><a href=\"#框架的优点\" class=\"headerlink\" title=\"框架的优点\"></a>框架的优点</h3><p>◇极大提高了开发效率<br>◇统一的编码规则,利于团队管理<br>◇灵活配置的应用,拥有更好的维护性  </p>\n<h3 id=\"SSM开发框架\"><a href=\"#SSM开发框架\" class=\"headerlink\" title=\"SSM开发框架\"></a>SSM开发框架</h3><p><img src=\"/p/f37d/1628239469486-ecff36a6-0968-4804-8f26-63c745ed2252.png\" class=\"lazyload\" data-srcset=\"/p/f37d/1628239469486-ecff36a6-0968-4804-8f26-63c745ed2252.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"></p>\n<h2 id=\"介绍MyBatis\"><a href=\"#介绍MyBatis\" class=\"headerlink\" title=\"介绍MyBatis\"></a>介绍MyBatis</h2><h3 id=\"什么是MyBatis\"><a href=\"#什么是MyBatis\" class=\"headerlink\" title=\"什么是MyBatis\"></a>什么是MyBatis</h3><p>◇MyBatis是优秀的持久层框架<br>◇MyBatis使用XML将SQL与程序解耦,便于维护<br>◇MyBatis学习简单,执行高效,是JDBC的延伸 </p>\n<h3 id=\"MyBatis开发流程\"><a href=\"#MyBatis开发流程\" class=\"headerlink\" title=\"MyBatis开发流程\"></a>MyBatis开发流程</h3><p>◇引入MyBatis依赖                          ◇创建核心配置文件<br>◇创建实体(Entity)类                        ◇创建Mapper映射文件<br>◇初始化SessionFactory                   ◇利用SqlSession对象操作数据  </p>\n<h2 id=\"单元测试与JUnit-4\"><a href=\"#单元测试与JUnit-4\" class=\"headerlink\" title=\"单元测试与JUnit 4\"></a>单元测试与JUnit 4</h2><h3 id=\"单元测试\"><a href=\"#单元测试\" class=\"headerlink\" title=\"单元测试\"></a>单元测试</h3><p>◇单元测试是指对软件中的最小可测试单元进行检查和验证<br>◇测试用例是指编写一段代码对已有功能(方法)进行校验<br>◇JUnit 4是Java中最著名的单元测试工具,主流IDE内置支持  </p>\n<h3 id=\"JUnit-4使用方法\"><a href=\"#JUnit-4使用方法\" class=\"headerlink\" title=\"JUnit 4使用方法\"></a>JUnit 4使用方法</h3><p>◇引入JUnit Jar包或增加Maven依赖<br>◇编写测试用例验证目标方法是否正确运行<br>◇在测试用例上增加@Test注解开始单元测试  </p>\n<h3 id=\"JUnit-4使用入门\"><a href=\"#JUnit-4使用入门\" class=\"headerlink\" title=\"JUnit 4使用入门\"></a>JUnit 4使用入门</h3><p>◇创建Maven项目<br> –pom.xml配置</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">&lt;dependencies&gt;</span><br><span class=\"line\">        &lt;dependency&gt;</span><br><span class=\"line\">            &lt;groupId&gt;junit&lt;/groupId&gt;</span><br><span class=\"line\">            &lt;artifactId&gt;junit&lt;/artifactId&gt;</span><br><span class=\"line\">            &lt;version&gt;<span class=\"number\">4.12</span>&lt;/version&gt;</span><br><span class=\"line\">        &lt;/dependency&gt;</span><br><span class=\"line\">&lt;/dependencies&gt;</span><br></pre></td></tr></table></figure>\n<p> –main中创建类</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Calculator</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">int</span> <span class=\"title\">add</span><span class=\"params\">(<span class=\"keyword\">int</span> a, <span class=\"keyword\">int</span> b)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> a+b;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">int</span> <span class=\"title\">subtract</span><span class=\"params\">(<span class=\"keyword\">int</span> a, <span class=\"keyword\">int</span> b)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> a - b;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">int</span> <span class=\"title\">multiply</span><span class=\"params\">(<span class=\"keyword\">int</span> a, <span class=\"keyword\">int</span> b)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> a * b;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">float</span> <span class=\"title\">divide</span><span class=\"params\">(<span class=\"keyword\">int</span> a, <span class=\"keyword\">int</span> b)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> (a*<span class=\"number\">1f</span>)/b;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p> –test中创建测试类,测试类或测试方法前有√则为正确运行,也要看程序运行和预期是否相同</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">CalculatorTest</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> Calculator cal = <span class=\"keyword\">new</span> Calculator();</span><br><span class=\"line\">    <span class=\"comment\">//测试用例命名规则</span></span><br><span class=\"line\">    <span class=\"comment\">//1.与原方法保持一致add</span></span><br><span class=\"line\">    <span class=\"comment\">//2.在原方法前增加test前缀testAdd</span></span><br><span class=\"line\">    <span class=\"meta\">@Test</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">testAdd</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">int</span> result = cal.add(<span class=\"number\">3</span>, <span class=\"number\">5</span>);</span><br><span class=\"line\">        System.out.println(result);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Test</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">subtract</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">int</span> result = cal.subtract(<span class=\"number\">1</span>, <span class=\"number\">2</span>);</span><br><span class=\"line\">        System.out.println(result);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Test</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">multiply</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">int</span> result = cal.multiply(<span class=\"number\">1</span>, <span class=\"number\">2</span>);</span><br><span class=\"line\">        System.out.println(result);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Test</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">divide</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">float</span> result = cal.divide(<span class=\"number\">1</span>, <span class=\"number\">2</span>);</span><br><span class=\"line\">        System.out.println(result);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>◇快速生成测试类方法：选中需要测试的类-&gt;Code-&gt;Generate-&gt;Test<br>◇可以同时运行多个测试类</p>\n<h2 id=\"MyBatis环境配置\"><a href=\"#MyBatis环境配置\" class=\"headerlink\" title=\"MyBatis环境配置\"></a>MyBatis环境配置</h2><h3 id=\"mybatis-config-xml\"><a href=\"#mybatis-config-xml\" class=\"headerlink\" title=\"mybatis-config.xml\"></a>mybatis-config.xml</h3><p>◇ MyBatis采用XML格式配置数据库环境信息<br>◇ MyBaits环境配置标签<br>◇ environment包含数据库驱动、URL、用户名与密码 </p>\n<h3 id=\"项目演示\"><a href=\"#项目演示\" class=\"headerlink\" title=\"项目演示\"></a>项目演示</h3><p>◇IDEA支持数据库面板，DataBase-&gt;+ -&gt;DataSource-&gt;MySql<br>◇pom.xml配置</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">&lt;repositories&gt;</span><br><span class=\"line\">        &lt;repository&gt;</span><br><span class=\"line\">            &lt;id&gt;aliyun&lt;/id&gt;</span><br><span class=\"line\">            &lt;name&gt;aliyun&lt;/name&gt;</span><br><span class=\"line\">            &lt;url&gt;https:<span class=\"comment\">//maven.aliyun.com/repository/public&lt;/url&gt;</span></span><br><span class=\"line\">        &lt;/repository&gt;</span><br><span class=\"line\">    &lt;/repositories&gt;</span><br><span class=\"line\">    &lt;dependencies&gt;</span><br><span class=\"line\">        &lt;dependency&gt;</span><br><span class=\"line\">            &lt;groupId&gt;org.mybatis&lt;/groupId&gt;</span><br><span class=\"line\">            &lt;artifactId&gt;mybatis&lt;/artifactId&gt;</span><br><span class=\"line\">            &lt;version&gt;<span class=\"number\">3.5</span><span class=\"number\">.1</span>&lt;/version&gt;</span><br><span class=\"line\">        &lt;/dependency&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">        &lt;dependency&gt;</span><br><span class=\"line\">            &lt;groupId&gt;mysql&lt;/groupId&gt;</span><br><span class=\"line\">            &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;</span><br><span class=\"line\">            &lt;version&gt;<span class=\"number\">5.1</span><span class=\"number\">.47</span>&lt;/version&gt;</span><br><span class=\"line\">        &lt;/dependency&gt;</span><br><span class=\"line\">        &lt;!--增加junit用于测试 --&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">    &lt;/dependencies&gt;</span><br></pre></td></tr></table></figure>\n<p>◇在main/resources目录下创建mybatis-config.xml文件</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">&lt;?xml version=<span class=\"string\">&quot;1.0&quot;</span> encoding=<span class=\"string\">&quot;UTF-8&quot;</span>?&gt;</span><br><span class=\"line\">&lt;!DOCTYPE configuration</span><br><span class=\"line\">        PUBLIC <span class=\"string\">&quot;-//mybatis.org//DTD Config 3.0//EN&quot;</span></span><br><span class=\"line\">        <span class=\"string\">&quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;</span>&gt;</span><br><span class=\"line\">&lt;configuration&gt;</span><br><span class=\"line\">    &lt;!--设置默认指向的数据库,这里默认指向dev--&gt;</span><br><span class=\"line\">    &lt;environments <span class=\"keyword\">default</span>=<span class=\"string\">&quot;dev&quot;</span>&gt;</span><br><span class=\"line\">        &lt;!--配置环境，不同的环境不同的id名字--&gt;</span><br><span class=\"line\">        &lt;environment id=<span class=\"string\">&quot;dev&quot;</span>&gt;</span><br><span class=\"line\">            &lt;!-- 采用JDBC方式对数据库事务进行commit/rollback --&gt;</span><br><span class=\"line\">            &lt;transactionManager type=<span class=\"string\">&quot;JDBC&quot;</span>&gt;&lt;/transactionManager&gt;</span><br><span class=\"line\">            &lt;!--采用连接池方式管理数据库连接--&gt;</span><br><span class=\"line\">            &lt;dataSource type=<span class=\"string\">&quot;POOLED&quot;</span>&gt;</span><br><span class=\"line\">                &lt;property name=<span class=\"string\">&quot;driver&quot;</span> value=<span class=\"string\">&quot;com.mysql.jdbc.Driver&quot;</span>/&gt;</span><br><span class=\"line\">                &lt;property name=<span class=\"string\">&quot;url&quot;</span> value=</span><br><span class=\"line\">    <span class=\"string\">&quot;jdbc:mysql://localhost:3306/babytun?useUnicode=true&amp;amp;characterEncoding=UTF-8&quot;</span>/&gt;</span><br><span class=\"line\">                &lt;property name=<span class=\"string\">&quot;username&quot;</span> value=<span class=\"string\">&quot;root&quot;</span>/&gt;</span><br><span class=\"line\">                &lt;property name=<span class=\"string\">&quot;password&quot;</span> value=<span class=\"string\">&quot;www.LCG.com&quot;</span>/&gt;</span><br><span class=\"line\">            &lt;/dataSource&gt;</span><br><span class=\"line\">        &lt;/environment&gt;</span><br><span class=\"line\">    &lt;/environments&gt;</span><br><span class=\"line\">&lt;/configuration&gt;</span><br></pre></td></tr></table></figure>\n<h2 id=\"SqlSessionFactory\"><a href=\"#SqlSessionFactory\" class=\"headerlink\" title=\"SqlSessionFactory\"></a>SqlSessionFactory</h2><p>◇ SqlSessionFactory是MyBatis的核心对象<br>◇ 用于初始化MyBatis,创建SqlSession对象<br>◇ 保证SqlSessionFactory在应用中全局唯一 </p>\n<h3 id=\"SqlSession\"><a href=\"#SqlSession\" class=\"headerlink\" title=\"SqlSession\"></a>SqlSession</h3><p>◇ SqlSession是MyBatis操作数据库的核心对象<br>◇ SqlSession使用JDBC方式与数据库交互<br>◇ SqlSession对象提供了数据表CRUD对应方法    </p>\n<h3 id=\"项目演示-1\"><a href=\"#项目演示-1\" class=\"headerlink\" title=\"项目演示\"></a>项目演示</h3><p>◇pom.xml中增加junit依赖用于测试<br>◇JUNIT单元测试类</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MyBatisTestor</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"meta\">@Test</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">testSqlSessionFactory</span><span class=\"params\">()</span><span class=\"keyword\">throws</span> IOException </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">//按照字符流方式进行.xml文件的读取，返回Reader对象</span></span><br><span class=\"line\">        Reader reader = Resources.getResourceAsReader(<span class=\"string\">&quot;mybatis-config.xml&quot;</span>);</span><br><span class=\"line\">        <span class=\"comment\">//初始化SqlSessionFactory对象，同时通过reader对象解析xml文件</span></span><br><span class=\"line\">        SqlSessionFactory sqlSessionFactory = <span class=\"keyword\">new</span> SqlSessionFactoryBuilder().build(reader);</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;SessionFactory加载成功&quot;</span>);</span><br><span class=\"line\">        SqlSession sqlSession = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            <span class=\"comment\">//创建SqlSession对象，SqlSession是JDBC的扩展类，用于与数据库交互</span></span><br><span class=\"line\">            sqlSession = sqlSessionFactory.openSession();</span><br><span class=\"line\">            <span class=\"comment\">//进行数据库的交互</span></span><br><span class=\"line\">            Connection connection = sqlSession.getConnection();</span><br><span class=\"line\">            System.out.println(connection);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</span><br><span class=\"line\">            e.printStackTrace();</span><br><span class=\"line\">        &#125;<span class=\"keyword\">finally</span> &#123;</span><br><span class=\"line\">            <span class=\"comment\">/*如果type=&quot;POOLED&quot;,代表使用连接池，close则是将连接回收到连接池中</span></span><br><span class=\"line\"><span class=\"comment\">            * 如果type=&quot;UNPOOLED&quot;,代表直连，close则会调用Connection.close()</span></span><br><span class=\"line\"><span class=\"comment\">            * 方法关闭连接*/</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span>(sqlSession!=<span class=\"keyword\">null</span>)&#123;</span><br><span class=\"line\">                sqlSession.close();</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">//测试工具类</span></span><br><span class=\"line\">     <span class=\"meta\">@Test</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">testMyBatisUtils</span><span class=\"params\">()</span><span class=\"keyword\">throws</span> Exception</span>&#123;</span><br><span class=\"line\">        SqlSession sqlSession = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            sqlSession = MyBatisUtils.openSession();</span><br><span class=\"line\">            Connection connection = sqlSession.getConnection();</span><br><span class=\"line\">            System.out.println(connection);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</span><br><span class=\"line\">            e.printStackTrace();</span><br><span class=\"line\">        &#125;<span class=\"keyword\">finally</span> &#123;</span><br><span class=\"line\">            MyBatisUtils.closeSession(sqlSession);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>◇初始化工具类</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MyBatisUtils</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">//利用static(静态)属于类不属于对象，且全局唯一</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> SqlSessionFactory sqlSessionFactory = <span class=\"keyword\">null</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//利用静态块在初始化类时实例化sqlSessionFactory</span></span><br><span class=\"line\">    <span class=\"keyword\">static</span> &#123;</span><br><span class=\"line\">        Reader reader = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            reader = Resources.getResourceAsReader(<span class=\"string\">&quot;mybatis-config.xml&quot;</span>);</span><br><span class=\"line\">            sqlSessionFactory = <span class=\"keyword\">new</span> SqlSessionFactoryBuilder().build(reader);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (IOException e) &#123;</span><br><span class=\"line\">            e.printStackTrace();</span><br><span class=\"line\">            <span class=\"comment\">//初始化错误时，通过抛出异常ExceptionInInitializerError通知调用者</span></span><br><span class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> ExceptionInInitializerError(e);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * openSession 创建一个新的SqlSession对象</span></span><br><span class=\"line\"><span class=\"comment\">     * 对于工具类的方法大都使用static描述，</span></span><br><span class=\"line\"><span class=\"comment\">     * 这样通过类名和方法名就可以直接使用了</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> SqlSession对象</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> SqlSession <span class=\"title\">openSession</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> sqlSessionFactory.openSession();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 释放一个有效的SqlSession对象</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> session 准备释放SqlSession对象</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">closeSession</span><span class=\"params\">(SqlSession session)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (session != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">            session.close();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h2 id=\"MyBatis数据查询\"><a href=\"#MyBatis数据查询\" class=\"headerlink\" title=\"MyBatis数据查询\"></a>MyBatis数据查询</h2><h3 id=\"MyBatis数据查询步骤\"><a href=\"#MyBatis数据查询步骤\" class=\"headerlink\" title=\"MyBatis数据查询步骤\"></a>MyBatis数据查询步骤</h3><p>◇创建实体类(Entity)                 ◇创建Mapper XML<br>◇编写SQL标签                         ◇开启驼峰命名映射<br>◇新增                                       ◇SqlSession执行select语句 </p>\n<h3 id=\"项目演示-2\"><a href=\"#项目演示-2\" class=\"headerlink\" title=\"项目演示\"></a>项目演示</h3><p>◇生成实体类，entity</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Goods</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> Integer goodsId;<span class=\"comment\">//商品编号</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> String title;<span class=\"comment\">//标题</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> String subTitle;<span class=\"comment\">//子标题</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> Float originalCost;<span class=\"comment\">//原始价格</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> Float currentPrice;<span class=\"comment\">//当前价格</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> Float discount;<span class=\"comment\">//折扣率</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> Integer isFreeDelivery;<span class=\"comment\">//是否包邮 ,1-包邮 0-不包邮</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> Integer categoryId;<span class=\"comment\">//分类编号</span></span><br><span class=\"line\">    ...</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>◇在Resources目录中创建mapper(映射器)文件，在其中创建xml文件;goods.xml文件说明了实体类和哪一张表对应</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">&lt;?xml version=<span class=\"string\">&quot;1.0&quot;</span> encoding=<span class=\"string\">&quot;UTF-8&quot;</span> ?&gt;</span><br><span class=\"line\">&lt;!DOCTYPE mapper</span><br><span class=\"line\">        PUBLIC <span class=\"string\">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span><br><span class=\"line\">        <span class=\"string\">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;&lt;!--与config中的不同 --&gt;</span><br><span class=\"line\">&lt;!--命名空间用来区分 --&gt;</span><br><span class=\"line\">&lt;mapper namespace=<span class=\"string\">&quot;goods&quot;</span>&gt;</span><br><span class=\"line\">    &lt;!--编写sql标签,resultType说明查询结果返回的实体类 --&gt;</span><br><span class=\"line\">    &lt;select id=<span class=\"string\">&quot;selectAll&quot;</span> resultType=<span class=\"string\">&quot;com.lcg.mybatis.entity.Goods&quot;</span>&gt;</span><br><span class=\"line\">        select * from t_goods order by goods_id desc limit <span class=\"number\">10</span></span><br><span class=\"line\">    &lt;/select&gt;</span><br><span class=\"line\">&lt;/mapper&gt;</span><br></pre></td></tr></table></figure>\n<p>◇新建了goods.xml后还需要在mybatis-config.xml中进行声明<br><img src=\"/p/f37d/1628332975684-1cd84570-03e0-4c7a-8f40-a0b5fcd43d7f.png\" class=\"lazyload\" data-srcset=\"/p/f37d/1628332975684-1cd84570-03e0-4c7a-8f40-a0b5fcd43d7f.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"><br>◇驼峰命名转换(在mybatis-config中配置)，数据表字段不区分大小写，但java属性区分大小写；防止读取数据库数据时丢失一些例如goods_id字段的数据</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">&lt;settings&gt;</span><br><span class=\"line\">    &lt;!-- goods_id ==&gt; goodsId 驼峰命名转换 --&gt;</span><br><span class=\"line\">    &lt;setting name=<span class=\"string\">&quot;mapUnderscoreToCamelCase&quot;</span> value=<span class=\"string\">&quot;true&quot;</span>/&gt;</span><br><span class=\"line\">&lt;/settings&gt;</span><br></pre></td></tr></table></figure>\n<p>◇编写测试</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Test</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">testSelectAll</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</span><br><span class=\"line\">    SqlSession session = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">    <span class=\"keyword\">try</span>&#123;</span><br><span class=\"line\">        session = MyBatisUtils.openSession();</span><br><span class=\"line\">        List&lt;Goods&gt; list = session.selectList(<span class=\"string\">&quot;goods.selectAll&quot;</span>);</span><br><span class=\"line\">        <span class=\"keyword\">for</span>(Goods g : list)&#123;</span><br><span class=\"line\">            System.out.println(g.getTitle());</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;<span class=\"keyword\">catch</span> (Exception e)&#123;</span><br><span class=\"line\">        <span class=\"keyword\">throw</span> e;</span><br><span class=\"line\">    &#125;<span class=\"keyword\">finally</span> &#123;</span><br><span class=\"line\">        MyBatisUtils.closeSession(session);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"Sql传参\"><a href=\"#Sql传参\" class=\"headerlink\" title=\"Sql传参\"></a>Sql传参</h2><h3 id=\"查询-select\"><a href=\"#查询-select\" class=\"headerlink\" title=\"查询 - select\"></a>查询 - select</h3><figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">&lt;select id=<span class=\"string\">&quot;selectById&quot;</span> parameterType=<span class=\"string\">&quot;Integer&quot;</span></span><br><span class=\"line\">resultType=<span class=\"string\">&quot;com.lcg.mybatis.entity.Goods&quot;</span>&gt;</span><br><span class=\"line\">select * from t_goods where goods_id = #&#123;value&#125;</span><br><span class=\"line\">&lt;/select&gt;</span><br></pre></td></tr></table></figure>\n<h3 id=\"项目示例\"><a href=\"#项目示例\" class=\"headerlink\" title=\"项目示例\"></a>项目示例</h3><p><strong>①单个参数</strong><br>◇在goods.xml中新增一个select查询</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">&lt;select id=<span class=\"string\">&quot;selectById&quot;</span> parameterType=<span class=\"string\">&quot;Integer&quot;</span> resultType=<span class=\"string\">&quot;com.lcg.mybatis.entity.Goods&quot;</span>&gt;</span><br><span class=\"line\">        select * from t_goods where goods_id = #&#123;value&#125;</span><br><span class=\"line\">    &lt;/select&gt;</span><br></pre></td></tr></table></figure>\n<p>◇进行测试</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 传递单个SQL参数</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@throws</span> Exception</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@Test</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">testSelectById</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</span><br><span class=\"line\">        SqlSession session = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">        <span class=\"keyword\">try</span>&#123;</span><br><span class=\"line\">            session = MyBatisUtils.openSession();</span><br><span class=\"line\">            Goods goods = session.selectOne(<span class=\"string\">&quot;goods.selectById&quot;</span> , <span class=\"number\">1603</span>);</span><br><span class=\"line\">            System.out.println(goods.getTitle());</span><br><span class=\"line\">        &#125;<span class=\"keyword\">catch</span> (Exception e)&#123;</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> e;</span><br><span class=\"line\">        &#125;<span class=\"keyword\">finally</span> &#123;</span><br><span class=\"line\">            MyBatisUtils.closeSession(session);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n<p><strong>②多个参数</strong><br><strong>◇</strong>session.selectxxx方法无法传递多个参数，所以利用Java.Util.Map键值对来进行多个参数的传递，即参数名为键，值为参数值<br>◇新增查询</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">&lt;select id=<span class=\"string\">&quot;selectByPriceRange&quot;</span> parameterType=<span class=\"string\">&quot;java.util.Map&quot;</span> </span><br><span class=\"line\">    resultType=<span class=\"string\">&quot;com.lcg.mybatis.entity.Goods&quot;</span>&gt;</span><br><span class=\"line\">    select * from t_goods</span><br><span class=\"line\">    where current_price between #&#123;min&#125; and #&#123;max&#125;</span><br><span class=\"line\">    limit <span class=\"number\">0</span>,#&#123;limt&#125;</span><br><span class=\"line\">&lt;/select&gt;</span><br></pre></td></tr></table></figure>\n<p>◇测试</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">    * 传递多个(3个)SQL参数</span></span><br><span class=\"line\"><span class=\"comment\">    * <span class=\"doctag\">@throws</span> Exception</span></span><br><span class=\"line\"><span class=\"comment\">    */</span></span><br><span class=\"line\">   <span class=\"meta\">@Test</span></span><br><span class=\"line\">   <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">testSelectByPriceRange</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</span><br><span class=\"line\">       SqlSession session = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">       <span class=\"keyword\">try</span>&#123;</span><br><span class=\"line\">           session = MyBatisUtils.openSession();</span><br><span class=\"line\">           Map param = <span class=\"keyword\">new</span> HashMap();</span><br><span class=\"line\">           param.put(<span class=\"string\">&quot;min&quot;</span>,<span class=\"number\">100</span>);</span><br><span class=\"line\">           param.put(<span class=\"string\">&quot;max&quot;</span> , <span class=\"number\">500</span>);</span><br><span class=\"line\">           param.put(<span class=\"string\">&quot;limt&quot;</span> , <span class=\"number\">10</span>);</span><br><span class=\"line\">           List&lt;Goods&gt; list = session.selectList(<span class=\"string\">&quot;goods.selectByPriceRange&quot;</span>, param);</span><br><span class=\"line\">           <span class=\"keyword\">for</span>(Goods g:list)&#123;</span><br><span class=\"line\">               System.out.println(g.getTitle() + <span class=\"string\">&quot;:&quot;</span> + g.getCurrentPrice());</span><br><span class=\"line\">           &#125;</span><br><span class=\"line\">       &#125;<span class=\"keyword\">catch</span> (Exception e)&#123;</span><br><span class=\"line\">           <span class=\"keyword\">throw</span> e;</span><br><span class=\"line\">       &#125;<span class=\"keyword\">finally</span> &#123;</span><br><span class=\"line\">           MyBatisUtils.closeSession(session);</span><br><span class=\"line\">       &#125;</span><br><span class=\"line\">   &#125;</span><br></pre></td></tr></table></figure>\n<p> ③多表关联<br>◇Sql语句</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!-- 利用LinkedHashMap保存多表关联结果</span></span><br><span class=\"line\"><span class=\"comment\">        MyBatis会将每一条记录包装为LinkedHashMap对象</span></span><br><span class=\"line\"><span class=\"comment\">        key是字段名  value是字段对应的值 , 字段类型根据表结构进行自动判断</span></span><br><span class=\"line\"><span class=\"comment\">        优点: 易于扩展,易于使用</span></span><br><span class=\"line\"><span class=\"comment\">        缺点: 太过灵活,无法进行编译时检查</span></span><br><span class=\"line\"><span class=\"comment\">     --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">select</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;selectGoodsMap&quot;</span> <span class=\"attr\">resultType</span>=<span class=\"string\">&quot;java.util.LinkedHashMap&quot;</span>&gt;</span></span><br><span class=\"line\">        select g.*,c.category_name from t_goods g, t_category c</span><br><span class=\"line\">        where g.category_id = c.category_id</span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">select</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>◇测试</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"code\"><pre><span class=\"line\">@Test</span><br><span class=\"line\">    public void testSelectGoodsMap() throws Exception &#123;</span><br><span class=\"line\">        SqlSession session = null;</span><br><span class=\"line\">        try&#123;</span><br><span class=\"line\">            session = MyBatisUtils.openSession();</span><br><span class=\"line\">            List<span class=\"tag\">&lt;<span class=\"name\">Map</span>&gt;</span> list = session.selectList(&quot;goods.selectGoodsMap&quot;);</span><br><span class=\"line\">            for(Map map : list)&#123;</span><br><span class=\"line\">                System.out.println(map);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;catch (Exception e)&#123;</span><br><span class=\"line\">            throw e;</span><br><span class=\"line\">        &#125;finally &#123;</span><br><span class=\"line\">            MyBatisUtils.closeSession(session);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"ResultMap结果映射\"><a href=\"#ResultMap结果映射\" class=\"headerlink\" title=\"ResultMap结果映射\"></a>ResultMap结果映射</h2><p>◇ResultMap可以将查询结果映射为复杂类型的Java对象<br>◇ResultMap适用于Java对象保存多表关联结果<br>◇ResultMap支持对象关联查询等高级特性<br><strong>项目示例</strong><br>◇创建类别实体</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"code\"><pre><span class=\"line\">public class Category &#123;</span><br><span class=\"line\">    private Integer categoryId;</span><br><span class=\"line\">    private String categoryName;</span><br><span class=\"line\">    private Integer parentId;</span><br><span class=\"line\">    private Integer categoryLevel;</span><br><span class=\"line\">    private Integer categoryOrder;</span><br><span class=\"line\"> ...</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>◇创建新包dto，用来进行对原始数据的扩展，保存以及传递;如在包中创建GoodsDTO对原始的Goods进行扩展</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"code\"><pre><span class=\"line\">//Data Transfer Object--数据传输对象</span><br><span class=\"line\">public class GoodsDTO &#123;</span><br><span class=\"line\">    private Goods goods = new Goods();</span><br><span class=\"line\">    private Category category = new Category();</span><br><span class=\"line\">    private String test;</span><br><span class=\"line\">...</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>◇结果映射</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!--结果映射--&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">resultMap</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;rmGoods&quot;</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;com.lcg.mybatis.dto.GoodsDTO&quot;</span>&gt;</span></span><br><span class=\"line\">        <span class=\"comment\">&lt;!--设置主键字段与属性映射--&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">id</span> <span class=\"attr\">property</span>=<span class=\"string\">&quot;goods.goodsId&quot;</span> <span class=\"attr\">column</span>=<span class=\"string\">&quot;goods_id&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">id</span>&gt;</span></span><br><span class=\"line\">        <span class=\"comment\">&lt;!--设置非主键字段与属性映射--&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">result</span> <span class=\"attr\">property</span>=<span class=\"string\">&quot;goods.title&quot;</span> <span class=\"attr\">column</span>=<span class=\"string\">&quot;title&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">result</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">result</span> <span class=\"attr\">property</span>=<span class=\"string\">&quot;goods.originalCost&quot;</span> <span class=\"attr\">column</span>=<span class=\"string\">&quot;original_cost&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">result</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">result</span> <span class=\"attr\">property</span>=<span class=\"string\">&quot;goods.currentPrice&quot;</span> <span class=\"attr\">column</span>=<span class=\"string\">&quot;current_price&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">result</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">result</span> <span class=\"attr\">property</span>=<span class=\"string\">&quot;goods.discount&quot;</span> <span class=\"attr\">column</span>=<span class=\"string\">&quot;discount&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">result</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">result</span> <span class=\"attr\">property</span>=<span class=\"string\">&quot;goods.isFreeDelivery&quot;</span> <span class=\"attr\">column</span>=<span class=\"string\">&quot;is_free_delivery&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">result</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">result</span> <span class=\"attr\">property</span>=<span class=\"string\">&quot;goods.categoryId&quot;</span> <span class=\"attr\">column</span>=<span class=\"string\">&quot;category_id&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">result</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">result</span> <span class=\"attr\">property</span>=<span class=\"string\">&quot;category.categoryId&quot;</span> <span class=\"attr\">column</span>=<span class=\"string\">&quot;category_id&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">result</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">result</span> <span class=\"attr\">property</span>=<span class=\"string\">&quot;category.categoryName&quot;</span> <span class=\"attr\">column</span>=<span class=\"string\">&quot;category_name&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">result</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">result</span> <span class=\"attr\">property</span>=<span class=\"string\">&quot;category.parentId&quot;</span> <span class=\"attr\">column</span>=<span class=\"string\">&quot;parent_id&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">result</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">result</span> <span class=\"attr\">property</span>=<span class=\"string\">&quot;category.categoryLevel&quot;</span> <span class=\"attr\">column</span>=<span class=\"string\">&quot;category_level&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">result</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">result</span> <span class=\"attr\">property</span>=<span class=\"string\">&quot;category.categoryOrder&quot;</span> <span class=\"attr\">column</span>=<span class=\"string\">&quot;category_order&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">result</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">result</span> <span class=\"attr\">property</span>=<span class=\"string\">&quot;test&quot;</span> <span class=\"attr\">column</span>=<span class=\"string\">&quot;test&quot;</span>/&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">resultMap</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">select</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;selectGoodsDTO&quot;</span> <span class=\"attr\">resultMap</span>=<span class=\"string\">&quot;rmGoods&quot;</span>&gt;</span></span><br><span class=\"line\">        select g.* , c.*,&#x27;1&#x27; as test from t_goods g , t_category c</span><br><span class=\"line\">        where g.category_id = c.category_id</span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">select</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>◇测试</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"code\"><pre><span class=\"line\">@Test</span><br><span class=\"line\">    public void testSelectGoodsDTO()throws Exception&#123;</span><br><span class=\"line\">        SqlSession session = null;</span><br><span class=\"line\">        try &#123;</span><br><span class=\"line\">            session = MyBatisUtils.openSession();</span><br><span class=\"line\">            List<span class=\"tag\">&lt;<span class=\"name\">GoodsDTO</span>&gt;</span> list = session.selectList(&quot;goods.selectGoodsDTO&quot;);</span><br><span class=\"line\">            for(GoodsDTO g:list)&#123;</span><br><span class=\"line\">                System.out.println(g.getGoods().getTitle());</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125; catch (Exception e) &#123;</span><br><span class=\"line\">            throw e;</span><br><span class=\"line\">        &#125;finally &#123;</span><br><span class=\"line\">            MyBatisUtils.closeSession(session);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"MyBatis数据写入\"><a href=\"#MyBatis数据写入\" class=\"headerlink\" title=\"MyBatis数据写入\"></a>MyBatis数据写入</h2><h3 id=\"数据库事务\"><a href=\"#数据库事务\" class=\"headerlink\" title=\"数据库事务\"></a>数据库事务</h3><p>◇数据库事务是保证数据操作完整性的基础<br><img src=\"/p/f37d/1628513637346-4dc8cb72-ae9e-46b1-8732-63a7f3f9c3b3.png\" class=\"lazyload\" data-srcset=\"/p/f37d/1628513637346-4dc8cb72-ae9e-46b1-8732-63a7f3f9c3b3.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"></p>\n<h3 id=\"MyBatis写操作包含三种\"><a href=\"#MyBatis写操作包含三种\" class=\"headerlink\" title=\"MyBatis写操作包含三种\"></a>MyBatis写操作包含三种</h3><p>◇插入 -  insert</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">insert</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;insert&quot;</span> <span class=\"attr\">parameterType</span>=<span class=\"string\">&quot;com.lcg.mybatis.entity.Goods&quot;</span>&gt;</span></span><br><span class=\"line\">INSERT INTO `babytun`.`t_goods`( `title`, `sub_title`, `original_cost`, current_price`)</span><br><span class=\"line\">VALUES ( #&#123;title&#125;, #&#123;subTitle&#125;, #&#123;originalCost&#125;, #&#123;currentPrice&#125;)</span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">selectKey</span> <span class=\"attr\">resultType</span>=<span class=\"string\">&quot;int&quot;</span> <span class=\"attr\">keyProperty</span>=<span class=\"string\">&quot;goodsId&quot;</span> <span class=\"attr\">order</span>=<span class=\"string\">&quot;AFTER&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"comment\">&lt;!-- 当前连接中最后产生的id号 --&gt;</span></span><br><span class=\"line\">select last_insert_id()</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">selectKey</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">insert</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">--示例代码</span><br><span class=\"line\"> <span class=\"tag\">&lt;<span class=\"name\">insert</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;insert&quot;</span> <span class=\"attr\">parameterType</span>=<span class=\"string\">&quot;com.lcg.mybatis.entity.Goods&quot;</span>&gt;</span></span><br><span class=\"line\">        insert into t_goods(title, sub_title, original_cost, current_price, </span><br><span class=\"line\">                            discount, is_free_delivery,category_id)</span><br><span class=\"line\">        value (#&#123;title&#125; , #&#123;subTitle&#125; , #&#123;originalCost&#125;, </span><br><span class=\"line\">               #&#123;currentPrice&#125;, #&#123;discount&#125;, #&#123;isFreeDelivery&#125;, #&#123;categoryId&#125;)</span><br><span class=\"line\">   //用来将新插入的id回填到类中</span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">selectKey</span> <span class=\"attr\">resultType</span>=<span class=\"string\">&quot;Integer&quot;</span> <span class=\"attr\">keyProperty</span>=<span class=\"string\">&quot;goodsId&quot;</span> <span class=\"attr\">order</span>=<span class=\"string\">&quot;AFTER&quot;</span>&gt;</span></span><br><span class=\"line\">            select last_insert_id()</span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">selectKey</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">insert</span>&gt;</span></span><br><span class=\"line\">    @Test</span><br><span class=\"line\">    public void testInsert() throws Exception &#123;</span><br><span class=\"line\">        SqlSession session = null;</span><br><span class=\"line\">        try&#123;</span><br><span class=\"line\">            session = MyBatisUtils.openSession();</span><br><span class=\"line\">            Goods goods = new Goods();</span><br><span class=\"line\">            goods.setTitle(&quot;测试商品&quot;);</span><br><span class=\"line\">            goods.setSubTitle(&quot;测试子标题&quot;);</span><br><span class=\"line\">            goods.setOriginalCost(200f);</span><br><span class=\"line\">            goods.setCurrentPrice(100f);</span><br><span class=\"line\">            goods.setDiscount(0.5f);</span><br><span class=\"line\">            goods.setIsFreeDelivery(1);</span><br><span class=\"line\">            goods.setCategoryId(43);</span><br><span class=\"line\">            //insert()方法返回值代表本次成功插入的记录总数</span><br><span class=\"line\">            int num = session.insert(&quot;goods.insert&quot;, goods);</span><br><span class=\"line\">            session.commit();//提交事务数据</span><br><span class=\"line\">            System.out.println(goods.getGoodsId());</span><br><span class=\"line\">        &#125;catch (Exception e)&#123;</span><br><span class=\"line\">            if(session != null)&#123;</span><br><span class=\"line\">                session.rollback();//回滚事务</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            throw e;</span><br><span class=\"line\">        &#125;finally &#123;</span><br><span class=\"line\">            MyBatisUtils.closeSession(session);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n<p>◇更新 -  update</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">update</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;update&quot;</span> <span class=\"attr\">parameterType</span>=<span class=\"string\">&quot;com.lcg.mybatis.entity.Goods&quot;</span>&gt;</span></span><br><span class=\"line\">        UPDATE t_goods</span><br><span class=\"line\">        SET</span><br><span class=\"line\">          title = #&#123;title&#125; ,</span><br><span class=\"line\">          sub_title = #&#123;subTitle&#125; ,</span><br><span class=\"line\">          original_cost = #&#123;originalCost&#125; ,</span><br><span class=\"line\">          current_price = #&#123;currentPrice&#125; ,</span><br><span class=\"line\">          discount = #&#123;discount&#125; ,</span><br><span class=\"line\">          is_free_delivery = #&#123;isFreeDelivery&#125; ,</span><br><span class=\"line\">          category_id = #&#123;categoryId&#125;</span><br><span class=\"line\">        WHERE</span><br><span class=\"line\">          goods_id = #&#123;goodsId&#125;</span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">update</span>&gt;</span></span><br><span class=\"line\"> @Test</span><br><span class=\"line\">    public void testUpdate() throws Exception &#123;</span><br><span class=\"line\">        SqlSession session = null;</span><br><span class=\"line\">        try&#123;</span><br><span class=\"line\">            session = MyBatisUtils.openSession();</span><br><span class=\"line\">            //通过selectOne方法得到指定商品编号的goods对象</span><br><span class=\"line\">            Goods goods = session.selectOne(&quot;goods.selectById&quot;, 739);</span><br><span class=\"line\">            goods.setTitle(&quot;更新测试商品&quot;);</span><br><span class=\"line\">            int num = session.update(&quot;goods.update&quot; , goods);</span><br><span class=\"line\">            session.commit();//提交事务数据</span><br><span class=\"line\">        &#125;catch (Exception e)&#123;</span><br><span class=\"line\">            if(session != null)&#123;</span><br><span class=\"line\">                session.rollback();//回滚事务</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            throw e;</span><br><span class=\"line\">        &#125;finally &#123;</span><br><span class=\"line\">            MyBatisUtils.closeSession(session);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>◇删除 -  delete</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!--delete from t_goods where goods_id in (1920,1921)--&gt;</span></span><br><span class=\"line\">   <span class=\"tag\">&lt;<span class=\"name\">delete</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;delete&quot;</span> <span class=\"attr\">parameterType</span>=<span class=\"string\">&quot;Integer&quot;</span>&gt;</span></span><br><span class=\"line\">       delete from t_goods where goods_id = #&#123;value&#125;</span><br><span class=\"line\">   <span class=\"tag\">&lt;/<span class=\"name\">delete</span>&gt;</span></span><br><span class=\"line\">@Test</span><br><span class=\"line\">   public void testDelete() throws Exception &#123;</span><br><span class=\"line\">       SqlSession session = null;</span><br><span class=\"line\">       try&#123;</span><br><span class=\"line\">           session = MyBatisUtils.openSession();</span><br><span class=\"line\">           int num = session.delete(&quot;goods.delete&quot; , 739);</span><br><span class=\"line\">           session.commit();//提交事务数据</span><br><span class=\"line\">       &#125;catch (Exception e)&#123;</span><br><span class=\"line\">           if(session != null)&#123;</span><br><span class=\"line\">               session.rollback();//回滚事务</span><br><span class=\"line\">           &#125;</span><br><span class=\"line\">           throw e;</span><br><span class=\"line\">       &#125;finally &#123;</span><br><span class=\"line\">           MyBatisUtils.closeSession(session);</span><br><span class=\"line\">       &#125;</span><br><span class=\"line\">   &#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"selectKey与useGeneratedKeys的区别\"><a href=\"#selectKey与useGeneratedKeys的区别\" class=\"headerlink\" title=\"selectKey与useGeneratedKeys的区别\"></a>selectKey与useGeneratedKeys的区别</h3><p>◇selectKey标签的用法</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">insert</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;insert&quot;</span> <span class=\"attr\">parameterType</span>=<span class=\"string\">&quot;com.lcg.mybatis.entity.Goods&quot;</span>&gt;</span></span><br><span class=\"line\">      INSERT INTO SQL语句</span><br><span class=\"line\">       <span class=\"tag\">&lt;<span class=\"name\">selectKey</span> <span class=\"attr\">resultType</span>=<span class=\"string\">&quot;Integer&quot;</span> <span class=\"attr\">keyProperty</span>=<span class=\"string\">&quot;goodsId&quot;</span> <span class=\"attr\">order</span>=<span class=\"string\">&quot;AFTER&quot;</span>&gt;</span></span><br><span class=\"line\">           select last_insert_id()</span><br><span class=\"line\">       <span class=\"tag\">&lt;/<span class=\"name\">selectKey</span>&gt;</span></span><br><span class=\"line\">   <span class=\"tag\">&lt;/<span class=\"name\">insert</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>◇useGeneratedKeys属性用法</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">insert</span>&gt;</span></span><br><span class=\"line\">   parameterType=&quot;com.lcg.mybatis.entity.Goods&quot;</span><br><span class=\"line\">   useGeneratedKeys=&quot;true&quot;</span><br><span class=\"line\">   keyProperty=&quot;goodsId&quot;</span><br><span class=\"line\">   KeyColumn=&quot;goods_id&quot;</span><br><span class=\"line\">  INSERT INTO SQL 语句</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">insert</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p><strong>二者区别</strong><br>◇selectKey标签需要明确编写获取最新主键的SQL语句<br>◇useGeneratedKeys属性会自动根据驱动生成对应SQL语句<br>◇selectKey适用于所有的关系型数据库<br>◇useGeneratedKeys只适用于能够”自增主键”类型的数据库<br>◇在Oracle(非自增)中selectKey的用法</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">insert</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;insert&quot;</span> <span class=\"attr\">parameterType</span>=<span class=\"string\">&quot;com.lcg.mybatis.entity.Goods&quot;</span>&gt;</span></span><br><span class=\"line\">      INSERT INTO SQL语句</span><br><span class=\"line\">       <span class=\"tag\">&lt;<span class=\"name\">selectKey</span> <span class=\"attr\">resultType</span>=<span class=\"string\">&quot;Integer&quot;</span> <span class=\"attr\">keyProperty</span>=<span class=\"string\">&quot;goodsId&quot;</span> <span class=\"attr\">order</span>=<span class=\"string\">&quot;BEFORE&quot;</span>&gt;</span></span><br><span class=\"line\">           select seq_goods.nextval as id from dual</span><br><span class=\"line\">       <span class=\"tag\">&lt;/<span class=\"name\">selectKey</span>&gt;</span></span><br><span class=\"line\">   <span class=\"tag\">&lt;/<span class=\"name\">insert</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"MyBatis预防SQL注入攻击\"><a href=\"#MyBatis预防SQL注入攻击\" class=\"headerlink\" title=\"MyBatis预防SQL注入攻击\"></a>MyBatis预防SQL注入攻击</h2><h3 id=\"SQL注入攻击\"><a href=\"#SQL注入攻击\" class=\"headerlink\" title=\"SQL注入攻击\"></a>SQL注入攻击</h3><p> ◇SQL注入是指攻击者利用SQL漏洞,绕过系统约束,越权获取数据的攻击方式  </p>\n<figure class=\"highlight xml\"><table><tr><td class=\"code\"><pre><span class=\"line\">SQL代码:</span><br><span class=\"line\">select * from a where name =&#x27;&quot;+ name+&quot;&#x27;&quot;;</span><br><span class=\"line\">正常情况:</span><br><span class=\"line\">name:张三 -&gt; select * from a where name=&#x27;张三&#x27;;</span><br><span class=\"line\">SQL注入攻击:</span><br><span class=\"line\">name:&#x27; or 1=1 or 1=&#x27;</span><br><span class=\"line\">select * from a where name=&#x27;&#x27; or 1=1 or 1=&#x27;&#x27;</span><br></pre></td></tr></table></figure>\n<h3 id=\"MyBatis两种传值方式\"><a href=\"#MyBatis两种传值方式\" class=\"headerlink\" title=\"MyBatis两种传值方式\"></a>MyBatis两种传值方式</h3><p>◇${}文本替换,未经任何处理对SQL文本替换<br>◇ #{}预编译传值,使用预编译传值可以预防SQL注入  </p>\n<h2 id=\"MyBatis工作流程\"><a href=\"#MyBatis工作流程\" class=\"headerlink\" title=\"MyBatis工作流程\"></a>MyBatis工作流程</h2><p><img src=\"/p/f37d/1628585431174-e99c3d94-a034-4cf0-8882-0cee59cca82f.png\" class=\"lazyload\" data-srcset=\"/p/f37d/1628585431174-e99c3d94-a034-4cf0-8882-0cee59cca82f.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"><br>◇首先在Java应用中创建mybatis-config.xml文件，用于全局配置，这个配置文件包含了全局设置项、环境配置、mapper声明等核心配置信息；然后在程序的运行过程中通过SqlSessionFactoryBuilder构造器对象来build(构造)SqlSessionFactory工厂类对象；该工厂类对象需要保证全局唯一，用于创建SqlSession对象；SqlSession是我们用于对数据库增删改查的核心对象，它要解析与之对应的mapper.xml文件，每一个mapper.xml文件中包含了大量的sql语句；我们通过SqlSession来访问mapper.xml文件，进而执行其中的sql语句；在SqlSession中主要提供了四种方法(insert | update | delete | select)和数据库进行交互；在进行写的操作时，不要忘记对事务进行相应的提交和回滚；在交互完毕后，应当关闭会话任务，这样我们的底层数据库连接要么被连接池回收要么就直接释放掉；SessionClose这个操作一般放在finally块中，保证它一定能够执行；</p>\n","categories":["Java数据库","MyBaits"],"tags":["MyBaits"]},{"title":"MyBaits进阶","url":"/p/fb2c.html","content":"<h2 id=\"MyBatis日志管理\"><a href=\"#MyBatis日志管理\" class=\"headerlink\" title=\"MyBatis日志管理\"></a>MyBatis日志管理</h2><h3 id=\"什么是日志\"><a href=\"#什么是日志\" class=\"headerlink\" title=\"什么是日志\"></a>什么是日志</h3><p>◇日志文件是用于记录系统操作事件的记录文件或文件集合<br>◇日志保存历史数据,是诊断问题以及理解系统活动的重要依据  </p>\n<h3 id=\"SLF4j与Logback\"><a href=\"#SLF4j与Logback\" class=\"headerlink\" title=\"SLF4j与Logback\"></a>SLF4j与Logback</h3><p><img src=\"/p/fb2c/1628599313923-5abfc2e2-0d7c-4efe-8078-f5601db8fca6.png\" class=\"lazyload\" data-srcset=\"/p/fb2c/1628599313923-5abfc2e2-0d7c-4efe-8078-f5601db8fca6.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"></p>\n<p><strong>代码示例</strong>​<br>◇配置依赖</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>ch.qos.logback<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>logback-classic<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.2.3<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p> ◇产生的日志(部分)</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"code\"><pre><span class=\"line\">20:53:41.109 [main] DEBUG goods.selectByTitle - ==&gt;  Preparing: select * from t_goods where title = ? order by title desc </span><br><span class=\"line\">20:53:41.131 [main] DEBUG goods.selectByTitle - ==&gt; Parameters: &#x27;&#x27; or 1=1 or title=&#x27;【德国】爱他美婴幼儿配方奶粉1段800g*2罐 铂金版&#x27;(String)</span><br><span class=\"line\">20:53:41.298 [main] DEBUG goods.selectByTitle - &lt;==      Total: 0</span><br></pre></td></tr></table></figure>\n<p>◇自定义日志格式：在resource目录新建logback.xml文件</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">configuration</span>&gt;</span></span><br><span class=\"line\">  <span class=\"comment\">&lt;!--ConsoleAppender是指在控制台输出日志 pattern指定日志输出格式，示例格式即</span></span><br><span class=\"line\"><span class=\"comment\">  线程，时间，按5个字符右对齐，说明哪个类产生的日志(最多36字符超过压缩)，具体日志内容 换行 </span></span><br><span class=\"line\"><span class=\"comment\">--&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">appender</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;console&quot;</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;ch.qos.logback.core.ConsoleAppender&quot;</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">encoder</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">pattern</span>&gt;</span>[%thread] %d&#123;HH:mm:ss.SSS&#125; %-5level %logger&#123;36&#125; - %msg%n<span class=\"tag\">&lt;/<span class=\"name\">pattern</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">encoder</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">appender</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">&lt;!--</span></span><br><span class=\"line\"><span class=\"comment\">        日志输出级别(优先级高到低):</span></span><br><span class=\"line\"><span class=\"comment\">        error: 错误 - 系统的故障日志</span></span><br><span class=\"line\"><span class=\"comment\">        warn: 警告 - 存在风险或使用不当的日志</span></span><br><span class=\"line\"><span class=\"comment\">        info: 一般性消息</span></span><br><span class=\"line\"><span class=\"comment\">        de<span class=\"doctag\">bug:</span> 程序内部用于调试信息</span></span><br><span class=\"line\"><span class=\"comment\">        trace: 程序运行的跟踪信息</span></span><br><span class=\"line\"><span class=\"comment\">     --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">root</span> <span class=\"attr\">level</span>=<span class=\"string\">&quot;debug&quot;</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">appender-ref</span> <span class=\"attr\">ref</span>=<span class=\"string\">&quot;console&quot;</span>/&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">root</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"MyBatis动态SQL\"><a href=\"#MyBatis动态SQL\" class=\"headerlink\" title=\"MyBatis动态SQL\"></a>MyBatis动态SQL</h2><p> ◇动态SQL是指根据参数数据动态组织SQL的技术  </p>\n<figure class=\"highlight xml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">select</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;dynamicSQL&quot;</span> <span class=\"attr\">parameterType</span>=<span class=\"string\">&quot;java.util.Map&quot;</span> <span class=\"attr\">resultType</span>=<span class=\"string\">&quot;com..Goods&quot;</span>&gt;</span></span><br><span class=\"line\">select * from t_goods</span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">where</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">if</span> <span class=\"attr\">test</span>=<span class=\"string\">&quot;categoryId != null&quot;</span>&gt;</span></span><br><span class=\"line\">and category_id = #&#123;categoryId&#125;</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">if</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">if</span> <span class=\"attr\">test</span>=<span class=\"string\">&quot;currentPrice != null&quot;</span>&gt;</span></span><br><span class=\"line\">and current_price <span class=\"symbol\">&amp;lt;</span> #&#123;currentPrice&#125;</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">if</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">where</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">select</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>◇示例代码</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">select</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;dynamicSQL&quot;</span> <span class=\"attr\">parameterType</span>=<span class=\"string\">&quot;java.util.Map&quot;</span> </span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">resultType</span>=<span class=\"string\">&quot;com.lcg.mybatis.entity.Goods&quot;</span>&gt;</span></span><br><span class=\"line\">        select * from t_goods</span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">where</span>&gt;</span></span><br><span class=\"line\">          <span class=\"tag\">&lt;<span class=\"name\">if</span> <span class=\"attr\">test</span>=<span class=\"string\">&quot;categoryId != null&quot;</span>&gt;</span></span><br><span class=\"line\">              and category_id = #&#123;categoryId&#125;</span><br><span class=\"line\">          <span class=\"tag\">&lt;/<span class=\"name\">if</span>&gt;</span></span><br><span class=\"line\">          <span class=\"tag\">&lt;<span class=\"name\">if</span> <span class=\"attr\">test</span>=<span class=\"string\">&quot;currentPrice != null&quot;</span>&gt;</span></span><br><span class=\"line\">              and current_price <span class=\"symbol\">&amp;lt;</span> #&#123;currentPrice&#125;  //小于号转义符</span><br><span class=\"line\">          <span class=\"tag\">&lt;/<span class=\"name\">if</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">where</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">select</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    @Test</span><br><span class=\"line\">    public void testDynamicSQL() throws Exception &#123;</span><br><span class=\"line\">        SqlSession session = null;</span><br><span class=\"line\">        try&#123;</span><br><span class=\"line\">            session = MyBatisUtils.openSession();</span><br><span class=\"line\">            Map param = new HashMap();</span><br><span class=\"line\">            param.put(&quot;categoryId&quot;, 44);</span><br><span class=\"line\">            param.put(&quot;currentPrice&quot;, 500);</span><br><span class=\"line\">            //查询条件</span><br><span class=\"line\">            List<span class=\"tag\">&lt;<span class=\"name\">Goods</span>&gt;</span> list = session.selectList(&quot;goods.dynamicSQL&quot;, param);</span><br><span class=\"line\">            for(Goods g:list)&#123;</span><br><span class=\"line\">                System.out.println(g.getTitle() + &quot;:&quot; +</span><br><span class=\"line\">                        g.getCategoryId()  + &quot;:&quot; + g.getCurrentPrice());</span><br><span class=\"line\"></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;catch (Exception e)&#123;</span><br><span class=\"line\">            throw e;</span><br><span class=\"line\">        &#125;finally &#123;</span><br><span class=\"line\">            MyBatisUtils.closeSession(session);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"MyBatis二级缓存\"><a href=\"#MyBatis二级缓存\" class=\"headerlink\" title=\"MyBatis二级缓存\"></a>MyBatis二级缓存</h2><h3 id=\"缓存简介\"><a href=\"#缓存简介\" class=\"headerlink\" title=\"缓存简介\"></a>缓存简介</h3><p>◇我们从数据库中查询到某一条数据后，因为业务的要求还需要这条数据，那么按照原始的方法就还需要在数据库中查询到该数据；因为MySql是将数据存放在硬盘上的，而硬盘的读取访问速度不是特别快；而且我们这里第一次获取和第二次获取记录的时候，都返回相同的数据；因此我们可以在第一次查询数据时，将该数据暂时保存到内存的某一个区域中，第二次查询时直接从内存的对应区域取出即可，因为内存的访问速度快，这样就能够提高查询的速度；在Mybatis中存在了两级缓存；<br>◇ 一级缓存默认开启,缓存的数据范围为SqlSession会话，即在一次SqlSession会话中，对数据库中的某个数据进行重复读取，Mybatis就会利用到这个缓存来提高程序的处理速度；<br>◇ 二级缓存手动开启,属于范围Mapper Namespace ，范围比SqlSession大的多；</p>\n<h3 id=\"缓存的范围\"><a href=\"#缓存的范围\" class=\"headerlink\" title=\"缓存的范围\"></a>缓存的范围</h3><p><img src=\"/p/fb2c/1628648358170-3c4957c8-1a4f-4c0b-9266-d477a41ad6d0.png\" class=\"lazyload\" data-srcset=\"/p/fb2c/1628648358170-3c4957c8-1a4f-4c0b-9266-d477a41ad6d0.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"></p>\n<h3 id=\"二级缓存运行规则\"><a href=\"#二级缓存运行规则\" class=\"headerlink\" title=\"二级缓存运行规则\"></a>二级缓存运行规则</h3><p>◇二级开启后默认所有查询操作均使用缓存<br>◇写操作使用commit提交时对该namespace缓存强制清空，保证商品一致性；如第一个用户查询到商品，而第二个用户将此商品名称改了，那么这时候就会将namespace缓存强制清空，第一个用户再次查询该商品时就得从数据库中获取了；<br>◇配置useCache=false可以不用缓存<br>◇在某一sql语句中配置flushCache=true代表执行完该sql语句后强制清空缓存<br>◇代码示例</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//测试一级缓存</span></span><br><span class=\"line\">    <span class=\"meta\">@Test</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">testLv1Cache</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</span><br><span class=\"line\">        SqlSession session = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">        <span class=\"keyword\">try</span>&#123;</span><br><span class=\"line\">            session = MyBatisUtils.openSession();</span><br><span class=\"line\">            <span class=\"comment\">//这里执行了两次sql查询，由于使用了缓存，所以在日志中可以看到只打印出一条sql语句</span></span><br><span class=\"line\">            Goods goods = session.selectOne(<span class=\"string\">&quot;goods.selectById&quot;</span> , <span class=\"number\">1603</span>);</span><br><span class=\"line\">            Goods goods1 = session.selectOne(<span class=\"string\">&quot;goods.selectById&quot;</span> , <span class=\"number\">1603</span>);</span><br><span class=\"line\">            System.out.println(goods.hashCode() + <span class=\"string\">&quot;:&quot;</span> + goods1.hashCode());</span><br><span class=\"line\">        &#125;<span class=\"keyword\">catch</span> (Exception e)&#123;</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> e;</span><br><span class=\"line\">        &#125;<span class=\"keyword\">finally</span> &#123;</span><br><span class=\"line\">            MyBatisUtils.closeSession(session);<span class=\"comment\">//关闭了会话</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">try</span>&#123;</span><br><span class=\"line\">            session = MyBatisUtils.openSession();</span><br><span class=\"line\">            <span class=\"comment\">//由于前面关闭了会话，这里是新的会话，需要对数据库进行查询</span></span><br><span class=\"line\">            Goods goods = session.selectOne(<span class=\"string\">&quot;goods.selectById&quot;</span> , <span class=\"number\">1603</span>);</span><br><span class=\"line\">            session.commit();<span class=\"comment\">//commit提交时对该namespace缓存强制清空</span></span><br><span class=\"line\">            <span class=\"comment\">//由于前面对缓存进行了强制清空，所以还需要访问数据库</span></span><br><span class=\"line\">            Goods goods1 = session.selectOne(<span class=\"string\">&quot;goods.selectById&quot;</span> , <span class=\"number\">1603</span>);</span><br><span class=\"line\">            System.out.println(goods.hashCode() + <span class=\"string\">&quot;:&quot;</span> + goods1.hashCode());</span><br><span class=\"line\">        &#125;<span class=\"keyword\">catch</span> (Exception e)&#123;</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> e;</span><br><span class=\"line\">        &#125;<span class=\"keyword\">finally</span> &#123;</span><br><span class=\"line\">            MyBatisUtils.closeSession(session);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"> <span class=\"comment\">//测试二级缓存 </span></span><br><span class=\"line\"> <span class=\"comment\">//在mapper标签下添加cache标签</span></span><br><span class=\"line\">&lt;!--开启了二级缓存</span><br><span class=\"line\">        eviction是缓存的清除策略,当缓存对象数量达到上限后,自动触发对应算法对缓存对象清除</span><br><span class=\"line\">            <span class=\"number\">1.</span>LRU – 最近最久未使用:移除最长时间不被使用的对象。</span><br><span class=\"line\">            O1 O2 O3 O4 .. O512</span><br><span class=\"line\">            <span class=\"number\">14</span> <span class=\"number\">99</span> <span class=\"number\">83</span> <span class=\"number\">1</span>     <span class=\"number\">893</span></span><br><span class=\"line\">            <span class=\"number\">2.</span>FIFO – 先进先出:按对象进入缓存的顺序来移除它们。</span><br><span class=\"line\">            <span class=\"number\">3.</span>SOFT – 软引用:移除基于垃圾收集器状态和软引用规则的对象。</span><br><span class=\"line\">            <span class=\"number\">4.</span>WEAK – 弱引用:更积极的移除基于垃圾收集器状态和弱引用规则的对象。</span><br><span class=\"line\">            <span class=\"number\">5.</span>LFU - 最不经常使用：移除最近访问频率最低的对象</span><br><span class=\"line\">      flushInterval代表间隔多长时间自动清空缓存，单位毫秒，<span class=\"number\">600000</span>毫秒为<span class=\"number\">10</span>分钟</span><br><span class=\"line\">    --&gt;</span><br><span class=\"line\">    &lt;cache eviction=<span class=\"string\">&quot;LRU&quot;</span> flushInterval=<span class=\"string\">&quot;600000&quot;</span> size=<span class=\"string\">&quot;512&quot;</span> readOnly=<span class=\"string\">&quot;true&quot;</span>/&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Test</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">testLv2Cache</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</span><br><span class=\"line\">        SqlSession session = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">        <span class=\"keyword\">try</span>&#123;</span><br><span class=\"line\">            session = MyBatisUtils.openSession();</span><br><span class=\"line\">            Goods goods = session.selectOne(<span class=\"string\">&quot;goods.selectById&quot;</span> , <span class=\"number\">1603</span>);</span><br><span class=\"line\">            System.out.println(goods.hashCode());</span><br><span class=\"line\">        &#125;<span class=\"keyword\">catch</span> (Exception e)&#123;</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> e;</span><br><span class=\"line\">        &#125;<span class=\"keyword\">finally</span> &#123;</span><br><span class=\"line\">            MyBatisUtils.closeSession(session);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">try</span>&#123;</span><br><span class=\"line\">            <span class=\"comment\">//这里虽然是新的会话，但是由于是二级缓存，所以还是可以从内存中提取数据；</span></span><br><span class=\"line\">            session = MyBatisUtils.openSession();</span><br><span class=\"line\">            Goods goods = session.selectOne(<span class=\"string\">&quot;goods.selectById&quot;</span> , <span class=\"number\">1603</span>);</span><br><span class=\"line\">            System.out.println(goods.hashCode());</span><br><span class=\"line\">        &#125;<span class=\"keyword\">catch</span> (Exception e)&#123;</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> e;</span><br><span class=\"line\">        &#125;<span class=\"keyword\">finally</span> &#123;</span><br><span class=\"line\">            MyBatisUtils.closeSession(session);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n<p>◇缓存标签的属性：<br>eviction是缓存的清除策略,当缓存对象数量达到上限后,自动触发对应算法对缓存对象清除<br>            1.LRU – 最近最久未使用:移除最长时间不被使用的对象。<br>            O1 O2 O3 O4 .. O512<br>            14 99 83 1     893<br>            2.FIFO – 先进先出:按对象进入缓存的顺序来移除它们。<br>            3.SOFT – 软引用:移除基于垃圾收集器状态和软引用规则的对象。<br>            4.WEAK – 弱引用:更积极的移除基于垃圾收集器状态和弱引用规则的对象。<br> flushInterval代表间隔多长时间自动清空缓存，单位毫秒<br>size 缓存存储上限，用于保存对象或集合(1个集合算1个对象)的数量上限<br>readOnly 设置为true，代表返回只读缓存，每次从缓存取出的是缓存对象本身，这种执行效率较高<br>                设置为false，代表每次取出的是缓存对象的”副本”，每一次取出的对象都是不同的，这种安全性较高<br>◇一些缓存相关的属性：useCache=”false”代表查询结果不被放入缓存，常用于读取全部数据的SQL语句中<br>执行完insert语句需要立即清空缓存，flushCache=”true”在sql执行后强制清空缓存 </p>\n<h2 id=\"MyBatis多表级联查询\"><a href=\"#MyBatis多表级联查询\" class=\"headerlink\" title=\"MyBatis多表级联查询\"></a>MyBatis多表级联查询</h2><h3 id=\"实体关系分析\"><a href=\"#实体关系分析\" class=\"headerlink\" title=\"实体关系分析\"></a>实体关系分析</h3><p><img src=\"/p/fb2c/1628753256241-93038a3b-4c03-4530-ace1-ddb89972beda.png\" class=\"lazyload\" data-srcset=\"/p/fb2c/1628753256241-93038a3b-4c03-4530-ace1-ddb89972beda.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"></p>\n<h3 id=\"商品和详情对象关联查询\"><a href=\"#商品和详情对象关联查询\" class=\"headerlink\" title=\"商品和详情对象关联查询\"></a>商品和详情对象关联查询</h3><p><strong>一对多</strong><br>◇增加实体类GoodsDetail</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"code\"><pre><span class=\"line\">public class GoodsDetail &#123;</span><br><span class=\"line\">    private Integer gdId;</span><br><span class=\"line\">    private Integer goodsId;</span><br><span class=\"line\">    private String gdPicUrl;</span><br><span class=\"line\">    private Integer gdOrder;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>◇配置</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span></span><br><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE <span class=\"meta-keyword\">mapper</span></span></span><br><span class=\"line\"><span class=\"meta\">        <span class=\"meta-keyword\">PUBLIC</span> <span class=\"meta-string\">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class=\"line\"><span class=\"meta\">        <span class=\"meta-string\">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">mapper</span> <span class=\"attr\">namespace</span>=<span class=\"string\">&quot;goodsDetail&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">select</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;selectByGoodsId&quot;</span> <span class=\"attr\">parameterType</span>=<span class=\"string\">&quot;Integer&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">            <span class=\"attr\">resultType</span>=<span class=\"string\">&quot;com.lcg.mybatis.entity.GoodsDetail&quot;</span>&gt;</span></span><br><span class=\"line\">        select * from t_goods_detail where goods_id = #&#123;value&#125;</span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">select</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>◇表达一个Goods对象有多个GoodsDetail对象：在Goods类中增加**private **List&lt;GoodsDetail&gt;<strong>goodsDetails</strong>;<br>◇Goods.xml中</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!--</span></span><br><span class=\"line\"><span class=\"comment\">    resultMap可用于说明一对多或者多对一以及多表查询(前面学过)的映射逻辑</span></span><br><span class=\"line\"><span class=\"comment\">    id 是resultMap属性引用的标志,需要和其他resultMap区分开</span></span><br><span class=\"line\"><span class=\"comment\">    type 在一对多的关系中指向One的实体(Goods)</span></span><br><span class=\"line\"><span class=\"comment\">--&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">resultMap</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;rmGoods1&quot;</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;com.lcg.mybatis.entity.Goods&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- 映射goods对象的主键到goods_id字段 --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">id</span> <span class=\"attr\">column</span>=<span class=\"string\">&quot;goods_id&quot;</span> <span class=\"attr\">property</span>=<span class=\"string\">&quot;goodsId&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">id</span>&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!--</span></span><br><span class=\"line\"><span class=\"comment\">        collection(集合)专用于描述Goods实体中的goodsDetails这个List数据从哪来的; 其含义是,在</span></span><br><span class=\"line\"><span class=\"comment\">        select * from t_goods limit 0,10 得到结果后,对所有Goods对象遍历得到goods_id字段值,</span></span><br><span class=\"line\"><span class=\"comment\">        并代入到goodsDetail命名空间的 selectByGoodsId的SQL中执行查询,</span></span><br><span class=\"line\"><span class=\"comment\">        将得到的&quot;商品详情&quot;集合赋值给goodsDetails 这个List对象.</span></span><br><span class=\"line\"><span class=\"comment\">    --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">collection</span> <span class=\"attr\">property</span>=<span class=\"string\">&quot;goodsDetails&quot;</span> <span class=\"attr\">select</span>=<span class=\"string\">&quot;goodsDetail.selectByGoodsId&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">                <span class=\"attr\">column</span>=<span class=\"string\">&quot;goods_id&quot;</span>/&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">resultMap</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">select</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;selectOneToMany&quot;</span> <span class=\"attr\">resultMap</span>=<span class=\"string\">&quot;rmGoods1&quot;</span>&gt;</span></span><br><span class=\"line\">    select * from t_goods limit 0,10</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">select</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>◇在核心配置文件(mybatis-config.xml)中进行注册</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">mappers</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">mapper</span> <span class=\"attr\">resource</span>=<span class=\"string\">&quot;mappers/goods.xml&quot;</span>/&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">mapper</span> <span class=\"attr\">resource</span>=<span class=\"string\">&quot;mappers/goods_detail.xml&quot;</span>/&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">mappers</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>◇测试</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"code\"><pre><span class=\"line\">@Test</span><br><span class=\"line\">    public void testOneToMany() throws Exception &#123;</span><br><span class=\"line\">        SqlSession session = null;</span><br><span class=\"line\">        try &#123;</span><br><span class=\"line\">            session = MyBatisUtils.openSession();</span><br><span class=\"line\">            List<span class=\"tag\">&lt;<span class=\"name\">Goods</span>&gt;</span> list = session.selectList(&quot;goods.selectOneToMany&quot;);</span><br><span class=\"line\">            for(Goods goods:list) &#123;</span><br><span class=\"line\">               System.out.println(goods.getTitle() + &quot;:&quot; + goods.getGoodsDetails().size());</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125; catch (Exception e) &#123;</span><br><span class=\"line\">            throw e;</span><br><span class=\"line\">        &#125; finally &#123;</span><br><span class=\"line\">            MyBatisUtils.closeSession(session);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n<p><strong>多对一</strong><br>◇在实体类GoodsDetail中增加**private **Goods <strong>goods</strong>;<br>◇在goods_detail.xml文件中进行对像关联的描述</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">resultMap</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;rmGoodsDetail&quot;</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;com.lcg.mybatis.entity.GoodsDetail&quot;</span>&gt;</span></span><br><span class=\"line\">       <span class=\"comment\">&lt;!--主键关联--&gt;</span></span><br><span class=\"line\">       <span class=\"tag\">&lt;<span class=\"name\">id</span> <span class=\"attr\">column</span>=<span class=\"string\">&quot;gd_id&quot;</span> <span class=\"attr\">property</span>=<span class=\"string\">&quot;gdId&quot;</span>/&gt;</span></span><br><span class=\"line\">       <span class=\"comment\">&lt;!--结果关联--&gt;</span></span><br><span class=\"line\">       <span class=\"tag\">&lt;<span class=\"name\">result</span> <span class=\"attr\">column</span>=<span class=\"string\">&quot;goods_id&quot;</span> <span class=\"attr\">property</span>=<span class=\"string\">&quot;goodsId&quot;</span>/&gt;</span></span><br><span class=\"line\">       <span class=\"comment\">&lt;!--association关联标签，用于多对一--&gt;</span></span><br><span class=\"line\">       <span class=\"tag\">&lt;<span class=\"name\">association</span> <span class=\"attr\">property</span>=<span class=\"string\">&quot;goods&quot;</span> <span class=\"attr\">select</span>=<span class=\"string\">&quot;goods.selectById&quot;</span> </span></span><br><span class=\"line\"><span class=\"tag\">                    <span class=\"attr\">column</span>=<span class=\"string\">&quot;goods_id&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">association</span>&gt;</span></span><br><span class=\"line\">   <span class=\"tag\">&lt;/<span class=\"name\">resultMap</span>&gt;</span></span><br><span class=\"line\">   <span class=\"tag\">&lt;<span class=\"name\">select</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;selectManyToOne&quot;</span> <span class=\"attr\">resultMap</span>=<span class=\"string\">&quot;rmGoodsDetail&quot;</span>&gt;</span></span><br><span class=\"line\">       select * from t_goods_detail limit 0,20</span><br><span class=\"line\">   <span class=\"tag\">&lt;/<span class=\"name\">select</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>◇测试  项目见F:mybatis;</p>\n<h2 id=\"分页插件PageHelper\"><a href=\"#分页插件PageHelper\" class=\"headerlink\" title=\"分页插件PageHelper\"></a>分页插件PageHelper</h2><h3 id=\"分页查询的麻烦事\"><a href=\"#分页查询的麻烦事\" class=\"headerlink\" title=\"分页查询的麻烦事\"></a>分页查询的麻烦事</h3><p>◇当前页数据查询 - select * from tab limit 0,10<br>◇总记录数查询 - select count(*) from tab<br>◇程序计算总页数、上一页页码、下一页页码<br>◇MyBatis分页插件PageHelper<a href=\"https://pagehelper.github.io/\">官方网站</a></p>\n<h3 id=\"pageHelper使用流程\"><a href=\"#pageHelper使用流程\" class=\"headerlink\" title=\"pageHelper使用流程\"></a>pageHelper使用流程</h3><p>◇maven引入PageHelper与jsqlparser </p>\n<figure class=\"highlight xml\"><table><tr><td class=\"code\"><pre><span class=\"line\">//pom.xml中</span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">     <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.github.pagehelper<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">     <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>pagehelper<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">     <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>5.1.10<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\"> <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"> <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">     <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.github.jsqlparser<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">     <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>jsqlparser<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">     <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>2.0<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\"> <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>◇mybatis-config.xml增加Plugin配置 </p>\n<figure class=\"highlight xml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">plugins</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">plugin</span> <span class=\"attr\">interceptor</span>=<span class=\"string\">&quot;com.github.pagehelper.PageInterceptor&quot;</span>&gt;</span></span><br><span class=\"line\">        <span class=\"comment\">&lt;!--设置数据类型 --&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;helperDialect&quot;</span> <span class=\"attr\">value</span>=<span class=\"string\">&quot;mysql&quot;</span>/&gt;</span></span><br><span class=\"line\">        <span class=\"comment\">&lt;!--分页合理化 --&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;reasonable&quot;</span> <span class=\"attr\">value</span>=<span class=\"string\">&quot;true&quot;</span>/&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">plugins</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>◇代码中使用PageHelper.startPage()自动分页  </p>\n<figure class=\"highlight xml\"><table><tr><td class=\"code\"><pre><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">select</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;selectPage&quot;</span> <span class=\"attr\">resultType</span>=<span class=\"string\">&quot;com.lcg.mybatis.entity.Goods&quot;</span>&gt;</span></span><br><span class=\"line\">        select * from t_goods where current_price <span class=\"symbol\">&amp;lt;</span> 1000</span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">select</span>&gt;</span></span><br><span class=\"line\">@Test</span><br><span class=\"line\">    public void testSelectPage() throws Exception &#123;</span><br><span class=\"line\">        SqlSession session = null;</span><br><span class=\"line\">        try &#123;</span><br><span class=\"line\">            session = MyBatisUtils.openSession();</span><br><span class=\"line\">            /*startPage方法会自动将下一次查询进行分页*/</span><br><span class=\"line\">            PageHelper.startPage(2,10);</span><br><span class=\"line\">            Page<span class=\"tag\">&lt;<span class=\"name\">Goods</span>&gt;</span> page = (Page) session.selectList(&quot;goods.selectPage&quot;);</span><br><span class=\"line\">            System.out.println(&quot;总的页数:&quot; + page.getPages());</span><br><span class=\"line\">            System.out.println(&quot;总记录数:&quot; + page.getTotal());</span><br><span class=\"line\">            System.out.println(&quot;开始行号:&quot; + page.getStartRow());</span><br><span class=\"line\">            System.out.println(&quot;结束行号:&quot; + page.getEndRow());</span><br><span class=\"line\">            System.out.println(&quot;当前页码:&quot; + page.getPageNum());</span><br><span class=\"line\">            List<span class=\"tag\">&lt;<span class=\"name\">Goods</span>&gt;</span> data = page.getResult();//当前页数据</span><br><span class=\"line\">            for (Goods g : data) &#123;</span><br><span class=\"line\">                System.out.println(g.getTitle());</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            System.out.println(&quot;&quot;);</span><br><span class=\"line\">        &#125; catch (Exception e) &#123;</span><br><span class=\"line\">            throw e;</span><br><span class=\"line\">        &#125; finally &#123;</span><br><span class=\"line\">            MyBatisUtils.closeSession(session);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"不同数据库的分页实现\"><a href=\"#不同数据库的分页实现\" class=\"headerlink\" title=\"不同数据库的分页实现\"></a>不同数据库的分页实现</h2><h3 id=\"MySQL分页\"><a href=\"#MySQL分页\" class=\"headerlink\" title=\"MySQL分页\"></a>MySQL分页</h3><figure class=\"highlight xml\"><table><tr><td class=\"code\"><pre><span class=\"line\">//第一个参数代表起始行号，第二个是偏移量</span><br><span class=\"line\">select * from table limit 10,20;</span><br></pre></td></tr></table></figure>\n<h3 id=\"Oracle\"><a href=\"#Oracle\" class=\"headerlink\" title=\"Oracle\"></a>Oracle</h3><figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> t3.<span class=\"operator\">*</span> <span class=\"keyword\">from</span> (</span><br><span class=\"line\"> <span class=\"keyword\">select</span> t2.<span class=\"operator\">*</span>, rownum <span class=\"keyword\">as</span> row_num <span class=\"keyword\">from</span> ( <span class=\"comment\">--rownum是伪列：无需声明直接使用的列，将前20条数据筛选</span></span><br><span class=\"line\"> <span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> <span class=\"keyword\">table</span> <span class=\"keyword\">order</span> <span class=\"keyword\">by</span> id <span class=\"keyword\">asc</span> <span class=\"comment\">--用于查询</span></span><br><span class=\"line\"> ) t2 <span class=\"keyword\">where</span> rownum<span class=\"operator\">&lt;=</span><span class=\"number\">20</span></span><br><span class=\"line\">) t3 </span><br><span class=\"line\"><span class=\"keyword\">where</span> t2.row_num<span class=\"operator\">&gt;</span><span class=\"number\">11</span> <span class=\"comment\">--第三层嵌套用于起始位置的筛选</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"SQL-Server-2000\"><a href=\"#SQL-Server-2000\" class=\"headerlink\" title=\"SQL Server 2000\"></a>SQL Server 2000</h3><figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> top <span class=\"number\">3</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> <span class=\"keyword\">table</span> <span class=\"comment\">--top语句在sql语句执行完后获取前几条数据</span></span><br><span class=\"line\"><span class=\"keyword\">where</span> </span><br><span class=\"line\"> id <span class=\"keyword\">not</span> <span class=\"keyword\">in</span> </span><br><span class=\"line\"> (<span class=\"keyword\">select</span> top <span class=\"number\">15</span> id <span class=\"keyword\">from</span> <span class=\"keyword\">table</span>)</span><br></pre></td></tr></table></figure>\n<h3 id=\"SQL-Server-2012\"><a href=\"#SQL-Server-2012\" class=\"headerlink\" title=\"SQL Server 2012+\"></a>SQL Server 2012+</h3><figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> <span class=\"keyword\">table</span> <span class=\"keyword\">order</span> <span class=\"keyword\">by</span> id </span><br><span class=\"line\"> <span class=\"keyword\">offset</span> <span class=\"number\">4</span> <span class=\"keyword\">rows</span> <span class=\"keyword\">fetch</span> next <span class=\"number\">5</span> <span class=\"keyword\">rows</span> <span class=\"keyword\">only</span> <span class=\"comment\">--offset偏移量 fetch next向后取多少行</span></span><br><span class=\"line\"> <span class=\"comment\">--若id为1的话即从第5(1+4)行开始向后取5条数据</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"MyBatis配置C3P0连接池\"><a href=\"#MyBatis配置C3P0连接池\" class=\"headerlink\" title=\"MyBatis配置C3P0连接池\"></a>MyBatis配置C3P0连接池</h2><p>◇pom.xml进行配置</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"operator\">&lt;</span>dependency<span class=\"operator\">&gt;</span></span><br><span class=\"line\">    <span class=\"operator\">&lt;</span>groupId<span class=\"operator\">&gt;</span>com.mchange<span class=\"operator\">&lt;</span><span class=\"operator\">/</span>groupId<span class=\"operator\">&gt;</span></span><br><span class=\"line\">    <span class=\"operator\">&lt;</span>artifactId<span class=\"operator\">&gt;</span>c3p0<span class=\"operator\">&lt;</span><span class=\"operator\">/</span>artifactId<span class=\"operator\">&gt;</span></span><br><span class=\"line\">    <span class=\"operator\">&lt;</span>version<span class=\"operator\">&gt;</span><span class=\"number\">0.9</span><span class=\"number\">.5</span><span class=\"number\">.4</span><span class=\"operator\">&lt;</span><span class=\"operator\">/</span>version<span class=\"operator\">&gt;</span></span><br><span class=\"line\"><span class=\"operator\">&lt;</span><span class=\"operator\">/</span>dependency<span class=\"operator\">&gt;</span></span><br></pre></td></tr></table></figure>\n<p>◇在mybatis创建datasoutce包，再新建C3P0DataSourceFactory类，继承自UnpooledDataSourceFactory以便于连接</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * C3P0与MyBatis兼容使用的数据源工厂类</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\">public class C3P0DataSourceFactory extends UnpooledDataSourceFactory &#123;</span><br><span class=\"line\">    public C3P0DataSourceFactory()&#123;</span><br><span class=\"line\">        this.dataSource <span class=\"operator\">=</span> <span class=\"keyword\">new</span> ComboPooledDataSource();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>◇在mybatis-config.xml配置文件中将<dataSource>的type改为com.lcg.mybatis.datasource.C3P0DataSourceFactory;因为不同的连接池对属性的命名规则不同，所以有以下更改：driver-&gt;driverClass , url-&gt;jdbcUrl , username-&gt;user</dataSource></p>\n<figure class=\"highlight xml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dataSource</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;com.lcg.mybatis.datasource.C3P0DataSourceFactory&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;driverClass&quot;</span> <span class=\"attr\">value</span>=<span class=\"string\">&quot;com.mysql.jdbc.Driver&quot;</span>/&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;jdbcUrl&quot;</span> <span class=\"attr\">value</span>=<span class=\"string\">&quot;&quot;</span>/&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;user&quot;</span> <span class=\"attr\">value</span>=<span class=\"string\">&quot;root&quot;</span>/&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;password&quot;</span> <span class=\"attr\">value</span>=<span class=\"string\">&quot;www.LCG.com&quot;</span>/&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;initialPoolSize&quot;</span> <span class=\"attr\">value</span>=<span class=\"string\">&quot;5&quot;</span>/&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;maxPoolSize&quot;</span> <span class=\"attr\">value</span>=<span class=\"string\">&quot;20&quot;</span>/&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;minPoolSize&quot;</span> <span class=\"attr\">value</span>=<span class=\"string\">&quot;5&quot;</span>/&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dataSource</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"MyBatis批处理\"><a href=\"#MyBatis批处理\" class=\"headerlink\" title=\"MyBatis批处理\"></a>MyBatis批处理</h2><p>◇goods.xml增加批处理的SQL语句</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"code\"><pre><span class=\"line\"> <span class=\"comment\">&lt;!--INSERT INTO table--&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!--VALUES (&quot;a&quot; , &quot;a1&quot; , &quot;a2&quot;),(&quot;b&quot; , &quot;b1&quot; , &quot;b2&quot;),(....)--&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">insert</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;batchInsert&quot;</span> <span class=\"attr\">parameterType</span>=<span class=\"string\">&quot;java.util.List&quot;</span>&gt;</span></span><br><span class=\"line\">        INSERT INTO t_goods(title, sub_title, original_cost, </span><br><span class=\"line\">      current_price, discount, is_free_delivery, category_id)</span><br><span class=\"line\">        VALUES</span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">foreach</span> <span class=\"attr\">collection</span>=<span class=\"string\">&quot;list&quot;</span> <span class=\"attr\">item</span>=<span class=\"string\">&quot;item&quot;</span> <span class=\"attr\">index</span>=<span class=\"string\">&quot;index&quot;</span> <span class=\"attr\">separator</span>=<span class=\"string\">&quot;,&quot;</span>&gt;</span></span><br><span class=\"line\">          (#&#123;item.title&#125;,#&#123;item.subTitle&#125;, #&#123;item.originalCost&#125;,</span><br><span class=\"line\">        #&#123;item.currentPrice&#125;, #&#123;item.discount&#125;, #&#123;item.isFreeDelivery&#125;, #&#123;item.categoryId&#125;)</span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">foreach</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">insert</span>&gt;</span></span><br><span class=\"line\">    @Test</span><br><span class=\"line\">    public void testBatchInsert() throws Exception &#123;</span><br><span class=\"line\">        SqlSession session = null;</span><br><span class=\"line\">        try &#123;</span><br><span class=\"line\">            long st = new Date().getTime();</span><br><span class=\"line\">            session = MyBatisUtils.openSession();</span><br><span class=\"line\">            List list = new ArrayList();</span><br><span class=\"line\">            for (int i = 0; i &lt; 10000; i++) &#123;</span><br><span class=\"line\">                Goods goods = new Goods();</span><br><span class=\"line\">                goods.setTitle(&quot;测试商品&quot;);</span><br><span class=\"line\">                goods.setSubTitle(&quot;测试子标题&quot;);</span><br><span class=\"line\">                goods.setOriginalCost(200f);</span><br><span class=\"line\">                goods.setCurrentPrice(100f);</span><br><span class=\"line\">                goods.setDiscount(0.5f);</span><br><span class=\"line\">                goods.setIsFreeDelivery(1);</span><br><span class=\"line\">                goods.setCategoryId(43);</span><br><span class=\"line\">                //insert()方法返回值代表本次成功插入的记录总数</span><br><span class=\"line\">                list.add(goods);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            session.insert(&quot;goods.batchInsert&quot;, list);</span><br><span class=\"line\">            session.commit();//提交事务数据</span><br><span class=\"line\">            long et = new Date().getTime();</span><br><span class=\"line\">            System.out.println(&quot;执行时间:&quot; + (et - st) + &quot;毫秒&quot;);</span><br><span class=\"line\">//            System.out.println(goods.getGoodsId());</span><br><span class=\"line\">        &#125; catch (Exception e) &#123;</span><br><span class=\"line\">            if (session != null) &#123;</span><br><span class=\"line\">                session.rollback();//回滚事务</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            throw e;</span><br><span class=\"line\">        &#125; finally &#123;</span><br><span class=\"line\">            MyBatisUtils.closeSession(session);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n<p>◇批量插入数据的局限：①无法获得插入数据的id；②批量生成的SQL太长，可能会被服务器拒绝<br>◇批量删除</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!--delete from t_goods where goods_id in (1920,1921,...)--&gt;</span></span><br><span class=\"line\">   <span class=\"tag\">&lt;<span class=\"name\">delete</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;batchDelete&quot;</span> <span class=\"attr\">parameterType</span>=<span class=\"string\">&quot;java.util.List&quot;</span>&gt;</span></span><br><span class=\"line\">        DELETE FROM t_goods WHERE goods_id in</span><br><span class=\"line\">     <span class=\"tag\">&lt;<span class=\"name\">foreach</span> <span class=\"attr\">collection</span>=<span class=\"string\">&quot;list&quot;</span> <span class=\"attr\">item</span>=<span class=\"string\">&quot;item&quot;</span> <span class=\"attr\">index</span>=<span class=\"string\">&quot;index&quot;</span> <span class=\"attr\">open</span>=<span class=\"string\">&quot;(&quot;</span> <span class=\"attr\">close</span>=<span class=\"string\">&quot;)&quot;</span> <span class=\"attr\">separator</span>=<span class=\"string\">&quot;,&quot;</span>&gt;</span></span><br><span class=\"line\">           #&#123;item&#125;</span><br><span class=\"line\">     <span class=\"tag\">&lt;/<span class=\"name\">foreach</span>&gt;</span></span><br><span class=\"line\">   <span class=\"tag\">&lt;/<span class=\"name\">delete</span>&gt;</span></span><br><span class=\"line\">    @Test</span><br><span class=\"line\">    public void testBatchDelete() throws Exception &#123;</span><br><span class=\"line\">        SqlSession session = null;</span><br><span class=\"line\">        try &#123;</span><br><span class=\"line\">            long st = new Date().getTime();</span><br><span class=\"line\">            session = MyBatisUtils.openSession();</span><br><span class=\"line\">            List list = new ArrayList();</span><br><span class=\"line\">            list.add(1920);</span><br><span class=\"line\">            list.add(1921);</span><br><span class=\"line\">            list.add(1922);</span><br><span class=\"line\">            session.delete(&quot;goods.batchDelete&quot;, list);</span><br><span class=\"line\">            session.commit();//提交事务数据</span><br><span class=\"line\">            long et = new Date().getTime();</span><br><span class=\"line\">            System.out.println(&quot;执行时间:&quot; + (et - st) + &quot;毫秒&quot;);</span><br><span class=\"line\">//          System.out.println(goods.getGoodsId());</span><br><span class=\"line\">        &#125; catch (Exception e) &#123;</span><br><span class=\"line\">            if (session != null) &#123;</span><br><span class=\"line\">                session.rollback();//回滚事务</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            throw e;</span><br><span class=\"line\">        &#125; finally &#123;</span><br><span class=\"line\">            MyBatisUtils.closeSession(session);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"MyBatis注解开发\"><a href=\"#MyBatis注解开发\" class=\"headerlink\" title=\"MyBatis注解开发\"></a>MyBatis注解开发</h2><h3 id=\"Mybatis常用注解\"><a href=\"#Mybatis常用注解\" class=\"headerlink\" title=\"Mybatis常用注解\"></a>Mybatis常用注解</h3><p>◇把原有放在xml的标签语句放在程序中<br><img src=\"/p/fb2c/1628925337535-f97712fe-fea0-4be2-87bd-c66e102d765b.png\" class=\"lazyload\" data-srcset=\"/p/fb2c/1628925337535-f97712fe-fea0-4be2-87bd-c66e102d765b.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"><br>◇创建dao包，然后创建GoodsDAO接口</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">interface</span> <span class=\"title\">GoodsDAO</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"meta\">@Select(&quot;select * from t_goods where current_price between  </span></span><br><span class=\"line\"><span class=\"meta\">        #&#123;min&#125; and #&#123;max&#125; order by current_price limit 0,#&#123;limt&#125;&quot;)</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> List&lt;Goods&gt; <span class=\"title\">selectByPriceRange</span><span class=\"params\">(<span class=\"meta\">@Param(&quot;min&quot;)</span> Float min ,</span></span></span><br><span class=\"line\"><span class=\"params\"><span class=\"function\">      <span class=\"meta\">@Param(&quot;max&quot;)</span> Float max ,<span class=\"meta\">@Param(&quot;limt&quot;)</span> Integer limt)</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Insert(&quot;INSERT INTO t_goods(title, sub_title, original_cost,</span></span><br><span class=\"line\"><span class=\"meta\">      current_price, discount, is_free_delivery, category_id)</span></span><br><span class=\"line\"><span class=\"meta\">      VALUES (#&#123;title&#125; , #&#123;subTitle&#125; , #&#123;originalCost&#125;, #&#123;currentPrice&#125;, </span></span><br><span class=\"line\"><span class=\"meta\">      #&#123;discount&#125;, #&#123;isFreeDelivery&#125;, #&#123;categoryId&#125;)&quot;)</span></span><br><span class=\"line\">    <span class=\"comment\">//&lt;selectKey&gt;</span></span><br><span class=\"line\">    <span class=\"meta\">@SelectKey(statement = &quot;select last_insert_id()&quot; , </span></span><br><span class=\"line\"><span class=\"meta\">      before = false , keyProperty = &quot;goodsId&quot; , resultType = Integer.class)</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">int</span> <span class=\"title\">insert</span><span class=\"params\">(Goods goods)</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Select(&quot;select * from t_goods&quot;)</span></span><br><span class=\"line\">    <span class=\"comment\">//&lt;resultMap&gt;</span></span><br><span class=\"line\">    <span class=\"meta\">@Results(&#123;</span></span><br><span class=\"line\"><span class=\"meta\">            //&lt;id&gt;</span></span><br><span class=\"line\"><span class=\"meta\">          @Result(column = &quot;goods_id&quot; ,property = &quot;goodsId&quot; , id = true) ,</span></span><br><span class=\"line\"><span class=\"meta\">            //&lt;result&gt;</span></span><br><span class=\"line\"><span class=\"meta\">            @Result(column = &quot;title&quot; ,property = &quot;title&quot;),</span></span><br><span class=\"line\"><span class=\"meta\">            @Result(column = &quot;current_price&quot; ,property = &quot;currentPrice&quot;)</span></span><br><span class=\"line\"><span class=\"meta\">    &#125;)</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> List&lt;GoodsDTO&gt; <span class=\"title\">selectAll</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>◇在核心配置文件mybatis-config.xml中进行相应说明</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">mappers</span>&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!--&lt;mapper class=&quot;com.lcg.mybatis.dao.GoodsDAO&quot;/&gt; 指向接口，下为简便方法--&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">package</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;com.lcg.mybatis.dao&quot;</span>/&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">mappers</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>◇测试类</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Test</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">testSelectByPriceRange</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</span><br><span class=\"line\">        SqlSession session = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">        <span class=\"keyword\">try</span>&#123;</span><br><span class=\"line\">            session = MyBatisUtils.openSession();</span><br><span class=\"line\">            <span class=\"comment\">//传入类对象</span></span><br><span class=\"line\">            GoodsDAO goodsDAO = session.getMapper(GoodsDAO.class);</span><br><span class=\"line\">            List&lt;Goods&gt; list = goodsDAO.selectByPriceRange(<span class=\"number\">100f</span>, <span class=\"number\">500f</span>, <span class=\"number\">20</span>);</span><br><span class=\"line\">            System.out.println(list.size());</span><br><span class=\"line\">        &#125;<span class=\"keyword\">catch</span> (Exception e)&#123;</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> e;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">finally</span> &#123;</span><br><span class=\"line\">            MyBatisUtils.closeSession(session);</span><br><span class=\"line\"></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 新增数据</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@throws</span> Exception</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@Test</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">testInsert</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</span><br><span class=\"line\">        SqlSession session = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">        <span class=\"keyword\">try</span>&#123;</span><br><span class=\"line\">            session = MyBatisUtils.openSession();</span><br><span class=\"line\">            Goods goods = <span class=\"keyword\">new</span> Goods();</span><br><span class=\"line\">            goods.setTitle(<span class=\"string\">&quot;测试商品&quot;</span>);</span><br><span class=\"line\">            goods.setSubTitle(<span class=\"string\">&quot;测试子标题&quot;</span>);</span><br><span class=\"line\">            goods.setOriginalCost(<span class=\"number\">200f</span>);</span><br><span class=\"line\">            goods.setCurrentPrice(<span class=\"number\">100f</span>);</span><br><span class=\"line\">            goods.setDiscount(<span class=\"number\">0.5f</span>);</span><br><span class=\"line\">            goods.setIsFreeDelivery(<span class=\"number\">1</span>);</span><br><span class=\"line\">            goods.setCategoryId(<span class=\"number\">43</span>);</span><br><span class=\"line\">            GoodsDAO goodsDAO = session.getMapper(GoodsDAO.class);</span><br><span class=\"line\">            <span class=\"comment\">//insert()方法返回值代表本次成功插入的记录总数</span></span><br><span class=\"line\">            <span class=\"keyword\">int</span> num = goodsDAO.insert(goods);</span><br><span class=\"line\">            session.commit();<span class=\"comment\">//提交事务数据</span></span><br><span class=\"line\">            System.out.println(goods.getGoodsId());</span><br><span class=\"line\">        &#125;<span class=\"keyword\">catch</span> (Exception e)&#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span>(session != <span class=\"keyword\">null</span>)&#123;</span><br><span class=\"line\">                session.rollback();<span class=\"comment\">//回滚事务</span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> e;</span><br><span class=\"line\">        &#125;<span class=\"keyword\">finally</span> &#123;</span><br><span class=\"line\">            MyBatisUtils.closeSession(session);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"meta\">@Test</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">testSelectAll</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</span><br><span class=\"line\">        SqlSession session = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">        <span class=\"keyword\">try</span>&#123;</span><br><span class=\"line\">            session = MyBatisUtils.openSession();</span><br><span class=\"line\">            GoodsDAO goodsDAO = session.getMapper(GoodsDAO.class);</span><br><span class=\"line\">            List&lt;GoodsDTO&gt; list = goodsDAO.selectAll();</span><br><span class=\"line\">            System.out.println(list.size());</span><br><span class=\"line\">        &#125;<span class=\"keyword\">catch</span> (Exception e)&#123;</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> e;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">finally</span> &#123;</span><br><span class=\"line\">            MyBatisUtils.closeSession(session);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n","categories":["Java数据库","MyBaits"],"tags":["MyBaits"]},{"title":"MySQL基本函数","url":"/p/8500.html","content":"<h2 id=\"MySQL的函数\"><a href=\"#MySQL的函数\" class=\"headerlink\" title=\"MySQL的函数\"></a>MySQL的函数</h2><p> ◇像编程语言利用函数封装业务功能一样，数据库也把一些复杂的功能封装到函数里，供使用者调用<br> ◇也可以自定义函数<br><img src=\"/p/8500/1626744661345-6111ef9d-04c3-4761-b727-9ae5c97863f8.png\" class=\"lazyload\" data-srcset=\"/p/8500/1626744661345-6111ef9d-04c3-4761-b727-9ae5c97863f8.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"></p>\n<h2 id=\"数字函数\"><a href=\"#数字函数\" class=\"headerlink\" title=\"数字函数\"></a>数字函数</h2><h3 id=\"数字函数（一）\"><a href=\"#数字函数（一）\" class=\"headerlink\" title=\"数字函数（一）\"></a>数字函数（一）</h3><p><img src=\"/p/8500/1626744703126-a396cd11-c086-4a87-b1b4-6312391ae480.png\" class=\"lazyload\" data-srcset=\"/p/8500/1626744703126-a396cd11-c086-4a87-b1b4-6312391ae480.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"></p>\n<h3 id=\"数字函数（二）\"><a href=\"#数字函数（二）\" class=\"headerlink\" title=\"数字函数（二）\"></a>数字函数（二）</h3><p>◇三角函数的参数为弧度<br><img src=\"/p/8500/1626744716967-68f7ed15-b497-4b9e-9f62-1c2445dbe9ec.png\" class=\"lazyload\" data-srcset=\"/p/8500/1626744716967-68f7ed15-b497-4b9e-9f62-1c2445dbe9ec.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"></p>\n<h2 id=\"日期函数\"><a href=\"#日期函数\" class=\"headerlink\" title=\"日期函数\"></a>日期函数</h2><h3 id=\"获取系统时间函数\"><a href=\"#获取系统时间函数\" class=\"headerlink\" title=\"获取系统时间函数\"></a>获取系统时间函数</h3><p>◇NOW()函数能获得系统日期和时间，格式yyyy-MM-dd hh:mm:ss<br>◇CURDATE()函数能获得当前系统日期，格式yyyy-MM-dd<br>◇CURTIME()函数能获得当前系统时间，格式hh:mm:ss  </p>\n<h3 id=\"日期格式化函数\"><a href=\"#日期格式化函数\" class=\"headerlink\" title=\"日期格式化函数\"></a>日期格式化函数</h3><p><img src=\"/p/8500/1626752210323-8c7cf93e-cd79-462d-8331-0f275fd02f86.png\" class=\"lazyload\" data-srcset=\"/p/8500/1626752210323-8c7cf93e-cd79-462d-8331-0f275fd02f86.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"><br>◇ DATE_FORMAT()函数用于格式化日期，返回用户想要的日期格式  </p>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\">DATE_FORMAT( 日期, 表达式)</span><br><span class=\"line\"><span class=\"keyword\">SELECT</span> ename,DATE_FORMAT(hiredate,&quot;%Y&quot;)<span class=\"operator\">/</span><span class=\"operator\">/</span>获取年份的格式</span><br><span class=\"line\">DATE_FORMAT(hiredate,&quot;%Y/%m%d&quot;) <span class=\"operator\">/</span><span class=\"operator\">/</span>返回<span class=\"number\">2021</span><span class=\"operator\">/</span><span class=\"number\">07</span><span class=\"operator\">/</span><span class=\"number\">20</span>这种格式</span><br><span class=\"line\"><span class=\"keyword\">FROM</span> t_emp;</span><br></pre></td></tr></table></figure>\n<h3 id=\"日期计算的注意事项\"><a href=\"#日期计算的注意事项\" class=\"headerlink\" title=\"日期计算的注意事项\"></a>日期计算的注意事项</h3><p>◇ MySQL数据库里面，两个日期不能直接加减，日期也不能与数字加减  </p>\n<h3 id=\"日期偏移计算\"><a href=\"#日期偏移计算\" class=\"headerlink\" title=\"日期偏移计算\"></a>日期偏移计算</h3><p> ◇ DATE_ADD()函数可以实现日期的偏移计算，而且时间单位很灵活  </p>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\">DATE_ADD( 日期 , <span class=\"type\">INTERVAL</span> 偏移量 时间单位 )</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">SELECT</span> DATE_ADD(NOW(),<span class=\"type\">INTERVAL</span> <span class=\"number\">15</span> <span class=\"keyword\">DAY</span>);</span><br><span class=\"line\"><span class=\"keyword\">SELECT</span> DATE_ADD(NOW(),<span class=\"type\">INTERVAL</span> <span class=\"number\">-300</span> <span class=\"keyword\">MINUTE</span>);</span><br></pre></td></tr></table></figure>\n<h3 id=\"计算日期之间相隔的天数\"><a href=\"#计算日期之间相隔的天数\" class=\"headerlink\" title=\"计算日期之间相隔的天数\"></a>计算日期之间相隔的天数</h3><p>◇ DATEDIFF()函数用来计算两个日期之间相差的天数  </p>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\">DATEDIFF ( 日期 , 日期 )</span><br></pre></td></tr></table></figure>\n<h3 id=\"课堂练习\"><a href=\"#课堂练习\" class=\"headerlink\" title=\"课堂练习\"></a>课堂练习</h3><p>◇ 利用日期函数，查询明年你的生日是星期几？  </p>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">SELECT</span> DATE_FORMAT(&quot;2020-02-19&quot;,&quot;%w&quot;)</span><br></pre></td></tr></table></figure>\n<p>◇ 利用日期函数，查询1981年上半年入职的员工有多少人？  </p>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">SELECT</span> <span class=\"built_in\">COUNT</span>(<span class=\"operator\">*</span>) <span class=\"keyword\">FROM</span> t_emp</span><br><span class=\"line\"><span class=\"keyword\">WHERE</span> DATE_FORMAT(hiredate,&quot;%Y&quot;)<span class=\"operator\">=</span><span class=\"number\">1981</span></span><br><span class=\"line\"><span class=\"keyword\">AND</span> DATE_FORMAT(hiredate,&quot;%m&quot;)<span class=\"operator\">&lt;=</span><span class=\"number\">6</span>;</span><br></pre></td></tr></table></figure>\n<h2 id=\"字符函数\"><a href=\"#字符函数\" class=\"headerlink\" title=\"字符函数\"></a>字符函数</h2><h3 id=\"字符函数（一）\"><a href=\"#字符函数（一）\" class=\"headerlink\" title=\"字符函数（一）\"></a>字符函数（一）</h3><p>◇INSERT(“ABC”,1,0,”DE”)数字1表示从前面的字符串ABC的第一个位置插入后面的字符串DE，0表示替换从插入位置起的0个字符；<br>◇REPLACE() 的第二个参数表示被替换的内容，最后一个参数表示替换的内容<br><img src=\"/p/8500/1626744868617-349e75c7-1c16-4cd4-bf54-b7ed9fab0132.png\" class=\"lazyload\" data-srcset=\"/p/8500/1626744868617-349e75c7-1c16-4cd4-bf54-b7ed9fab0132.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"></p>\n<h3 id=\"字符函数（二）\"><a href=\"#字符函数（二）\" class=\"headerlink\" title=\"字符函数（二）\"></a>字符函数（二）</h3><p>◇截取字符串起始位置从1开始<br>◇填充字符函数第二个参数表示填充到多少字符，而不是填充多少字符；<br><img src=\"/p/8500/1626744883419-428def08-c61f-4a7c-b422-7e6c5ecd35fa.png\" class=\"lazyload\" data-srcset=\"/p/8500/1626744883419-428def08-c61f-4a7c-b422-7e6c5ecd35fa.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"></p>\n<h3 id=\"课堂练习-1\"><a href=\"#课堂练习-1\" class=\"headerlink\" title=\"课堂练习\"></a>课堂练习</h3><p>◇将某人的姓名的名用<em>替代  eg: 欧</em>*</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">SELECT</span> RPAD(<span class=\"built_in\">SUBSTRING</span>(&quot;欧宝玉&quot;,<span class=\"number\">1</span>,<span class=\"number\">1</span>),LENGTH(&quot;欧宝玉&quot;)<span class=\"operator\">/</span><span class=\"number\">3</span>,&quot;*&quot;);</span><br></pre></td></tr></table></figure>\n<h2 id=\"条件函数\"><a href=\"#条件函数\" class=\"headerlink\" title=\"条件函数\"></a>条件函数</h2><p>◇ SQL语句中可以利用条件函数来实现编程语言里的条件判断  </p>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\">IFNULL( 表达式 , 值 )</span><br><span class=\"line\">IF( 表达式 , 值<span class=\"number\">1</span> , 值<span class=\"number\">2</span> )<span class=\"operator\">/</span><span class=\"operator\">/</span>如果满足表达式则是值<span class=\"number\">1</span>，否则是值<span class=\"number\">2</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"条件语句\"><a href=\"#条件语句\" class=\"headerlink\" title=\"条件语句\"></a>条件语句</h3><p> ◇ 复杂的条件判断可以用条件语句来实现，比IF语句功能更强大  </p>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">CASE</span></span><br><span class=\"line\"><span class=\"keyword\">WHEN</span> 表达式 <span class=\"keyword\">THEN</span> 值<span class=\"number\">1</span> ,</span><br><span class=\"line\"><span class=\"keyword\">WHEN</span> 表达式 <span class=\"keyword\">THEN</span> 值<span class=\"number\">2</span> , …… , <span class=\"keyword\">ELSE</span> 值N</span><br><span class=\"line\"><span class=\"keyword\">END</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"课堂练习-2\"><a href=\"#课堂练习-2\" class=\"headerlink\" title=\"课堂练习\"></a>课堂练习</h3><p>◇ 中秋节公司发放礼品，SALES部门发放礼品A，其余部门发放礼品B， 打印每名员工获得的礼品。  </p>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">SELECT</span> <span class=\"keyword\">FROM</span> t_emp e <span class=\"keyword\">JOIN</span> t_dept d <span class=\"keyword\">ON</span> e.deptno<span class=\"operator\">=</span>d.deptno,</span><br><span class=\"line\">IF(d.dname<span class=\"operator\">=</span>&quot;SALES&quot;,&quot;礼品A&quot;,&quot;礼品B&quot;)</span><br><span class=\"line\"><span class=\"keyword\">FROM</span> t_emp e <span class=\"keyword\">JOIN</span> t_dept d <span class=\"keyword\">ON</span> e.deptno<span class=\"operator\">=</span>d.deptno;</span><br></pre></td></tr></table></figure>\n<p>◇ 公司年庆决定组织员工集体旅游，每个部门旅游目的地是不同的。SALES部门去P1地点，ACCOUNTING部门去P2地点 ，RESEARCH部门去P3地点，查询每名员工的旅行地点。  </p>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">SELECT</span> </span><br><span class=\"line\"> e.empno,e.ename,</span><br><span class=\"line\"> <span class=\"keyword\">CASE</span> </span><br><span class=\"line\"> <span class=\"keyword\">WHEN</span> d.dname<span class=\"operator\">=</span>&quot;SALES&quot; <span class=\"keyword\">THEN</span> &quot;P1&quot;</span><br><span class=\"line\"> <span class=\"keyword\">WHEN</span> d.dname<span class=\"operator\">=</span>&quot;ACCOUNTING&quot; <span class=\"keyword\">THEN</span> &quot;P2&quot;</span><br><span class=\"line\"> <span class=\"keyword\">WHEN</span> d.dname<span class=\"operator\">=</span>&quot;RESEARCH&quot; <span class=\"keyword\">THEN</span> &quot;P3&quot;</span><br><span class=\"line\"> <span class=\"keyword\">END</span> </span><br><span class=\"line\"> <span class=\"keyword\">AS</span> place</span><br><span class=\"line\"><span class=\"keyword\">FROM</span> t_emp e <span class=\"keyword\">JOIN</span> t_dept d <span class=\"keyword\">ON</span> e.deptno<span class=\"operator\">=</span>d.deptno</span><br></pre></td></tr></table></figure>\n<p>◇ 公司决定为员工调整基本工资，具体调整方案如下：<br><img src=\"/p/8500/1626790167145-a52425b0-80f5-499c-9547-8e4307a1d314.png\" class=\"lazyload\" data-srcset=\"/p/8500/1626790167145-a52425b0-80f5-499c-9547-8e4307a1d314.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"></p>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\">UPDATE t_emp e <span class=\"keyword\">LEFT</span> <span class=\"keyword\">JOIN</span> t_dept d <span class=\"keyword\">ON</span> e.deptno<span class=\"operator\">=</span>d.deptno</span><br><span class=\"line\"><span class=\"keyword\">LEFT</span> <span class=\"keyword\">JOIN</span> (<span class=\"keyword\">SELECT</span> deptno,<span class=\"built_in\">AVG</span>(sal) <span class=\"keyword\">AS</span> avg <span class=\"keyword\">FROM</span> t_emp <span class=\"keyword\">GROUP</span> <span class=\"keyword\">BY</span> deptno) t</span><br><span class=\"line\"><span class=\"keyword\">ON</span> e.deptno<span class=\"operator\">=</span>t.deptno</span><br><span class=\"line\"><span class=\"keyword\">SET</span> sal<span class=\"operator\">=</span>(</span><br><span class=\"line\"><span class=\"keyword\">CASE</span> </span><br><span class=\"line\">  <span class=\"keyword\">WHEN</span> d.dname<span class=\"operator\">=</span>&quot;SALES&quot; <span class=\"keyword\">AND</span> DATEDIFF(NOW(),e.hiredate)<span class=\"operator\">/</span><span class=\"number\">365</span><span class=\"operator\">&gt;=</span><span class=\"number\">20</span></span><br><span class=\"line\">  <span class=\"keyword\">THEN</span> e.sal<span class=\"operator\">*</span><span class=\"number\">1.1</span></span><br><span class=\"line\">  <span class=\"keyword\">WHEN</span> d.dname<span class=\"operator\">=</span>&quot;SALES&quot; <span class=\"keyword\">AND</span> DATEDIFF(NOW(),e.hiredate)<span class=\"operator\">/</span><span class=\"number\">365</span><span class=\"operator\">&lt;</span><span class=\"number\">20</span></span><br><span class=\"line\">  <span class=\"keyword\">THEN</span> e.sal<span class=\"operator\">*</span><span class=\"number\">1.05</span></span><br><span class=\"line\">  <span class=\"keyword\">WHEN</span> d.dname<span class=\"operator\">=</span>&quot;ACCOUNTING&quot;  <span class=\"keyword\">THEN</span> e.sal<span class=\"operator\">+</span><span class=\"number\">300</span></span><br><span class=\"line\">  <span class=\"keyword\">WHEN</span> d.dname<span class=\"operator\">=</span>&quot;RESEARCH&quot; <span class=\"keyword\">AND</span> e.sal<span class=\"operator\">&lt;</span>t.avg <span class=\"keyword\">THEN</span> e.sal<span class=\"operator\">+</span><span class=\"number\">200</span></span><br><span class=\"line\">  <span class=\"keyword\">WHEN</span> e.deptno <span class=\"keyword\">IS</span> <span class=\"keyword\">NULL</span> <span class=\"keyword\">THEN</span> e.sal<span class=\"operator\">+</span><span class=\"number\">100</span></span><br><span class=\"line\">  <span class=\"keyword\">END</span></span><br><span class=\"line\">);</span><br></pre></td></tr></table></figure>\n\n","categories":["Java数据库","MySQL基础"],"tags":["MySQL"]},{"title":"MySQL基本操作","url":"/p/a881.html","content":"<h2 id=\"数据操作语言：INSERT语句\"><a href=\"#数据操作语言：INSERT语句\" class=\"headerlink\" title=\"数据操作语言：INSERT语句\"></a>数据操作语言：INSERT语句</h2><h3 id=\"INSERT语句\"><a href=\"#INSERT语句\" class=\"headerlink\" title=\"INSERT语句\"></a>INSERT语句</h3><p> ◇ INSERT语句可以向数据表写入记录，可以是一条记录，也可以是多条记录  </p>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">INSERT</span> <span class=\"keyword\">INTO</span> 表名 ( 字段<span class=\"number\">1</span>, 字段<span class=\"number\">2</span>, …… ) </span><br><span class=\"line\"><span class=\"keyword\">VALUES</span> ( 值<span class=\"number\">1</span>, 值<span class=\"number\">2</span>, …… ) ;</span><br><span class=\"line\"><span class=\"keyword\">INSERT</span> <span class=\"keyword\">INTO</span> 表名 ( 字段<span class=\"number\">1</span>, 字段<span class=\"number\">2</span>, …… ) </span><br><span class=\"line\"><span class=\"keyword\">VALUES</span> ( 值<span class=\"number\">1</span>, 值<span class=\"number\">2</span>, …… ) , ( 值<span class=\"number\">1</span>, 值<span class=\"number\">2</span>, …… ) ;<span class=\"operator\">/</span><span class=\"operator\">/</span>插入多条记录</span><br></pre></td></tr></table></figure>\n<h3 id=\"INSERT语句方言\"><a href=\"#INSERT语句方言\" class=\"headerlink\" title=\"INSERT语句方言\"></a>INSERT语句方言</h3><p> ◇ MYSQL的INSERT语句还有一种方言语法  </p>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">INSERT</span> <span class=\"keyword\">INTO</span> 表名 <span class=\"keyword\">SET</span> 字段<span class=\"number\">1</span><span class=\"operator\">=</span>值<span class=\"number\">1</span>, 字段<span class=\"number\">2</span><span class=\"operator\">=</span>值<span class=\"number\">2</span>, …… ;</span><br></pre></td></tr></table></figure>\n<h3 id=\"IGNORE关键字\"><a href=\"#IGNORE关键字\" class=\"headerlink\" title=\"IGNORE关键字\"></a>IGNORE关键字</h3><p> ◇ IGNORE关键字会让INSERT只插入数据库不存在的记录  </p>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">INSERT</span> [ IGNORE ] <span class=\"keyword\">INTO</span> 表名 …… ;</span><br></pre></td></tr></table></figure>\n<h3 id=\"INSERT中的子查询\"><a href=\"#INSERT中的子查询\" class=\"headerlink\" title=\"INSERT中的子查询\"></a>INSERT中的子查询</h3><p>◇ INSERT语句中可以包含子查询语句，代表把子查询的内容写入到数据表<br>◇ 把人数超过5人的部门记录拷贝到新的部门表  </p>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">CREATE</span> <span class=\"keyword\">TABLE</span> t_dept_new <span class=\"keyword\">LIKE</span> t_dept;</span><br><span class=\"line\"><span class=\"keyword\">INSERT</span> <span class=\"keyword\">INTO</span> t_dept_new(deptno,dname,loc)</span><br><span class=\"line\">(<span class=\"keyword\">SELECT</span> d.deptno,d.dname,d.loc <span class=\"keyword\">FROM</span> t_dept d <span class=\"keyword\">JOIN</span></span><br><span class=\"line\">(<span class=\"keyword\">SELECT</span> deptno <span class=\"keyword\">FROM</span> t_emp <span class=\"keyword\">GROUP</span> <span class=\"keyword\">BY</span> deptno</span><br><span class=\"line\"><span class=\"keyword\">HAVING</span> <span class=\"built_in\">COUNT</span>(<span class=\"operator\">*</span>)<span class=\"operator\">&gt;=</span><span class=\"number\">5</span>) temp</span><br><span class=\"line\"><span class=\"keyword\">ON</span> d.deptno <span class=\"operator\">=</span> temp.deptno</span><br><span class=\"line\">);</span><br></pre></td></tr></table></figure>\n<h2 id=\"数据操作语言：UPDATE语句\"><a href=\"#数据操作语言：UPDATE语句\" class=\"headerlink\" title=\"数据操作语言：UPDATE语句\"></a>数据操作语言：UPDATE语句</h2><h3 id=\"UPDATE语句\"><a href=\"#UPDATE语句\" class=\"headerlink\" title=\"UPDATE语句\"></a>UPDATE语句</h3><ul>\n<li>◇ UPDATE语句用于修改表的记录  <figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"operator\">/</span><span class=\"operator\">/</span>&quot;IGNORE&quot;关键字在UPDATE语句中表示忽略修改数据时遇到冲突的记录，把不冲突的记录写到数据表里</span><br><span class=\"line\">UPDATE [ IGNORE ] 表名</span><br><span class=\"line\"><span class=\"keyword\">SET</span> 字段<span class=\"number\">1</span><span class=\"operator\">=</span>值<span class=\"number\">1</span>, 字段<span class=\"number\">2</span><span class=\"operator\">=</span>值<span class=\"number\">2</span>, ……</span><br><span class=\"line\">[ <span class=\"keyword\">WHERE</span> 条件<span class=\"number\">1</span>, 条件<span class=\"number\">2</span>, …… ] </span><br><span class=\"line\">[ <span class=\"keyword\">ORDER</span> <span class=\"keyword\">BY</span> …… ] <span class=\"operator\">/</span><span class=\"operator\">/</span>排序，如果需要将员工编号<span class=\"operator\">+</span><span class=\"number\">1</span>的话，可以先进行降序否则可能引发主键冲突</span><br><span class=\"line\">[ LIMIT …… ] <span class=\"operator\">/</span><span class=\"operator\">/</span>取分页数据</span><br></pre></td></tr></table></figure>\n<h3 id=\"UPDATE语句的表连接\"><a href=\"#UPDATE语句的表连接\" class=\"headerlink\" title=\"UPDATE语句的表连接\"></a>UPDATE语句的表连接</h3>◇ 因为WHERE子句中的子查询效率非常低，所以我们可以利用表连接的方式来改造UPDATE语句  <figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\">UPDATE 表<span class=\"number\">1</span> <span class=\"keyword\">JOIN</span> 表<span class=\"number\">2</span> <span class=\"keyword\">ON</span> 条件</span><br><span class=\"line\"><span class=\"keyword\">SET</span> 字段<span class=\"number\">1</span> <span class=\"operator\">=</span> 值<span class=\"number\">1</span> , 字段<span class=\"number\">2</span> <span class=\"operator\">=</span> 值<span class=\"number\">2</span> , …… ;</span><br></pre></td></tr></table></figure>\n◇ 表连接的UPDATE语句可以修改多张表的记录<br>◇ UPDATE语句的表连接可以演变成下面的样子  <figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\">UPDATE 表<span class=\"number\">1</span> , 表<span class=\"number\">2</span></span><br><span class=\"line\"><span class=\"keyword\">SET</span> 字段<span class=\"number\">1</span> <span class=\"operator\">=</span> 值<span class=\"number\">1</span> , 字段<span class=\"number\">2</span> <span class=\"operator\">=</span> 值<span class=\"number\">2</span> , ……</span><br><span class=\"line\"><span class=\"keyword\">WHERE</span> 连接条件 ;</span><br></pre></td></tr></table></figure>\n◇ UPDATE语句的表连接既可以是内连接，又可以是外连接 <figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\">UPDATE 表<span class=\"number\">1</span> [ <span class=\"keyword\">LEFT</span> <span class=\"operator\">|</span> <span class=\"keyword\">RIGHT</span> ] <span class=\"keyword\">JOIN</span> 表<span class=\"number\">2</span> <span class=\"keyword\">ON</span> 条件</span><br><span class=\"line\"><span class=\"keyword\">SET</span> 字段<span class=\"number\">1</span> <span class=\"operator\">=</span> 值<span class=\"number\">1</span> , 字段<span class=\"number\">2</span> <span class=\"operator\">=</span> 值<span class=\"number\">2</span> , …… ;</span><br></pre></td></tr></table></figure>\n◇ 把没有部门的员工，或者SALES部门低于2000元底薪的员工，都调往20部门  <figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\">UPDATE t_emp e <span class=\"keyword\">LEFT</span> <span class=\"keyword\">JOIN</span> t_dept d <span class=\"keyword\">ON</span> e.deptno<span class=\"operator\">=</span>d.deptno</span><br><span class=\"line\"><span class=\"keyword\">SET</span> e.deptno<span class=\"operator\">=</span><span class=\"number\">20</span></span><br><span class=\"line\"><span class=\"keyword\">WHERE</span> e.deptno <span class=\"keyword\">IS</span> <span class=\"keyword\">NULL</span> <span class=\"keyword\">OR</span> (d.dname<span class=\"operator\">=</span>&quot;SALES&quot; <span class=\"keyword\">AND</span> e.sal<span class=\"operator\">&lt;</span><span class=\"number\">2000</span>);</span><br></pre></td></tr></table></figure>\n<h3 id=\"课堂练习\"><a href=\"#课堂练习\" class=\"headerlink\" title=\"课堂练习\"></a>课堂练习</h3>◇ 把每个员工的编号和上司的编号+1，用ORDER BY子句完成 <figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\">UPDATE t_emp <span class=\"keyword\">SET</span> empno<span class=\"operator\">=</span>empno<span class=\"operator\">+</span><span class=\"number\">1</span>,mgr<span class=\"operator\">=</span>mgr<span class=\"operator\">+</span><span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"keyword\">ORDER</span> <span class=\"keyword\">BY</span> empno <span class=\"keyword\">DESC</span></span><br></pre></td></tr></table></figure>\n◇ 把月收入前三名的员工底薪减100元，用LIMIT子句完成  <figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\">UPDATE t_emp <span class=\"keyword\">SET</span> sal<span class=\"operator\">=</span>sal<span class=\"number\">-100</span></span><br><span class=\"line\"><span class=\"keyword\">ORDER</span> <span class=\"keyword\">BY</span> sal<span class=\"operator\">+</span>IFNULL(comm,<span class=\"number\">0</span>) <span class=\"keyword\">DESC</span></span><br><span class=\"line\">LIMIT <span class=\"number\">3</span>;</span><br></pre></td></tr></table></figure>\n◇ 把ALLEN调往RESEARCH部门，职务调整为ANALYST  //牵扯到两张表<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"operator\">/</span><span class=\"operator\">/</span>这里不能写连接条件(<span class=\"keyword\">ON</span> e.deptno<span class=\"operator\">=</span>d.deptno)，因为会将A锁定到R部门</span><br><span class=\"line\">UPDATE t_emp e <span class=\"keyword\">JOIN</span> t_dept d </span><br><span class=\"line\"><span class=\"keyword\">SET</span> e.deptno<span class=\"operator\">=</span>d.deptno,e.job<span class=\"operator\">=</span>&quot;ANALYST&quot;</span><br><span class=\"line\"><span class=\"keyword\">WHERE</span> e.ename<span class=\"operator\">=</span>&quot;ALLEN&quot; <span class=\"keyword\">AND</span> d.dname<span class=\"operator\">=</span>&quot;RESEARCH&quot;</span><br></pre></td></tr></table></figure>\n◇ 把底薪低于公司平均底薪的员工，底薪增加150元  <figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\">UPDATE t_emp e <span class=\"keyword\">JOIN</span></span><br><span class=\"line\">(<span class=\"keyword\">SELECT</span> <span class=\"built_in\">AVG</span>(sal) <span class=\"keyword\">AS</span> avg <span class=\"keyword\">FROM</span> t_emp) t<span class=\"operator\">/</span><span class=\"operator\">/</span>子查询结果集</span><br><span class=\"line\"><span class=\"keyword\">ON</span> e.sal<span class=\"operator\">&lt;</span>t.avg</span><br><span class=\"line\"><span class=\"keyword\">SET</span> e.sal<span class=\"operator\">=</span>e.sal<span class=\"operator\">+</span><span class=\"number\">150</span>;</span><br></pre></td></tr></table></figure>\n<h2 id=\"数据操作语言：DELETE语句\"><a href=\"#数据操作语言：DELETE语句\" class=\"headerlink\" title=\"数据操作语言：DELETE语句\"></a>数据操作语言：DELETE语句</h2><h3 id=\"DELETE语句\"><a href=\"#DELETE语句\" class=\"headerlink\" title=\"DELETE语句\"></a>DELETE语句</h3>◇ DELETE语句用于删除记录，语法如下：  <figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">DELETE</span> [ IGNORE ] <span class=\"keyword\">FROM</span> 表名<span class=\"operator\">/</span><span class=\"operator\">/</span>IGNORE:能删则删，不能删则忽略，不会报错</span><br><span class=\"line\">[ <span class=\"keyword\">WHERE</span> 条件<span class=\"number\">1</span>, 条件<span class=\"number\">2</span>, …… ]</span><br><span class=\"line\">[ <span class=\"keyword\">ORDER</span> <span class=\"keyword\">BY</span> …… ] </span><br><span class=\"line\">[ LIMIT …… ] ;</span><br></pre></td></tr></table></figure>\n<h3 id=\"DELETE语句的表连接\"><a href=\"#DELETE语句的表连接\" class=\"headerlink\" title=\"DELETE语句的表连接\"></a>DELETE语句的表连接</h3>◇ 因为相关子查询效率非常低，所以我们可以利用表连接的方式来改造DELETE语句  <figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">DELETE</span> 表<span class=\"number\">1</span> , …… <span class=\"keyword\">FROM</span> 表<span class=\"number\">1</span> <span class=\"keyword\">JOIN</span> 表<span class=\"number\">2</span> <span class=\"keyword\">ON</span> 条件</span><br><span class=\"line\">[ <span class=\"keyword\">WHERE</span> 条件<span class=\"number\">1</span> , 条件<span class=\"number\">2</span> , …… ] </span><br><span class=\"line\">[ <span class=\"keyword\">ORDER</span> <span class=\"keyword\">BY</span> …… ] </span><br><span class=\"line\">[ LIMIT …… ] ;</span><br></pre></td></tr></table></figure>\n◇ DELETE语句的表连接既可以是内连接，又可以是外连接  <figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">DELETE</span> 表<span class=\"number\">1</span> , …… <span class=\"keyword\">FROM</span> 表<span class=\"number\">1</span> [ <span class=\"keyword\">LEFT</span> <span class=\"operator\">|</span> <span class=\"keyword\">RIGHT</span> ] <span class=\"keyword\">JOIN</span> 表<span class=\"number\">2</span> </span><br><span class=\"line\"><span class=\"keyword\">ON</span> 条件 …… ;</span><br></pre></td></tr></table></figure>\n◇ 删除SALES部门的员工，以及没有部门的员工。  <figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">DELETE</span> e</span><br><span class=\"line\"><span class=\"keyword\">FROM</span> t_emp e <span class=\"keyword\">LEFT</span> <span class=\"keyword\">JOIN</span> t_dept d <span class=\"keyword\">ON</span> e.deptno<span class=\"operator\">=</span>d.deptno</span><br><span class=\"line\"><span class=\"keyword\">WHERE</span> d.dneme<span class=\"operator\">=</span>&quot;SALES&quot; <span class=\"keyword\">OR</span> e.deptno <span class=\"keyword\">IS</span> <span class=\"keyword\">NULL</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"快速删除数据表全部记录\"><a href=\"#快速删除数据表全部记录\" class=\"headerlink\" title=\"快速删除数据表全部记录\"></a>快速删除数据表全部记录</h3>◇ DELETE语句是在事务机制下删除记录，删除记录之前，先把将要删除的记录保存到日志文件里，然后再删除记录。<br>◇ TRUNCATE语句在事务机制之外删除记录，速度远超过DELETE语句  <figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">TRUNCATE</span> <span class=\"keyword\">TABLE</span> 表名 ;</span><br></pre></td></tr></table></figure>\n<h3 id=\"课堂练习-1\"><a href=\"#课堂练习-1\" class=\"headerlink\" title=\"课堂练习\"></a>课堂练习</h3>◇ 删除10部门中，工龄超过20年的员工记录 <figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">DELETE</span> <span class=\"keyword\">FROM</span> t_emp</span><br><span class=\"line\"><span class=\"keyword\">WHERE</span> deptno<span class=\"operator\">=</span><span class=\"number\">10</span> <span class=\"keyword\">AND</span> DATEDIFF(NOW(),hiredate)<span class=\"operator\">/</span><span class=\"number\">365</span> <span class=\"operator\">&gt;=</span><span class=\"number\">20</span></span><br></pre></td></tr></table></figure>\n◇ 删除20部门中工资最高的员工记录  <figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">DELETE</span> <span class=\"keyword\">FROM</span> t_emp</span><br><span class=\"line\"><span class=\"keyword\">WHERE</span> deptno<span class=\"operator\">=</span><span class=\"number\">20</span></span><br><span class=\"line\"><span class=\"keyword\">ORDER</span> <span class=\"keyword\">BY</span> sal<span class=\"operator\">+</span>IFNULL(comm,<span class=\"number\">0</span>) <span class=\"keyword\">DESC</span></span><br><span class=\"line\">LIMIT <span class=\"number\">1</span>;</span><br></pre></td></tr></table></figure>\n◇ 删除SALES部门和该部门的全部员工记录 <figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">DELETE</span> e,d</span><br><span class=\"line\"><span class=\"keyword\">FROM</span> t_emp e <span class=\"keyword\">JOIN</span> t_dept d <span class=\"keyword\">ON</span> e.deptno<span class=\"operator\">=</span>d.deptno</span><br><span class=\"line\"><span class=\"keyword\">WHERE</span> d.dname<span class=\"operator\">=</span>&quot;SALES&quot;;</span><br></pre></td></tr></table></figure>\n◇ 删除每个低于部门平均底薪的员工记录  <figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">DELETE</span> e</span><br><span class=\"line\"><span class=\"keyword\">FROM</span> t_emp e <span class=\"keyword\">JOIN</span> </span><br><span class=\"line\">(<span class=\"keyword\">SELECT</span> deptno,<span class=\"built_in\">AVG</span>(sal) <span class=\"keyword\">AS</span> avg <span class=\"keyword\">FROM</span> t_emp <span class=\"keyword\">GROUP</span> <span class=\"keyword\">BY</span> deptno) t</span><br><span class=\"line\"><span class=\"keyword\">ON</span> e.deptno <span class=\"operator\">=</span> t.deptno <span class=\"keyword\">AND</span> e.sal<span class=\"operator\">&lt;</span>t.avg</span><br></pre></td></tr></table></figure>\n◇ 删除员工KING和他的直接下属的员工记录，用表连接实现。  <figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">DELETE</span> e</span><br><span class=\"line\"><span class=\"keyword\">FROM</span> t_emp e <span class=\"keyword\">JOIN</span> </span><br><span class=\"line\">(<span class=\"keyword\">SELECT</span> empno <span class=\"keyword\">FROM</span> t_emp <span class=\"keyword\">WHERE</span> ename<span class=\"operator\">=</span>&quot;KING&quot;) t<span class=\"operator\">/</span><span class=\"operator\">/</span>结果集里的数据不能删</span><br><span class=\"line\"><span class=\"keyword\">ON</span> e.mgr<span class=\"operator\">=</span>t.empno <span class=\"keyword\">OR</span> e.empno<span class=\"operator\">=</span>t.empno;</span><br></pre></td></tr></table></figure></li>\n</ul>\n","categories":["Java数据库","MySQL基础"],"tags":["MySQL"]},{"title":"MySQL综合应用","url":"/p/c9e2.html","content":"<h2 id=\"数据库的事务机制\"><a href=\"#数据库的事务机制\" class=\"headerlink\" title=\"数据库的事务机制\"></a>数据库的事务机制</h2><h3 id=\"避免写入直接操作数据文件\"><a href=\"#避免写入直接操作数据文件\" class=\"headerlink\" title=\"避免写入直接操作数据文件\"></a>避免写入直接操作数据文件</h3><p> ◇ 如果数据的写入直接操作数据文件是非常危险的事情<br><img src=\"/p/c9e2/1626917790269-93acb2ad-63b6-4dd4-be0c-2e9fc2a0efb0.png\" class=\"lazyload\" data-srcset=\"/p/c9e2/1626917790269-93acb2ad-63b6-4dd4-be0c-2e9fc2a0efb0.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"></p>\n<h3 id=\"利用日志来实现间接写入\"><a href=\"#利用日志来实现间接写入\" class=\"headerlink\" title=\"利用日志来实现间接写入\"></a>利用日志来实现间接写入</h3><p>◇ MySQL总共有5种日志，其中只有redo(重做)日志和undo(撤销)日志与事务有关<br><img src=\"/p/c9e2/1626917898437-0ccbca8d-0d06-4df1-a5bc-55e18b880fe0.png\" class=\"lazyload\" data-srcset=\"/p/c9e2/1626917898437-0ccbca8d-0d06-4df1-a5bc-55e18b880fe0.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"></p>\n<h3 id=\"事务机制（Transaction）\"><a href=\"#事务机制（Transaction）\" class=\"headerlink\" title=\"事务机制（Transaction）\"></a>事务机制（Transaction）</h3><p>◇ RDBMS = SQL语句 + 事务（ACID）<br>◇ 事务是一个或者多个SQL语句组成的整体，要么全部执行成功，要 么全都执行失败  </p>\n<h3 id=\"事务案例\"><a href=\"#事务案例\" class=\"headerlink\" title=\"事务案例\"></a>事务案例</h3><p>◇ 把10部门中MANGER员工调往20部门，其他岗位的员工调往30部门，然后删除10部门<br><img src=\"/p/c9e2/1626917996276-921161a2-38af-41f5-ae65-e38647751e68.png\" class=\"lazyload\" data-srcset=\"/p/c9e2/1626917996276-921161a2-38af-41f5-ae65-e38647751e68.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"></p>\n<h3 id=\"管理事务\"><a href=\"#管理事务\" class=\"headerlink\" title=\"管理事务\"></a>管理事务</h3><p>◇ 默认情况下，MySQL执行每条SQL语句都会自动开启和提交事务<br>◇ 为了让多条SQL语句纳入到一个事务之下，可以手动管理事务  </p>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">START</span> TRANSACTION ;<span class=\"operator\">/</span><span class=\"operator\">/</span>开启事务</span><br><span class=\"line\"><span class=\"keyword\">SQL</span>语句</span><br><span class=\"line\">[ <span class=\"keyword\">COMMIT</span> <span class=\"operator\">|</span> <span class=\"keyword\">ROLLBACK</span> ] ;<span class=\"operator\">/</span><span class=\"operator\">/</span>提交<span class=\"operator\">|</span>回滚</span><br></pre></td></tr></table></figure>\n<h3 id=\"事务的ACID属性\"><a href=\"#事务的ACID属性\" class=\"headerlink\" title=\"事务的ACID属性\"></a>事务的ACID属性</h3><p><img src=\"/p/c9e2/1626918119445-1a0602c1-e9b0-4847-bfce-dcefc14db76d.png\" class=\"lazyload\" data-srcset=\"/p/c9e2/1626918119445-1a0602c1-e9b0-4847-bfce-dcefc14db76d.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"></p>\n<h4 id=\"事务的原子性\"><a href=\"#事务的原子性\" class=\"headerlink\" title=\"事务的原子性\"></a>事务的原子性</h4><p>◇ 一个事务中的所有操作要么全部完成，要么全部失败。事务执行后 ，不允许停留在中间某个状态  </p>\n<h4 id=\"事务的一致性\"><a href=\"#事务的一致性\" class=\"headerlink\" title=\"事务的一致性\"></a>事务的一致性</h4><p>◇ 不管在任何给定的时间、并发事务有多少，事务必须保证运行结果 的一致性<br>◇ 事务可以并发执行，但是最终MySQL却串行执行<br><img src=\"/p/c9e2/1626918183199-9912d76a-7d0f-43f0-b79e-3a527aa25551.png\" class=\"lazyload\" data-srcset=\"/p/c9e2/1626918183199-9912d76a-7d0f-43f0-b79e-3a527aa25551.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"></p>\n<h4 id=\"事务的隔离性\"><a href=\"#事务的隔离性\" class=\"headerlink\" title=\"事务的隔离性\"></a>事务的隔离性</h4><p>◇ 隔离性要求事务不受其他并发事务的影响，如同在给定的时间内，该事务是数据库唯一运行的事物<br>◇ 默认情况下A事务，只能看到日志中该事务的相关数据<br><img src=\"/p/c9e2/1626918249811-8534a704-899e-49cb-9c39-01d8f26737fc.png\" class=\"lazyload\" data-srcset=\"/p/c9e2/1626918249811-8534a704-899e-49cb-9c39-01d8f26737fc.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"></p>\n<h4 id=\"事务的持久性\"><a href=\"#事务的持久性\" class=\"headerlink\" title=\"事务的持久性\"></a>事务的持久性</h4><p> ◇事务一旦提交，结果便是永久性的。即便发生宕机，仍然可以依靠事务日志完成数据的持久化  </p>\n<h3 id=\"事务的四个隔离级别\"><a href=\"#事务的四个隔离级别\" class=\"headerlink\" title=\"事务的四个隔离级别\"></a>事务的四个隔离级别</h3><p><img src=\"/p/c9e2/1626918389326-5eab4721-6bd8-43a0-bf2e-6a779663c28e.png\" class=\"lazyload\" data-srcset=\"/p/c9e2/1626918389326-5eab4721-6bd8-43a0-bf2e-6a779663c28e.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"></p>\n<h3 id=\"修改事务隔离级别\"><a href=\"#修改事务隔离级别\" class=\"headerlink\" title=\"修改事务隔离级别\"></a>修改事务隔离级别</h3><p>◇在Navicat中开启两个sql面板可以模拟两个不同的事务；Mysql默认的隔离级别是REPEATABLE READ<br>◇ READ UNCOMMITTED 代表可以读取其他事务未提交的数据  </p>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">SET</span> SESSION TRANSACTION ISOLATION LEVEL </span><br><span class=\"line\">READ UNCOMMITTED;</span><br></pre></td></tr></table></figure>\n<p>◇ READ COMMITTED 代表只能读取其他事务提交的数据  </p>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">SET</span> SESSION TRANSACTION ISOLATION LEVEL </span><br><span class=\"line\">READ COMMITTED;</span><br></pre></td></tr></table></figure>\n<p>◇ REPEATABLE READ 代表事务在执行中反复读取数据，得到的结果是一致的，不会受其他事务影响  </p>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">SET</span> SESSION TRANSACTION ISOLATION LEVEL </span><br><span class=\"line\">REPEATABLE READ;</span><br></pre></td></tr></table></figure>\n<h3 id=\"业务案例\"><a href=\"#业务案例\" class=\"headerlink\" title=\"业务案例\"></a>业务案例</h3><p>①比如说购票场景里面，由于事务之间是隔离的，所以A、B两事务分别对第一条记录进行操作；A事务修改将其改为已售出，但是A事务未进行提交，因此真实的数据还是未售出状态；B事务将其改为已售出，并且很快进行提交；那么当A进行提交时，发现记录变成了已售出，就会发生回滚，即修改失败；虽然说没有产生有歧义的数据，但是动不动就购票失败，十分影响用户体验；因此在这个场景下我们应当允许事务去读取其他事务的临时状态；B事务可以看到A事务里的临时信息，即修改了第一条记录，但未提交；那么B就无法修改此记录；就不会引发数据冲突了；所以这里使用的隔离级别为:READ UNCOMMITTED<br><img src=\"/p/c9e2/1626918423470-5ed66a73-33cf-4fd7-8082-cdefb265ee8a.png\" class=\"lazyload\" data-srcset=\"/p/c9e2/1626918423470-5ed66a73-33cf-4fd7-8082-cdefb265ee8a.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"><br>②对于银行转账之类的业务场景；就只能让当前事务去读取其他事务已经提交的数据，而不能够去读取其他事务的临时数据;比如说下面的Scott账户，假设B事务执行，需要支出100元，但是还没有提交；而这时A事务进行转账操作，由于可以看到B事务的临时数据，所以A事务看到Scott账户为4900元，提交后，账户变为5900元；但如果B事务由于某些原因回滚的话，原来的操作无效；而此时账户余额却是4900元，凭空少了100元；因此这种场景必须使用READ COMMITTED隔离级别；<br><img src=\"/p/c9e2/1626918537468-9c083613-aa6e-4b96-9e6a-3cb7625db4f6.png\" class=\"lazyload\" data-srcset=\"/p/c9e2/1626918537468-9c083613-aa6e-4b96-9e6a-3cb7625db4f6.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"><br>③又如，A事务进行某商品的下单购票后未提交事务，但是B事务确将商品价格提高了；那么此时A事务应该根据原价购买；所以隔离级别使用REPEATABLE READ；即不受其他任何事务的影响，无论其他事务提交与否；<br><img src=\"/p/c9e2/1626918633199-35ba965c-25a8-41b6-b280-3a59d1b6d4ee.png\" class=\"lazyload\" data-srcset=\"/p/c9e2/1626918633199-35ba965c-25a8-41b6-b280-3a59d1b6d4ee.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"></p>\n<h3 id=\"事务的序列化\"><a href=\"#事务的序列化\" class=\"headerlink\" title=\"事务的序列化\"></a>事务的序列化</h3><p>◇ 由于事务并发执行所带来的各种问题，前三种隔离级别只适用在某些业务场景中，但是序列化的隔离性，只有前面的会话结束后(事务提交后)才能执行下一个事务，即让事务逐一执行，不能够并发地执行事务；但是这样会大大降低数据库的并发能力，所以不太常用；  </p>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">SET</span> SESSION TRANSACTION ISOLATION LEVEL</span><br><span class=\"line\">SERIALIZABLE;</span><br></pre></td></tr></table></figure>\n<h2 id=\"数据导入与导出\"><a href=\"#数据导入与导出\" class=\"headerlink\" title=\"数据导入与导出\"></a>数据导入与导出</h2><h3 id=\"数据导出与备份的区别\"><a href=\"#数据导出与备份的区别\" class=\"headerlink\" title=\"数据导出与备份的区别\"></a>数据导出与备份的区别</h3><p>◇ 数据导出，导出的纯粹是业务数据<br>◇ 数据备份，备份的是数据文件、日志文件、索引文件等等<br><img src=\"/p/c9e2/1626918828306-0b54f018-06c6-4391-8539-16724d411448.png\" class=\"lazyload\" data-srcset=\"/p/c9e2/1626918828306-0b54f018-06c6-4391-8539-16724d411448.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"></p>\n<h3 id=\"数据导出的分类\"><a href=\"#数据导出的分类\" class=\"headerlink\" title=\"数据导出的分类\"></a>数据导出的分类</h3><p><img src=\"/p/c9e2/1626918863615-44b06718-5e90-4bbd-99c0-489bbc76cba0.png\" class=\"lazyload\" data-srcset=\"/p/c9e2/1626918863615-44b06718-5e90-4bbd-99c0-489bbc76cba0.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"></p>\n<h3 id=\"导出SQL文件\"><a href=\"#导出SQL文件\" class=\"headerlink\" title=\"导出SQL文件\"></a>导出SQL文件</h3><p>◇ mysqldump用来把业务数据导出成SQL文件，其中也包括了表结构  </p>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\">mysqldump <span class=\"operator\">-</span>uroot <span class=\"operator\">-</span>p [ <span class=\"keyword\">no</span><span class=\"operator\">-</span>data ] 逻辑库 <span class=\"operator\">&gt;</span> 路径</span><br></pre></td></tr></table></figure>\n<p>◇ 如果业务数据非常多，建议只导出表结构，然后用SELECT INTO OUTFILE把数据导出成文本文档  </p>\n<h3 id=\"导入SQL文件\"><a href=\"#导入SQL文件\" class=\"headerlink\" title=\"导入SQL文件\"></a>导入SQL文件</h3><p>◇ source命令用于导入SQL文件，包括创建数据表，写入记录等  </p>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">sql</span> <span class=\"operator\">&gt;</span> USE demo ;</span><br><span class=\"line\"><span class=\"keyword\">sql</span> <span class=\"operator\">&gt;</span> SOURCE backup.sql ;</span><br></pre></td></tr></table></figure>\n\n","categories":["Java数据库","MySQL基础"],"tags":["MySQL"]},{"title":"Nginx入门","url":"/p/e129.html","content":"<h2 id=\"介绍\"><a href=\"#介绍\" class=\"headerlink\" title=\"介绍\"></a>介绍</h2><p>1.Nginx介绍<br>2.Nginx的安装<br>3. 常用命令讲解和演示<br>4.配置文件讲解<br>5.场景实战：搭建一个静态的Nginx服务<br>6.总结</p>\n<h2 id=\"Nginx介绍\"><a href=\"#Nginx介绍\" class=\"headerlink\" title=\"Nginx介绍\"></a>Nginx介绍</h2><h3 id=\"Nginx是什么、适用场景\"><a href=\"#Nginx是什么、适用场景\" class=\"headerlink\" title=\"Nginx是什么、适用场景\"></a>Nginx是什么、适用场景</h3><p>◇HTTP的反向代理服务器<br>◇正向代理；指的是普通的代理转发，在我们的客户端和服务器之间加了一个代理服务器；作为客户端，会将消息传到代理服务器上，而代理服务器将客户端的请求进行转发；代理服务器提供安全功能，代理服务器拥有一个防火墙，可以使客户端拥有其不具备的安全检测的功能；可以通过代理服务器隐藏自身的信息；<br><img src=\"/p/e129/1636529487131-62ea6235-13bf-400a-8180-184d04c7504d.png\" class=\"lazyload\" data-srcset=\"/p/e129/1636529487131-62ea6235-13bf-400a-8180-184d04c7504d.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"><br>◇反向代理；反向代理通常位于服务端中；指我们客户端去访问的时候，不直接访问到我们所要访问的服务器，而是在这些服务器之前加一个统一的反向代理服务器，对于客户端而言，访问的服务器信息是看不到的；反向代理服务器除了和代理服务器一样提供安全功能外，还有一个功能是在后端多个服务器之间提供负载均衡，或者是对比较慢的服务器提供缓存，把经常访问的内容缓存到代理服务器中；<br><img src=\"/p/e129/1636529533636-4e6b7695-7f6c-4d92-8e6d-1e15090f0dc5.png\" class=\"lazyload\" data-srcset=\"/p/e129/1636529533636-4e6b7695-7f6c-4d92-8e6d-1e15090f0dc5.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"><br>◇Nginx的作用正是反向代理<img src=\"/p/e129/1636721331582-10fe5345-9841-4302-b5f8-4b60a551ab84.png\" class=\"lazyload\" data-srcset=\"/p/e129/1636721331582-10fe5345-9841-4302-b5f8-4b60a551ab84.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"></p>\n<p>◇正向+反向代理<br><img src=\"/p/e129/1636721836068-00257156-75a8-40a4-8953-f23dd51ece1c.png\" class=\"lazyload\" data-srcset=\"/p/e129/1636721836068-00257156-75a8-40a4-8953-f23dd51ece1c.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"><br>◇动态静态资源分离<br>   作为后端服务器需要给前端提供一些资源，但这些资源可能包含了逻辑代码也可能包含css静态资源；对于静态资源，其实没有必要由我们后台服务器去提供，不进行分离的话访问会变慢；<br>  静态资源无需经过Tomcat，Tomcat只负责处理动态请求，这样访问速度就会提高；如后缀为gif的时候，Nginx会直接获取到当前请求的文件并返回；<br>  Nginx本身就是一个静态资源服务器；比如我们只有静态资源的时候，如个人主页，公司简介这些都可以作为静态资源网站去实现，就可以直接使用Nginx作为服务器；</p>\n<h3 id=\"Nginx的优点\"><a href=\"#Nginx的优点\" class=\"headerlink\" title=\"Nginx的优点\"></a>Nginx的优点</h3><p>◇高并发、高性能<br>◇可扩展性好, Nginx的第三方生态圈非常丰富；<br>◇高可靠性，即Nginx可以在服务器上不断的运行，长达数年之久；用户直接访问到Nginx；<br>◇热部署，不停止服务的情况下对自身进行升级或修改完善；<br>◇开源、可商用</p>\n<h2 id=\"Nginx的安装\"><a href=\"#Nginx的安装\" class=\"headerlink\" title=\"Nginx的安装\"></a>Nginx的安装</h2><p>◇Linux的安装</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">yum install yum-utils</span><br><span class=\"line\">#新建文件输入源信息;</span><br><span class=\"line\">vim /etc/yum.repos.d/nginx.repo</span><br><span class=\"line\">#以下就是配置信息:</span><br><span class=\"line\">    [nginx-stable]</span><br><span class=\"line\">    name=nginx stable repo</span><br><span class=\"line\">    baseurl=http:<span class=\"comment\">//nginx.org/packages/centos/7/$basearch/</span></span><br><span class=\"line\">    gpgcheck=<span class=\"number\">1</span></span><br><span class=\"line\">    enabled=<span class=\"number\">1</span></span><br><span class=\"line\">    gpgkey=https:<span class=\"comment\">//nginx.org/keys/nginx_signing.key</span></span><br><span class=\"line\">    module_hotfixes=<span class=\"keyword\">true</span></span><br><span class=\"line\"></span><br><span class=\"line\">    [nginx-mainline]</span><br><span class=\"line\">    name=nginx mainline repo</span><br><span class=\"line\">    baseurl=http:<span class=\"comment\">//nginx.org/packages/mainline/centos/7/$basearch/</span></span><br><span class=\"line\">    gpgcheck=<span class=\"number\">1</span></span><br><span class=\"line\">    enabled=<span class=\"number\">0</span></span><br><span class=\"line\">    gpgkey=https:<span class=\"comment\">//nginx.org/keys/nginx_signing.key</span></span><br><span class=\"line\">    module_hotfixes=<span class=\"keyword\">true</span></span><br><span class=\"line\">#查看源,stable代表稳定版本,</span><br><span class=\"line\">yum list | grep nginx</span><br><span class=\"line\">#开始下载,版本选择第一个稳定的版本</span><br><span class=\"line\">yum install nginx <span class=\"number\">1</span>:<span class=\"number\">1.16</span><span class=\"number\">.1</span>-<span class=\"number\">1.</span>el7.ngx</span><br><span class=\"line\">y确认下载</span><br><span class=\"line\">y确认验证</span><br><span class=\"line\">#检查是否安装成功</span><br><span class=\"line\">nginx -v</span><br><span class=\"line\">whereis nginx</span><br></pre></td></tr></table></figure>\n<p>◇Windows不推荐安装，因为服务器通常不是Windows下的；</p>\n<h2 id=\"常用命令讲解和演示\"><a href=\"#常用命令讲解和演示\" class=\"headerlink\" title=\"常用命令讲解和演示\"></a>常用命令讲解和演示</h2><p>◇启动命令: /usr/sbin/nginx<br>◇查看是否启动成功,查看进程判断：ps -aux |grep nginx或直接访问nginx的网站80端口<br>◇nginx -h //查看主要命令<br>◇-c 读取指定配置文件</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">cd /etc/nginx  <span class=\"comment\">//查看配置文件</span></span><br><span class=\"line\">ls</span><br><span class=\"line\">nginx -s stop  <span class=\"comment\">//如果前面有启动的话，先关闭再指定配置文件</span></span><br><span class=\"line\">nginx -c /etc/nginx/nginx.conf   <span class=\"comment\">//指定配置文件为nginx.conf</span></span><br></pre></td></tr></table></figure>\n<p>◇-t 测试，主要用来测试配置文件是否正确<br>nginx -t //进行测试<br>◇在nginx启动后，也可以用上面这个命令查看nginx的配置文件是哪一个；<br>◇-v 简要版本信息； -V 详细版本信息；<br>◇where is   或者   ps aux|grep nginx  //找到正在运行的nginx的路径<br>◇-s 信号</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">stop  <span class=\"comment\">//立即停止</span></span><br><span class=\"line\">quit  <span class=\"comment\">//优雅停止,不在接收新的请求，但会将已经送达的请求处理完再关闭</span></span><br><span class=\"line\">reload <span class=\"comment\">//重启:先检查配置文件的有效性，无效的话不会重启；有效的话就会启动一个新的进程，直到旧的</span></span><br><span class=\"line\">      进程把它的任务处理完毕后，再让旧进程退出；</span><br><span class=\"line\">reopen <span class=\"comment\">//更换日志文件,即日志过长的话,新建一个文件用来记录日志</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"配置文件讲解\"><a href=\"#配置文件讲解\" class=\"headerlink\" title=\"配置文件讲解\"></a>配置文件讲解</h2><h3 id=\"配置文件语法\"><a href=\"#配置文件语法\" class=\"headerlink\" title=\"配置文件语法\"></a>配置文件语法</h3><p>◇以  ;  结尾<br>◇  {}组织多条指令<br>◇include 引入<br>◇用 #注释<br>◇$ 变量</p>\n<h3 id=\"配置文件讲解-1\"><a href=\"#配置文件讲解-1\" class=\"headerlink\" title=\"配置文件讲解\"></a>配置文件讲解</h3><p>◇nginx.conf</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"># 运行用户，默认是nginx</span><br><span class=\"line\">user  nginx;</span><br><span class=\"line\"># nginx进程数,一般设置为和cpu核数一样</span><br><span class=\"line\">worker_processes  <span class=\"number\">1</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"># 全局错误日志路径</span><br><span class=\"line\">error_log  /<span class=\"keyword\">var</span>/log/nginx/error.log warn;</span><br><span class=\"line\"># 进程pid路径</span><br><span class=\"line\">pid        /<span class=\"keyword\">var</span>/run/nginx.pid;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">events &#123;</span><br><span class=\"line\"># 最大连接数</span><br><span class=\"line\">    worker_connections  <span class=\"number\">1024</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"># 设置http服务器</span><br><span class=\"line\">http &#123;</span><br><span class=\"line\">    include       /etc/nginx/mime.types;</span><br><span class=\"line\">    default_type  application/octet-stream;</span><br><span class=\"line\"># 设置日志的格式</span><br><span class=\"line\">    log_format  main  <span class=\"string\">&#x27;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#x27;</span></span><br><span class=\"line\">                      <span class=\"string\">&#x27;$status $body_bytes_sent &quot;$http_referer&quot; &#x27;</span></span><br><span class=\"line\">                      <span class=\"string\">&#x27;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#x27;</span>;</span><br><span class=\"line\"># 访问日志的路径</span><br><span class=\"line\">    access_log  /<span class=\"keyword\">var</span>/log/nginx/access.log  main;</span><br><span class=\"line\"></span><br><span class=\"line\"># 开启高效传输模式</span><br><span class=\"line\">    sendfile        on;</span><br><span class=\"line\">    #tcp_nopush     on;</span><br><span class=\"line\"># 长连接超时时间，单位是秒</span><br><span class=\"line\">    keepalive_timeout  <span class=\"number\">65</span>;</span><br><span class=\"line\">#传输时是否压缩，压缩的话需要解压，但是传的大小就小了</span><br><span class=\"line\">    #gzip  on;</span><br><span class=\"line\">#加载其他的配置文件，形成一带多的内容</span><br><span class=\"line\">    include /etc/nginx/conf.d<span class=\"comment\">/*.conf;</span></span><br><span class=\"line\"><span class=\"comment\">&#125;</span></span><br></pre></td></tr></table></figure>\n<p>◇ etc/nginx/conf.d/default.conf</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">server &#123;</span><br><span class=\"line\">    listen       <span class=\"number\">80</span>; #端口号</span><br><span class=\"line\">    server_name  localhost; #服务器名字</span><br><span class=\"line\"></span><br><span class=\"line\">    access_log  /<span class=\"keyword\">var</span>/log/nginx/host.access.log  main;</span><br><span class=\"line\">    </span><br><span class=\"line\">    location / &#123;  #/路径</span><br><span class=\"line\">        root   /usr/share/nginx/html/; #默认转发的路径</span><br><span class=\"line\">        index  index.html index.htm;  #默认主页</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    error_page   <span class=\"number\">500</span> <span class=\"number\">502</span> <span class=\"number\">503</span> <span class=\"number\">504</span>  /50x.html;  #错误请求页面</span><br><span class=\"line\">    location = /50x.html &#123;  #/50x.html路径</span><br><span class=\"line\">        root   /usr/share/nginx/html;  #当路径想要请求某些错误文件的时候，会转发到此地址</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"场景实战\"><a href=\"#场景实战\" class=\"headerlink\" title=\"场景实战\"></a>场景实战</h2><h3 id=\"搭建一个静态文件的Nginx服务\"><a href=\"#搭建一个静态文件的Nginx服务\" class=\"headerlink\" title=\"搭建一个静态文件的Nginx服务\"></a>搭建一个静态文件的Nginx服务</h3><p>◇上传网页文件到服务器(在本地主机的终端执行)</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">#-r表示上传文件夹，上传文件夹静态网页的所有内容则直接在后面+/; root后面加上上传的地址</span><br><span class=\"line\">scp -r /文件的路径/静态网页/   root@服务器的ip地址(<span class=\"number\">198.</span>xxx) :/usr/share/nginx/web/</span><br></pre></td></tr></table></figure>\n<p>◇查看是否上传成功 ：ls、cat<br>◇打开配置文件并进行修改</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"># vim /etc/nginx/conf.d/<span class=\"keyword\">default</span>.conf</span><br><span class=\"line\">#主要修改location的部分</span><br><span class=\"line\"> location / &#123;  </span><br><span class=\"line\">        root   /usr/share/nginx/web/; #将html改为web</span><br><span class=\"line\">        index  index.html index.htm; </span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">location = /50x.html &#123;  </span><br><span class=\"line\">        root   /usr/share/nginx/web;  #也改成web</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>◇重启nginx</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">nginx -t  #测试配置文件是否正确</span><br><span class=\"line\">nginx -s reload #重启</span><br></pre></td></tr></table></figure>\n<h2 id><a href=\"#\" class=\"headerlink\" title></a></h2>","categories":["分布式与微服务"],"tags":["Nginx"]},{"title":"RESTFUL风格的应用","url":"/p/cc19.html","content":"<h2 id=\"传统Web应用的问题\"><a href=\"#传统Web应用的问题\" class=\"headerlink\" title=\"传统Web应用的问题\"></a>传统Web应用的问题</h2><p><img src=\"/p/cc19/1634216854423-40c6124e-0a6c-4a90-8fc0-094c591599f2.png\" class=\"lazyload\" data-srcset=\"/p/cc19/1634216854423-40c6124e-0a6c-4a90-8fc0-094c591599f2.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"><br>◇上图描述了传统开发模式的流程，可知在这种模式下，我们客户端需要支持html的浏览器；但目前互联网的发展呈多元化，有微信小程序，APP等各种客户端；那么像这种客户端是不支持html的，那么我们希望这种客户端都能和后端通过html进行通信，该如何实现呢？这时一种全新的开发理念就出现了，即RESTful；</p>\n<h2 id=\"REST与RESTful\"><a href=\"#REST与RESTful\" class=\"headerlink\" title=\"REST与RESTful\"></a>REST与RESTful</h2><p>◇REST-表现层状态转换,资源在网络中以某种表现形式进行状态转移<br>◇RESTful是基于REST理念的一套开发风格,是具体的开发规则<br>◇RESTful传输数据如下图，客户端不再是标准的浏览器，并不拘泥于客户端必须是浏览器；当手机中有一个小程序向<a href=\"http://xxx.com/list%E8%BF%99%E4%B8%AAurl%E5%8F%91%E9%80%81%E4%BA%86%E4%B8%80%E4%B8%AA%E8%AF%B7%E6%B1%82%EF%BC%8C%E8%80%8C%E8%BF%99%E4%B8%AA%E8%AF%B7%E6%B1%82%E5%8F%91%E9%80%81%E5%88%B0%E4%BA%86web%E7%AB%AF%E7%9A%84%E6%9C%8D%E5%8A%A1%E5%99%A8%EF%BC%8C%E7%BB%8F%E8%BF%87%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%A4%84%E7%90%86%E4%BB%A5%E5%90%8E%EF%BC%8C%E4%BD%9C%E4%B8%BA%E6%9C%8D%E5%8A%A1%E5%99%A8%E8%BF%94%E5%9B%9E%E7%9A%84%E4%B8%8D%E5%86%8D%E6%98%AFhtml%E7%9A%84%E6%96%87%E6%9C%AC%EF%BC%8C%E8%80%8C%E6%98%AF%E5%83%8FJSON%E6%88%96XML%E8%BF%99%E6%A0%B7%E7%9A%84%E6%95%B0%E7%BB%84%EF%BC%9B%E5%8D%B3%E5%9C%A8RESTful%E5%BC%80%E5%8F%91%E9%A3%8E%E6%A0%BC%E4%B8%AD%EF%BC%8C%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%8F%AA%E8%BF%94%E5%9B%9E%E6%95%B0%E6%8D%AE%EF%BC%8C%E8%80%8C%E8%BF%99%E7%A7%8D%E6%95%B0%E6%8D%AE%E4%BB%A5JSON%E6%88%96XML%E7%9A%84%E6%96%B9%E5%BC%8F%E4%BD%93%E7%8E%B0%EF%BC%8C%E8%A6%81%E6%B1%82%E8%BF%94%E5%9B%9E%E7%9A%84%E6%95%B0%E6%8D%AE%E4%B8%8D%E5%8C%85%E5%90%AB%E4%BB%BB%E4%BD%95%E4%B8%8E%E5%B1%95%E7%8E%B0%E7%9A%84%E5%86%85%E5%AE%B9%EF%BC%9B%E5%85%B7%E4%BD%93%E7%9A%84%E5%B1%95%E7%8E%B0%E6%96%B9%E5%BC%8F%E4%BA%A4%E7%94%B1%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%A4%84%E7%90%86%EF%BC%9B%E8%BF%99%E6%A0%B7%E5%81%9A%E7%9A%84%E5%A5%BD%E5%A4%84%E6%98%AF%E5%90%8E%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%B8%88%E5%8F%AF%E4%BB%A5%E4%B8%93%E6%B3%A8%E4%BA%8E%E5%90%8E%E5%8F%B0%E5%BC%80%E5%8F%91%EF%BC%8C%E8%80%8C%E6%95%B0%E6%8D%AE%E7%9A%84%E5%B1%95%E7%8E%B0%E4%BA%A4%E7%BB%99%E5%89%8D%E7%AB%AF%E5%AE%8C%E6%88%90%EF%BC%9B%E5%8D%B3%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB%EF%BC%9B\">http://xxx.com/list这个url发送了一个请求，而这个请求发送到了web端的服务器，经过服务器处理以后，作为服务器返回的不再是html的文本，而是像JSON或XML这样的数组；即在RESTful开发风格中，服务器只返回数据，而这种数据以JSON或XML的方式体现，要求返回的数据不包含任何与展现的内容；具体的展现方式交由客户端处理；这样做的好处是后端工程师可以专注于后台开发，而数据的展现交给前端完成；即前后端分离；</a><br><img src=\"/p/cc19/1634217425921-bc98db74-c09b-4e16-b950-091b8b553382.png\" class=\"lazyload\" data-srcset=\"/p/cc19/1634217425921-bc98db74-c09b-4e16-b950-091b8b553382.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"></p>\n<h2 id=\"RESTful开发规范\"><a href=\"#RESTful开发规范\" class=\"headerlink\" title=\"RESTful开发规范\"></a>RESTful开发规范</h2><p>◇使用URL作为用户交互入口<br>◇ 明确的语义规范(GET|POST|PUT|DELETE)；这里的语义规范是指在http发送请求的时候，例如get请求和post请求它们实现的含义是不同的；在我们日常开发中，常用的http发送的方式有四种，GET|POST|PUT|DELETE，在web环境下不支持后两种，这四种其实分别对应了查询|新增|更新|删除 的操作，也就是说同一个url在向服务器发送请求的时候，使用了不同的请求方式，则服务器的处理操作也是不同的；<br>◇ 只返回数据(JSON|XML),不包含任何展现 ；默认使用JSON数据；</p>\n<h2 id=\"RESTful命名要求\"><a href=\"#RESTful命名要求\" class=\"headerlink\" title=\"RESTful命名要求\"></a>RESTful命名要求</h2><p>◇uri在RESTful中是有明确用法的，需要书写正确；<br>第一行说明我们要查询作者是Lily的文章；<br>◇第二行错误是因为我不具有语义，即无法通过uri明白要干什么；而修改后的uri让我们知道是要查询id号为1的学生；RESTful可以把id号附加到uri中；<br>◇第三行，在RESTful中强制要求所有的uri中出现的单词必须是名词，不能是动词；<br>◇第四行，实际使用中如果uri的层级过多，会造成uri的管理混乱，同时造成维护不便；如果超过两级，通常将id进行参数化，书写为?id=1的形式；作为RESTful它里边所代表的资源是由最后一个名词决定的；所以这里查询id=1的名词是指作者而不是文章；<br>◇第五行，RESTful建议最好在名词上区分单复数；一般复数形式用于查询；其他操作往往针对一个对象，通常采用单数形式；<br><img src=\"/p/cc19/1634218937948-c2fd7f02-a288-4f85-84c0-cfb73d99a99f.png\" class=\"lazyload\" data-srcset=\"/p/cc19/1634218937948-c2fd7f02-a288-4f85-84c0-cfb73d99a99f.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"></p>\n<h2 id=\"开发RESTful-Web应用\"><a href=\"#开发RESTful-Web应用\" class=\"headerlink\" title=\"开发RESTful Web应用\"></a>开发RESTful Web应用</h2><h3 id=\"服务器端\"><a href=\"#服务器端\" class=\"headerlink\" title=\"服务器端\"></a>服务器端</h3><p>◇创建maven项目restful，然后配置工程结构，配置Tomcat；<br>◇配置各种xml文件；<br>◇创建RestController控制器类</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Controller</span></span><br><span class=\"line\"><span class=\"meta\">@RequestMapping(&quot;/restful&quot;)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">RestfulController</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"meta\">@GetMapping(&quot;/request&quot;)</span></span><br><span class=\"line\">    <span class=\"meta\">@ResponseBody</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">doGetRequest</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">/*一个JSON格式的字符串，在其中增加key和value</span></span><br><span class=\"line\"><span class=\"comment\">        * 注意：双引号中如果包括双引号，要使用转义字符\\,将双引号写成\\&quot;*/</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">&quot;&#123;\\&quot;message\\&quot;:\\&quot;返回查询结果\\&quot;&#125;&quot;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>◇这样，就完成了restful风格的开发，可以看出，restful并不是新技术，而是一种开发风格；那么如何将JSON字符串进行页面的展现呢？这就是前端的工作了；<br>◇如果我们在页面运行过程中，想得到url返回的数据，可以使用ajax技术，ajax可以在页面中异步的与url发送请求，得到相应结果；</p>\n<h3 id=\"客户端\"><a href=\"#客户端\" class=\"headerlink\" title=\"客户端\"></a>客户端</h3><p>◇现在我们开发一个客户端，与服务器端的restful进行交互<br>◇将jQuery包复制到webapp目录下，因为待会需要使用jQuery的ajax函数，在http页面中向controller发起http请求；<br>◇在webapp目录下创建客户端html页面；client.html；</p>\n<figure class=\"highlight html\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE <span class=\"meta-keyword\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span> <span class=\"attr\">lang</span>=<span class=\"string\">&quot;en&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">charset</span>=<span class=\"string\">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>RESTful实验室<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\"><span class=\"comment\">&lt;!--引入jquery--&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;jquery-3.3.1.min.js&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!--书写页面就绪函数,在页面加载完以后</span></span><br><span class=\"line\"><span class=\"comment\">    直接用我们定义的按钮绑定单击事件,并书写事件函数--&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span><span class=\"javascript\"></span></span><br><span class=\"line\"><span class=\"javascript\">        $(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;<span class=\"comment\">//页面就绪函数</span></span></span><br><span class=\"line\"><span class=\"javascript\">            $(<span class=\"string\">&quot;#btnGet&quot;</span>).click(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;<span class=\"comment\">//单击事件函数</span></span></span><br><span class=\"line\"><span class=\"javascript\">                $.ajax(&#123;<span class=\"comment\">/*利用ajax函数向服务器端发送一个异步请求*/</span></span></span><br><span class=\"line\"><span class=\"javascript\">                    <span class=\"attr\">url</span>:<span class=\"string\">&quot;/restful/request&quot;</span>, <span class=\"comment\">//请求的url地址</span></span></span><br><span class=\"line\"><span class=\"javascript\">                    <span class=\"attr\">type</span>:<span class=\"string\">&quot;get&quot;</span>, <span class=\"comment\">//请求方式为get</span></span></span><br><span class=\"line\"><span class=\"javascript\">                    <span class=\"attr\">dataType</span>:<span class=\"string\">&quot;json&quot;</span>,<span class=\"comment\">//说明服务器返回的数据类型为json</span></span></span><br><span class=\"line\"><span class=\"javascript\">                    <span class=\"comment\">/*success回调函数，能将字符串转换为json对象*/</span></span></span><br><span class=\"line\"><span class=\"javascript\">                    <span class=\"attr\">success</span>:<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">json</span>) </span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">                        <span class=\"comment\">/*绑定一个&lt;h1&gt;标签的id,然服务器返回的数据</span></span></span><br><span class=\"line\"><span class=\"comment\"><span class=\"javascript\">                        * 填充到这个&lt;h1&gt;里边；text方法用于设置内部的文本</span></span></span><br><span class=\"line\"><span class=\"comment\"><span class=\"javascript\">                        * json.message得到JSON中message的value(值)*/</span></span></span><br><span class=\"line\"><span class=\"javascript\">                        $(<span class=\"string\">&quot;#message&quot;</span>).text(json.message);</span></span><br><span class=\"line\"><span class=\"javascript\">                    &#125;</span></span><br><span class=\"line\"><span class=\"javascript\">                &#125;)</span></span><br><span class=\"line\"><span class=\"javascript\">            &#125;)</span></span><br><span class=\"line\"><span class=\"javascript\">        &#125;)</span></span><br><span class=\"line\"><span class=\"javascript\">    </span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"comment\">&lt;!--通过这个按钮利用ajax向服务器发送http请求--&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;button&quot;</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;btnGet&quot;</span> <span class=\"attr\">value</span>=<span class=\"string\">&quot;发送Get请求&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">h1</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;message&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">h1</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>◇当我们运行Tomcat并在浏览器输入client.html的页面，点击按钮就会将服务器返回的数据展示在页面的&lt;h1&gt;标签上，如果出现了中文乱码，并且是在程序里创建了消息转换器解决中文时；我们可以按F12然后查看Network网络部分，再次点击按钮，查看request请求，查看Headers中Response Headers响应头部分，如下图，可以看看蓝标处的Context-Type；jequery通过ajax发送请求以后，返回的响应的类型不是我们设置的text/html,而且如果字符集不是utf-8的话，就会出现乱码问题；<br><img src=\"/p/cc19/1634262466249-64e6e6dd-dac1-4ffa-8a6a-34af3e96fb01.png\" class=\"lazyload\" data-srcset=\"/p/cc19/1634262466249-64e6e6dd-dac1-4ffa-8a6a-34af3e96fb01.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"><br>那么如果如果charset不是utf-8的话，该怎么做呢？<br>我们可以在服务器端修改这个字符集，打开applicationContext配置文件将消息转换器增加配置；</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">list</span>&gt;</span></span><br><span class=\"line\"><span class=\"comment\">&lt;!--原本设置的字符集只能针对text/html格式的--&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">value</span>&gt;</span>text/html;charset=utf-8<span class=\"tag\">&lt;/<span class=\"name\">value</span>&gt;</span></span><br><span class=\"line\"><span class=\"comment\">&lt;!--现在我们增加application/json格式的，通知客户端</span></span><br><span class=\"line\"><span class=\"comment\">将数据用utf-8的字符集进行展示--&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">value</span>&gt;</span>application/json;charset=utf-8<span class=\"tag\">&lt;/<span class=\"name\">value</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">list</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"RESTful不同操作\"><a href=\"#RESTful不同操作\" class=\"headerlink\" title=\"RESTful不同操作\"></a>RESTful不同操作</h3><p>◇作为restful还有一个重要特性，就是针对不同的请求来做不同的操作；如查询用get，新增用post，修改put，删除delete；那么在程序中是如何体现的呢？<br>◇服务端方法,注意请求地址需要不同，否则会报500错误：There is already ‘restfulController’ bean method</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@RequestMapping(&quot;/request&quot;)</span></span><br><span class=\"line\"><span class=\"meta\">@ResponseBody</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">doPostRequest</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">&quot;&#123;\\&quot;message\\&quot;:\\&quot;数据新增成功\\&quot;&#125;&quot;</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"meta\">@RequestMapping(&quot;/put&quot;)</span></span><br><span class=\"line\"><span class=\"meta\">@ResponseBody</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">doPutRequest</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">&quot;&#123;\\&quot;message\\&quot;:\\&quot;数据更新成功\\&quot;&#125;&quot;</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"meta\">@RequestMapping(&quot;/delete&quot;)</span></span><br><span class=\"line\"><span class=\"meta\">@ResponseBody</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">doDeleteRequest</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">&quot;&#123;\\&quot;message\\&quot;:\\&quot;数据删除成功\\&quot;&#125;&quot;</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>◇客户端调用,只写了delete请求的，其他的请求是一样的实现方式，只是请求类型不一样</p>\n<figure class=\"highlight html\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE <span class=\"meta-keyword\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span> <span class=\"attr\">lang</span>=<span class=\"string\">&quot;en&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">charset</span>=<span class=\"string\">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>RESTful实验室<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\"><span class=\"comment\">&lt;!--引入jquery--&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;jquery-3.3.1.min.js&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span><span class=\"javascript\"></span></span><br><span class=\"line\"><span class=\"javascript\">        $(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">            $(<span class=\"string\">&quot;#btnDelete&quot;</span>).click(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">                $.ajax(&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">                    <span class=\"attr\">url</span>:<span class=\"string\">&quot;/restful/delete&quot;</span>,</span></span><br><span class=\"line\"><span class=\"javascript\">                    <span class=\"attr\">type</span>:<span class=\"string\">&quot;delete&quot;</span>, <span class=\"comment\">//可以是GET|POST|PUT|DELETE</span></span></span><br><span class=\"line\"><span class=\"javascript\">                    <span class=\"attr\">dataType</span>:<span class=\"string\">&quot;json&quot;</span>,</span></span><br><span class=\"line\"><span class=\"javascript\">                    <span class=\"attr\">success</span>:<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">json</span>) </span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">                        $(<span class=\"string\">&quot;#message&quot;</span>).text(json.message);</span></span><br><span class=\"line\"><span class=\"javascript\">                    &#125;</span></span><br><span class=\"line\"><span class=\"javascript\">                &#125;)</span></span><br><span class=\"line\"><span class=\"javascript\">            &#125;)</span></span><br><span class=\"line\"><span class=\"javascript\">        &#125;)</span></span><br><span class=\"line\"><span class=\"javascript\">    </span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;button&quot;</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;btnDelete&quot;</span> <span class=\"attr\">value</span>=<span class=\"string\">&quot;发送Delete请求&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">h1</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;message&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">h1</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"RestController注解与路径变量\"><a href=\"#RestController注解与路径变量\" class=\"headerlink\" title=\"RestController注解与路径变量\"></a>RestController注解与路径变量</h2><p>◇上面的案例还有一些小问题，其一返回值我们使用的是字符串拼接完成的，如果是一个复杂对象或者大的集合就会显得很麻烦；那么如何优化JSON产生的过程呢？其二，在当前的应用中，我们每一个方法都固定写了 @ResponseBody这个注解来直接返回一个JSON字符串，那么有没有简单的方式，不用每一个方法上都进行这个注解呢；其三，在restful中允许uri出现id这样的数据，那么如何获取uri中像id这样的数据呢；<br>◇解决第二个问题，我们只需要将原来类上的@Controller注解改为@RestController，这样就不需要在每个方法上面都添加@ResponseBody了；<br>◇路劲变量即放在uri中的变量；如 POST /article/1 意思为提交id为1的文章，其中1就是一个变量称为路径变量；<br>现在我们要创建一个全新的请求request，假设请求的id值为100的话，那么uri书写的样式为：POST /restful/request/100，那在服务器端怎么接收到这个100呢？因为100并不是我们请求得参数，而是uri中的一部分，好在springmvc给我们提供了路径变量的支持，我们只需要给@GetMapping注解中的uri增加对应的路劲变量名字即可，需要用大括号括起来；如@GetMapping(<strong>“/request/{rid}”</strong>)；前面我们定义了路径前缀/restful；在程序中的接收方法为：在方法中根据rid的属性设置一个Integer数字类型的参数,并且在参数前增加路劲变量的注解，并将上面增加的路径变量名字rid放在注解中，<br>即方法写为：<strong>public <strong>String doPostRequest(@PathVariable(</strong>“rid”</strong>) Integer requestId)；<br>◇controller方法部分</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//Post /restful/request/100</span></span><br><span class=\"line\"><span class=\"meta\">@RequestMapping(&quot;/request/&#123;rid&#125;&quot;)</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">doPostRequest</span><span class=\"params\">(<span class=\"meta\">@PathVariable(&quot;rid&quot;)</span> Integer requestId)</span></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">&quot;&#123;\\&quot;message\\&quot;:\\&quot;数据新增成功\\&quot;,\\&quot;id\\&quot;:&quot;</span>+requestId+<span class=\"string\">&quot;&#125;&quot;</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>◇客户端请求部分</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">$(function()&#123;</span><br><span class=\"line\">    $(<span class=\"string\">&quot;#btnPost&quot;</span>).click(function () &#123;</span><br><span class=\"line\">        $.ajax(&#123;</span><br><span class=\"line\">            url:<span class=\"string\">&quot;/restful/request/100&quot;</span>,</span><br><span class=\"line\">            type:<span class=\"string\">&quot;post&quot;</span>,</span><br><span class=\"line\">            dataType:<span class=\"string\">&quot;json&quot;</span>,</span><br><span class=\"line\">            success:function (json) &#123;</span><br><span class=\"line\">                $(<span class=\"string\">&quot;#message&quot;</span>).text(json.message+<span class=\"string\">&quot;:&quot;</span>+json.id);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;)</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n<h2 id=\"简单请求与非简单请求\"><a href=\"#简单请求与非简单请求\" class=\"headerlink\" title=\"简单请求与非简单请求\"></a>简单请求与非简单请求</h2><h3 id=\"概念\"><a href=\"#概念\" class=\"headerlink\" title=\"概念\"></a>概念</h3><p>◇简单请求是指标准结构的HTTP请求,对应GET/POST请求<br>◇ 非简单请求是复杂要求的HTTP请求,指PUT/DELETE、扩展标准请求<br>◇ 两者最大区别是非简单请求发送前需要发送预检请求<br>◇非简单请求图示<br><img src=\"/p/cc19/1634353555066-a7e51ee4-b7a0-42f8-a3a0-cc0973f71136.png\" class=\"lazyload\" data-srcset=\"/p/cc19/1634353555066-a7e51ee4-b7a0-42f8-a3a0-cc0973f71136.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"><br>◇预检请求可以让服务器预先处理，对于不符合要求的请求就会挡在外头实际的数据并不会发送，这样就可以减轻网络传输和服务器的压力了；</p>\n<h3 id=\"代码演示\"><a href=\"#代码演示\" class=\"headerlink\" title=\"代码演示\"></a>代码演示</h3><p>◇我们在简单请求post和非简单请求put上各加一个数据data，在发送的请求中我们附加查询字符串：”name=lily&amp;age=23”,</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">data:<span class=\"string\">&quot;name=lily&amp;age=23&quot;</span>,</span><br></pre></td></tr></table></figure>\n<p>◇如果要接收一系列数据，最好新建一个实体对象；那么我们在实体包总成绩Person实体对象</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.lcg.restful.entity;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Person</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> String name;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> Integer age;</span><br><span class=\"line\">    ...</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>◇然后在控制器类中的post请求方法里增加实体对象的参数；</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//Post /restful/request/100</span></span><br><span class=\"line\">   <span class=\"meta\">@RequestMapping(&quot;/request/&#123;rid&#125;&quot;)</span></span><br><span class=\"line\">   <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">doPostRequest</span><span class=\"params\">(<span class=\"meta\">@PathVariable(&quot;rid&quot;)</span> Integer requestId, Person person)</span> </span>&#123;</span><br><span class=\"line\">       System.out.println(person.getName()+<span class=\"string\">&quot;:&quot;</span>+person.getAge());</span><br><span class=\"line\">       <span class=\"keyword\">return</span> <span class=\"string\">&quot;&#123;\\&quot;message\\&quot;:\\&quot;数据新增成功\\&quot;,\\&quot;id\\&quot;:&quot;</span> + requestId + <span class=\"string\">&quot;&#125;&quot;</span>;</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">   <span class=\"meta\">@RequestMapping(&quot;/put&quot;)</span></span><br><span class=\"line\">   <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">doPutRequest</span><span class=\"params\">(Person person)</span> </span>&#123;</span><br><span class=\"line\">       System.out.println(person.getName()+<span class=\"string\">&quot;:&quot;</span>+person.getAge());</span><br><span class=\"line\">       <span class=\"keyword\">return</span> <span class=\"string\">&quot;&#123;\\&quot;message\\&quot;:\\&quot;数据更新成功\\&quot;&#125;&quot;</span>;</span><br><span class=\"line\">   &#125;</span><br></pre></td></tr></table></figure>\n<p>◇但是，作为非简单请求的put，不能像post一样直接进行参数的增加；这是因为springmvc最早是为网页提供服务的，而网页中只支持post和get两个简单请求，对于put和delete这种特殊请求是不支持的；但随着技术的发展，springmvc需要考虑到这种特殊请求，作为springmvc不能把这种特殊请求方式和简单请求进行相同的处理，因此springmvc为这种特殊请求提供了额外的表单内容过滤器；具体实现为，打开web.xml配置表单内容过滤器</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">&lt;filter&gt;</span><br><span class=\"line\">        &lt;filter-name&gt;formContentFilter&lt;/filter-name&gt;</span><br><span class=\"line\">        &lt;filter-<span class=\"class\"><span class=\"keyword\">class</span>&gt;<span class=\"title\">org</span>.<span class=\"title\">springframework</span>.<span class=\"title\">web</span>.<span class=\"title\">filter</span>.<span class=\"title\">FormContentFilter</span>&lt;/<span class=\"title\">filter</span>-<span class=\"title\">class</span>&gt;</span></span><br><span class=\"line\"><span class=\"class\">    &lt;/<span class=\"title\">filter</span>&gt;</span></span><br><span class=\"line\"><span class=\"class\">    &lt;<span class=\"title\">filter</span>-<span class=\"title\">mapping</span>&gt;</span></span><br><span class=\"line\"><span class=\"class\">        &lt;<span class=\"title\">filter</span>-<span class=\"title\">name</span>&gt;<span class=\"title\">formContentFilter</span>&lt;/<span class=\"title\">filter</span>-<span class=\"title\">name</span>&gt;</span></span><br><span class=\"line\"><span class=\"class\">        &lt;<span class=\"title\">url</span>-<span class=\"title\">pattern</span>&gt;/*&lt;/<span class=\"title\">url</span>-<span class=\"title\">pattern</span>&gt;</span></span><br><span class=\"line\"><span class=\"class\">    &lt;/<span class=\"title\">filter</span>-<span class=\"title\">mapping</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>只有增加了这个filter，springmvc才能对put等特殊请求进行良好的支持；</p>\n<h2 id=\"JSON序列化\"><a href=\"#JSON序列化\" class=\"headerlink\" title=\"JSON序列化\"></a>JSON序列化</h2><p>◇Apache提供的maven<a href=\"https://search.maven.org/\">中央仓库地址</a>下载jackson-core，jackson的核心组件；jackson是世界上使用频率高，效率号的JSON序列化组件，其核心组件2.9以前的版本与mysql使用时会有漏洞，所以我们使用2.9版本以后的组件；<br>◇在pom.xml中增加jackson的依赖；</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!--jackson-core是最底层的核心包，不能独立运行--&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>jackson-core<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>2.9.9<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">        <span class=\"comment\">&lt;!--还需要引进databind(数据绑定,用以核心交互)</span></span><br><span class=\"line\"><span class=\"comment\">        和annotations(注解,用以简化开发)--&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>jackson-databind<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>2.9.9<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>jackson-annotations<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>2.9.9<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>◇当我们加载好jackson后，springmvc会自动利用其进行JSON的序列化，不需要额外的配置；<br>◇在控制器类中增加findByPersonId()方法示例JSON序列化的使用方法</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/*在这里返回的并非字符串或者ModelAndView，而是一个实体对象</span></span><br><span class=\"line\"><span class=\"comment\">    * 如果我们返回一个实体对象并且方法上设置为@ResponseBody或者类</span></span><br><span class=\"line\"><span class=\"comment\">    * 上设置了@RestController那么springmvc就会自动的使用jackson</span></span><br><span class=\"line\"><span class=\"comment\">    * 对这个对象进行JSON序列化的输出,从而避免了手动拼接字符串的麻烦*/</span></span><br><span class=\"line\">    <span class=\"meta\">@GetMapping(&quot;/person&quot;)</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> Person <span class=\"title\">findByPersonId</span><span class=\"params\">(Integer id)</span></span>&#123;</span><br><span class=\"line\">        Person p = <span class=\"keyword\">new</span> Person();</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (id == <span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">            p.setName(<span class=\"string\">&quot;莉莉&quot;</span>);</span><br><span class=\"line\">            p.setAge(<span class=\"number\">22</span>);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (id == <span class=\"number\">2</span>) &#123;</span><br><span class=\"line\">            p.setName(<span class=\"string\">&quot;张珊&quot;</span>);</span><br><span class=\"line\">            p.setAge(<span class=\"number\">20</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> p;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/*返回多个对象,当程序返回以后，list集合就会产生一个JSON数组，包含每一个</span></span><br><span class=\"line\"><span class=\"comment\">JSON序列化后的对象*/</span></span><br><span class=\"line\">    <span class=\"meta\">@GetMapping(&quot;/persons&quot;)</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> List&lt;Person&gt; <span class=\"title\">findPersons</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">        List list = <span class=\"keyword\">new</span> ArrayList();</span><br><span class=\"line\">        Person p1=<span class=\"keyword\">new</span> Person();</span><br><span class=\"line\">        p1.setName(<span class=\"string\">&quot;lily&quot;</span>);</span><br><span class=\"line\">        p1.setAge(<span class=\"number\">22</span>);</span><br><span class=\"line\">        Person p2=<span class=\"keyword\">new</span> Person();</span><br><span class=\"line\">        p2.setName(<span class=\"string\">&quot;leon&quot;</span>);</span><br><span class=\"line\">        p2.setAge(<span class=\"number\">23</span>);</span><br><span class=\"line\">        list.add(p1);</span><br><span class=\"line\">        list.add(p2);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> list;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n<p>◇启动后浏览器输入<a href=\"http://localhost:8080/restful/person?id=1%EF%BC%8C%E9%A1%B5%E9%9D%A2%E6%98%BE%E7%A4%BAJSON%E5%AD%97%E7%AC%A6%E4%B8%B2%EF%BC%9A%7B&quot;name&quot;:&quot;%E8%8E%89%E8%8E%89&quot;,&quot;age&quot;:22%7D\">http://localhost:8080/restful/person?id=1，页面显示JSON字符串：{&quot;name&quot;:&quot;莉莉&quot;,&quot;age&quot;:22}</a><br>输入<a href=\"http://localhost:8080/restful/persons%EF%BC%8C%E6%98%BE%E7%A4%BAJSON%E6%95%B0%E7%BB%84%EF%BC%9A[%7B&quot;name&quot;:&quot;lily&quot;,&quot;age&quot;:22%7D,%7B&quot;name&quot;:&quot;leon&quot;,&quot;age&quot;:23%7D]\">http://localhost:8080/restful/persons，显示JSON数组：[{&quot;name&quot;:&quot;lily&quot;,&quot;age&quot;:22},{&quot;name&quot;:&quot;leon&quot;,&quot;age&quot;:23}]</a><br>◇在客户端显示JSON对象数组；</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/*查询所有人员的函数*/</span></span><br><span class=\"line\">       $(function () &#123;</span><br><span class=\"line\">           $(<span class=\"string\">&quot;#btnPersons&quot;</span>).click(function () &#123;</span><br><span class=\"line\">               $.ajax(&#123;</span><br><span class=\"line\">                   url:<span class=\"string\">&quot;/restful/persons&quot;</span>,</span><br><span class=\"line\">                   type:<span class=\"string\">&quot;get&quot;</span>,</span><br><span class=\"line\">                   dataType:<span class=\"string\">&quot;json&quot;</span>,</span><br><span class=\"line\">                   success: function (json) &#123;</span><br><span class=\"line\">                       console.info(json);<span class=\"comment\">/*浏览器的控制台打印json信息*/</span></span><br><span class=\"line\">                       <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i = <span class=\"number\">0</span>; i &lt; json.length; i++) &#123;</span><br><span class=\"line\">                           <span class=\"keyword\">var</span> p = json[i];</span><br><span class=\"line\">                           $(<span class=\"string\">&quot;#divPersons&quot;</span>).append(<span class=\"string\">&quot;&lt;h2&quot;</span>+p.name+<span class=\"string\">&quot;-&quot;</span>+p.age+<span class=\"string\">&quot;h2&gt;&quot;</span>)</span><br><span class=\"line\">                       &#125;</span><br><span class=\"line\">                   &#125;</span><br><span class=\"line\">               &#125;)</span><br><span class=\"line\">           &#125;)</span><br><span class=\"line\">       &#125;)</span><br><span class=\"line\">           </span><br><span class=\"line\">   &lt;input type=<span class=\"string\">&quot;button&quot;</span> id=<span class=\"string\">&quot;btnPersons&quot;</span> value=<span class=\"string\">&quot;查询所有人员&quot;</span>&gt;</span><br><span class=\"line\">   &lt;!--将查询的人员放入下面的div中--&gt;</span><br><span class=\"line\">   &lt;div id=<span class=\"string\">&quot;divPersons&quot;</span>&gt;&lt;/div&gt;</span><br></pre></td></tr></table></figure>\n<p>◇但是在时间处理上jackson做得并不理想；在Person中额外的增加日期属性birthday;并将人员的birthday设置为当前时间以便于演示；<br>◇通过JSON对时间类型进行输出的时候，得到的是一串很长的数字，这个数字是从1970年到现在为止的毫秒数，而非具体的时间；因此jackson提供了内置的格式化注解@JsonFormat，可以将时间按指定格式进行输出；将该注解写在类的时间类型属性上；</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">private</span> Integer age;</span><br><span class=\"line\"><span class=\"meta\">@JsonFormat(pattern =&quot;yyy-MM-dd HH:mm:ss&quot;)</span></span><br><span class=\"line\"><span class=\"keyword\">private</span> Date birthday;</span><br></pre></td></tr></table></figure>\n<p>但这样又会出现问题，会发现时间与我们的正确时间不一致，相差了8个小时；因为jackson在对对象序列化的时候，对日期类型会按照伦敦天文台的时区作为起点，而北京时间和伦敦差了八个时区；具体的做法还需要修改注解，我们额外的增加timezone=”GMT+8”,即增加了八个时区，修改为@JsonFormat(pattern =<strong>“yyy-MM-dd HH:mm:ss”</strong>,timezone = <strong>“GMT+8”</strong>)；</p>\n<h2 id=\"浏览器的跨域访问\"><a href=\"#浏览器的跨域访问\" class=\"headerlink\" title=\"浏览器的跨域访问\"></a>浏览器的跨域访问</h2><h3 id=\"浏览器的同源策略\"><a href=\"#浏览器的同源策略\" class=\"headerlink\" title=\"浏览器的同源策略\"></a>浏览器的同源策略</h3><p>◇同源策略阻止从一个域加载的脚本去获取另一个域上的资源;即如果我们把client.html文件下载到桌面再用浏览器打开的话，就相当于一个域了(C:/Desktop/client.html)，所以无法访问原来的资源；<br>◇只要协议、域名、端口有任何一个不同，都被当作是不同的域<br>◇那么如何进行跨域访问呢？浏览器Console看到Access-Control-Allow-Origin就代表跨域了</p>\n<h3 id=\"同源策略示例\"><a href=\"#同源策略示例\" class=\"headerlink\" title=\"同源策略示例\"></a>同源策略示例</h3><p><img src=\"/p/cc19/1634385595364-3599ac60-4094-4cd2-aa8a-59d5b7a3744b.png\" class=\"lazyload\" data-srcset=\"/p/cc19/1634385595364-3599ac60-4094-4cd2-aa8a-59d5b7a3744b.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"><br>◇第一个，域名、端口、协议都不同；第二个协议不同；第三个域名不同；第四个端口不同(默认网站端口为80)；第五个在本机测试的时候，localhost和127.0.0.1虽然从系统的层面上都指向了本机，但它们却是不同的域；</p>\n<h3 id=\"HTML中允许跨域的标签\"><a href=\"#HTML中允许跨域的标签\" class=\"headerlink\" title=\"HTML中允许跨域的标签\"></a>HTML中允许跨域的标签</h3><p>◇&lt;img&gt;  - 显示远程图片<br>◇&lt;script&gt; - 加载远程js<br>◇&lt;link&gt;    - 加载远程css</p>\n<h2 id=\"SpringMVC跨域访问\"><a href=\"#SpringMVC跨域访问\" class=\"headerlink\" title=\"SpringMVC跨域访问\"></a>SpringMVC跨域访问</h2><h3 id=\"CORS跨域资源访问\"><a href=\"#CORS跨域资源访问\" class=\"headerlink\" title=\"CORS跨域资源访问\"></a>CORS跨域资源访问</h3><p>◇CORS是一种机制,使用额外的HTTP头通知浏览器可以访问其他域<br>◇URL响应头包含 Access-Control-*指明请求允许跨域  </p>\n<h3 id=\"解决跨域访问的方法\"><a href=\"#解决跨域访问的方法\" class=\"headerlink\" title=\"解决跨域访问的方法\"></a>解决跨域访问的方法</h3><p>◇ @CrossOrigin－ Controller跨域注解  ，只是在当前controller中生效<br>◇ <a href=\"mvc:cors\">mvc:cors</a> - Spring MVC全局跨域配置<br>◇在服务器的提供端(也就是接收请求的端)配置跨域;</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//方法一</span></span><br><span class=\"line\"><span class=\"comment\">//origins说明允许被哪些其他域名访问,可以写多个,也可以使用*表示所有域都可以进行访问,但不推荐</span></span><br><span class=\"line\"><span class=\"comment\">/*@CrossOrigin(origins = &quot;*&quot;,maxAge = 3600)maxAge表示设置预检请求的缓存时间为3600秒</span></span><br><span class=\"line\"><span class=\"comment\">maxAge参数说明我们可以将预检请求的处理结果进行缓存;如果在指定的缓存时间内，同样的请求在进行</span></span><br><span class=\"line\"><span class=\"comment\">访问就可以不用再进行预检请求了;</span></span><br><span class=\"line\"><span class=\"comment\">*/</span></span><br><span class=\"line\"><span class=\"meta\">@CrossOrigin(origins = &#123;&quot;http://localhost:8080&quot;&#125;)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">RestfulController</span> </span>&#123;</span><br><span class=\"line\">....</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>◇当我们查看Request Headers（请求头）时，会看到Sec-Fetch-Mode:cors 表明这是一个跨域访问；</p>\n<h3 id=\"CORS全局配置\"><a href=\"#CORS全局配置\" class=\"headerlink\" title=\"CORS全局配置\"></a>CORS全局配置</h3><p>◇打开applicationContext.xml配置文件进行设置；</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">mvc:cors</span>&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!--子标签mvc：mapping 映射</span></span><br><span class=\"line\"><span class=\"comment\">    path对应了当前应用的url地址;</span></span><br><span class=\"line\"><span class=\"comment\">    allowed-origins表示允许被哪些域名进行访问,可以进行多个域名的书写</span></span><br><span class=\"line\"><span class=\"comment\">    max-age预检请求处理结果的缓存时间</span></span><br><span class=\"line\"><span class=\"comment\">    --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">mvc:mapping</span> <span class=\"attr\">path</span>=<span class=\"string\">&quot;/restful/**&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">                 <span class=\"attr\">allowed-origins</span>=<span class=\"string\">&quot;http://localhost:8080,http://www.gamest.com&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">                 <span class=\"attr\">max-age</span>=<span class=\"string\">&quot;3600&quot;</span>/&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">mvc:cors</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n","categories":["Spring","SpringMVC基础"],"tags":["开发"]},{"title":"Redis入门","url":"/p/d40.html","content":"<h2 id=\"课程介绍\"><a href=\"#课程介绍\" class=\"headerlink\" title=\"课程介绍\"></a>课程介绍</h2><p>◇Redis介绍与安装<br>◇掌握在Java中操作Redis<br>◇掌握Redis的常用命令与数据类型  </p>\n<h2 id=\"Redis介绍\"><a href=\"#Redis介绍\" class=\"headerlink\" title=\"Redis介绍\"></a>Redis介绍</h2><p>◇Redis是Key-Value型NoSQL数据库 ,即每一个数据都有键和值；<br>◇Redis将数据存储在内存中，同时也能持久化到磁盘<br>◇Redis常用于缓存，利用内存的高效提高程序的处理速度  </p>\n<h2 id=\"Redis特点\"><a href=\"#Redis特点\" class=\"headerlink\" title=\"Redis特点\"></a>Redis特点</h2><p>◇ 速度快              ◇ 广泛的语言支持<br>◇ 持久化              ◇ 多种数据结构<br>◇ 主从复制           ◇ 分布式与高可用 </p>\n<h2 id=\"Redis的安装与启动\"><a href=\"#Redis的安装与启动\" class=\"headerlink\" title=\"Redis的安装与启动\"></a>Redis的安装与启动</h2><h3 id=\"在Linux系统中安装Redis\"><a href=\"#在Linux系统中安装Redis\" class=\"headerlink\" title=\"在Linux系统中安装Redis\"></a>在Linux系统中安装Redis</h3><p>◇进入<a href=\"https://redis.io/\">redis官网</a><br>◇创建redis目录，安装gcc用于make编译<br>◇安装命令</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">$ wget https://download.redis.io/releases/redis-5.0.2.tar.gz</span><br><span class=\"line\">$ tar xzf redis-5.0.2.tar.gz</span><br><span class=\"line\">$ cd redis-5.0.2</span><br><span class=\"line\">$ make</span><br></pre></td></tr></table></figure>\n<p>◇启动redis: 在src目录中redis-server开启服务器；redis-cli进行客户端连接；<br>◇[root@master redis-5.0.2]# ./src/redis-server redis.conf #启动命令</p>\n<h3 id=\"在Windows系统中安装Redis\"><a href=\"#在Windows系统中安装Redis\" class=\"headerlink\" title=\"在Windows系统中安装Redis\"></a>在Windows系统中安装Redis</h3><p>◇进入github<a href=\"https://github.com/MicrosoftArchive/redis\">下载</a><br>◇点击releases，下载zip文件进行解压<br>◇在终端(cmd)进入解压目录中，dir查看文件；<br>◇安装命令：redis-server  redis.windows.conf<br>◇由于Windows的版本过旧，仅做学习使用；</p>\n<h2 id=\"Redis的常用基本配置\"><a href=\"#Redis的常用基本配置\" class=\"headerlink\" title=\"Redis的常用基本配置\"></a>Redis的常用基本配置</h2><p><img src=\"/p/d40/1630301413623-fa8ca9d5-879a-45c2-9331-146cbba40f2f.png\" class=\"lazyload\" data-srcset=\"/p/d40/1630301413623-fa8ca9d5-879a-45c2-9331-146cbba40f2f.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"><br>◇编辑redis.conf（配置文件）定位到136行，有一个daemonize（是否后台运行，守护进程)，改为yes即可进行守护；这样启动后，不会出现redis的logo并且启动会只要虚拟机运行，则redis一直提供服务；netstat -tulpn#查看系统占用的端口，进而查看redis是否运行；若要关闭redis，可以杀死进程或者利用客户端关闭；<br>◇redis-cli即redis客户端，用来执行redis指令；进入方法：./src/redis-cli 退出命令：exit<br>◇在客户端使用命令:ping 若出现PONG 则说明redis正常运行；关闭redis进程：./src/redis-cli shutdown<br>◇在redis.conf文件可以使用vim命令修改相关配置；<br>◇修改redis端口后需要指定端口进行连接， ./src/redis-cli -p 6380 #指定6380端口进行连接<br>◇redis的数据库名字为数字0~15；如果觉得数据库数量不够用，可以在配置文件中设置，在大概186行出的databases进行修改;<br>◇在配置文件的507行有个#requirepass foobared,说明默认密码是foobared，将注释取消，修改为12345。这样在使用redis时需要使用密码了。在启动后，输入命令：auth 12345即可<br>◇在263行，有dir ./即数据的保存目录；dump.rdb就是redis的全量备份。</p>\n<h2 id=\"Redis通用命令\"><a href=\"#Redis通用命令\" class=\"headerlink\" title=\"Redis通用命令\"></a>Redis通用命令</h2><p><img src=\"/p/d40/1630301443965-582fbcdb-70a6-42ef-8a1b-d04ef40c75fe.png\" class=\"lazyload\" data-srcset=\"/p/d40/1630301443965-582fbcdb-70a6-42ef-8a1b-d04ef40c75fe.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"><br>◇示例</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">./src/redis-cli -p 6379 #连接客户端</span><br><span class=\"line\">auth 12345 #输入密码</span><br><span class=\"line\">select 0 #选择0号数据库</span><br><span class=\"line\">set name lily #在当前数据库中增加一个key=name,value=lily的数据</span><br><span class=\"line\">get name #获取数据</span><br><span class=\"line\">set name lee #会将前面的数据覆盖掉</span><br><span class=\"line\">keys * #查询所有的key</span><br><span class=\"line\">dbsize #显示当前数据库的数据总量</span><br><span class=\"line\">del name #删除name这个key</span><br></pre></td></tr></table></figure>\n<h2 id=\"Redis数据类型\"><a href=\"#Redis数据类型\" class=\"headerlink\" title=\"Redis数据类型\"></a>Redis数据类型</h2><p>◇ String - 字符串类型     ◇ Hash - Hash类型<br>◇ List - 列表类型             ◇ Set - 集合类型<br>◇ Zset - 有序集合类型  </p>\n<h2 id=\"String-字符串类型\"><a href=\"#String-字符串类型\" class=\"headerlink\" title=\"String 字符串类型\"></a>String 字符串类型</h2><p><img src=\"/p/d40/1630301541873-e169dfb8-2a11-44db-b001-d364dad29ec1.png\" class=\"lazyload\" data-srcset=\"/p/d40/1630301541873-e169dfb8-2a11-44db-b001-d364dad29ec1.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"></p>\n<h2 id=\"字符串命令\"><a href=\"#字符串命令\" class=\"headerlink\" title=\"字符串命令\"></a>字符串命令</h2><p><img src=\"/p/d40/1630301585498-ea031812-7b93-44fb-bf1f-d358bd0e47b2.png\" class=\"lazyload\" data-srcset=\"/p/d40/1630301585498-ea031812-7b93-44fb-bf1f-d358bd0e47b2.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"></p>\n<h2 id=\"Hash键值类型\"><a href=\"#Hash键值类型\" class=\"headerlink\" title=\"Hash键值类型\"></a>Hash键值类型</h2><p>◇Hash类型用于存储结构化数据<br><img src=\"/p/d40/1630301642145-939a3186-55d0-47e9-a6fc-7c83e0178a14.png\" class=\"lazyload\" data-srcset=\"/p/d40/1630301642145-939a3186-55d0-47e9-a6fc-7c83e0178a14.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"></p>\n<h2 id=\"Hash-命令\"><a href=\"#Hash-命令\" class=\"headerlink\" title=\"Hash 命令\"></a>Hash 命令</h2><p><img src=\"/p/d40/1630301692289-f55f142a-ad1a-4e01-bf37-bf1c9d1b3503.png\" class=\"lazyload\" data-srcset=\"/p/d40/1630301692289-f55f142a-ad1a-4e01-bf37-bf1c9d1b3503.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"></p>\n<h2 id=\"List列表类型\"><a href=\"#List列表类型\" class=\"headerlink\" title=\"List列表类型\"></a>List列表类型</h2><p>◇List列表就是一系列字符串的“数组”，按插入顺序排序<br>◇List列表最大长度为2的32次方-1，可以包含40亿个元素  </p>\n<h2 id=\"List-命令\"><a href=\"#List-命令\" class=\"headerlink\" title=\"List 命令\"></a>List 命令</h2><p>◇rpush listkey c b a - 右侧插入<br>◇lpush listkey f e d - 左侧插入<br>◇ d e f c b a<br>◇rpop listkey - 右侧弹出<br>◇lpop listkey - 左侧弹出  </p>\n<h2 id=\"List-指令\"><a href=\"#List-指令\" class=\"headerlink\" title=\"List 指令\"></a>List 指令</h2><p>◇llen listkey - 获取长度<br>◇lrange listkey 0 2<br>◇lrange listkey 1 -1 获取子集  </p>\n<h2 id=\"Set与Zset集合类型\"><a href=\"#Set与Zset集合类型\" class=\"headerlink\" title=\"Set与Zset集合类型\"></a>Set与Zset集合类型</h2><p>◇Set集合是字符串的无序集合，集合成员是唯一的<br>◇Zset集合是字符串的有序集合，集合成员是唯一的  </p>\n<h2 id=\"Java客户端-Jedis\"><a href=\"#Java客户端-Jedis\" class=\"headerlink\" title=\"Java客户端-Jedis\"></a>Java客户端-Jedis</h2><p>◇Jedis是Java语言开发的Redis客户端工具包<br>◇Jedis只是对Redis命令的封装,掌握Redis命令便可轻易上手  </p>\n<h3 id=\"Jedis使用演示\"><a href=\"#Jedis使用演示\" class=\"headerlink\" title=\"Jedis使用演示\"></a>Jedis使用演示</h3><p>◇编辑配置文件redis.conf，在88行处：protected-mode yes #是否开启保护模式，设置为no关闭，允许其他ip主机连接进来<br>◇在69行处bind 127.0.0.1改为0.0.0.0表示任意ip主机都可以访问进来；<br>◇设置防火墙放行6379端口：firewall-cmd –zone=public –add-port=6379/tcp –permanent; firewall-cmd –reload#重载<br>◇查看redis服务器的IP地址<br>◇Windows上<a href=\"https://github.com/redis/jedis\">下载jedis</a><br>◇利用maven进行下载</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>redis.clients<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>jedis<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>2.9.0<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"在IDEA中创建maven工程\"><a href=\"#在IDEA中创建maven工程\" class=\"headerlink\" title=\"在IDEA中创建maven工程\"></a>在IDEA中创建maven工程</h3><p>◇JedisTestor</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">JedisTestor</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> </span>&#123;</span><br><span class=\"line\">        Jedis jedis = <span class=\"keyword\">new</span> Jedis(<span class=\"string\">&quot;192.168.132.144&quot;</span> , <span class=\"number\">6379</span>);<span class=\"comment\">//虚拟机IP地址，redis服务器端口号</span></span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            jedis.auth(<span class=\"string\">&quot;12345&quot;</span>);<span class=\"comment\">//输入密码</span></span><br><span class=\"line\">            jedis.select(<span class=\"number\">2</span>);</span><br><span class=\"line\">            System.out.println(<span class=\"string\">&quot;Redis连接成功&quot;</span>);</span><br><span class=\"line\">            <span class=\"comment\">//字符串</span></span><br><span class=\"line\">            jedis.set(<span class=\"string\">&quot;sn&quot;</span> , <span class=\"string\">&quot;7781-9938&quot;</span>);</span><br><span class=\"line\">            String sn = jedis.get(<span class=\"string\">&quot;sn&quot;</span>);</span><br><span class=\"line\">            System.out.println(sn);</span><br><span class=\"line\">            jedis.mset(<span class=\"keyword\">new</span> String[]&#123;<span class=\"string\">&quot;title&quot;</span> , <span class=\"string\">&quot;婴幼儿奶粉&quot;</span> , <span class=\"string\">&quot;num&quot;</span> , <span class=\"string\">&quot;20&quot;</span>&#125;);</span><br><span class=\"line\">            List&lt;String&gt; goods =  jedis.mget(<span class=\"keyword\">new</span> String[]&#123;<span class=\"string\">&quot;sn&quot;</span> , <span class=\"string\">&quot;title&quot;</span> , <span class=\"string\">&quot;num&quot;</span>&#125;);</span><br><span class=\"line\">            System.out.println(goods);</span><br><span class=\"line\">            Long num = jedis.incr(<span class=\"string\">&quot;num&quot;</span>);</span><br><span class=\"line\">            System.out.println(num);</span><br><span class=\"line\">            <span class=\"comment\">//Hash</span></span><br><span class=\"line\">            jedis.hset(<span class=\"string\">&quot;student:3312&quot;</span> , <span class=\"string\">&quot;name&quot;</span> , <span class=\"string\">&quot;张晓明&quot;</span>);</span><br><span class=\"line\">            String name = jedis.hget(<span class=\"string\">&quot;student:3312&quot;</span> , <span class=\"string\">&quot;name&quot;</span>);</span><br><span class=\"line\">            System.out.println(name);</span><br><span class=\"line\">            Map&lt;String,String&gt; studentMap = <span class=\"keyword\">new</span> HashMap();</span><br><span class=\"line\">            studentMap.put(<span class=\"string\">&quot;name&quot;</span>, <span class=\"string\">&quot;李兰&quot;</span>);</span><br><span class=\"line\">            studentMap.put(<span class=\"string\">&quot;age&quot;</span>, <span class=\"string\">&quot;18&quot;</span>);</span><br><span class=\"line\">            studentMap.put(<span class=\"string\">&quot;id&quot;</span>, <span class=\"string\">&quot;3313&quot;</span>);</span><br><span class=\"line\">            jedis.hmset(<span class=\"string\">&quot;student:3313&quot;</span>, studentMap);</span><br><span class=\"line\">            Map&lt;String,String&gt; smap =  jedis.hgetAll(<span class=\"string\">&quot;student:3313&quot;</span>);</span><br><span class=\"line\">            System.out.println(smap);</span><br><span class=\"line\">            <span class=\"comment\">//List</span></span><br><span class=\"line\">            jedis.del(<span class=\"string\">&quot;letter&quot;</span>); <span class=\"comment\">//将letter列表删除,否则后面会依次叠加</span></span><br><span class=\"line\">            jedis.rpush(<span class=\"string\">&quot;letter&quot;</span> , <span class=\"keyword\">new</span> String[]&#123;<span class=\"string\">&quot;d&quot;</span> , <span class=\"string\">&quot;e&quot;</span> , <span class=\"string\">&quot;f&quot;</span>&#125;);</span><br><span class=\"line\">            jedis.lpush(<span class=\"string\">&quot;letter&quot;</span> ,  <span class=\"keyword\">new</span> String[]&#123;<span class=\"string\">&quot;c&quot;</span> , <span class=\"string\">&quot;b&quot;</span> , <span class=\"string\">&quot;a&quot;</span>&#125;);</span><br><span class=\"line\">            List&lt;String&gt; letter =  jedis.lrange(<span class=\"string\">&quot;letter&quot;</span> , <span class=\"number\">0</span> , -<span class=\"number\">1</span>);</span><br><span class=\"line\">            jedis.lpop(<span class=\"string\">&quot;letter&quot;</span>);</span><br><span class=\"line\">            jedis.rpop(<span class=\"string\">&quot;letter&quot;</span>);</span><br><span class=\"line\">            letter = jedis.lrange(<span class=\"string\">&quot;letter&quot;</span>, <span class=\"number\">0</span>, -<span class=\"number\">1</span>);</span><br><span class=\"line\">            System.out.println(letter);</span><br><span class=\"line\">        &#125;<span class=\"keyword\">catch</span>(Exception e)&#123;</span><br><span class=\"line\">            e.printStackTrace();</span><br><span class=\"line\">        &#125;<span class=\"keyword\">finally</span> &#123;</span><br><span class=\"line\">            jedis.close();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"利用Jedis缓存数据\"><a href=\"#利用Jedis缓存数据\" class=\"headerlink\" title=\"利用Jedis缓存数据\"></a>利用Jedis缓存数据</h3><p>◇创建实体类Good</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Goods</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> Integer goodsId;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> String goodsName;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> String description;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> Float price;</span><br><span class=\"line\">    ...</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>◇创建缓存示例类</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">CacheSample</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">CacheSample</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">        Jedis jedis = <span class=\"keyword\">new</span> Jedis(<span class=\"string\">&quot;192.168.132.144&quot;</span>);</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            List&lt;Goods&gt; goodsList = <span class=\"keyword\">new</span> ArrayList&lt;Goods&gt;();</span><br><span class=\"line\">            <span class=\"comment\">//初始化模拟数据</span></span><br><span class=\"line\">            goodsList.add(<span class=\"keyword\">new</span> Goods(<span class=\"number\">8818</span>, <span class=\"string\">&quot;红富士苹果&quot;</span>, <span class=\"string\">&quot;&quot;</span>, <span class=\"number\">3.5f</span>));</span><br><span class=\"line\">            goodsList.add(<span class=\"keyword\">new</span> Goods(<span class=\"number\">8819</span>, <span class=\"string\">&quot;进口脐橙&quot;</span>, <span class=\"string\">&quot;&quot;</span>, <span class=\"number\">5f</span>));</span><br><span class=\"line\">            goodsList.add(<span class=\"keyword\">new</span> Goods(<span class=\"number\">8820</span>, <span class=\"string\">&quot;进口香蕉&quot;</span>, <span class=\"string\">&quot;&quot;</span>, <span class=\"number\">25f</span>));</span><br><span class=\"line\">            jedis.auth(<span class=\"string\">&quot;12345&quot;</span>);</span><br><span class=\"line\">            jedis.select(<span class=\"number\">3</span>);<span class=\"comment\">//选择redis的三号数据库</span></span><br><span class=\"line\">            <span class=\"comment\">//将每一个二进制存储的java对象序列化为json字符串以便redis存储</span></span><br><span class=\"line\">            <span class=\"keyword\">for</span> (Goods goods : goodsList) &#123;</span><br><span class=\"line\">                String json = JSON.toJSONString(goods);</span><br><span class=\"line\">                System.out.println(json);</span><br><span class=\"line\">                String key = <span class=\"string\">&quot;goods:&quot;</span> + goods.getGoodsId();</span><br><span class=\"line\">                jedis.set(key , json);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</span><br><span class=\"line\">            e.printStackTrace();</span><br><span class=\"line\">        &#125;<span class=\"keyword\">finally</span> &#123;</span><br><span class=\"line\">            jedis.close();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">new</span> CacheSample();</span><br><span class=\"line\">        System.out.printf(<span class=\"string\">&quot;请输入要查询的商品编号：&quot;</span>);</span><br><span class=\"line\">        String goodsId = <span class=\"keyword\">new</span> Scanner(System.in).next();</span><br><span class=\"line\">        Jedis jedis = <span class=\"keyword\">new</span> Jedis(<span class=\"string\">&quot;192.168.132.144&quot;</span>);</span><br><span class=\"line\">        <span class=\"keyword\">try</span>&#123;</span><br><span class=\"line\">            jedis.auth(<span class=\"string\">&quot;12345&quot;</span>);</span><br><span class=\"line\">            jedis.select(<span class=\"number\">3</span>);</span><br><span class=\"line\">            String key = <span class=\"string\">&quot;goods:&quot;</span> + goodsId;</span><br><span class=\"line\">            <span class=\"keyword\">if</span>(jedis.exists(key))&#123;</span><br><span class=\"line\">                String json = jedis.get(key);</span><br><span class=\"line\">                System.out.println(json);</span><br><span class=\"line\">                <span class=\"comment\">//json字符串转换为java对象</span></span><br><span class=\"line\">                Goods g = JSON.parseObject(json, Goods.class);</span><br><span class=\"line\">                System.out.println(g.getGoodsName());</span><br><span class=\"line\">                System.out.println(g.getPrice());</span><br><span class=\"line\">            &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">                System.out.println(<span class=\"string\">&quot;您输入的商品编号不存在，请重新输入！&quot;</span>);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;<span class=\"keyword\">catch</span>(Exception e)&#123;</span><br><span class=\"line\">            e.printStackTrace();</span><br><span class=\"line\">        &#125;<span class=\"keyword\">finally</span> &#123;</span><br><span class=\"line\">            jedis.close();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n","categories":["Java数据库","Linux与Redis基础"],"tags":["Redis"]},{"title":"SQL简介","url":"/p/a804.html","content":"<h2 id=\"学习目标\"><a href=\"#学习目标\" class=\"headerlink\" title=\"学习目标\"></a>学习目标</h2><p>◇ 管理逻辑库和数据表</p>\n<ul>\n<li>创建、删除、修改逻辑库和数据表<br>◇ 了解常用的数据类型和约束  </li>\n<li>字符串、整数、浮点数、精确数字、日期、枚举。主键约束、非空 约束、唯一约束、外键约束等<br>◇ 掌握索引运行机制和使用原则  </li>\n<li>排序为什么可以提高数据检索速度？怎么创建和删除索引？什么条 件下使用索引？  <h2 id=\"什么是SQL语言-？\"><a href=\"#什么是SQL语言-？\" class=\"headerlink\" title=\"什么是SQL语言 ？\"></a>什么是SQL语言 ？</h2>◇ SQL 是用于访问和处理数据的标准的计算机语言<br><img src=\"/p/a804/1625838154950-b6a31bc1-f93a-4483-a4bc-a7499a1c4669.png\" class=\"lazyload\" data-srcset=\"/p/a804/1625838154950-b6a31bc1-f93a-4483-a4bc-a7499a1c4669.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"></li>\n</ul>\n<h3 id=\"SQL语言分类\"><a href=\"#SQL语言分类\" class=\"headerlink\" title=\"SQL语言分类\"></a>SQL语言分类</h3><p><img src=\"/p/a804/1625838195563-598330f3-eee6-49ab-b74d-d55f33493ae0.png\" class=\"lazyload\" data-srcset=\"/p/a804/1625838195563-598330f3-eee6-49ab-b74d-d55f33493ae0.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"></p>\n<h3 id=\"SQL语句注意事项\"><a href=\"#SQL语句注意事项\" class=\"headerlink\" title=\"SQL语句注意事项\"></a>SQL语句注意事项</h3><p>◇ SQL语句不区分大小写，但是字符串区分大小写<br>◇ SQL语句必须以分号结尾<br>◇ SQL语句中的空白和换行没有限制，但是不能破坏语法 </p>\n<h3 id=\"SQL语句的注释\"><a href=\"#SQL语句的注释\" class=\"headerlink\" title=\"SQL语句的注释\"></a>SQL语句的注释</h3><p>◇ SQL语句的注释有两种，分别如下：<br> #这是一段注释<br>/<em>这是另一段注释</em>/</p>\n<h2 id=\"创建逻辑库\"><a href=\"#创建逻辑库\" class=\"headerlink\" title=\"创建逻辑库\"></a>创建逻辑库</h2><p><img src=\"/p/a804/1625838421553-d4761883-6cd5-47ea-bed3-1e2d07e73537.png\" class=\"lazyload\" data-srcset=\"/p/a804/1625838421553-d4761883-6cd5-47ea-bed3-1e2d07e73537.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"></p>\n<h2 id=\"创建数据表\"><a href=\"#创建数据表\" class=\"headerlink\" title=\"创建数据表\"></a>创建数据表</h2><figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">CREATE</span> <span class=\"keyword\">TABLE</span> 数据表 (</span><br><span class=\"line\">列名<span class=\"number\">1</span> 数据类型 [ 约束 ] [COMMENT 注释] ,</span><br><span class=\"line\">列名<span class=\"number\">2</span> 数据类型 [ 约束 ] [COMMENT 注释] , ……</span><br><span class=\"line\">) [ COMMENT <span class=\"operator\">=</span> 注释 ] ;</span><br><span class=\"line\"><span class=\"keyword\">DROP</span> <span class=\"keyword\">TABLE</span> 数据表 ;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">CREATE</span> <span class=\"keyword\">TABLE</span> student (</span><br><span class=\"line\">id <span class=\"type\">INT</span> UNSIGNED <span class=\"keyword\">PRIMARY</span> KEY ,</span><br><span class=\"line\">name <span class=\"type\">VARCHAR</span>(<span class=\"number\">20</span>) <span class=\"keyword\">NOT</span> <span class=\"keyword\">NULL</span> , sex <span class=\"type\">CHAR</span>(<span class=\"number\">1</span>) <span class=\"keyword\">NOT</span> <span class=\"keyword\">NULL</span> ,</span><br><span class=\"line\">birthday <span class=\"type\">DATE</span> <span class=\"keyword\">NOT</span> <span class=\"keyword\">NULL</span> ,</span><br><span class=\"line\">tel <span class=\"type\">CHAR</span>(<span class=\"number\">11</span>) <span class=\"keyword\">NOT</span> <span class=\"keyword\">NULL</span> ,</span><br><span class=\"line\">remark <span class=\"type\">VARCHAR</span>(<span class=\"number\">200</span>)</span><br><span class=\"line\">);</span><br></pre></td></tr></table></figure>\n<h2 id=\"数据表的其他操作\"><a href=\"#数据表的其他操作\" class=\"headerlink\" title=\"数据表的其他操作\"></a>数据表的其他操作</h2><figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">SHOW</span> tables ;</span><br><span class=\"line\"><span class=\"keyword\">DESC</span> student ;   <span class=\"operator\">/</span><span class=\"operator\">/</span>查看表的结构</span><br><span class=\"line\"><span class=\"keyword\">SHOW</span> <span class=\"keyword\">CREATE</span> <span class=\"keyword\">TABLE</span> student ;</span><br><span class=\"line\"><span class=\"keyword\">DROP</span> <span class=\"keyword\">TABLE</span> student ;</span><br></pre></td></tr></table></figure>\n<h2 id=\"数据定义语言：数据类型\"><a href=\"#数据定义语言：数据类型\" class=\"headerlink\" title=\"数据定义语言：数据类型\"></a>数据定义语言：数据类型</h2><h3 id=\"数据类型：数字\"><a href=\"#数据类型：数字\" class=\"headerlink\" title=\"数据类型：数字\"></a>数据类型：数字</h3><p>◇DECIMAL相当于用字符来保存数字，所以不存在精度的丢失；参数10表示整数+小数为十位<br>参数2表示精确到小数点后两位<br><img src=\"/p/a804/1625838928851-acc12aba-1b8a-47cd-a43b-7bb022a49641.png\" class=\"lazyload\" data-srcset=\"/p/a804/1625838928851-acc12aba-1b8a-47cd-a43b-7bb022a49641.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"></p>\n<h3 id=\"不精确的浮点数\"><a href=\"#不精确的浮点数\" class=\"headerlink\" title=\"不精确的浮点数\"></a>不精确的浮点数</h3><p>◇ 十进制的浮点数无法在计算机中用二进制精确表达<br><img src=\"/p/a804/1625838986936-842b2ae4-572c-4618-949b-d0874d60b79f.png\" class=\"lazyload\" data-srcset=\"/p/a804/1625838986936-842b2ae4-572c-4618-949b-d0874d60b79f.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"></p>\n<h3 id=\"数据类型：字符串\"><a href=\"#数据类型：字符串\" class=\"headerlink\" title=\"数据类型：字符串\"></a>数据类型：字符串</h3><p><img src=\"/p/a804/1625839086946-6c97c58c-0b4d-4c4a-9314-535803a59c73.png\" class=\"lazyload\" data-srcset=\"/p/a804/1625839086946-6c97c58c-0b4d-4c4a-9314-535803a59c73.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"></p>\n<h3 id=\"数据类型：日期类型\"><a href=\"#数据类型：日期类型\" class=\"headerlink\" title=\"数据类型：日期类型\"></a>数据类型：日期类型</h3><p><img src=\"/p/a804/1625839693685-beccf98c-d86a-49ae-ba12-ad38022c6eb1.png\" class=\"lazyload\" data-srcset=\"/p/a804/1625839693685-beccf98c-d86a-49ae-ba12-ad38022c6eb1.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"></p>\n<h2 id=\"数据定义语言：修改表结构\"><a href=\"#数据定义语言：修改表结构\" class=\"headerlink\" title=\"数据定义语言：修改表结构\"></a>数据定义语言：修改表结构</h2><h3 id=\"添加字段\"><a href=\"#添加字段\" class=\"headerlink\" title=\"添加字段\"></a>添加字段</h3><figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">ALTER</span> <span class=\"keyword\">TABLE</span> 表名称</span><br><span class=\"line\"><span class=\"keyword\">ADD</span> 列<span class=\"number\">1</span> 数据类型 [ 约束 ] [COMMENT 注释] , <span class=\"keyword\">ADD</span> 列<span class=\"number\">2</span> 数据类型 [ 约束 ] [COMMENT 注释] ,</span><br><span class=\"line\">…… ;</span><br></pre></td></tr></table></figure>\n<h3 id=\"修改字段类型和约束\"><a href=\"#修改字段类型和约束\" class=\"headerlink\" title=\"修改字段类型和约束\"></a>修改字段类型和约束</h3><figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">ALTER</span> <span class=\"keyword\">TABLE</span> 表名称</span><br><span class=\"line\">MODIFY 列<span class=\"number\">1</span> 数据类型 [ 约束 ] [COMMENT 注释] , MODIFY 列<span class=\"number\">2</span> 数据类型 [ 约束 ] [COMMENT 注释] ,</span><br><span class=\"line\">…… ;</span><br></pre></td></tr></table></figure>\n<h3 id=\"修改字段名称\"><a href=\"#修改字段名称\" class=\"headerlink\" title=\"修改字段名称\"></a>修改字段名称</h3><figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">ALTER</span> <span class=\"keyword\">TABLE</span> 表名称</span><br><span class=\"line\">CHANGE 列<span class=\"number\">1</span> 新列名<span class=\"number\">1</span> 数据类型 [ 约束 ] [COMMENT 注释] ,</span><br><span class=\"line\">CHANGE 列<span class=\"number\">2</span> 新列名<span class=\"number\">2</span> 数据类型 [ 约束 ] [COMMENT 注释] ,</span><br><span class=\"line\">…… ;</span><br></pre></td></tr></table></figure>\n<h3 id=\"删除字段\"><a href=\"#删除字段\" class=\"headerlink\" title=\"删除字段\"></a>删除字段</h3><figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">ALTER</span> <span class=\"keyword\">TABLE</span> 表名称</span><br><span class=\"line\"><span class=\"keyword\">DROP</span> 列<span class=\"number\">1</span> ,</span><br><span class=\"line\"><span class=\"keyword\">DROP</span> 列<span class=\"number\">2</span> ，</span><br><span class=\"line\">…… ;</span><br></pre></td></tr></table></figure>\n<h3 id=\"修改表名\"><a href=\"#修改表名\" class=\"headerlink\" title=\"修改表名\"></a>修改表名</h3><figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">ALTER</span> <span class=\"keyword\">TABLE</span> 表名 RENAME 新表名 </span><br></pre></td></tr></table></figure>\n","categories":["Java数据库","MySQL基础"],"tags":["数据库"]},{"title":"Spring AOP面向切面编程","url":"/p/7cef.html","content":"<h2 id=\"课程介绍\"><a href=\"#课程介绍\" class=\"headerlink\" title=\"课程介绍\"></a>课程介绍</h2><p>◇ 介绍Spring AOP与相关概念名词<br>◇ Spring AOP开发与配置流程<br>◇ Spring 五种通知类型与应用场景  </p>\n<h2 id=\"Spring中的可插拔组件技术\"><a href=\"#Spring中的可插拔组件技术\" class=\"headerlink\" title=\"Spring中的可插拔组件技术\"></a>Spring中的可插拔组件技术</h2><p>◇假设软件模块A是系统的用户管理模块，B是系统的员工管理模块，这两个模块都有自己的各种各样的员工业务逻辑类，执行过程从上到下。要求：两个模块从上到下处理业务的过程中，都要进行权限过滤，只有拥有权限的用户才能进入对应的模块；实现方法：利用面向切面编程技术；所谓面向切面编程就是指在软件运行过程中，在执行前或者执行后都可以额外增加相应的扩展功能(称之为切面，Aspect)，如下图的权限切面和日志切面；<br><img src=\"/p/7cef/1633054465138-34c81581-9016-4f4d-9afb-d3be05dc9924.png\" class=\"lazyload\" data-srcset=\"/p/7cef/1633054465138-34c81581-9016-4f4d-9afb-d3be05dc9924.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"></p>\n<h2 id=\"Spring-AOP\"><a href=\"#Spring-AOP\" class=\"headerlink\" title=\"Spring AOP\"></a>Spring AOP</h2><p>◇Spring AOP - Aspect Oriented Programming 面向切面编程<br>◇AOP的做法是将通用、与业务无关的功能抽象封装为切面类<br>◇切面可配置在目标方法的执行前、后运行，真正做到即插即用<br>◇在不修改源码的情况下对程序行为进行扩展</p>\n<h2 id=\"初识AOP编程\"><a href=\"#初识AOP编程\" class=\"headerlink\" title=\"初识AOP编程\"></a>初识AOP编程</h2><p>◇业务背景：在工程中有员工和用户两个service及dao；现在需要在service和dao的方法执行之前在控制台打印它们各自执行的时间(不是指时间大小)，通过这些信息我们可以知道在一天什么时间段是应用程序负载最高的时刻；如果采用直接在执行方法前打印输出系统时间，由于程序有很多类，类中也有很多方法，所以这个方法过于繁琐，因此采用Spring AOP技术，在这些方法执行前进行拦截，先打印时间，然后再去执行方法内部的方法；具体项目见AOP/s01<br>◇pom.xml核心配置</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">&lt;dependencies&gt;</span><br><span class=\"line\">        &lt;dependency&gt;</span><br><span class=\"line\">            &lt;groupId&gt;org.springframework&lt;/groupId&gt;</span><br><span class=\"line\">            &lt;artifactId&gt;spring-context&lt;/artifactId&gt;</span><br><span class=\"line\">            &lt;version&gt;<span class=\"number\">5.2</span><span class=\"number\">.6</span>.RELEASE&lt;/version&gt;</span><br><span class=\"line\">        &lt;/dependency&gt;</span><br><span class=\"line\">        &lt;!--aspectjweaver是Spring AOP的底层依赖--&gt;</span><br><span class=\"line\">        &lt;dependency&gt;</span><br><span class=\"line\">            &lt;groupId&gt;org.aspectj&lt;/groupId&gt;</span><br><span class=\"line\">            &lt;artifactId&gt;aspectjweaver&lt;/artifactId&gt;</span><br><span class=\"line\">            &lt;version&gt;<span class=\"number\">1.9</span><span class=\"number\">.5</span>&lt;/version&gt;</span><br><span class=\"line\">        &lt;/dependency&gt;</span><br><span class=\"line\">    &lt;/dependencies&gt;</span><br></pre></td></tr></table></figure>\n<p>◇创建aspect包，在其下创建MethodAspect类用于扩展功能编写</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.lcg.spring.aop.aspect;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> org.aspectj.lang.JoinPoint;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.text.SimpleDateFormat;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.Date;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//切面类</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MethodAspect</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">//切面方法,用于扩展额外功能</span></span><br><span class=\"line\">    <span class=\"comment\">//JoinPoint 连接点,通过连接点可以获取目标类/方法的信息</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">printExecutionTime</span><span class=\"params\">(JoinPoint joinPoint)</span></span>&#123;</span><br><span class=\"line\">        SimpleDateFormat sdf = <span class=\"keyword\">new</span> SimpleDateFormat(<span class=\"string\">&quot;yyyy-MM-dd HH:mm:ss SSS&quot;</span>);</span><br><span class=\"line\">        String now = sdf.format(<span class=\"keyword\">new</span> Date());</span><br><span class=\"line\">        String className = joinPoint.getTarget().getClass().getName();<span class=\"comment\">//获取目标类的名称</span></span><br><span class=\"line\">        String methodName = joinPoint.getSignature().getName();<span class=\"comment\">//获取目标方法名称</span></span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;----&gt;&quot;</span> + now + <span class=\"string\">&quot;:&quot;</span> + className + <span class=\"string\">&quot;.&quot;</span> + methodName);</span><br><span class=\"line\">        Object[] args = joinPoint.getArgs();<span class=\"comment\">//获取到传入目标方法的参数</span></span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;----&gt;参数个数:&quot;</span> + args.length);</span><br><span class=\"line\">        <span class=\"keyword\">for</span>(Object arg:args)&#123;</span><br><span class=\"line\">            System.out.println(<span class=\"string\">&quot;----&gt;参数:&quot;</span> + arg);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">doAfterReturning</span><span class=\"params\">(JoinPoint joinPoint,Object ret)</span></span>&#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;&lt;----返回后通知:&quot;</span> + ret);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">doAfterThrowing</span><span class=\"params\">(JoinPoint joinPoint,Throwable th)</span></span>&#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;&lt;----异常通知:&quot;</span> + th.getMessage());</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">doAfter</span><span class=\"params\">(JoinPoint joinPoint)</span></span>&#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;&lt;----触发后置通知&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>◇在applicationContext中配置（开头部分schema不同于以前的配置，需要添加一部分）</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">&lt;?xml version=<span class=\"string\">&quot;1.0&quot;</span> encoding=<span class=\"string\">&quot;UTF-8&quot;</span>?&gt;</span><br><span class=\"line\">&lt;beans xmlns:xsi=<span class=\"string\">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class=\"line\">       xmlns:context=<span class=\"string\">&quot;http://www.springframework.org/schema/context&quot;</span></span><br><span class=\"line\">       xmlns:aop=<span class=\"string\">&quot;http://www.springframework.org/schema/aop&quot;</span></span><br><span class=\"line\">       xmlns=<span class=\"string\">&quot;http://www.springframework.org/schema/beans&quot;</span></span><br><span class=\"line\">       xsi:schemaLocation=<span class=\"string\">&quot;http://www.springframework.org/schema/beans</span></span><br><span class=\"line\"><span class=\"string\">        http://www.springframework.org/schema/beans/spring-beans.xsd</span></span><br><span class=\"line\"><span class=\"string\">        http://www.springframework.org/schema/context</span></span><br><span class=\"line\"><span class=\"string\">        http://www.springframework.org/schema/context/spring-context.xsd</span></span><br><span class=\"line\"><span class=\"string\">        http://www.springframework.org/schema/aop</span></span><br><span class=\"line\"><span class=\"string\">        http://www.springframework.org/schema/aop/spring-aop.xsd&quot;</span>&gt;</span><br><span class=\"line\">    &lt;bean id=<span class=\"string\">&quot;userDao&quot;</span> <span class=\"class\"><span class=\"keyword\">class</span></span>=<span class=\"string\">&quot;com.lcg.spring.aop.dao.UserDao&quot;</span>/&gt;</span><br><span class=\"line\">    &lt;bean id=<span class=\"string\">&quot;employeeDao&quot;</span> <span class=\"class\"><span class=\"keyword\">class</span></span>=<span class=\"string\">&quot;com.lcg.spring.aop.dao.EmployeeDao&quot;</span>/&gt;</span><br><span class=\"line\">    &lt;bean id=<span class=\"string\">&quot;userService&quot;</span> <span class=\"class\"><span class=\"keyword\">class</span></span>=<span class=\"string\">&quot;com.lcg.spring.aop.service.UserService&quot;</span>&gt;</span><br><span class=\"line\">        &lt;property name=<span class=\"string\">&quot;userDao&quot;</span> ref=<span class=\"string\">&quot;userDao&quot;</span>/&gt;</span><br><span class=\"line\">    &lt;/bean&gt;</span><br><span class=\"line\">    &lt;bean id=<span class=\"string\">&quot;employeeService&quot;</span> <span class=\"class\"><span class=\"keyword\">class</span></span>=<span class=\"string\">&quot;com.lcg.spring.aop.service.EmployeeService&quot;</span>&gt;</span><br><span class=\"line\">        &lt;property name=<span class=\"string\">&quot;employeeDao&quot;</span> ref=<span class=\"string\">&quot;employeeDao&quot;</span>/&gt;</span><br><span class=\"line\">    &lt;/bean&gt;</span><br><span class=\"line\">    &lt;!-- AOP配置 --&gt;</span><br><span class=\"line\">    &lt;bean id=<span class=\"string\">&quot;methodAspect&quot;</span> <span class=\"class\"><span class=\"keyword\">class</span></span>=<span class=\"string\">&quot;com.lcg.spring.aop.aspect.MethodAspect&quot;</span>&gt;&lt;/bean&gt;</span><br><span class=\"line\">    &lt;aop:config&gt;<span class=\"comment\">//此标签由AOP命名空间提供</span></span><br><span class=\"line\">        &lt;!-- PointCut 切点,使用execution表达式描述切面的作用范围 --&gt;</span><br><span class=\"line\">        &lt;!-- execution(<span class=\"keyword\">public</span> * com.lcg..*.*(..)) 说明切面作用在com.lcg包下的所有类的所有方法上 --&gt;</span><br><span class=\"line\">        &lt;!--&lt;aop:pointcut id=<span class=\"string\">&quot;pointcut&quot;</span> expression=<span class=\"string\">&quot;execution(public * com.lcg..*.*(..))&quot;</span>&gt;&lt;/aop:pointcut&gt;--&gt;</span><br><span class=\"line\">        &lt;!--只对所有Service类生效--&gt;</span><br><span class=\"line\">        &lt;aop:pointcut id=<span class=\"string\">&quot;pointcut&quot;</span> expression=<span class=\"string\">&quot;execution(* com.lcg..*Service.*(..))&quot;</span>&gt;&lt;/aop:pointcut&gt;</span><br><span class=\"line\">        &lt;!--只对所有返回值为String类型方法生效--&gt;</span><br><span class=\"line\">        &lt;!--&lt;aop:pointcut id=<span class=\"string\">&quot;pointcut&quot;</span> expression=<span class=\"string\">&quot;execution(String com.lcg..*Service.*(..))&quot;</span>&gt;&lt;/aop:pointcut&gt;--&gt;</span><br><span class=\"line\">        &lt;!--对方法名进行约束 --&gt;</span><br><span class=\"line\">        &lt;!--&lt;aop:pointcut id=<span class=\"string\">&quot;pointcut&quot;</span> expression=<span class=\"string\">&quot;execution(* com.lcg..*Service.create*(..))&quot;</span>&gt;&lt;/aop:pointcut&gt;--&gt;</span><br><span class=\"line\">        &lt;!-- 对参数进行约束 --&gt;</span><br><span class=\"line\">        &lt;!--&lt;aop:pointcut id=<span class=\"string\">&quot;pointcut&quot;</span> expression=<span class=\"string\">&quot;execution(* com.lcg..*Service.*(String,*))&quot;</span>&gt;&lt;/aop:pointcut&gt;--&gt;</span><br><span class=\"line\">        </span><br><span class=\"line\">        &lt;!-- 定义切面类 让IOC容器认为这个bean是一个切面类--&gt;</span><br><span class=\"line\">        &lt;aop:aspect ref=<span class=\"string\">&quot;methodAspect&quot;</span>&gt;</span><br><span class=\"line\">            &lt;!-- before前置通知(Advice),代表在目标方法运行前先执行methodAspect.printExecutionTime() --&gt;</span><br><span class=\"line\">            &lt;aop:before method=<span class=\"string\">&quot;printExecutionTime&quot;</span> pointcut-ref=<span class=\"string\">&quot;pointcut&quot;</span>/&gt;<span class=\"comment\">//pointcut-ref指向定义的切点;        </span></span><br><span class=\"line\">        &lt;/aop:aspect&gt;</span><br><span class=\"line\">    &lt;/aop:config&gt;</span><br><span class=\"line\">&lt;/beans&gt;</span><br></pre></td></tr></table></figure>\n<h2 id=\"AOP关键概念\"><a href=\"#AOP关键概念\" class=\"headerlink\" title=\"AOP关键概念\"></a>AOP关键概念</h2><h3 id=\"Spring-AOP与AspectJ的关系\"><a href=\"#Spring-AOP与AspectJ的关系\" class=\"headerlink\" title=\"Spring AOP与AspectJ的关系\"></a>Spring AOP与AspectJ的关系</h3><p>◇Eclipse AspectJ,一种基于Java平台的面向切面编程的语言<br>◇Spring AOP使用了AspectJ切入点匹配功能<br>◇Spring AOP利用代理技术实现对象运行时功能扩展  </p>\n<h3 id=\"几个关键概念\"><a href=\"#几个关键概念\" class=\"headerlink\" title=\"几个关键概念\"></a>几个关键概念</h3><p><img src=\"/p/7cef/1633086185761-39f8cae3-34da-48c9-8ea6-3f720722d114.png\" class=\"lazyload\" data-srcset=\"/p/7cef/1633086185761-39f8cae3-34da-48c9-8ea6-3f720722d114.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"></p>\n<h3 id=\"AOP配置过程\"><a href=\"#AOP配置过程\" class=\"headerlink\" title=\"AOP配置过程\"></a>AOP配置过程</h3><p>◇依赖Aspect                                  ◇实现切面类和切面方法<br>◇配置Aspect Bean                         ◇定义PointCut<br>◇配置Advice</p>\n<h3 id=\"JoinPoint核心方法\"><a href=\"#JoinPoint核心方法\" class=\"headerlink\" title=\"JoinPoint核心方法\"></a>JoinPoint核心方法</h3><p><img src=\"/p/7cef/1633088659918-690d3c9d-3b43-43b2-97c5-cbc47ec7214a.png\" class=\"lazyload\" data-srcset=\"/p/7cef/1633088659918-690d3c9d-3b43-43b2-97c5-cbc47ec7214a.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"></p>\n<h2 id=\"PointCut切点表达式\"><a href=\"#PointCut切点表达式\" class=\"headerlink\" title=\"PointCut切点表达式\"></a>PointCut切点表达式</h2><p>◇完整方法的描述：         public void com.lcg.service.UserService.createUser(形参1，形参2，…)<br>◇切点表达式：execution(public   *    com.lcg      ..             *       .        *         (            ..              ) )<br>◇ * - 通配符    .. - 包通配符      (..) - 参数通配符<br>◇切点表达式的含义：去匹配com.lcg包下所有类的所有公用方法；<br>◇(<em>,</em>)-代表两个参数；  *可以替换为string</p>\n<h2 id=\"五种通知类型\"><a href=\"#五种通知类型\" class=\"headerlink\" title=\"五种通知类型\"></a>五种通知类型</h2><h3 id=\"归纳\"><a href=\"#归纳\" class=\"headerlink\" title=\"归纳\"></a>归纳</h3><p><img src=\"/p/7cef/1633086260010-1fe93912-8ac0-4246-8adf-4d07b8500275.png\" class=\"lazyload\" data-srcset=\"/p/7cef/1633086260010-1fe93912-8ac0-4246-8adf-4d07b8500275.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"></p>\n<h3 id=\"特殊的”通知”-引介增强\"><a href=\"#特殊的”通知”-引介增强\" class=\"headerlink\" title=\"特殊的”通知” - 引介增强\"></a>特殊的”通知” - 引介增强</h3><p>◇引介增强(IntroductionInterceptor)是对类的增强，而非方法<br>◇引介增强允许在运行时为类目标增加新属性或方法<br>◇引介增强允许在运行时改变类的行为，让类随运行环境动态变更</p>\n<h3 id=\"代码示例\"><a href=\"#代码示例\" class=\"headerlink\" title=\"代码示例\"></a>代码示例</h3><p>◇目标方法</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">doAfterReturning</span><span class=\"params\">(JoinPoint joinPoint,Object ret)</span></span>&#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;&lt;----返回后通知:&quot;</span> + ret);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">doAfterThrowing</span><span class=\"params\">(JoinPoint joinPoint,Throwable th)</span></span>&#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;&lt;----异常通知:&quot;</span> + th.getMessage());</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">doAfter</span><span class=\"params\">(JoinPoint joinPoint)</span></span>&#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;&lt;----触发后置通知&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n<p>◇配置</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">&lt;aop:aspect ref=<span class=\"string\">&quot;methodAspect&quot;</span>&gt;</span><br><span class=\"line\">            &lt;!-- before通知(Advice),代表在目标方法运行前先执行methodAspect.printExecutionTime() --&gt;</span><br><span class=\"line\">            &lt;aop:before method=<span class=\"string\">&quot;printExecutionTime&quot;</span> pointcut-ref=<span class=\"string\">&quot;pointcut&quot;</span>/&gt;</span><br><span class=\"line\">            &lt;!--返回后通知,returning表示哪个参数接收目标方法的返回值--&gt;</span><br><span class=\"line\">            &lt;aop:after-returning method=<span class=\"string\">&quot;doAfterReturning&quot;</span> returning=<span class=\"string\">&quot;ret&quot;</span> pointcut-ref=<span class=\"string\">&quot;pointcut&quot;</span>/&gt;</span><br><span class=\"line\">            &lt;!--异常通知--&gt;</span><br><span class=\"line\">            &lt;aop:after-throwing method=<span class=\"string\">&quot;doAfterThrowing&quot;</span> throwing=<span class=\"string\">&quot;th&quot;</span> pointcut-ref=<span class=\"string\">&quot;pointcut&quot;</span>/&gt;</span><br><span class=\"line\">            &lt;!--最后通知，目标方法运行后执行--&gt;</span><br><span class=\"line\">            &lt;aop:after method=<span class=\"string\">&quot;doAfter&quot;</span> pointcut-ref=<span class=\"string\">&quot;pointcut&quot;</span>&gt;&lt;/aop:after&gt;</span><br><span class=\"line\">        &lt;/aop:aspect&gt;</span><br></pre></td></tr></table></figure>\n<h2 id=\"详解环绕通知-Around-Advice\"><a href=\"#详解环绕通知-Around-Advice\" class=\"headerlink\" title=\"详解环绕通知(Around Advice)\"></a>详解环绕通知(Around Advice)</h2><h3 id=\"利用AOP进行方法性能筛选\"><a href=\"#利用AOP进行方法性能筛选\" class=\"headerlink\" title=\"利用AOP进行方法性能筛选\"></a>利用AOP进行方法性能筛选</h3><p>◇案例背景，在实际工作中可能遇到这种情况：由于不断的数据累积，用户量的增大，可能会导致我们生产环境中系统越来越慢，那我们如何定位到是哪一个方法运行慢呢？解决方法：利用AOP技术在方法执行前以及执行后记录时间，两相减即为执行时长，把超过指定时长的方法输出到日志中去；但由于需要记录一前一后两个时间，所以采用环绕通知来实现；</p>\n<h3 id=\"代码示例-AOP-S02\"><a href=\"#代码示例-AOP-S02\" class=\"headerlink\" title=\"代码示例(AOP/S02)\"></a>代码示例(AOP/S02)</h3><p>◇切面类</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.lcg.spring.aop.aspect;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> org.aspectj.lang.ProceedingJoinPoint;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.text.SimpleDateFormat;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.Date;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MethodChecker</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">////ProceedingJoinPoint是JoinPoint的升级版,在原有功能外,还可以控制目标方法是否执行</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> Object <span class=\"title\">check</span><span class=\"params\">(ProceedingJoinPoint pjp)</span> <span class=\"keyword\">throws</span> Throwable </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">long</span> startTime = <span class=\"keyword\">new</span> Date().getTime();</span><br><span class=\"line\">            Object ret = pjp.proceed();<span class=\"comment\">//执行目标方法,返回的对象ret即为目标方法的返回值</span></span><br><span class=\"line\">            <span class=\"keyword\">long</span> endTime = <span class=\"keyword\">new</span> Date().getTime();</span><br><span class=\"line\">            <span class=\"keyword\">long</span> duration = endTime - startTime; <span class=\"comment\">//执行时长</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span>(duration &gt;= <span class=\"number\">1000</span>)&#123;</span><br><span class=\"line\">                String className = pjp.getTarget().getClass().getName();</span><br><span class=\"line\">                String methodName = pjp.getSignature().getName();</span><br><span class=\"line\">                SimpleDateFormat sdf = <span class=\"keyword\">new</span> SimpleDateFormat(<span class=\"string\">&quot;yyyy-MM-dd HH:mm:ss SSS&quot;</span>);</span><br><span class=\"line\">                String now = sdf.format(<span class=\"keyword\">new</span> Date());</span><br><span class=\"line\">                System.out.println(<span class=\"string\">&quot;=======&quot;</span> + now + <span class=\"string\">&quot;:&quot;</span> + className + <span class=\"string\">&quot;.&quot;</span> + methodName + <span class=\"string\">&quot;(&quot;</span> + duration + <span class=\"string\">&quot;ms)======&quot;</span>);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> ret;<span class=\"comment\">//返回</span></span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (Throwable throwable) &#123;</span><br><span class=\"line\">            System.out.println(<span class=\"string\">&quot;Exception message:&quot;</span> + throwable.getMessage());</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> throwable;<span class=\"comment\">//直接抛出异常</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>◇配置</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">&lt;aop:config&gt;</span><br><span class=\"line\">    &lt;aop:pointcut id=<span class=\"string\">&quot;pointcut&quot;</span> expression=<span class=\"string\">&quot;execution(* com.lcg..*.*(..))&quot;</span>&gt;&lt;/aop:pointcut&gt;</span><br><span class=\"line\">    &lt;aop:aspect ref=<span class=\"string\">&quot;methodChecker&quot;</span>&gt;</span><br><span class=\"line\">        &lt;!--环绕通知--&gt;</span><br><span class=\"line\">        &lt;aop:around method=<span class=\"string\">&quot;check&quot;</span> pointcut-ref=<span class=\"string\">&quot;pointcut&quot;</span>/&gt;</span><br><span class=\"line\">    &lt;/aop:aspect&gt;</span><br><span class=\"line\">&lt;/aop:config&gt;</span><br></pre></td></tr></table></figure>\n<p>◇应用程序入口</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">SpringApplication</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> </span>&#123;</span><br><span class=\"line\">        ApplicationContext context = <span class=\"keyword\">new</span> ClassPathXmlApplicationContext(<span class=\"string\">&quot;classpath:applicationContext.xml&quot;</span>);</span><br><span class=\"line\">        UserService userService = context.getBean(<span class=\"string\">&quot;userService&quot;</span>, UserService.class);</span><br><span class=\"line\">        userService.createUser();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"利用注解配置Spring-AOP\"><a href=\"#利用注解配置Spring-AOP\" class=\"headerlink\" title=\"利用注解配置Spring AOP\"></a>利用注解配置Spring AOP</h2><p><strong>代码示例(AOP/S03)</strong><br>◇pom.xml加载jar包，完成底层依赖；<br>◇applicationContext配置文件增加注解相关的配置</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">&lt;?xml version=<span class=\"string\">&quot;1.0&quot;</span> encoding=<span class=\"string\">&quot;UTF-8&quot;</span>?&gt;</span><br><span class=\"line\">&lt;beans xmlns:xsi=<span class=\"string\">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class=\"line\">       xmlns:context=<span class=\"string\">&quot;http://www.springframework.org/schema/context&quot;</span></span><br><span class=\"line\">       xmlns:aop=<span class=\"string\">&quot;http://www.springframework.org/schema/aop&quot;</span></span><br><span class=\"line\">       xmlns=<span class=\"string\">&quot;http://www.springframework.org/schema/beans&quot;</span></span><br><span class=\"line\">       xsi:schemaLocation=<span class=\"string\">&quot;http://www.springframework.org/schema/beans</span></span><br><span class=\"line\"><span class=\"string\">        http://www.springframework.org/schema/beans/spring-beans.xsd</span></span><br><span class=\"line\"><span class=\"string\">        http://www.springframework.org/schema/context</span></span><br><span class=\"line\"><span class=\"string\">        http://www.springframework.org/schema/context/spring-context.xsd</span></span><br><span class=\"line\"><span class=\"string\">        http://www.springframework.org/schema/aop</span></span><br><span class=\"line\"><span class=\"string\">        http://www.springframework.org/schema/aop/spring-aop.xsd&quot;</span>&gt;</span><br><span class=\"line\">    &lt;!--组件扫描,初始化IoC容器--&gt;</span><br><span class=\"line\">    &lt;context:component-scan base-<span class=\"keyword\">package</span>=<span class=\"string\">&quot;com.lcg&quot;</span>/&gt;</span><br><span class=\"line\">    &lt;!--启用Spring AOP注解模式--&gt;</span><br><span class=\"line\">    &lt;aop:aspectj-autoproxy/&gt;</span><br><span class=\"line\">&lt;/beans&gt;</span><br></pre></td></tr></table></figure>\n<p>◇将dao类以及service类进行上节课ioc注解相关的配置，如@Repository和@Service等<br>◇切面类注解</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.lcg.spring.aop.aspect;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> org.aspectj.lang.ProceedingJoinPoint;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.aspectj.lang.annotation.*;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.stereotype.Component;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.text.SimpleDateFormat;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.Date;</span><br><span class=\"line\"><span class=\"meta\">@Component</span> <span class=\"comment\">//标记当前类为组件</span></span><br><span class=\"line\"><span class=\"meta\">@Aspect</span> <span class=\"comment\">//说明当前类是切面类</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MethodChecker</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">//环绕通知,参数为PointCut切点表达式</span></span><br><span class=\"line\">    <span class=\"meta\">@Around(&quot;execution(* com.lcg..*Service.*(..))&quot;)</span></span><br><span class=\"line\">    <span class=\"comment\">//ProceedingJoinPoint是JoinPoint的升级版,在原有功能外,还可以控制目标方法是否执行</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> Object <span class=\"title\">check</span><span class=\"params\">(ProceedingJoinPoint pjp)</span> <span class=\"keyword\">throws</span> Throwable </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">long</span> startTime = <span class=\"keyword\">new</span> Date().getTime();</span><br><span class=\"line\">            Object ret = pjp.proceed();<span class=\"comment\">//执行目标方法</span></span><br><span class=\"line\">            <span class=\"keyword\">long</span> endTime = <span class=\"keyword\">new</span> Date().getTime();</span><br><span class=\"line\">            <span class=\"keyword\">long</span> duration = endTime - startTime; <span class=\"comment\">//执行时长</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span>(duration &gt;= <span class=\"number\">1000</span>)&#123;</span><br><span class=\"line\">                String className = pjp.getTarget().getClass().getName();</span><br><span class=\"line\">                String methodName = pjp.getSignature().getName();</span><br><span class=\"line\">                SimpleDateFormat sdf = <span class=\"keyword\">new</span> SimpleDateFormat(<span class=\"string\">&quot;yyyy-MM-dd HH:mm:ss SSS&quot;</span>);</span><br><span class=\"line\">                String now = sdf.format(<span class=\"keyword\">new</span> Date());</span><br><span class=\"line\">                System.out.println(<span class=\"string\">&quot;=======&quot;</span> + now + <span class=\"string\">&quot;:&quot;</span> + className + <span class=\"string\">&quot;.&quot;</span> + methodName + <span class=\"string\">&quot;(&quot;</span> + duration + <span class=\"string\">&quot;ms)======&quot;</span>);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> ret;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (Throwable throwable) &#123;</span><br><span class=\"line\">            System.out.println(<span class=\"string\">&quot;Exception message:&quot;</span> + throwable.getMessage());</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> throwable;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h2 id=\"代理模式\"><a href=\"#代理模式\" class=\"headerlink\" title=\"代理模式\"></a>代理模式</h2><h3 id=\"Spring-AOP实现原理\"><a href=\"#Spring-AOP实现原理\" class=\"headerlink\" title=\"Spring AOP实现原理\"></a>Spring AOP实现原理</h3><p>◇Spring基于代理模式实现功能动态扩展，包含两种形式<br>◇目标类拥有接口，通过JDK动态代理实现功能扩展<br>◇目标类没有接口，通过CGLib组件实现功能扩展</p>\n<h3 id=\"静态代理\"><a href=\"#静态代理\" class=\"headerlink\" title=\"静态代理\"></a>静态代理</h3><p>◇代理模式通过代理对象对原对象的实现功能扩展<br>◇所谓代理模式，其核心理念是实现一个代理类，在代理类中持有最原始的委托类；代理类和委托类实现共同的接口；而客户通过代理类来完成所需的功能<br><img src=\"/p/7cef/1633227288993-6f02aa5f-5d59-4c02-ad4b-52ad7c10b046.png\" class=\"lazyload\" data-srcset=\"/p/7cef/1633227288993-6f02aa5f-5d59-4c02-ad4b-52ad7c10b046.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"><br><strong>代码演示(AOP/S04)</strong><br>◇创建接口UserService</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">interface</span> <span class=\"title\">UserService</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">createUser</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>◇创建接口的实现类UserServiceImpl（委托类）</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">UserServiceImpl</span> <span class=\"keyword\">implements</span> <span class=\"title\">UserService</span></span>&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">createUser</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;执行创建用户业务逻辑&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>◇案例背景：现在需要将方法执行的时间打印出来，在前面已经讲过Spring AOP技术来实现。但是在代理模式中如何实现呢？如果要实现这个功能的扩展就必须基于UserService接口创建对应的代理类，同时在代理类中去持有与之对应的具体实现；<br>◇创建UserServiceProxy（代理类）</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> java.text.SimpleDateFormat;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.Date;</span><br><span class=\"line\"><span class=\"comment\">//静态代理是指必须手动创建代理类的代理模式使用方式</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">UserServiceProxy</span> <span class=\"keyword\">implements</span> <span class=\"title\">UserService</span></span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">//持有委托类的对象</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> UserService userService ;</span><br><span class=\"line\">    <span class=\"comment\">//创建代理对象的时候，通过外侧传入某一个UserService的实现类为内部的委托类赋值，相当于持有委托类</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">UserServiceProxy</span><span class=\"params\">(UserService userService)</span></span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.userService = userService;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">createUser</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;=====&quot;</span> + <span class=\"keyword\">new</span> SimpleDateFormat(<span class=\"string\">&quot;yyyy-MM-dd HH:mm:ss SSS&quot;</span>).format(<span class=\"keyword\">new</span> Date()) +<span class=\"string\">&quot;=========&quot;</span>);</span><br><span class=\"line\">        userService.createUser();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>◇主程序（客户）</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Application</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> </span>&#123;</span><br><span class=\"line\">        UserService userService = <span class=\"keyword\">new</span> UserServiceProxy(<span class=\"keyword\">new</span> UserServiceImpl());</span><br><span class=\"line\">        userService.createUser();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>◇代理模式是可以嵌套使用的，因此在代理类的构造方法中参数为接口类的某一个实现而非具体的接口实现类UserServiceImpl；嵌套使用案例：再创建一个代理类，实现一些后置功能，然后在这个代理类中传入参数为另一个代理类的实现；**new **UserServiceProxy1(**new **UserServiceProxy(**new **UserServiceImpl()))因为参数不管是什么对象，只要实现了接口类即可；缺点：随着功能的不断扩大，每一个具体的实现类都至少拥有一个代理类，这种方式称为静态代理。</p>\n<h3 id=\"JDK动态代理\"><a href=\"#JDK动态代理\" class=\"headerlink\" title=\"JDK动态代理\"></a>JDK动态代理</h3><p>◇静态代理与动态代理最显著的区别是静态代理必须手动创建代理类，而动态代理根据接口的结构运行时在内存中进行生成。<br><strong>代码实现（AOP/S05）</strong><br>◇EmployeeService接口</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">interface</span> <span class=\"title\">EmployeeService</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">createEmployee</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>◇EmployeeServiceImpl实现类</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">EmployeeServiceImpl</span> <span class=\"keyword\">implements</span> <span class=\"title\">EmployeeService</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">createEmployee</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;执行创建员工业务逻辑&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>◇创建ProxyInvocationHandler类，实现重要的接口InvocationHandler</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * InvocationHandler是JDK提供的反射类,用于在JDK动态代理中对目标方法进行增强</span></span><br><span class=\"line\"><span class=\"comment\"> * InvocationHandler实现类与切面类的环绕通知类似</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ProxyInvocationHandler</span> <span class=\"keyword\">implements</span> <span class=\"title\">InvocationHandler</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> Object target;<span class=\"comment\">//目标对象</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> <span class=\"title\">ProxyInvocationHandler</span><span class=\"params\">(Object target)</span></span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.target = target;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 必须实现这个invoke()方法</span></span><br><span class=\"line\"><span class=\"comment\">     * 在invoke()方法对目标方法进行增强</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> proxy 代理类对象</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> method 目标方法对象</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> args 目标方法实参</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> 目标方法运行后返回值</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@throws</span> Throwable 目标方法抛出的异常</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> Object <span class=\"title\">invoke</span><span class=\"params\">(Object proxy, Method method, Object[] args)</span> <span class=\"keyword\">throws</span> Throwable </span>&#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;=====&quot;</span> + <span class=\"keyword\">new</span> SimpleDateFormat(<span class=\"string\">&quot;yyyy-MM-dd HH:mm:ss SSS&quot;</span>).format(<span class=\"keyword\">new</span> Date()) +<span class=\"string\">&quot;=========&quot;</span>);</span><br><span class=\"line\">        Object ret = method.invoke(target, args);<span class=\"comment\">//调用目标方法,相当于ProceedingJoinPoint.proceed()</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> ret;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> </span>&#123;</span><br><span class=\"line\">        UserService userService = <span class=\"keyword\">new</span> UserServiceImpl();</span><br><span class=\"line\">        ProxyInvocationHandler invocationHandler = <span class=\"keyword\">new</span> ProxyInvocationHandler(userService);</span><br><span class=\"line\">        <span class=\"comment\">//动态创建代理类</span></span><br><span class=\"line\">        <span class=\"comment\">/*newProxyInstance方法基于接口动态创建代理类,三个参数（类加载器，类要实现的接口，如何对目标方法进行扩展）*/</span></span><br><span class=\"line\">        UserService userServiceProxy = (UserService)Proxy.newProxyInstance(userService.getClass().getClassLoader(),</span><br><span class=\"line\">                userService.getClass().getInterfaces(),</span><br><span class=\"line\">                invocationHandler);</span><br><span class=\"line\">        userServiceProxy.createUser();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//动态代理,必须实现接口才可以运行</span></span><br><span class=\"line\">        EmployeeService employeeService = <span class=\"keyword\">new</span> EmployeeServiceImpl();</span><br><span class=\"line\">        EmployeeService employeeServiceProxy = (EmployeeService)Proxy.newProxyInstance(employeeService.getClass().getClassLoader(),</span><br><span class=\"line\">                employeeService.getClass().getInterfaces(),</span><br><span class=\"line\">                <span class=\"keyword\">new</span> ProxyInvocationHandler(employeeService));</span><br><span class=\"line\">        employeeServiceProxy.createEmployee();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"JDK动态代理解析\"><a href=\"#JDK动态代理解析\" class=\"headerlink\" title=\"JDK动态代理解析\"></a>JDK动态代理解析</h3><p>◇<a href=\"https://jiankunking.blog.csdn.net/article/details/52143504\">CSDN参考链接</a><br>◇Proxy是JDK反射包提供的类，其作用是根据已有接口来生成对应的代理类。</p>\n<p>◇下图代码有简化，省略了参数。首先在执行Proxy.newProxyInstance()方法，然后jdk会在本地文件中生成.class文件，然后依次确定代理类的包名为com.sun.proxy，确定类名为$Proxy0。然后通过ProxyGenerator生成代理类，通过伪代码可以看出是使用确定的类名并实现参数值传递过来的接口创建的，代理类和被代理类实现的是同一个接口。并且代理类中会持有一个接口的对象targetObject,这个对象是由new ProxyInvocationHandler(target)中的参数target提供的。然后在代理类中使用这个对象调用接口中定义的方法，并在方法执行前后者后增加在InvocationHandler类中扩展功能的代码。</p>\n<p>◇在创建完代理类以后，因为保存的是字节码文件，所以还要通过方法defineClass0将字节码文件通过被代理类的类加载器载入到JVM的方法区中。当类加载完成后，就会调用userServiceProxy.createUser()方法区加载类对象-&gt;new @$Proxy0()最终实例化代理类，将对象存放在JVM的堆区中。由于实例化代理类的同时也会实例化被代理类的实现类，所以代理类对象和被代理类的实现类对象(UserServiceImpl)有关联。</p>\n<p><img src=\"/p/7cef/image-20220327231651543.png\" class=\"lazyload\" data-srcset=\"/p/7cef/image-20220327231651543.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image-20220327231651543\"></p>\n<h3 id=\"CGLib实现代理类\"><a href=\"#CGLib实现代理类\" class=\"headerlink\" title=\"CGLib实现代理类\"></a>CGLib实现代理类</h3><p>◇CGLib是运行时字节码增强技术<br>◇Spring AOP扩展无接口类使用CGLib<br>◇AOP会运行时生成目标继承类字节码的方式进行行为扩展<br>◇如下图，假设有一个最原始的Service类，类中有一个findById()方法;该Service类没有实现任何接口，因此无法实现JDK的动态代理。Spring会自动使用CGLib通过继承的方式来对类进行扩展。这个类是在jvm运行过程中自动生成的，生成规则是：原类名+$$+EnhancerByCGLIB<br><img src=\"/p/7cef/1633250112821-72b8f05b-0992-4d48-95a4-208734a4e2dd.png\" class=\"lazyload\" data-srcset=\"/p/7cef/1633250112821-72b8f05b-0992-4d48-95a4-208734a4e2dd.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"></p>\n","categories":["Spring","Spring基础"],"tags":["Spring"]},{"title":"SpringBoot入门","url":"/p/e10.html","content":"<h2 id=\"前期准备\"><a href=\"#前期准备\" class=\"headerlink\" title=\"前期准备\"></a>前期准备</h2><h3 id=\"课程简介\"><a href=\"#课程简介\" class=\"headerlink\" title=\"课程简介\"></a>课程简介</h3><p>1.Spting Boot概述<br>2.Spring Boot版本介绍<br>3.新建Spring Boot项目演示(官网和IDEA两种)</p>\n<h3 id=\"软件版本\"><a href=\"#软件版本\" class=\"headerlink\" title=\"软件版本\"></a>软件版本</h3><p>Java 1.8.0_171（大版本一致）<br>MySQL 8.0.12（大版本一致）<br>Maven 3.3.9（大版本一致）<br>Spring Boot 2.2.1（版本需要严格一致）  </p>\n<h3 id=\"Spring-Boot诞生历史\"><a href=\"#Spring-Boot诞生历史\" class=\"headerlink\" title=\"Spring Boot诞生历史\"></a>Spring Boot诞生历史</h3><p>◇Spring的缺点：配置过于繁琐<br>◇Spring Boot开发团队: Pivotal</p>\n<h3 id=\"Spring-Boot简介\"><a href=\"#Spring-Boot简介\" class=\"headerlink\" title=\"Spring Boot简介\"></a>Spring Boot简介</h3><p>◇简化初始搭建以及开发过程<br>◇不再需要定义样板化的配置<br>◇快速应用开发领域</p>\n<h3 id=\"Spring、Spring-MVC、Spring-Boot\"><a href=\"#Spring、Spring-MVC、Spring-Boot\" class=\"headerlink\" title=\"Spring、Spring MVC、Spring Boot\"></a>Spring、Spring MVC、Spring Boot</h3><p>◇Spring最初利用IOC和AOP解耦<br>◇按照这种模式搞了MVC框架<br>◇写很多样板代码很麻烦，就有了Spring Boot<br>◇Spring Cloud是在Spring Boot基础上诞生的；</p>\n<h3 id=\"Spring-Boot核心特点\"><a href=\"#Spring-Boot核心特点\" class=\"headerlink\" title=\"Spring Boot核心特点\"></a>Spring Boot核心特点</h3><p>◇开箱即用：对于spring需要Tomcat等一系列配置，而springboot不需要；<br>◇约定优于配置，在开发中遵守某种约定；</p>\n<h3 id=\"Spring-Boot版本介绍\"><a href=\"#Spring-Boot版本介绍\" class=\"headerlink\" title=\"Spring Boot版本介绍\"></a>Spring Boot版本介绍</h3><p><img src=\"/p/e10/1635758293954-ea2b47bc-0be8-46a2-bc28-cedb50597c0a.png\" class=\"lazyload\" data-srcset=\"/p/e10/1635758293954-ea2b47bc-0be8-46a2-bc28-cedb50597c0a.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"><br>◇CURRENT，代表最新的GA版本<br>◇GA，General Availability（正式发布版本),面向大众的，功能完美并且稳定；<br>◇SNAPSHOT，版本会被修改<br>◇如何选择版本？选择GA版本，不一定要最新的；</p>\n<h2 id=\"Spring-Boot-项目开发\"><a href=\"#Spring-Boot-项目开发\" class=\"headerlink\" title=\"Spring Boot 项目开发\"></a>Spring Boot 项目开发</h2><h3 id=\"官网构建\"><a href=\"#官网构建\" class=\"headerlink\" title=\"官网构建\"></a>官网构建</h3><p>◇<a href=\"https://start.spring.io/\">Spring官网 </a>来进行开发；选择maven-&gt;选择springboot版本-&gt;填写工程名-&gt;选择jar包-&gt;增加springweb依赖-&gt;<br>Explore(预览)-&gt;Generate(生成)；<br>◇打开IDEA，点击import Project(引入项目),将刚才下载好的项目解压并进入文件夹点击open-&gt;选择Maven-&gt;勾选Import Maven projects automatically-&gt;next-&gt;finish;可以看到会生成一个启动类xxxApplication,这个启动类最好不要随意更改位置；</p>\n<h3 id=\"IDEA集成\"><a href=\"#IDEA集成\" class=\"headerlink\" title=\"IDEA集成\"></a>IDEA集成</h3><p>◇IDEA集成的Spring Initializr<br>◇新建项目-&gt;选择Spring Initializr-&gt;选择java版本1.8-&gt;Default-&gt;next-&gt;填写项目Group等信息;<br><img src=\"/p/e10/1635765769890-3ead8c1a-ed8d-4a93-b864-d6356c202e32.png\" class=\"lazyload\" data-srcset=\"/p/e10/1635765769890-3ead8c1a-ed8d-4a93-b864-d6356c202e32.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"><br>◇选择springboot版本以及web依赖<br><img src=\"/p/e10/1635765865834-485ce888-f4e7-47c3-8adf-ed1b9ff6f74a.png\" class=\"lazyload\" data-srcset=\"/p/e10/1635765865834-485ce888-f4e7-47c3-8adf-ed1b9ff6f74a.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"></p>\n<h3 id=\"项目结构解析\"><a href=\"#项目结构解析\" class=\"headerlink\" title=\"项目结构解析\"></a>项目结构解析</h3><p>◇Spring Boot的基础结构共三个文件：入口(启动类)、配置文件(放在resources文件夹下)、测试入口(在test文件夹下)<br>◇生成的Application和ApplicationTests类都可以直接运行来启动当前创建的项目;<br>◇对于pom.xml文件修改springboot的版本为:2.2.1.RELEASE</p>\n<h3 id=\"案例演示\"><a href=\"#案例演示\" class=\"headerlink\" title=\"案例演示\"></a>案例演示</h3><p>◇新建一个ParaController类</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.lcg.springboottest;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.bind.annotation.PathVariable;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.bind.annotation.RequestParam;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> *  演示各种传参形式</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"meta\">@RestController</span> <span class=\"comment\">//有Restful能力的Controller</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ParaController</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"meta\">@GetMapping(&quot;/test01&quot;)</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">firstRequest</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">&quot;第一个Spring Boot接口&quot;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">//@RequestParam注解会在请求参数中找到num这个参数并进行绑定</span></span><br><span class=\"line\">    <span class=\"comment\">//访问  /test02?num=6</span></span><br><span class=\"line\">    <span class=\"meta\">@GetMapping(&quot;/test02&quot;)</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">requestParam</span><span class=\"params\">(<span class=\"meta\">@RequestParam</span> Integer num)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">&quot;test02: num=&quot;</span>+num;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">/*从路径中获取参数num</span></span><br><span class=\"line\"><span class=\"comment\">    * 访问test03/6*/</span></span><br><span class=\"line\">    <span class=\"meta\">@GetMapping(&quot;/test03/&#123;num&#125;&quot;)</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">pathParam</span><span class=\"params\">(<span class=\"meta\">@PathVariable(&quot;num&quot;)</span> Integer num)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">&quot;test03:num=&quot;</span>+num;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@GetMapping(&#123;&quot;/multi01&quot;,&quot;/multi02&quot;&#125;)</span><span class=\"comment\">//多url的情况</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">multiUrl</span><span class=\"params\">(<span class=\"meta\">@RequestParam</span> Integer num)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">&quot;multi:num=&quot;</span>+num;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@GetMapping(&#123;&quot;/test04&quot;&#125;)</span> <span class=\"comment\">//required= false表示不是必须传参，并设置默认参数为0；</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">test04</span><span class=\"params\">(<span class=\"meta\">@RequestParam(required= false,defaultValue = &quot;0&quot;)</span> Integer num)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">&quot;test04: num=&quot;</span>+num;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h3 id=\"Web项目的三层结构\"><a href=\"#Web项目的三层结构\" class=\"headerlink\" title=\"Web项目的三层结构\"></a>Web项目的三层结构</h3><p>◇Controller 做一些简单的逻辑判断<br>◇Service 对业务逻辑进行抽象，封装保持Controller的简洁;<br>◇Dao 一般用于和数据库的交互，增删改查之类；</p>\n<h3 id=\"配置文件的两种写法\"><a href=\"#配置文件的两种写法\" class=\"headerlink\" title=\"配置文件的两种写法\"></a>配置文件的两种写法</h3><p>◇application.properties<br>environments.dev.url=<a href=\"http://gamest.link/\">http://gamest.link</a><br>environments.dev.name=Developer</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">server.port=<span class=\"number\">8081</span>   <span class=\"comment\">//配置端口</span></span><br><span class=\"line\">server.servlet.context-path=/first  <span class=\"comment\">//配置项目统一路径前缀</span></span><br></pre></td></tr></table></figure>\n<p>◇yml写法：分层级，冒号后需要空格；好处是前面的前缀相同的话可以直接并列；</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">environments:</span><br><span class=\"line\">   dev:</span><br><span class=\"line\">     url:http:<span class=\"comment\">//gamest.link</span></span><br><span class=\"line\">     name:Developer</span><br></pre></td></tr></table></figure>\n<p>◇两种写法的<a href=\"https://www.toyaml.com/index.html\">转换网站</a></p>\n<h3 id=\"进行自定义配置\"><a href=\"#进行自定义配置\" class=\"headerlink\" title=\"进行自定义配置\"></a>进行自定义配置</h3><p>◇利用value注解配置属性</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//配置文件中</span></span><br><span class=\"line\">school.grade=<span class=\"number\">3</span></span><br><span class=\"line\">school.classnum=<span class=\"number\">6</span></span><br><span class=\"line\">    -----------------------------------------------------------------------</span><br><span class=\"line\"><span class=\"comment\">//控制器中</span></span><br><span class=\"line\">    <span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">* 演示读取配置的控制器*/</span></span><br><span class=\"line\"><span class=\"meta\">@RestController</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">PropertiesController</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"meta\">@Value(&quot;$&#123;school.grade&#125;&quot;)</span> <span class=\"comment\">//进行与配置文件的绑定,按住ctrl然后鼠标放在上面会有配置提示</span></span><br><span class=\"line\">    Integer grade;</span><br><span class=\"line\">    <span class=\"meta\">@Value(&quot;$&#123;school.classnum&#125;&quot;)</span></span><br><span class=\"line\">    Integer classnum;</span><br><span class=\"line\">    <span class=\"meta\">@GetMapping(&quot;/grade&quot;)</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">gradeClass</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">&quot;年级：&quot;</span>+grade+<span class=\"string\">&quot;班级：&quot;</span>+classnum;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>◇配置类</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.lcg.springboottest;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.boot.context.properties.ConfigurationProperties;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.stereotype.Component;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * School配置类</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"meta\">@Component</span></span><br><span class=\"line\"><span class=\"meta\">@ConfigurationProperties(prefix = &quot;school&quot;)</span> <span class=\"comment\">//设置属性的前缀</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">SchoolConfig</span> </span>&#123;</span><br><span class=\"line\">    Integer grade;</span><br><span class=\"line\">    Integer classnum;</span><br><span class=\"line\">        <span class=\"function\"><span class=\"keyword\">public</span> Integer <span class=\"title\">getGrade</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> grade;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">//需要有get和set方法spring才能从配置文件中注入数据进来</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">setGrade</span><span class=\"params\">(Integer grade)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.grade = grade;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> Integer <span class=\"title\">getClassnum</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> classnum;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">setClassnum</span><span class=\"params\">(Integer classnum)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.classnum = classnum;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>◇读取配置类的方法</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.lcg.springboottest;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 读取配置类</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"meta\">@RestController</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ConfigController</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span> <span class=\"comment\">//自动引入</span></span><br><span class=\"line\">    SchoolConfig schoolConfig;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@GetMapping(&quot;/grade&quot;)</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">gradeClass</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">&quot;年级：&quot;</span>+schoolConfig.grade+<span class=\"string\">&quot;班级：&quot;</span>+schoolConfig.classnum;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"Service和DAO的编写\"><a href=\"#Service和DAO的编写\" class=\"headerlink\" title=\"Service和DAO的编写\"></a>Service和DAO的编写</h2><h3 id=\"数据库的创建\"><a href=\"#数据库的创建\" class=\"headerlink\" title=\"数据库的创建\"></a>数据库的创建</h3><p>◇新建数据库springstu存储学生信息；<br>◇建立学生表，包含了id，姓名</p>\n<h3 id=\"项目依赖与配置\"><a href=\"#项目依赖与配置\" class=\"headerlink\" title=\"项目依赖与配置\"></a>项目依赖与配置</h3><p>◇引入mybatis依赖</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">&lt;!--mybatis依赖--&gt;</span><br><span class=\"line\">&lt;dependency&gt;</span><br><span class=\"line\">    &lt;groupId&gt;org.mybatis.spring.boot&lt;/groupId&gt;</span><br><span class=\"line\">    &lt;artifactId&gt;mybatis-spring-boot-starter&lt;/artifactId&gt;</span><br><span class=\"line\">    &lt;version&gt;<span class=\"number\">2.1</span><span class=\"number\">.1</span>&lt;/version&gt;</span><br><span class=\"line\">&lt;/dependency&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;!--mybatis的mysql连接池依赖--&gt;</span><br><span class=\"line\">&lt;dependency&gt;</span><br><span class=\"line\">    &lt;groupId&gt;mysql&lt;/groupId&gt;</span><br><span class=\"line\">    &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;</span><br><span class=\"line\">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>\n<p>◇数据库的配置</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">spring.datasource.username=root</span><br><span class=\"line\">spring.datasource.password=www.LCG.com</span><br><span class=\"line\">spring.datasource.url=jdbc:mysql:<span class=\"comment\">//localhost:3306/springstu?useUnicode=true&amp;amp;\\</span></span><br><span class=\"line\">  characterEncoding=UTF-<span class=\"number\">8</span></span><br></pre></td></tr></table></figure>\n<p>◇创建实体类<br>◇创建controller</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@RestController</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">StudentController</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    StudentService studentService;</span><br><span class=\"line\">    <span class=\"meta\">@GetMapping(&quot;/student&quot;)</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">student</span><span class=\"params\">(<span class=\"meta\">@RequestParam(required = false,defaultValue = &quot;1&quot;)</span> Integer num)</span> </span>&#123;</span><br><span class=\"line\">       Student student = studentService.findStudent(num);</span><br><span class=\"line\">       <span class=\"keyword\">return</span> <span class=\"string\">&quot;学生学号:&quot;</span>+student.getNum()+<span class=\"string\">&quot;学生姓名：&quot;</span>+student.getName();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>◇创建service</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Service</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">StudentService</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    StudentMapper studentMapper;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> Student <span class=\"title\">findStudent</span><span class=\"params\">(Integer id)</span> </span>&#123;</span><br><span class=\"line\">       <span class=\"keyword\">return</span> studentMapper.findById(id);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>◇创建Mapper接口</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Mapper</span> </span><br><span class=\"line\"><span class=\"meta\">@Repository</span> <span class=\"comment\">//用在持久层的接口上，这个注解是将接口的一个实现类交给spring管理</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">interface</span> <span class=\"title\">StudentMapper</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"meta\">@Select(&quot;select * from students where id = #&#123;id&#125;&quot;)</span></span><br><span class=\"line\">    <span class=\"function\">Student <span class=\"title\">findById</span><span class=\"params\">(Integer id)</span></span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>◇springboot整合mybatis的项目示例<a href=\"https://www.cnblogs.com/wangzaiplus/p/10899962.html\">参考链接</a></p>\n","categories":["Spring","SpringBoot"],"tags":["SpringBoot"]},{"title":"SpringCloud开发入门","url":"/p/8a2d.html","content":"<h2 id=\"课程安排\"><a href=\"#课程安排\" class=\"headerlink\" title=\"课程安排\"></a>课程安排</h2><ol>\n<li>Spring Cloud简介 </li>\n<li>项目整体设计 </li>\n<li>课程列表模块开发  </li>\n<li>课程价格模块开发</li>\n<li>服务注册与发现Eureka </li>\n<li>服务间调用OpenFeign  </li>\n<li>负载均衡Ribbon </li>\n<li>熔断器Hystrix </li>\n<li>网关Zuul  </li>\n<li>整体测试 </li>\n<li>项目总结  <h2 id=\"Spring-Cloud简介\"><a href=\"#Spring-Cloud简介\" class=\"headerlink\" title=\"Spring Cloud简介\"></a>Spring Cloud简介</h2>◇ 成熟的微服务框架，定位为开发人员提供工具，以快速构建分布式系统<br>◇核心组件<br><img src=\"/p/8a2d/1637201478519-93f45ace-901c-442c-9163-9e6624fd8722.png\" class=\"lazyload\" data-srcset=\"/p/8a2d/1637201478519-93f45ace-901c-442c-9163-9e6624fd8722.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"></li>\n</ol>\n<h2 id=\"项目整体设计\"><a href=\"#项目整体设计\" class=\"headerlink\" title=\"项目整体设计\"></a>项目整体设计</h2><h3 id=\"接口设计\"><a href=\"#接口设计\" class=\"headerlink\" title=\"接口设计\"></a>接口设计</h3><p>◇课程列表<br>◇单个课程价格<br>◇整合课程列表和价格；首先会通过远程调用获取整个课程列表，然后遍历课程，补充课程价格；</p>\n<h3 id=\"系统数据流向\"><a href=\"#系统数据流向\" class=\"headerlink\" title=\"系统数据流向\"></a>系统数据流向</h3><p><img src=\"/p/8a2d/1637237174459-c8165a19-bc27-46cf-a455-4f6b3583dc22.png\" class=\"lazyload\" data-srcset=\"/p/8a2d/1637237174459-c8165a19-bc27-46cf-a455-4f6b3583dc22.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"></p>\n<h3 id=\"数据库设计\"><a href=\"#数据库设计\" class=\"headerlink\" title=\"数据库设计\"></a>数据库设计</h3><p>◇课程表course<br><img src=\"/p/8a2d/1637237679549-0044ab1b-fb71-4db3-b500-900344d40c98.png\" class=\"lazyload\" data-srcset=\"/p/8a2d/1637237679549-0044ab1b-fb71-4db3-b500-900344d40c98.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"><br>◇课程价格表course_price<br><img src=\"/p/8a2d/1637237804357-252adc06-25d6-48cf-8b03-e9ee6434947c.png\" class=\"lazyload\" data-srcset=\"/p/8a2d/1637237804357-252adc06-25d6-48cf-8b03-e9ee6434947c.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"></p>\n<h2 id=\"项目基础开发\"><a href=\"#项目基础开发\" class=\"headerlink\" title=\"项目基础开发\"></a>项目基础开发</h2><p>◇选择Spring Initalizr项目<br><img src=\"/p/8a2d/1637238522858-02cc690b-3f8b-47a8-8fee-7c8ba43125aa.png\" class=\"lazyload\" data-srcset=\"/p/8a2d/1637238522858-02cc690b-3f8b-47a8-8fee-7c8ba43125aa.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"><br><img src=\"/p/8a2d/1637238754507-9fc39092-aec3-40b9-ba7a-138c3680851f.png\" class=\"lazyload\" data-srcset=\"/p/8a2d/1637238754507-9fc39092-aec3-40b9-ba7a-138c3680851f.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"><br>◇因为是多个模块，所以删除掉src目录；<br>◇右键新建一个module，选择maven；项目名：course-service；然后在course-service里面将src删除，并新建一个模块，course-list,Parent选择course-service；同样的方法在course-service下创建新模块course-price;<br><img src=\"/p/8a2d/1637240760861-d17948bd-126d-4e5b-a407-a0ff6ba4fdfd.png\" class=\"lazyload\" data-srcset=\"/p/8a2d/1637240760861-d17948bd-126d-4e5b-a407-a0ff6ba4fdfd.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"></p>\n<h3 id=\"course-list模块\"><a href=\"#course-list模块\" class=\"headerlink\" title=\"course-list模块\"></a>course-list模块</h3><p>◇配置course-list的pom.xml文件，增加相关依赖和插件</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependencies</span>&gt;</span></span><br><span class=\"line\">       <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">           <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">           <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter-web<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">       <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">       <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">           <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>mysql<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">           <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>mysql-connector-java<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">       <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">       <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">           <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.mybatis.spring.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">           <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">           <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>2.1.1<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">       <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">   <span class=\"tag\">&lt;/<span class=\"name\">dependencies</span>&gt;</span></span><br><span class=\"line\">   <span class=\"tag\">&lt;<span class=\"name\">build</span>&gt;</span></span><br><span class=\"line\">       <span class=\"tag\">&lt;<span class=\"name\">plugins</span>&gt;</span></span><br><span class=\"line\">           <span class=\"tag\">&lt;<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\">               <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">               <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">           <span class=\"tag\">&lt;/<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\">       <span class=\"tag\">&lt;/<span class=\"name\">plugins</span>&gt;</span></span><br><span class=\"line\">   <span class=\"tag\">&lt;/<span class=\"name\">build</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>◇在course-list模块中新建包com.lcg.course,新建应用入口类CourseListApplication；</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.lcg.course;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.boot.SpringApplication;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 项目启动类</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"meta\">@SpringBootApplication</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">CourseListApplication</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">//启动项目</span></span><br><span class=\"line\">        SpringApplication.run(CourseListApplication.class, args);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>◇在course-list的resources目录下新建application.properties进行基础配置</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">server.port=<span class=\"number\">8081</span></span><br><span class=\"line\">spring.datasource.driver-<span class=\"class\"><span class=\"keyword\">class</span>-<span class=\"title\">name</span></span>=com.mysql.cj.jdbc.Driver</span><br><span class=\"line\">spring.datasource.url=jdbc:mysql:<span class=\"comment\">//localhost:3306/course?serverTimezone=UTC&amp;useUnicode=true&amp;characterEncoding=utf-8&amp;useSSL=true</span></span><br><span class=\"line\">spring.datasource.username=root</span><br><span class=\"line\">spring.datasource.password=<span class=\"number\">123456</span></span><br><span class=\"line\">logging.pattern.console=%clr(%d&#123;$&#123;LOG_DATEFORMAT_PATTERN:HH:mm:ss.SSS&#125;&#125;)&#123;faint&#125; %clr($&#123;LOG_LEVEL_PATTERN:-%5p&#125;) %clr($&#123;PID:- &#125;)&#123;magenta&#125; %clr(---)&#123;faint&#125; %clr([%<span class=\"number\">15.</span>15t])&#123;faint&#125; %clr(%-<span class=\"number\">40.</span>40logger&#123;<span class=\"number\">39</span>&#125;)&#123;cyan&#125; %clr(:)&#123;faint&#125; %m%n$&#123;LOG_EXCEPTION_CONVERSION_WORD:%wEx&#125;</span><br><span class=\"line\">mybatis.configuration.map-underscore-to-camel-<span class=\"keyword\">case</span>=<span class=\"keyword\">true</span></span><br><span class=\"line\">spring.application.name=course-list</span><br></pre></td></tr></table></figure>\n<p>◇新建entity包，创建实体类Course;注意实体类需要接入Serializable接口并实现tostring方法以实现序列化；<br>◇新建service包，创建接口CourseListService，然后创建其实现类<br>◇和数据库打交道也需要Mapper类；创建dao包，新建CourseMapper接口；</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Mapper</span></span><br><span class=\"line\"><span class=\"meta\">@Repository</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">interface</span> <span class=\"title\">CourseMapper</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Select(&quot;SELECT * FROM course WHERE valid = 1&quot;)</span></span><br><span class=\"line\">    <span class=\"function\">List&lt;Course&gt; <span class=\"title\">findValidCourses</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>◇新建controller包，创建CourseListController类</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 描述：     CourseListController课程列表Controller</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"meta\">@RestController</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">CourseListController</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    CourseListService courseListService;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@GetMapping(&quot;/courses&quot;)</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> List&lt;Course&gt; <span class=\"title\">courseList</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> courseListService.getCourseList();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"course-price模块\"><a href=\"#course-price模块\" class=\"headerlink\" title=\"course-price模块\"></a>course-price模块</h3><p>◇配置文件pom与course-list相同；<br>◇新增各个包<br><img src=\"/p/8a2d/1637308280783-9d5b99df-41d4-4c4c-9265-108a72dce8bb.png\" class=\"lazyload\" data-srcset=\"/p/8a2d/1637308280783-9d5b99df-41d4-4c4c-9265-108a72dce8bb.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"><br>◇新建mapper类根据课程id查询课程价格</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 描述：     课程价格Mapper类</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"meta\">@Mapper</span></span><br><span class=\"line\"><span class=\"meta\">@Repository</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">interface</span> <span class=\"title\">CoursePriceMapper</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Select(&quot;SELECT * FROM course_price WHERE course_id = #&#123;courseId&#125;&quot;)</span></span><br><span class=\"line\">    <span class=\"function\">CoursePrice <span class=\"title\">findCoursePrice</span><span class=\"params\">(Integer courseId)</span></span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"Eureka\"><a href=\"#Eureka\" class=\"headerlink\" title=\"Eureka\"></a>Eureka</h2><h3 id=\"介绍\"><a href=\"#介绍\" class=\"headerlink\" title=\"介绍\"></a>介绍</h3><p>◇Eureka(服务注册与发现)是Netflix的核心子模块；主要作用是用于定位服务；有了它以后，只需要使用服务的标识符就可以访问到该服务了；其他服务可以使用Eureka的客户端来连接到Eureka的服务端，并且维持心跳链接；这样Eureka可以维护各个模块的实时信息；一个新的服务也可以通过Eureka来找到组件的各个服务的地址；<br>◇为什么需要服务注册与发现；如果没有服务注册与发现，我们开发B服务，需要使用到A服务，那么就需要在B服务中配置A服务的IP地址以便访问；但是如果A服务的IP地址变化，我们在B服务中的配置也要相应的改变，所以就会造成难以维护；<br>◇服务提供者把自己的服务地址提供到服务注册中心，当调用者调用该服务时，通过服务注册中心查询到最新的服务地址进行调用；</p>\n<h3 id=\"Eureka架构\"><a href=\"#Eureka架构\" class=\"headerlink\" title=\"Eureka架构\"></a>Eureka架构</h3><p>◇Eureka Server and Eureka Client<br><img src=\"/p/8a2d/1637312280257-2cc61536-9d50-471c-92ab-f8f50ef2458d.png\" class=\"lazyload\" data-srcset=\"/p/8a2d/1637312280257-2cc61536-9d50-471c-92ab-f8f50ef2458d.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"><br>◇最先启动的就是服务注册中心。然后服务提供者启动，它会去找到配置在服务注册中心的地址，然后把服务内容注册上去；可以进行更新，注销服务等操作；然后就是消费者调用服务，首先会在服务注册中心得到注册表(Get Registry)，拿到最新的服务信息，然后远程调用服务；(注意不是通过服务注册中心调用服务)<br>◇集群架构<br><img src=\"/p/8a2d/1637312645740-4c63b167-f761-4ce4-a7bf-d1b20b460ea2.png\" class=\"lazyload\" data-srcset=\"/p/8a2d/1637312645740-4c63b167-f761-4ce4-a7bf-d1b20b460ea2.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"><br>◇服务注册中心为了提高容灾能力，有多个节点(服务器)；服务提供者可以在不同的服务器节点注册，但注册信息时共享的，消费者找到任一节点即可；</p>\n<h3 id=\"引入Eureka\"><a href=\"#引入Eureka\" class=\"headerlink\" title=\"引入Eureka\"></a>引入Eureka</h3><p>◇新建模块eureka-server<br>◇引入依赖</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">project</span> <span class=\"attr\">xmlns</span>=<span class=\"string\">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">  <span class=\"attr\">xmlns:xsi</span>=<span class=\"string\">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">  <span class=\"attr\">xsi:schemaLocation</span>=<span class=\"string\">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">parent</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-cloud-course-practice<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.imooc<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>0.0.1-SNAPSHOT<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">parent</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">modelVersion</span>&gt;</span>4.0.0<span class=\"tag\">&lt;/<span class=\"name\">modelVersion</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>eureka-server<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.0-SNAPSHOT<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">packaging</span>&gt;</span>jar<span class=\"tag\">&lt;/<span class=\"name\">packaging</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">&lt;!-- 模块名及描述信息 --&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">name</span>&gt;</span>course-eureka-server<span class=\"tag\">&lt;/<span class=\"name\">name</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">description</span>&gt;</span>Spring Cloud Eureka<span class=\"tag\">&lt;/<span class=\"name\">description</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">dependencies</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.cloud<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-server<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">dependencies</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">build</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">plugins</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;/<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">plugins</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">build</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">project</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>◇对于spring-cloud的版本，各个模块都应该统一，所以在最外层的pom文件中增加配置spring-cloud版本</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!--标识Spring Cloud的版本--&gt;</span></span><br><span class=\"line\"> <span class=\"tag\">&lt;<span class=\"name\">dependencyManagement</span>&gt;</span><span class=\"comment\">&lt;!--依赖管理--&gt;</span></span><br><span class=\"line\">   <span class=\"tag\">&lt;<span class=\"name\">dependencies</span>&gt;</span></span><br><span class=\"line\">     <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">       <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.cloud<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">       <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-cloud-dependencies<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">       <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>Greenwich.SR5<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">       <span class=\"tag\">&lt;<span class=\"name\">type</span>&gt;</span>pom<span class=\"tag\">&lt;/<span class=\"name\">type</span>&gt;</span><span class=\"comment\">&lt;!--类型--&gt;</span></span><br><span class=\"line\">       <span class=\"tag\">&lt;<span class=\"name\">scope</span>&gt;</span>import<span class=\"tag\">&lt;/<span class=\"name\">scope</span>&gt;</span><span class=\"comment\">&lt;!--范围，导入时生效--&gt;</span></span><br><span class=\"line\">     <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">   <span class=\"tag\">&lt;/<span class=\"name\">dependencies</span>&gt;</span></span><br><span class=\"line\"> <span class=\"tag\">&lt;/<span class=\"name\">dependencyManagement</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>◇配置文件application.properties</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">spring.application.name=eureka-server</span><br><span class=\"line\">server.port=<span class=\"number\">8000</span></span><br><span class=\"line\">eureka.instance.hostname=localhost</span><br><span class=\"line\">#fetch-registry：获取注册表。不需要同步其他节点数据。</span><br><span class=\"line\">eureka.client.fetch-registry=<span class=\"keyword\">false</span></span><br><span class=\"line\">#register-with-eureka代表是否将自己注册到Eureka Server，默认是<span class=\"keyword\">true</span>。</span><br><span class=\"line\">eureka.client.register-with-eureka=<span class=\"keyword\">false</span></span><br><span class=\"line\">#服务提供的地址</span><br><span class=\"line\">eureka.client.service-url.defaultZone=http:<span class=\"comment\">//$&#123;eureka.instance.hostname&#125;:$&#123;server.port&#125;/eureka/</span></span><br></pre></td></tr></table></figure>\n<p>◇启动注解,创建启动类</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@EnableEurekaServer</span> <span class=\"comment\">//标识Eureka服务的启动类</span></span><br><span class=\"line\"><span class=\"meta\">@SpringBootApplication</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">EurekaServerApplication</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> </span>&#123;</span><br><span class=\"line\">        SpringApplication.run(EurekaServerApplication.class, args);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>◇输入:<a href=\"http://127.0.0.1:8000/\">http://127.0.0.1:8000/</a> ;查看Eurea的默认管理界面<br><img src=\"/p/8a2d/1637389180166-bdb1d1d0-589b-4d59-9eaa-761573bc4205.png\" class=\"lazyload\" data-srcset=\"/p/8a2d/1637389180166-bdb1d1d0-589b-4d59-9eaa-761573bc4205.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"></p>\n<h3 id=\"注册服务\"><a href=\"#注册服务\" class=\"headerlink\" title=\"注册服务\"></a>注册服务</h3><p>◇在course-list中，添加spring-cloud依赖</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.cloud<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-client<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>◇然后在application配置文件中增加eureka服务器连接的配置，这样course-list服务启动后就会自动的在服务注册中心进行注册</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">eureka.client.service-url.defaultZone=http:<span class=\"comment\">//localhost:8000/eureka/</span></span><br></pre></td></tr></table></figure>\n<p>◇先启动eureka服务，然后启动course-list，然后查看服务注册中心页面<br><img src=\"/p/8a2d/1637390984269-a49a7553-e76c-4bb4-b527-e2aefe87cb25.png\" class=\"lazyload\" data-srcset=\"/p/8a2d/1637390984269-a49a7553-e76c-4bb4-b527-e2aefe87cb25.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"><br>◇可以看到我们的课程列表服务成功注册上去<br>◇对于course-price服务也是一样的配置</p>\n<h2 id=\"OpenFeign\"><a href=\"#OpenFeign\" class=\"headerlink\" title=\"OpenFeign\"></a>OpenFeign</h2><h3 id=\"介绍-1\"><a href=\"#介绍-1\" class=\"headerlink\" title=\"介绍\"></a>介绍</h3><p>◇使用此组件可以用来调用远程服务，就像调用本地服务一样方便；<br><img src=\"/p/8a2d/1637392295068-9d336030-c77b-452d-805d-923209ce6177.png\" class=\"lazyload\" data-srcset=\"/p/8a2d/1637392295068-9d336030-c77b-452d-805d-923209ce6177.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"><br>◇提供服务的生产者首先在服务注册中心进行注册，然后使用服务的消费者把服务注册中心的它能够调用的所有服务的地址获取到，而OpenFeign封装了一个发送网络请求的一个工具，然后就利用它去调用服务；</p>\n<h3 id=\"集成Feign\"><a href=\"#集成Feign\" class=\"headerlink\" title=\"集成Feign\"></a>集成Feign</h3><p>◇引入依赖；因为是在cours-price中调用course-list服务，所以在course-price中进行相关依赖的引入</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.cloud<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-cloud-starter-openfeign<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>◇新建一个course-list的客户端接口</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> *  课程列表的Feign客户端,需要参考调用服务的原来用法</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"meta\">@FeignClient(&quot;course-list&quot;)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">interface</span> <span class=\"title\">CourseListClient</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"meta\">@GetMapping(&quot;/courses&quot;)</span></span><br><span class=\"line\">    <span class=\"function\">List&lt;Course&gt; <span class=\"title\">courseList</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>◇Course引入course-list模块中的实体，这样pom文件会自动增加配置</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">&lt;dependency&gt;</span><br><span class=\"line\">  &lt;groupId&gt;com.lcg&lt;/groupId&gt;</span><br><span class=\"line\">  &lt;artifactId&gt;course-list&lt;/artifactId&gt;</span><br><span class=\"line\">  &lt;version&gt;<span class=\"number\">0.0</span><span class=\"number\">.1</span>-SNAPSHOT&lt;/version&gt;</span><br><span class=\"line\">  &lt;scope&gt;compile&lt;/scope&gt;</span><br><span class=\"line\">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>\n<p>◇注解；在course-price的启动类上增加@EnableFeignClients 注解<br>◇调用上面创建的client，在CoursePriceController中新增方法</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Autowired</span></span><br><span class=\"line\">CourseListClient courseListClient;</span><br><span class=\"line\"><span class=\"meta\">@GetMapping(&quot;/courseInPrice&quot;)</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> List&lt;Course&gt; <span class=\"title\">getCourseListInPrice</span><span class=\"params\">(Integer courseId)</span> </span>&#123;</span><br><span class=\"line\">    List&lt;Course&gt; courses = courseListClient.courseList();</span><br><span class=\"line\">    <span class=\"keyword\">return</span> courses;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"负载均衡\"><a href=\"#负载均衡\" class=\"headerlink\" title=\"负载均衡\"></a>负载均衡</h2><h3 id=\"两种类型\"><a href=\"#两种类型\" class=\"headerlink\" title=\"两种类型\"></a>两种类型</h3><p>◇客户端负载均衡(Ribbon);<br>◇服务端负载均衡(Nginx)；对于所有的请求，都应该先达到Nginx节点，有它进行分发转发；<br>◇以上两个负载均衡可以同时存在的，比如一个大型服务，用户的请求就会先达到Nginx上；而Ribbon主要用于服务内部，即服务之间也会进行相互调用，就没有必要通过Nginx，直接采用Ribbon；</p>\n<h3 id=\"负载均衡策略\"><a href=\"#负载均衡策略\" class=\"headerlink\" title=\"负载均衡策略\"></a>负载均衡策略</h3><p>◇RandomRule 表示随机策略，每次回随机进行调用<br>◇RoundRobinRule 表示轮询策略，即周而复始的循环；这种策略可以比较好的平衡各个节点的压力；<br>◇ResponseTimeWeightedRule加权， 根据每一个 Server 的平均响应时间动态加权<br>◇如果要配置不同的负载均衡方式可以在application文件中对 Ribbon.NFLoadBalancerRuleClassName  进行设置；</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">#在客户端course-price中指定模块course-list的负载均衡方式</span><br><span class=\"line\">course-list.ribbon.NFLoadBanlancerRuleClassName=com.netflix.loadbalancer.RoundRobinRule</span><br></pre></td></tr></table></figure>\n<h2 id=\"断路器\"><a href=\"#断路器\" class=\"headerlink\" title=\"断路器\"></a>断路器</h2><h3 id=\"为什么需要断路器\"><a href=\"#为什么需要断路器\" class=\"headerlink\" title=\"为什么需要断路器\"></a>为什么需要断路器</h3><p>◇我们在远程调用服务的时候，如果某一个服务出现了延迟，就会导致整体项目的延迟；如左下图，一个用户的请求依赖于多个服务，其中红色的代表出现了延迟；假设服务I的功能是找到用户信息，而其他是下单之类的功能；那么在没有得到用户信息之前，是无法进行下单的，这样一来用户请求就会卡在订单处；<br>◇又或者如右下图，服务I服务于多个用户，当该服务出现延迟后，这些用户请求都会卡住，并且用户请求前面的服务的资源也得不到释放，比如前面的服务A是连接数据库的，而数据库的连接池有上限，若有大量用户卡在I处，但是用户的连接数不会释放，这样数据库就会资源耗尽，导致系统不可用；<br><img src=\"/p/8a2d/1637407392505-057e0933-53ae-4670-b52f-7ea0d8b56bc7.png\" class=\"lazyload\" data-srcset=\"/p/8a2d/1637407392505-057e0933-53ae-4670-b52f-7ea0d8b56bc7.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"><br>◇断路器的作用就是将出现故障的单元隔离开，防止其影响到其他单元进而导致整个系统不可用；如在淘宝双十一活动时如果下单业务出现故障，只是当前无法下单，而不会整个系统卡死；</p>\n<h3 id=\"Hystrix\"><a href=\"#Hystrix\" class=\"headerlink\" title=\"Hystrix\"></a>Hystrix</h3><p>◇Hystrix可以快速的构建一个断路功能；当某一个服务发生故障的时候我们会返回一个默认的响应，而不是长时间的让用户去等待，这样就不会让我们的线程去调用故障服务，又调用不通导致其占用的资源不能释放，避免在分布式系统中故障的蔓延；</p>\n<h3 id=\"编码实现断路器\"><a href=\"#编码实现断路器\" class=\"headerlink\" title=\"编码实现断路器\"></a>编码实现断路器</h3><p>◇给course-price增加断路器功能；在pom中引入依赖</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">&lt;dependency&gt;</span><br><span class=\"line\">  &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</span><br><span class=\"line\">  &lt;artifactId&gt;spring-cloud-starter-netflix-hystrix&lt;/artifactId&gt;</span><br><span class=\"line\">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>\n<p>◇进行配置，开启断路器</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">feign.hystrix.enabled=<span class=\"keyword\">true</span></span><br></pre></td></tr></table></figure>\n<p>◇在启动类上增加@EnableCircuitBreaker注解，表示断路器<br>◇因为是调用的课程列表服务，所以就在CourseListClient接口的注解中指明断路后执行的类</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//设置服务的value,以及指定断路器实现类</span></span><br><span class=\"line\"><span class=\"meta\">@FeignClient(value = &quot;course-list&quot;,fallback = CourseListClientHystrix.class )</span></span><br><span class=\"line\"><span class=\"meta\">@Primary</span> <span class=\"comment\">//即当同类型的bean有多个的时候,手动的设置去注入哪一个(实现接口的类也算一个bean)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">interface</span> <span class=\"title\">CourseListClient</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"meta\">@GetMapping(&quot;/courses&quot;)</span></span><br><span class=\"line\">    <span class=\"function\">List&lt;Course&gt; <span class=\"title\">courseList</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>◇断路实现类</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> *  断路器实现类,出错返回一个空的课程列表</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"meta\">@Component</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">CourseListClientHystrix</span> <span class=\"keyword\">implements</span> <span class=\"title\">CourseListClient</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> List&lt;Course&gt; <span class=\"title\">courseList</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> Collections.emptyList();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>◇关闭course-list服务就能够模拟断路；</p>\n<h2 id=\"整合两个服务\"><a href=\"#整合两个服务\" class=\"headerlink\" title=\"整合两个服务\"></a>整合两个服务</h2><p>◇course-price模块中新增实体类</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 课程与价格的融合类</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">CourseAndPrice</span> <span class=\"keyword\">implements</span> <span class=\"title\">Serializable</span> </span>&#123;</span><br><span class=\"line\">    Integer id;</span><br><span class=\"line\">    Integer courseId;</span><br><span class=\"line\">    String name;</span><br><span class=\"line\">    Integer price;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>◇service中新增方法及其实现；得到课程价格对象</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//接口方法</span></span><br><span class=\"line\"><span class=\"function\">List&lt;CourseAndPrice&gt; <span class=\"title\">getCourseAndPrice</span><span class=\"params\">()</span></span>;</span><br></pre></td></tr></table></figure>\n<p>–实现</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> List&lt;CourseAndPrice&gt; <span class=\"title\">getCourseAndPrice</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        List&lt;Course&gt; courses = courseListClient.courseList();</span><br><span class=\"line\">        List&lt;CourseAndPrice&gt; courseAndPrices = <span class=\"keyword\">new</span> ArrayList&lt;&gt;();</span><br><span class=\"line\">        <span class=\"comment\">//遍历得到的课程</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> (Course course:courses) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (course != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">                <span class=\"comment\">//拿到的不为空的课程,根据课程的id查询到它的价格</span></span><br><span class=\"line\">                CoursePrice coursePrice = getCoursePrice(course.getCourseId());</span><br><span class=\"line\">                CourseAndPrice courseAndPrice = <span class=\"keyword\">new</span> CourseAndPrice();</span><br><span class=\"line\">                <span class=\"comment\">//进行课程和价格的拼接</span></span><br><span class=\"line\">                courseAndPrice.setPrice(coursePrice.getPrice());</span><br><span class=\"line\">                courseAndPrice.setName(course.getName());</span><br><span class=\"line\">                courseAndPrice.setCourseId(course.getCourseId());</span><br><span class=\"line\">                courseAndPrice.setId(course.getId());</span><br><span class=\"line\">                courseAndPrices.add(courseAndPrice);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> courseAndPrices;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n<p>◇在course-price模块的控制器类中增加方法调用service服务</p>\n<h2 id=\"网关Zuul\"><a href=\"#网关Zuul\" class=\"headerlink\" title=\"网关Zuul\"></a>网关Zuul</h2><h3 id=\"为什么需要网关\"><a href=\"#为什么需要网关\" class=\"headerlink\" title=\"为什么需要网关\"></a>为什么需要网关</h3><p>◇签名校验、登录校验冗余问题；为了保证系统的安全就不得不在每一个模块中加入校验的逻辑，判断用户账号密码正确与否；如果没有网关去做统一的校验我们就得在每个模块都编写同样的校验代码，造成冗余；维护性也比较差；<br>◇Spring Cloud Zuul是Spring Cloud中的一个组件，它会和Eureka进行整合，它本身是Eureka的一个client，会注册到Eureka上；有了Zuul以后，假设其端口号是8083，那么用户可以直接访问8083端口而不做模块的区分，然后网关去区分不同的模块，另一作用就是统一校验；</p>\n<h3 id=\"Zuul介绍\"><a href=\"#Zuul介绍\" class=\"headerlink\" title=\"Zuul介绍\"></a>Zuul介绍</h3><p><img src=\"/p/8a2d/1637415602338-e1dc1b10-b6fd-4fcd-b91c-e3e06c2845e0.png\" class=\"lazyload\" data-srcset=\"/p/8a2d/1637415602338-e1dc1b10-b6fd-4fcd-b91c-e3e06c2845e0.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"><br>◇如上图，手机即代表用户；用户在访问的时候并不会直接访问到我们的服务，而是先访问到网关；网关在从服务注册中心获取到各个服务模块提前注册好的信息；这样网关就知道各个模块在哪里，然后对用户的请求进行正确的转发；</p>\n<h3 id=\"集成Zuul\"><a href=\"#集成Zuul\" class=\"headerlink\" title=\"集成Zuul\"></a>集成Zuul</h3><p>◇把Zuul注册到Eureka服务注册中心；需要新建一个模块course-zuul<br>◇pom文件引入依赖</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependencies</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.cloud<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-client<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.cloud<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-cloud-starter-netflix-zuul<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependencies</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">build</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">plugins</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">plugins</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">build</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>◇新建启动类</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 描述：     网关启动类</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"meta\">@EnableZuulProxy</span></span><br><span class=\"line\"><span class=\"meta\">@SpringCloudApplication</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ZuulGatewayApplication</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> </span>&#123;</span><br><span class=\"line\">        SpringApplication.run(ZuulGatewayApplication.class, args);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>◇配置路由地址等信息</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">spring.application.name=course-gateway</span><br><span class=\"line\">server.port=<span class=\"number\">9000</span></span><br><span class=\"line\">#配置日志</span><br><span class=\"line\">logging.pattern.console=%clr(%d&#123;$&#123;LOG_DATEFORMAT_PATTERN:HH:mm:ss.SSS&#125;&#125;)&#123;faint&#125; %clr($&#123;LOG_LEVEL_PATTERN:-%5p&#125;) %clr($&#123;PID:- &#125;)&#123;magenta&#125; %clr(---)&#123;faint&#125; %clr([%<span class=\"number\">15.</span>15t])&#123;faint&#125; %clr(%-<span class=\"number\">40.</span>40logger&#123;<span class=\"number\">39</span>&#125;)&#123;cyan&#125; %clr(:)&#123;faint&#125; %m%n$&#123;LOG_EXCEPTION_CONVERSION_WORD:%wEx&#125;</span><br><span class=\"line\">mybatis.configuration.map-underscore-to-camel-<span class=\"keyword\">case</span>=<span class=\"keyword\">true</span></span><br><span class=\"line\">    </span><br><span class=\"line\">eureka.client.service-url.defaultZone=http:<span class=\"comment\">//localhost:8000/eureka/</span></span><br><span class=\"line\"></span><br><span class=\"line\">#配置zuul的统一前缀</span><br><span class=\"line\">zuul.prefix=/lcg  </span><br><span class=\"line\">#配置各个模块的前缀</span><br><span class=\"line\">zuul.routes.course-list.path=/list<span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">#指定服务名</span></span><br><span class=\"line\"><span class=\"comment\">zuul.routes.course-list.service-id=course-list</span></span><br><span class=\"line\"><span class=\"comment\"></span></span><br><span class=\"line\"><span class=\"comment\">zuul.routes.course-price.path=/price/**</span></span><br><span class=\"line\"><span class=\"comment\">zuul.routes.course-price.service-id=course-price</span></span><br></pre></td></tr></table></figure>\n<p>◇访问course-list模块：127.0.0.1:9000/lcg/list即可；</p>\n<h3 id=\"利用网关实现过滤器\"><a href=\"#利用网关实现过滤器\" class=\"headerlink\" title=\"利用网关实现过滤器\"></a>利用网关实现过滤器</h3><p>◇ pre 过滤器在路由请求之前运行<br>◇ route 过滤器可以处理请求的实际路由<br>◇ post 路由请求后运行过滤器<br>◇ error 如果在处理请求的过程中发生错误，则过滤器将运行<br>◇新建包filter；然后新建两个过滤器；<br>◇pre过滤器，这里用来记录请求的时间</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 描述：     记录请求时间</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"meta\">@Component</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">PreRequestFilter</span> <span class=\"keyword\">extends</span> <span class=\"title\">ZuulFilter</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">filterType</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">//过滤器的类型</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> FilterConstants.PRE_TYPE;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">int</span> <span class=\"title\">filterOrder</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">boolean</span> <span class=\"title\">shouldFilter</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">//是否启用过滤器,在这里也可以写一些逻辑对需要过滤的url进行过滤</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">true</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> Object <span class=\"title\">run</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> ZuulException </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">//获取上下文</span></span><br><span class=\"line\">        RequestContext currentContext = RequestContext.getCurrentContext();</span><br><span class=\"line\">        <span class=\"comment\">//记录当前时间</span></span><br><span class=\"line\">        currentContext.set(<span class=\"string\">&quot;startTime&quot;</span>, System.currentTimeMillis());</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;过滤器已经记录时间&quot;</span>);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">null</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>◇post过滤器</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 描述：     请求处理后的过滤器</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"meta\">@Component</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">PostRequestFilter</span> <span class=\"keyword\">extends</span> <span class=\"title\">ZuulFilter</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">filterType</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> FilterConstants.POST_TYPE;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//通过int值来定义过滤器的执行顺序,默认为0,数字越大,优先级越低</span></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">int</span> <span class=\"title\">filterOrder</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">//过滤器请求最后的位置(默认1000) - 1 即在它之前一点点的时机运行</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> FilterConstants.SEND_RESPONSE_FILTER_ORDER - <span class=\"number\">1</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">boolean</span> <span class=\"title\">shouldFilter</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">true</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> Object <span class=\"title\">run</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> ZuulException </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">//获取上下文</span></span><br><span class=\"line\">        RequestContext currentContext = RequestContext.getCurrentContext();</span><br><span class=\"line\">        Long startTime = (Long) currentContext.get(<span class=\"string\">&quot;startTime&quot;</span>);<span class=\"comment\">//获取请求时间</span></span><br><span class=\"line\">        <span class=\"keyword\">long</span> duration = System.currentTimeMillis() - startTime;</span><br><span class=\"line\">        String requestURI = currentContext.getRequest().getRequestURI();<span class=\"comment\">//获取uri</span></span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;uri:&quot;</span> + requestURI + <span class=\"string\">&quot;,处理时长：&quot;</span> + duration);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">null</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n","categories":["分布式与微服务"],"tags":["SpringCloud"]},{"title":"Spring JDBC与事务管理","url":"/p/d79b.html","content":"<h2 id=\"课程介绍\"><a href=\"#课程介绍\" class=\"headerlink\" title=\"课程介绍\"></a>课程介绍</h2><p>◇Spring JDBC与JdbcTemplate对象<br>◇声明式事务与两种配置方式<br>◇声明式事务七种事务传播行为  </p>\n<h2 id=\"Spring-JDBC\"><a href=\"#Spring-JDBC\" class=\"headerlink\" title=\"Spring JDBC\"></a>Spring JDBC</h2><h3 id=\"简介\"><a href=\"#简介\" class=\"headerlink\" title=\"简介\"></a>简介</h3><p>◇Spring JDBC是Spring生态用于处理关系型数据库的模块<br>◇Spring JDBC对JDBC API进行封装，极大简化开发工作量<br>◇JdbcTemplate是Spring JDBC核心类，提供数据CRUD方法<br>◇有Mybatis为什么还需要Spring JDBC？<br>答：这两者面向的对象不一样，Mybatis封装程度较高，适合中小企业做软件的敏捷开发，让程序员可以快速的完成数据库的交互工作；但是封装程度高意味着执行效率较低；而Spring JDBC只是对原始的JDBC的API进行简单封装，执行效率较高；</p>\n<h3 id=\"Spring-JDBC的使用步骤\"><a href=\"#Spring-JDBC的使用步骤\" class=\"headerlink\" title=\"Spring JDBC的使用步骤\"></a>Spring JDBC的使用步骤</h3><p>◇Maven工程引入依赖spring-jdbc<br>◇applicationContext.xml配置DataSource数据源<br>◇在Dao注入JdbcTemplate对象,实现数据CRUD  </p>\n<h2 id=\"jdbcTemplate实现增删改查\"><a href=\"#jdbcTemplate实现增删改查\" class=\"headerlink\" title=\"jdbcTemplate实现增删改查\"></a>jdbcTemplate实现增删改查</h2><p><strong>代码实现(jdbc/s01)</strong><br>◇由于代码过于繁多，因此不再展示。仅将代码中主要方法思路记下。具体代码见文件夹的项目；</p>\n<h3 id=\"执行查询\"><a href=\"#执行查询\" class=\"headerlink\" title=\"执行查询\"></a>执行查询</h3><p><strong>◇核心配置文件pom.xml **<br>加载底层依赖：spring-context, spring-jdbc, mysql-connector-java;<br><strong>◇新增实体类Employee</strong><br>实体成员和数据库保持一致。<br><strong>◇新增Dao</strong><br><strong>jdbcTemplate</strong>.queryForObject()方法的含义是进行指定的查询(查询单条语句)，将唯一返回的数据转换为对应的对象，第一个参数是sql语句，第二个参数是与sql语句对应的参数(如sql需要查询的属性)一般用new object数组实现，如</strong>new <strong>Object[]{“研发部”}；最后一个参数是</strong>new <strong>BeanPropertyRowMapper<Employee>(Employee.<strong>class</strong>)，其中BeanPropertyRowMapper的含义是指将bean属性和每一行的列进行一一匹配，即从数据库记录到实体对象的转化；<br><strong>jdbcTemplate</strong>.query()方法用于查询复合数据，默认返回list集合，参数和queryForObject()方法一致；<br><strong>◇applicationContext.xml配置文件</strong><br>定义数据源，说明要连接哪一个数据库，用户名，密码等；<br>配置JdbcTemplate以提供数据CRUD(增删改查)的API；<br>为Dao注入JdbcTemplate对象，只有注入以后，我们的具体的业务方法才可以去掉用jdbcTemplate相应的API来完成数据库的增删改查操作；<br>◇如果查询的字段没有与之对应的实体属性，该怎么办？<br>答：使用</Employee></strong>jdbcTemplate**.queryForList()方法，将查询结果作为列表返回，同时将每一条数据按map对象进行包裹；该方法前两个参数和上述一致，但没有第三个参数；List中没一条数据都是一个Map对象，Map的Key是原始的字段名，Value是字段名所对应的数值；通过此方法，不过结果有没有对应的实体属性，都将其放入Map中，安装键值对的规则进行保存，每一个Map就对应着一条记录；</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"> <span class=\"comment\">//将查询结果作为Map进行封装</span></span><br><span class=\"line\">List&lt;Map&lt;String, Object&gt;&gt; maps = jdbcTemplate.queryForList(sql, <span class=\"keyword\">new</span> Object[]&#123;dname&#125;);</span><br></pre></td></tr></table></figure>\n<h3 id=\"执行插入\"><a href=\"#执行插入\" class=\"headerlink\" title=\"执行插入\"></a>执行插入</h3><p>◇插入的方法为**jdbcTemplate.**update()方法；第一个参数为sql语句，第二个为传入的参数(new Object[])；new Object[]的数据来源从实体类的get中将与之对应的属性进行提取；</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">insert</span><span class=\"params\">(Employee employee)</span></span>&#123;</span><br><span class=\"line\">        String sql = <span class=\"string\">&quot;insert into employee(eno,ename,salary,dname,hiredate) values(?,?,?,?,?)&quot;</span>;</span><br><span class=\"line\">        <span class=\"comment\">//利用update方法实现数据写入操作</span></span><br><span class=\"line\">        jdbcTemplate.update(sql,<span class=\"keyword\">new</span> Object[]&#123;</span><br><span class=\"line\">           employee.getEno() , employee.getEname(),employee.getSalary(),employee.getDname() , employee.getHiredate()</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"执行更新\"><a href=\"#执行更新\" class=\"headerlink\" title=\"执行更新\"></a>执行更新</h3><p>◇更新的方法和插入方法一样；只不过SQL语句不同；update方法有一个返回值，代表执行本次sql语句所真实影响的数据条目；</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">int</span> <span class=\"title\">update</span><span class=\"params\">(Employee employee)</span></span>&#123;</span><br><span class=\"line\">    String sql = <span class=\"string\">&quot;UPDATE employee SET ename = ?, salary = ?, dname = ?, hiredate = ? WHERE eno = ?&quot;</span>;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> count = jdbcTemplate.update(sql, <span class=\"keyword\">new</span> Object[]&#123;employee.getEname(), employee.getSalary(), employee.getDname(), employee.getHiredate(), employee.getEno()&#125;);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> count;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>◇测试用例</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Test</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span>  <span class=\"title\">testUpdate</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">    Employee employee = employeeDao.findById(<span class=\"number\">8888</span>);</span><br><span class=\"line\">    employee.setSalary(employee.getSalary() + <span class=\"number\">1000</span>);</span><br><span class=\"line\">    <span class=\"keyword\">int</span> count = employeeDao.update(employee);</span><br><span class=\"line\">    System.out.println(<span class=\"string\">&quot;本次更新&quot;</span> + count + <span class=\"string\">&quot;条数据&quot;</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"执行删除\"><a href=\"#执行删除\" class=\"headerlink\" title=\"执行删除\"></a>执行删除</h3><p>◇执行删除的方法也是update；</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">int</span> <span class=\"title\">delete</span><span class=\"params\">(Integer eno)</span></span>&#123;</span><br><span class=\"line\">     String sql = <span class=\"string\">&quot;delete from employee where eno = ?&quot;</span>;</span><br><span class=\"line\">     <span class=\"keyword\">return</span> jdbcTemplate.update(sql, <span class=\"keyword\">new</span> Object[]&#123;eno&#125;);</span><br><span class=\"line\"> &#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"Spring事务管理\"><a href=\"#Spring事务管理\" class=\"headerlink\" title=\"Spring事务管理\"></a>Spring事务管理</h2><h3 id=\"什么是事务\"><a href=\"#什么是事务\" class=\"headerlink\" title=\"什么是事务\"></a>什么是事务</h3><p>◇事务是以一种可靠的、一致的方式，访问和操作数据库的 程序单元<br>◇ 通俗地说：要么把事情做完，要么什么都不做，不要做一半<br>◇ 事务依赖于数据库实现,MySQL通过事务区作为数据缓冲地带  </p>\n<h3 id=\"编程式事务\"><a href=\"#编程式事务\" class=\"headerlink\" title=\"编程式事务\"></a>编程式事务</h3><p>◇编程式事务是指通过代码手动提交回滚事务的事务控制方法<br>◇SpringJDBC通过TransactionManager事务管理器实现事务控制<br>◇事务管理器提供commit/rollback方法进行事务提交与回滚</p>\n<h3 id=\"代码演示编程式事务-s01\"><a href=\"#代码演示编程式事务-s01\" class=\"headerlink\" title=\"代码演示编程式事务(s01)\"></a>代码演示编程式事务(s01)</h3><p>◇需求分析：最近公司入职了十名新员工，需要将这十名新员工批量的导入到员工表当中，对于导入的要求，要么一次性全部导入，要么什么都不做；<br>◇通过需求分析可知，需要通过事务来进行控制。业务逻辑的代码一般写在service包里，所以新增service；<br><strong>◇EmployeeService</strong><br>底层依赖于EmployeeDao；增加batchImport()方法，用于批量导入；利用for循环模拟十名员工；数据插入调用方法<strong>employeeDao</strong>.insert();<br>Service写好后还要在applicationContext中进行配置，beanId为employeeService，class指向service类；属性注入employeeDao;<br>但是，这样写的代码并不正确；因为通过打印日志可以看出这十个员工数据的插入并不是在同一事务中进行的。<br>在pom.xml中加载日志组件logback-classic，Spring框架默认集成此组件；<br>◇那么要怎么实现事务批量导入呢？<br>作为编程式事务，需要配置bean对象，beanId为transactionManager，意为事务管理器，其用途就是控制事务的提交和回滚；class为org.springframework.jdbc.datasource.DataSourceTransactionManager;  基于数据源的事务管理器，需要绑定数据源；ref=”dataSource”；在需要进行事务控制的类里边进行transactionManager的注入；<br>**private **DataSourceTransactionManager <strong>transactionManager</strong>;在生成get和set方法；然后在applicationContext配置文件的Service配置中注入事务管理器的bean: </p>\n<figure class=\"highlight xml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;employeeService&quot;</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;com.lcg.spring.jdbc.service.EmployeeService&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;employeeDao&quot;</span> <span class=\"attr\">ref</span>=<span class=\"string\">&quot;employeeDao&quot;</span>/&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;transactionManager&quot;</span> <span class=\"attr\">ref</span>=<span class=\"string\">&quot;transactionManager&quot;</span>/&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>作为batchImport需要进行事务管理，所以在此方法执行前增加事务默认的标准配置；开始一个事务，说明此段代码后的所有增删改查都进入了事务管理；</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">batchImport</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">//定义了事务默认的标准配置</span></span><br><span class=\"line\">    TransactionDefinition definition = <span class=\"keyword\">new</span> DefaultTransactionDefinition();</span><br><span class=\"line\">    <span class=\"comment\">//开始(创建)一个事务,返回的对象为事务状态,事务状态说明当前事务的执行阶段</span></span><br><span class=\"line\">    TransactionStatus status = transactionManager.getTransaction(definition);</span><br><span class=\"line\">    <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">1</span>; i &lt;= <span class=\"number\">10</span>; i++) &#123;</span><br><span class=\"line\">            <span class=\"comment\">/*if (i == 3) &#123;</span></span><br><span class=\"line\"><span class=\"comment\">                throw new RuntimeException(&quot;意料之外的异常&quot;);</span></span><br><span class=\"line\"><span class=\"comment\">            &#125;*/</span></span><br><span class=\"line\">            Employee employee = <span class=\"keyword\">new</span> Employee();</span><br><span class=\"line\">            employee.setEno(<span class=\"number\">8000</span> + i);</span><br><span class=\"line\">            employee.setEname(<span class=\"string\">&quot;员工&quot;</span> + i);</span><br><span class=\"line\">            employee.setSalary(<span class=\"number\">4000f</span>);</span><br><span class=\"line\">            employee.setDname(<span class=\"string\">&quot;市场部&quot;</span>);</span><br><span class=\"line\">            employee.setHiredate(<span class=\"keyword\">new</span> Date());</span><br><span class=\"line\">            employeeDao.insert(employee);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">//提交事务,参数为status</span></span><br><span class=\"line\">        transactionManager.commit(status);</span><br><span class=\"line\">    &#125;<span class=\"keyword\">catch</span> (RuntimeException e)&#123;</span><br><span class=\"line\">        <span class=\"comment\">//出现异常，回滚事务</span></span><br><span class=\"line\">        transactionManager.rollback(status);</span><br><span class=\"line\">        <span class=\"keyword\">throw</span> e;<span class=\"comment\">//可以捕获异常，也可以抛出异常，视具体业务而定</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>通过事务，已经执行成功的sql语句并非直接修改在表中，而是在事务区内，当所有的事务都执行成功后才写入到数据表中，如果遇到异常则会进行回滚；<br>◇编程式事务的优点：代码写在程序中，对程序员友好；缺点：存在人为的风险，产生数据不完整的情况；</p>\n<h3 id=\"声明式事务\"><a href=\"#声明式事务\" class=\"headerlink\" title=\"声明式事务\"></a>声明式事务</h3><p>◇声明式事务指使用配置或注解，在不修改源码情况下通过配置形式自动实现事务控制，声明式事务的本质就是AOP环绕通知；<br>◇ 当目标方法执行成功时,自动提交事务<br>◇ 当目标方法抛出运行时异常时,自动事务回滚  </p>\n<h3 id=\"配置过程\"><a href=\"#配置过程\" class=\"headerlink\" title=\"配置过程\"></a>配置过程</h3><p>◇配置TransactionManager事务管理器<br>◇配置事务通知与事务属性<br>◇为事务通知绑定PointCut切点(PointCut说明在哪个类哪个方法上应用通知)</p>\n<h3 id=\"代码演示声明式事务-s02\"><a href=\"#代码演示声明式事务-s02\" class=\"headerlink\" title=\"代码演示声明式事务(s02)\"></a>代码演示声明式事务(s02)</h3><p>◇声明式事务直接在配置文件中配置即可<br><strong>◇applicationContext的配置</strong><br>第一步，和编程式一样需要配置事务管理器，绑定数据源；<br>第二步，事务通知配置；需要新增命名空间:<strong>xmlns:tx=”<a href=\"http://www.springframework.org/schema/tx&quot;\">http://www.springframework.org/schema/tx&quot;</a></strong><br>以及命名空间所对应的url的描述文件(xsd)得实际地址；以及AOP的命名空间(<strong>xmlns:aop=”<a href=\"http://www.springframework.org/schema/aop&quot;\">http://www.springframework.org/schema/aop&quot;</a></strong>)和实际的xsd文件地址</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"code\"><pre><span class=\"line\">http://www.springframework.org/schema/tx</span><br><span class=\"line\">https://www.springframework.org/schema/tx/spring-tx.xsd</span><br><span class=\"line\"></span><br><span class=\"line\">http://www.springframework.org/schema/aop</span><br><span class=\"line\">https://www.springframework.org/schema/aop/spring-aop.xsd</span><br></pre></td></tr></table></figure>\n<p>事务通知配置，决定哪些方法使用事务，哪些方法不使用事务，配置方法如下：<br>propagation表示设置事务的传播行为，propagation=”REQUIRED”表示需要使用事务；read-only=”true”表示当前方法是只读的，propagation=”NOT_SUPPORTED”表示方法不支持事务；</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"code\"><pre><span class=\"line\">   </span><br><span class=\"line\"> <span class=\"comment\">&lt;!-- 1.事务管理器,用于创建事务/提交/回滚 --&gt;</span></span><br><span class=\"line\">   <span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;transactionManager&quot;</span> \t\t  <span class=\"attr\">class</span>=<span class=\"string\">&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;</span>&gt;</span></span><br><span class=\"line\">       <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;dataSource&quot;</span> <span class=\"attr\">ref</span>=<span class=\"string\">&quot;dataSource&quot;</span>/&gt;</span></span><br><span class=\"line\">   <span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">   <span class=\"comment\">&lt;!--2.事务通知配置,决定哪些方法使用事务,哪些方法不使用事务 --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">tx:advice</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;txAdvice&quot;</span> <span class=\"attr\">transaction-manager</span>=<span class=\"string\">&quot;transactionManager&quot;</span>&gt;</span></span><br><span class=\"line\">       <span class=\"tag\">&lt;<span class=\"name\">tx:attributes</span>&gt;</span></span><br><span class=\"line\">           <span class=\"comment\">&lt;!-- 目标方法名为batchImport时,启用声明式事务,成功提交,运行时异常回滚 --&gt;</span></span><br><span class=\"line\">           <span class=\"tag\">&lt;<span class=\"name\">tx:method</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;batchImport&quot;</span> <span class=\"attr\">propagation</span>=<span class=\"string\">&quot;REQUIRED&quot;</span>/&gt;</span></span><br><span class=\"line\">           <span class=\"tag\">&lt;<span class=\"name\">tx:method</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;batch*&quot;</span> <span class=\"attr\">propagation</span>=<span class=\"string\">&quot;REQUIRED&quot;</span>/&gt;</span></span><br><span class=\"line\">           <span class=\"comment\">&lt;!-- 设置所有findXXX方法不需要使用事务 --&gt;</span></span><br><span class=\"line\">           <span class=\"tag\">&lt;<span class=\"name\">tx:method</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;find*&quot;</span> <span class=\"attr\">propagation</span>=<span class=\"string\">&quot;NOT_SUPPORTED&quot;</span> <span class=\"attr\">read-only</span>=<span class=\"string\">&quot;true&quot;</span>/&gt;</span></span><br><span class=\"line\">           <span class=\"tag\">&lt;<span class=\"name\">tx:method</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;get*&quot;</span> <span class=\"attr\">propagation</span>=<span class=\"string\">&quot;NOT_SUPPORTED&quot;</span> <span class=\"attr\">read-only</span>=<span class=\"string\">&quot;true&quot;</span>/&gt;</span></span><br><span class=\"line\">           //其他选项，一律按如下实现</span><br><span class=\"line\">           <span class=\"tag\">&lt;<span class=\"name\">tx:method</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;*&quot;</span> <span class=\"attr\">propagation</span>=<span class=\"string\">&quot;REQUIRED&quot;</span>/&gt;</span></span><br><span class=\"line\">       <span class=\"tag\">&lt;/<span class=\"name\">tx:attributes</span>&gt;</span></span><br><span class=\"line\">   <span class=\"tag\">&lt;/<span class=\"name\">tx:advice</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>第三步，定义切点作用范围，并关联到通知上</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!--3. 定义声明式事务的作用范围--&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">aop:config</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">aop:pointcut</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;pointcut&quot;</span> <span class=\"attr\">expression</span>=<span class=\"string\">&quot;execution(* com.lcg..*Service.*(..))&quot;</span>/&gt;</span></span><br><span class=\"line\">        //与通知关联</span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">aop:advisor</span> <span class=\"attr\">advice-ref</span>=<span class=\"string\">&quot;txAdvice&quot;</span> <span class=\"attr\">pointcut-ref</span>=<span class=\"string\">&quot;pointcut&quot;</span>/&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">aop:config</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"事务传播行为\"><a href=\"#事务传播行为\" class=\"headerlink\" title=\"事务传播行为\"></a>事务传播行为</h3><p>◇事务传播行为是指多个拥有事务的方法在嵌套调用时的事务控制方式<br>◇XML：&lt;tx:method name=”…” propagation=”REQUIRED”/&gt;<br>◇注解：@Transactional(propagation=Propagation.REQUIRED)<br>◇如果还有大量的类似batchImport的批量任务需要开发，则可以创建一个专用于批量导入的服务类BatchService，类的方法可以有很多批量导入的方法；批量导入的服务执行入口放在EmployeeService服务类里边；需要为批量服务类进行bean配置以及注入；</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;batchService&quot;</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;com.lcg.spring.jdbc.service.BatchService&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;employeeDao&quot;</span> <span class=\"attr\">ref</span>=<span class=\"string\">&quot;employeeDao&quot;</span>/&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"事务传播行为七种类型\"><a href=\"#事务传播行为七种类型\" class=\"headerlink\" title=\"事务传播行为七种类型\"></a>事务传播行为七种类型</h3><p><img src=\"/p/d79b/1633676701801-8ff4303e-1a5d-4f38-9b35-95adeb808314.png\" class=\"lazyload\" data-srcset=\"/p/d79b/1633676701801-8ff4303e-1a5d-4f38-9b35-95adeb808314.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"><br>◇代码分析<br>–EmployeeService类中的批量导入方法</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">startImportJob</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">       batchService.importJob1();</span><br><span class=\"line\">       <span class=\"keyword\">if</span>(<span class=\"number\">1</span>==<span class=\"number\">1</span>)&#123;</span><br><span class=\"line\">           <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> RuntimeException(<span class=\"string\">&quot;意料之外的异常&quot;</span>);</span><br><span class=\"line\">       &#125;</span><br><span class=\"line\">       batchService.importJob2();</span><br><span class=\"line\">       System.out.println(<span class=\"string\">&quot;批量导入成功&quot;</span>);</span><br><span class=\"line\">   &#125;</span><br></pre></td></tr></table></figure>\n<p>–方法的配置情况</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">tx:method</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;importJob1&quot;</span> <span class=\"attr\">propagation</span>=<span class=\"string\">&quot;REQUIRED&quot;</span>/&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">tx:method</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;importJob2&quot;</span> <span class=\"attr\">propagation</span>=<span class=\"string\">&quot;REQUIRED&quot;</span>/&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">tx:method</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;*&quot;</span> <span class=\"attr\">propagation</span>=<span class=\"string\">&quot;REQUIRED&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>\n<p>◇通过配置信息可以知道对于方法startImportJob()以及其里面嵌套的方法importJob1和<del>2都是具有事务的；<br>对于外侧的方法startImportJob在运行时会创建一个事务，而嵌套调用的importJob1和</del>2在执行时发现外侧已经有了现成的事务，所以在运行时内侧的事务就会加入到外侧的事务中，也就意味着在执行start方法的时候，整体是在一个事务中完成的数据的增删改操作；如图所示，红色框为主方法的事务，蓝框为子方法的事务，<br><img src=\"/p/d79b/1633677913394-16f82101-b0f1-4094-9393-a165fbd94d0c.png\" class=\"lazyload\" data-srcset=\"/p/d79b/1633677913394-16f82101-b0f1-4094-9393-a165fbd94d0c.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"><br>因此当子方法1执行成功了，但子方法2执行前遇到了异常，总的事务也会进行回滚，导致方法1无法写入数据进数据库；<br>◇如果我们期望无论是方法1还是方法2，只要方法执行成功，就能够成功写入数据库，彼此互不干扰，该如何实现呢？我们可以更改配置项，将原来的配置改为</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">tx:method</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;importJob1&quot;</span> <span class=\"attr\">propagation</span>=<span class=\"string\">&quot;REQUIRES_NEW&quot;</span>/&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">tx:method</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;importJob2&quot;</span> <span class=\"attr\">propagation</span>=<span class=\"string\">&quot;REQUIRES_NEW&quot;</span>/&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">tx:method</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;*&quot;</span> <span class=\"attr\">propagation</span>=<span class=\"string\">&quot;REQUIRED&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>\n<p>REQUIRES_NEW表示针对于两个子方法，在运行过程中都会产生新的事务；该方法执行过程如下图<br><img src=\"/p/d79b/1633678405307-1da3421c-293a-4f2d-8970-a68631305b50.png\" class=\"lazyload\" data-srcset=\"/p/d79b/1633678405307-1da3421c-293a-4f2d-8970-a68631305b50.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"></p>\n<h3 id=\"注解配置声明式事务\"><a href=\"#注解配置声明式事务\" class=\"headerlink\" title=\"注解配置声明式事务\"></a>注解配置声明式事务</h3><p>代码演示(s03)<br>◇核心配置文件pom.xml与上面相同<br>◇applicationContext.xml没有配置部分，然后利用component-scan来设置扫描的基本包是哪个；然后定义数据源，初始化JdbcTemplate,配置事务管理器，这三项是必须要配置的bean；最后启用注解形式声明式事务；</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!--数据源--&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;dataSource&quot;</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;org.springframework.jdbc.datasource.DriverManagerDataSource&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;driverClassName&quot;</span> <span class=\"attr\">value</span>=<span class=\"string\">&quot;com.mysql.cj.jdbc.Driver&quot;</span>/&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;url&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">              <span class=\"attr\">value</span>=<span class=\"string\">&quot;jdbc:mysql://localhost:3306/test?useSSL=false<span class=\"symbol\">&amp;amp;</span>useUnicode=true<span class=\"symbol\">&amp;amp;</span>characterEncoding=UTF-8<span class=\"symbol\">&amp;amp;</span>serverTimezone=Asia/Shanghai<span class=\"symbol\">&amp;amp;</span>allowPublicKeyRetrieval=true&quot;</span>/&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;username&quot;</span> <span class=\"attr\">value</span>=<span class=\"string\">&quot;root&quot;</span>/&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;password&quot;</span> <span class=\"attr\">value</span>=<span class=\"string\">&quot;root&quot;</span>/&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span></span><br><span class=\"line\"><span class=\"comment\">&lt;!--JdbcTemplate--&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;jdbcTemplate&quot;</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;org.springframework.jdbc.core.JdbcTemplate&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;dataSource&quot;</span> <span class=\"attr\">ref</span>=<span class=\"string\">&quot;dataSource&quot;</span>/&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span></span><br><span class=\"line\"><span class=\"comment\">&lt;!--事务管理器--&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;transactionManager&quot;</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;dataSource&quot;</span> <span class=\"attr\">ref</span>=<span class=\"string\">&quot;dataSource&quot;</span>/&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span></span><br><span class=\"line\"><span class=\"comment\">&lt;!-- 启用注解形式声明式事务 --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">tx:annotation-driven</span> <span class=\"attr\">transaction-manager</span>=<span class=\"string\">&quot;transactionManager&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>\n<p>◇在Dao类中，利用@Resource完成对象的注入；<br>◇在service中，使用@Service完成IOC容器的实例化，在service依赖的每一个dao上进行@Resource完成dao的注入;<br>◇利用注解进行事务的配置，则只需将声明式注解@Transactional放在需要的类上,说明事务配置应用于当前类所有方法，默认事务传播为REQUIRED；也可以自行设置@Transactional(propagation = Propagation.REQUIRED);<br>当然对于不同的方法，也可以进行不同的设置，只需在方法上进行注解配置即可；例如在查询的方法上选择不使用事务，并且只读；</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Service</span></span><br><span class=\"line\"><span class=\"comment\">//声明式事务核心注解</span></span><br><span class=\"line\"><span class=\"comment\">//放在类上,将声明式事务配置应用于当前类所有方法,默认事务传播为 REQUIRED</span></span><br><span class=\"line\"><span class=\"meta\">@Transactional</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">EmployeeService</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"meta\">@Resource</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> EmployeeDao employeeDao;</span><br><span class=\"line\">    <span class=\"meta\">@Resource</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> BatchService batchService;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Transactional(propagation = Propagation.NOT_SUPPORTED , readOnly = true)</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> Employee <span class=\"title\">findById</span><span class=\"params\">(Integer eno)</span></span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> employeeDao.findById(eno);</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n\n","categories":["Spring","Spring基础"],"tags":["Spring"]},{"title":"Spring Ioc容器与Bean管理","url":"/p/ddb.html","content":"<h2 id=\"内容说明\"><a href=\"#内容说明\" class=\"headerlink\" title=\"内容说明\"></a>内容说明</h2><h3 id=\"Spring-loC\"><a href=\"#Spring-loC\" class=\"headerlink\" title=\"Spring loC\"></a>Spring loC</h3><p><img src=\"/p/ddb/1630934849961-68c37275-c326-42dd-8c9f-76cfafd3018f.png\" class=\"lazyload\" data-srcset=\"/p/ddb/1630934849961-68c37275-c326-42dd-8c9f-76cfafd3018f.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"></p>\n<h3 id=\"Spring-AOP\"><a href=\"#Spring-AOP\" class=\"headerlink\" title=\"Spring AOP\"></a>Spring AOP</h3><p><img src=\"/p/ddb/1630934894951-889d3e71-8aa4-4b9e-9d01-59f2309a0ead.png\" class=\"lazyload\" data-srcset=\"/p/ddb/1630934894951-889d3e71-8aa4-4b9e-9d01-59f2309a0ead.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"></p>\n<h3 id=\"Spring-JDBC与声明式事务\"><a href=\"#Spring-JDBC与声明式事务\" class=\"headerlink\" title=\"Spring JDBC与声明式事务\"></a>Spring JDBC与声明式事务</h3><p><img src=\"/p/ddb/1630934966182-c5242625-3f9e-4dca-bb7f-b9c938d16a41.png\" class=\"lazyload\" data-srcset=\"/p/ddb/1630934966182-c5242625-3f9e-4dca-bb7f-b9c938d16a41.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"></p>\n<h2 id=\"课程介绍\"><a href=\"#课程介绍\" class=\"headerlink\" title=\"课程介绍\"></a>课程介绍</h2><p>◇Spring快速入门              ◇Spring XML配置<br>◇对象实例化配置             ◇依赖注入配置<br>◇注解与Java Config         ◇Spring 单元测试  </p>\n<h2 id=\"Spring-快速入门\"><a href=\"#Spring-快速入门\" class=\"headerlink\" title=\"Spring 快速入门\"></a>Spring 快速入门</h2><h3 id=\"生活中的烦恼\"><a href=\"#生活中的烦恼\" class=\"headerlink\" title=\"生活中的烦恼\"></a>生活中的烦恼</h3><p>◇苹果这个对象的控制权是由客户发起的，客户必须掌握所有对象的特征细节后才能做出选择；<br><img src=\"/p/ddb/1630896908927-dca53881-2a3f-4257-a25b-b18849a33964.png\" class=\"lazyload\" data-srcset=\"/p/ddb/1630896908927-dca53881-2a3f-4257-a25b-b18849a33964.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"></p>\n<h3 id=\"现实中的商机\"><a href=\"#现实中的商机\" class=\"headerlink\" title=\"现实中的商机\"></a>现实中的商机</h3><p>◇客户将获取对象的权利交个水果摊老板，有老板替顾客做出选择；<br><img src=\"/p/ddb/1630896927455-4bbc1576-c9c6-4121-87fa-8faeba7edb6a.png\" class=\"lazyload\" data-srcset=\"/p/ddb/1630896927455-4bbc1576-c9c6-4121-87fa-8faeba7edb6a.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"></p>\n<h3 id=\"IoC控制反转\"><a href=\"#IoC控制反转\" class=\"headerlink\" title=\"IoC控制反转\"></a>IoC控制反转</h3><p>◇IoC控制反转,全称Inverse of Control,是一种设计理念<br>◇由代理人来创建与管理对象,消费者通过代理人来获取对象<br>◇IoC的目的是降低对象之间直接耦合<br>◇对象直接引用导致对象硬性关联，程序难以扩展维护<br><img src=\"/p/ddb/1630896883840-020fd28b-142f-4a04-a184-3ff5e61c3694.png\" class=\"lazyload\" data-srcset=\"/p/ddb/1630896883840-020fd28b-142f-4a04-a184-3ff5e61c3694.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"><br>◇ 加入IoC容器将对象统一管理，让对象关联变为弱耦合<br><img src=\"/p/ddb/1630897013449-8f132662-7b2a-46a3-9c48-86b23d169e58.png\" class=\"lazyload\" data-srcset=\"/p/ddb/1630897013449-8f132662-7b2a-46a3-9c48-86b23d169e58.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"></p>\n<h3 id=\"DI依赖注入\"><a href=\"#DI依赖注入\" class=\"headerlink\" title=\"DI依赖注入\"></a>DI依赖注入</h3><p>◇IoC是设计理念,是现代程序设计遵循的标准,是宏观目标<br>◇DI(Dependency Injection)是具体技术实现,是微观实现<br>◇DI在Java中利用反射技术实现对象注入(Injection)  </p>\n<h2 id=\"Spring\"><a href=\"#Spring\" class=\"headerlink\" title=\"Spring\"></a>Spring</h2><p><a href=\"https://spring.io/\">官网</a></p>\n<h3 id=\"Spring的含义\"><a href=\"#Spring的含义\" class=\"headerlink\" title=\"Spring的含义\"></a>Spring的含义</h3><p>◇Spring可从狭义与广义两个角度看待<br>◇狭义的Spring是指Spring框架(Spring Fremework)<br>◇广义的Spring是指Spring生态体系 </p>\n<h3 id=\"狭义的Spring框架\"><a href=\"#狭义的Spring框架\" class=\"headerlink\" title=\"狭义的Spring框架\"></a>狭义的Spring框架</h3><p>◇Spring框架是企业开发复杂性的一站式解决方案<br>◇Spring框架的核心是IoC容器与AOP面向切面编程<br>◇Spring IoC负责创建与管理系统对象，并在此基础上扩展功能 </p>\n<h3 id=\"广义的Spring生态体系\"><a href=\"#广义的Spring生态体系\" class=\"headerlink\" title=\"广义的Spring生态体系\"></a>广义的Spring生态体系</h3><p><img src=\"/p/ddb/1630936934175-c8cf8bd3-8a1a-4b42-b5c9-2aca583eb41b.png\" class=\"lazyload\" data-srcset=\"/p/ddb/1630936934175-c8cf8bd3-8a1a-4b42-b5c9-2aca583eb41b.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"></p>\n<h3 id=\"传统开发方式\"><a href=\"#传统开发方式\" class=\"headerlink\" title=\"传统开发方式\"></a>传统开发方式</h3><p>◇对象直接引用导致对象硬性关联，程序难以扩展维护<br><img src=\"/p/ddb/1630897484380-d37f95ca-a896-4b39-8386-450ce02a9638.png\" class=\"lazyload\" data-srcset=\"/p/ddb/1630897484380-d37f95ca-a896-4b39-8386-450ce02a9638.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"></p>\n<h3 id=\"Spring-IoC容器\"><a href=\"#Spring-IoC容器\" class=\"headerlink\" title=\"Spring IoC容器\"></a>Spring IoC容器</h3><p>◇IoC容器是Spring生态的地基,用于统一创建与管理对象依赖<br><img src=\"/p/ddb/1630897523216-2350d7a4-dc59-41b0-a257-85960d5a2356.png\" class=\"lazyload\" data-srcset=\"/p/ddb/1630897523216-2350d7a4-dc59-41b0-a257-85960d5a2356.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"></p>\n<h3 id=\"Spring-IoC容器职责\"><a href=\"#Spring-IoC容器职责\" class=\"headerlink\" title=\"Spring IoC容器职责\"></a>Spring IoC容器职责</h3><p>◇对象的控制权交由第三方统一管理(IoC控制翻转)<br>◇利用Java反射技术实现运行时对象创建与关联(DI依赖注入)<br>◇基于配置提高应用程序的可维护性与扩展性 </p>\n<h3 id=\"Spring-IoC初体验\"><a href=\"#Spring-IoC初体验\" class=\"headerlink\" title=\"Spring IoC初体验\"></a>Spring IoC初体验</h3><p>◇妈妈在早餐后给三个孩子分发餐后水果<br>◇盘子里装有三个苹果: 红富士/青苹果/金帅<br>◇孩子们口味不同: 莉莉喜欢甜的/安迪喜欢酸的/露娜喜欢软的  </p>\n<h2 id=\"代码示例\"><a href=\"#代码示例\" class=\"headerlink\" title=\"代码示例\"></a>代码示例</h2><h4 id=\"传统代码\"><a href=\"#传统代码\" class=\"headerlink\" title=\"传统代码\"></a>传统代码</h4><p> –实体类</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Apple</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> String title;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> String color;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> String origin;</span><br><span class=\"line\">               ...</span><br><span class=\"line\"> &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Child</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> String name;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> Apple apple;</span><br><span class=\"line\">    ...</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">eat</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">        System.out.println(name+<span class=\"string\">&quot;吃到了&quot;</span>+apple.getOrigin()+<span class=\"string\">&quot;种植的&quot;</span>+apple.getTitle());</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p> –应用入口</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Application</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> </span>&#123;</span><br><span class=\"line\">        Apple a1 = <span class=\"keyword\">new</span> Apple(<span class=\"string\">&quot;红富士&quot;</span>, <span class=\"string\">&quot;红色&quot;</span>, <span class=\"string\">&quot;欧洲&quot;</span>);</span><br><span class=\"line\">        Apple a2 = <span class=\"keyword\">new</span> Apple(<span class=\"string\">&quot;青苹果&quot;</span>, <span class=\"string\">&quot;绿色&quot;</span>, <span class=\"string\">&quot;中亚&quot;</span>);</span><br><span class=\"line\">        Apple a3 = <span class=\"keyword\">new</span> Apple(<span class=\"string\">&quot;金帅&quot;</span>, <span class=\"string\">&quot;黄色&quot;</span>, <span class=\"string\">&quot;中国&quot;</span>);</span><br><span class=\"line\">        Child lily = <span class=\"keyword\">new</span> Child(<span class=\"string\">&quot;莉莉&quot;</span>, a1);</span><br><span class=\"line\">        Child andy = <span class=\"keyword\">new</span> Child(<span class=\"string\">&quot;安迪&quot;</span>, a2);</span><br><span class=\"line\">        Child luna = <span class=\"keyword\">new</span> Child(<span class=\"string\">&quot;露娜&quot;</span>, a3);</span><br><span class=\"line\">        lily.eat();</span><br><span class=\"line\">        andy.eat();</span><br><span class=\"line\">        luna.eat();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>◇缺点分析：①苹果的描述写死在代码中，若描述改变需要修改源代码；②对象的数量固定的，若要新增对象需要修改源代码，程序的可维护性，可扩展性不足；③对象是硬关联的，每个孩子喜欢的苹果不同则需要修改源码，比较死板；</p>\n<h4 id=\"Spring-Ioc\"><a href=\"#Spring-Ioc\" class=\"headerlink\" title=\"Spring Ioc\"></a>Spring Ioc</h4><p>◇加载配置</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">&lt;dependencies&gt;</span><br><span class=\"line\">    &lt;dependency&gt;</span><br><span class=\"line\">        &lt;groupId&gt;org.springframework&lt;/groupId&gt;</span><br><span class=\"line\">        &lt;artifactId&gt;spring-context&lt;/artifactId&gt;</span><br><span class=\"line\">        &lt;version&gt;<span class=\"number\">5.2</span><span class=\"number\">.6</span>.RELEASE&lt;/version&gt;</span><br><span class=\"line\">    &lt;/dependency&gt;</span><br><span class=\"line\">&lt;/dependencies&gt;</span><br></pre></td></tr></table></figure>\n<p>◇applicationContext.xml</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">&lt;?xml version=<span class=\"string\">&quot;1.0&quot;</span> encoding=<span class=\"string\">&quot;UTF-8&quot;</span>?&gt;</span><br><span class=\"line\">&lt;beans xmlns=<span class=\"string\">&quot;http://www.springframework.org/schema/beans&quot;</span></span><br><span class=\"line\">       xmlns:xsi=<span class=\"string\">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class=\"line\">       xsi:schemaLocation=<span class=\"string\">&quot;http://www.springframework.org/schema/beans</span></span><br><span class=\"line\"><span class=\"string\">        https://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span><br><span class=\"line\">    &lt;!--在IoC容器启动时，自动有Spring实例化Apple对象，取名sweetApple放入到容器中--&gt;</span><br><span class=\"line\">    &lt;bean id=<span class=\"string\">&quot;sweetApple&quot;</span> <span class=\"class\"><span class=\"keyword\">class</span></span>=<span class=\"string\">&quot;com.lcg.spring.ioc.entity.Apple&quot;</span>&gt;</span><br><span class=\"line\">        &lt;property name=<span class=\"string\">&quot;title&quot;</span> value=<span class=\"string\">&quot;红富士&quot;</span>&gt;&lt;/property&gt;</span><br><span class=\"line\">        &lt;property name=<span class=\"string\">&quot;origin&quot;</span> value=<span class=\"string\">&quot;欧洲&quot;</span>&gt;&lt;/property&gt;</span><br><span class=\"line\">        &lt;property name=<span class=\"string\">&quot;color&quot;</span> value=<span class=\"string\">&quot;红色&quot;</span>&gt;&lt;/property&gt;</span><br><span class=\"line\">    &lt;/bean&gt;</span><br><span class=\"line\">    &lt;bean id=<span class=\"string\">&quot;sourApple&quot;</span> <span class=\"class\"><span class=\"keyword\">class</span></span>=<span class=\"string\">&quot;com.lcg.spring.ioc.entity.Apple&quot;</span>&gt;</span><br><span class=\"line\">        &lt;property name=<span class=\"string\">&quot;title&quot;</span> value=<span class=\"string\">&quot;青苹果&quot;</span>&gt;&lt;/property&gt;</span><br><span class=\"line\">        &lt;property name=<span class=\"string\">&quot;origin&quot;</span> value=<span class=\"string\">&quot;中亚&quot;</span>&gt;&lt;/property&gt;</span><br><span class=\"line\">        &lt;property name=<span class=\"string\">&quot;color&quot;</span> value=<span class=\"string\">&quot;绿色&quot;</span>&gt;&lt;/property&gt;</span><br><span class=\"line\">    &lt;/bean&gt;</span><br><span class=\"line\">    &lt;bean id=<span class=\"string\">&quot;softApple&quot;</span> <span class=\"class\"><span class=\"keyword\">class</span></span>=<span class=\"string\">&quot;com.lcg.spring.ioc.entity.Apple&quot;</span>&gt;</span><br><span class=\"line\">        &lt;property name=<span class=\"string\">&quot;title&quot;</span> value=<span class=\"string\">&quot;金帅&quot;</span>&gt;&lt;/property&gt;</span><br><span class=\"line\">        &lt;property name=<span class=\"string\">&quot;origin&quot;</span> value=<span class=\"string\">&quot;中国&quot;</span>&gt;&lt;/property&gt;</span><br><span class=\"line\">        &lt;property name=<span class=\"string\">&quot;color&quot;</span> value=<span class=\"string\">&quot;黄色&quot;</span>&gt;&lt;/property&gt;</span><br><span class=\"line\">    &lt;/bean&gt;</span><br><span class=\"line\">    &lt;!--孩子 --&gt;</span><br><span class=\"line\">    &lt;bean id=<span class=\"string\">&quot;lily&quot;</span> <span class=\"class\"><span class=\"keyword\">class</span></span>=<span class=\"string\">&quot;com.lcg.spring.ioc.entity.Child&quot;</span>&gt;</span><br><span class=\"line\">        &lt;property name=<span class=\"string\">&quot;name&quot;</span> value=<span class=\"string\">&quot;lily&quot;</span>/&gt;</span><br><span class=\"line\">        &lt;property name=<span class=\"string\">&quot;apple&quot;</span> ref=<span class=\"string\">&quot;sweetApple&quot;</span>/&gt;</span><br><span class=\"line\">    &lt;/bean&gt;</span><br><span class=\"line\">    &lt;bean id=<span class=\"string\">&quot;andy&quot;</span> <span class=\"class\"><span class=\"keyword\">class</span></span>=<span class=\"string\">&quot;com.lcg.spring.ioc.entity.Child&quot;</span>&gt;</span><br><span class=\"line\">        &lt;property name=<span class=\"string\">&quot;name&quot;</span> value=<span class=\"string\">&quot;andy&quot;</span>/&gt;</span><br><span class=\"line\">        &lt;property name=<span class=\"string\">&quot;apple&quot;</span> ref=<span class=\"string\">&quot;sourApple&quot;</span>/&gt;</span><br><span class=\"line\">    &lt;/bean&gt;</span><br><span class=\"line\">    &lt;bean id=<span class=\"string\">&quot;luna&quot;</span> <span class=\"class\"><span class=\"keyword\">class</span></span>=<span class=\"string\">&quot;com.lcg.spring.ioc.entity.Child&quot;</span>&gt;</span><br><span class=\"line\">        &lt;property name=<span class=\"string\">&quot;name&quot;</span> value=<span class=\"string\">&quot;luna&quot;</span>/&gt;</span><br><span class=\"line\">        &lt;property name=<span class=\"string\">&quot;apple&quot;</span> ref=<span class=\"string\">&quot;softApple&quot;</span>/&gt;</span><br><span class=\"line\">    &lt;/bean&gt;</span><br><span class=\"line\">&lt;/beans&gt;</span><br></pre></td></tr></table></figure>\n<p>◇应用接口</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">SpringApplication</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">//加载指定的配置文件</span></span><br><span class=\"line\">        ApplicationContext context =</span><br><span class=\"line\">                <span class=\"keyword\">new</span> ClassPathXmlApplicationContext(<span class=\"string\">&quot;classpath:applicationContext.xml&quot;</span>);</span><br><span class=\"line\">        Apple sweetApple = context.getBean(<span class=\"string\">&quot;sweetApple&quot;</span>, Apple.class);</span><br><span class=\"line\">        System.out.println(sweetApple.getTitle());</span><br><span class=\"line\">        <span class=\"comment\">//从IoC容器中提取beanId=lily的对象</span></span><br><span class=\"line\">        Child lily = context.getBean(<span class=\"string\">&quot;lily&quot;</span>, Child.class);</span><br><span class=\"line\">        Child andy = context.getBean(<span class=\"string\">&quot;andy&quot;</span>, Child.class);</span><br><span class=\"line\">        Child luna = context.getBean(<span class=\"string\">&quot;luna&quot;</span>, Child.class);</span><br><span class=\"line\">        lily.eat();</span><br><span class=\"line\">        andy.eat();</span><br><span class=\"line\">        luna.eat();</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n<p>◇这样，通过Ioc容器，将程序代码转变为配置文本，维护性更好，让对象与对象之间有效的解耦</p>\n<h2 id=\"XML管理对象-Bean\"><a href=\"#XML管理对象-Bean\" class=\"headerlink\" title=\"XML管理对象(Bean)\"></a>XML管理对象(Bean)</h2><h3 id=\"三种配置方式\"><a href=\"#三种配置方式\" class=\"headerlink\" title=\"三种配置方式\"></a>三种配置方式</h3><p>◇基于XML配置Bean<br>◇基于注解配置Bean<br>◇基于Java代码配置Bean  </p>\n<h3 id=\"applicationContext-xml\"><a href=\"#applicationContext-xml\" class=\"headerlink\" title=\"applicationContext.xml\"></a>applicationContext.xml</h3><figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">&lt;bean id=<span class=\"string\">&quot;sweetApple&quot;</span> <span class=\"class\"><span class=\"keyword\">class</span></span>=<span class=\"string\">&quot;com.lcg.spring.ioc.entity.Apple&quot;</span>&gt;</span><br><span class=\"line\"> &lt;property name=<span class=\"string\">&quot;title&quot;</span> value=<span class=\"string\">&quot;红富士&quot;</span>&gt;&lt;/property&gt;</span><br><span class=\"line\"> &lt;property name=<span class=\"string\">&quot;origin&quot;</span> value=<span class=\"string\">&quot;欧洲&quot;</span>&gt;&lt;/property&gt;</span><br><span class=\"line\"> &lt;property name=<span class=\"string\">&quot;color&quot;</span> value=<span class=\"string\">&quot;红色&quot;</span>&gt;&lt;/property&gt;</span><br><span class=\"line\">&lt;/bean&gt;</span><br></pre></td></tr></table></figure>\n<h3 id=\"XML方式创建IoC容器\"><a href=\"#XML方式创建IoC容器\" class=\"headerlink\" title=\"XML方式创建IoC容器\"></a>XML方式创建IoC容器</h3><figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//创建IoC容器并根据配置文件创建对象</span></span><br><span class=\"line\">ApplicationContext context = <span class=\"keyword\">new</span> </span><br><span class=\"line\">ClassPathXmlApplicationContext(<span class=\"string\">&quot;classpath:applicationContext.xml&quot;</span>);</span><br></pre></td></tr></table></figure>\n<h3 id=\"Spring框架组成模块\"><a href=\"#Spring框架组成模块\" class=\"headerlink\" title=\"Spring框架组成模块\"></a>Spring框架组成模块</h3><p>◇四层，核心为第二层<br><img src=\"/p/ddb/1630897823185-2161c56c-32a7-4329-9432-24b4449a80e0.png\" class=\"lazyload\" data-srcset=\"/p/ddb/1630897823185-2161c56c-32a7-4329-9432-24b4449a80e0.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"></p>\n<h3 id=\"ApplicationContext实现类\"><a href=\"#ApplicationContext实现类\" class=\"headerlink\" title=\"ApplicationContext实现类\"></a>ApplicationContext实现类</h3><p>◇ClassPathXmlApplicationContext<br>◇AnnotationConfigApplicationContext<br>◇WebApplicationContext </p>\n<h3 id=\"实例化Bean的三种方式\"><a href=\"#实例化Bean的三种方式\" class=\"headerlink\" title=\"实例化Bean的三种方式\"></a>实例化Bean的三种方式</h3><p>◇基于构造方法对象实例化<br>◇基于静态工厂实例化<br>◇基于工厂实例方法实例化  </p>\n<p><strong>一、构造方法实例化对象</strong> </p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">Apple</span><span class=\"params\">(String title,Stirng color,String origin)</span></span>&#123;</span><br><span class=\"line\">    System.out.println(<span class=\"string\">&quot;通过带参构造方法创建对象,&quot;</span>+<span class=\"keyword\">this</span>);</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.title=title;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.color=color;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.origin=origin;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p><strong>1.利用构造方法参数名实例化</strong><br>◇如果对象不止一个构造函数，则按照对应的参数(个数，类型)来进行设置;</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">&lt;bean id=<span class=\"string\">&quot;sweetApple&quot;</span> <span class=\"class\"><span class=\"keyword\">class</span></span>=<span class=\"string\">&quot;com.lcg.spring.ioc.entity.Apple&quot;</span>&gt; </span><br><span class=\"line\"> &lt;!-- 没有constructor-arg则代表调用默认构造方法实例化 --&gt;</span><br><span class=\"line\"> &lt;constructor-arg name=<span class=\"string\">&quot;title&quot;</span> value=<span class=\"string\">&quot;红富士&quot;</span>/&gt;</span><br><span class=\"line\"> &lt;constructor-arg name=<span class=\"string\">&quot;origin&quot;</span> value=<span class=\"string\">&quot;欧洲&quot;</span>/&gt; </span><br><span class=\"line\"> &lt;constructor-arg name=<span class=\"string\">&quot;color&quot;</span> value=<span class=\"string\">&quot;红色&quot;</span>/&gt;</span><br><span class=\"line\">&lt;/bean&gt;</span><br></pre></td></tr></table></figure>\n<p><strong>2.利用构造方法参数位置实例化</strong>  </p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">&lt;bean id=<span class=\"string\">&quot;sweetApple&quot;</span> <span class=\"class\"><span class=\"keyword\">class</span></span>=<span class=\"string\">&quot;com.imooc.spring.ioc.entity.Apple&quot;</span>&gt; </span><br><span class=\"line\"> &lt;!-- 利用构造方法参数位置实现对象实例化 --&gt;</span><br><span class=\"line\"> &lt;constructor-arg index=<span class=\"string\">&quot;0&quot;</span> value=<span class=\"string\">&quot;红富士&quot;</span>/&gt;</span><br><span class=\"line\"> &lt;constructor-arg index=<span class=\"string\">&quot;1&quot;</span> value=<span class=\"string\">&quot;红色&quot;</span>/&gt;</span><br><span class=\"line\"> &lt;constructor-arg index=<span class=\"string\">&quot;2&quot;</span> value=<span class=\"string\">&quot;欧洲&quot;</span>/&gt;</span><br><span class=\"line\">&lt;/bean&gt;</span><br></pre></td></tr></table></figure>\n<p><strong>二、工厂模式实例化对象</strong> </p>\n<p>◇创建工厂类。创建静态工厂类AppleStaticFactory,使得创建对象的代码被隐藏，主要目的是在ioc容器之外通过程序的形式组织对象；好处：可以在创建对象的过程中赋予额外的行为(如日志输出等),</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 静态工厂通过静态方法创建对象，隐藏创建对象的细节</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">AppleStaticFactory</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> Apple <span class=\"title\">createSweetApple</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">        Apple apple = <span class=\"keyword\">new</span> Apple();</span><br><span class=\"line\">        apple.setTitle(<span class=\"string\">&quot;红富士&quot;</span>);</span><br><span class=\"line\">        apple.setOrigin(<span class=\"string\">&quot;欧洲&quot;</span>);</span><br><span class=\"line\">        apple.setColor(<span class=\"string\">&quot;红色&quot;</span>);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> apple;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>◇在applicationContext.xml中配置</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">&lt;!--利用静态工厂获取对象，加上工厂方法--&gt;</span><br><span class=\"line\">&lt;bean id=<span class=\"string\">&quot;apple4&quot;</span> <span class=\"class\"><span class=\"keyword\">class</span></span>=<span class=\"string\">&quot;com.lcg.spring.ioc.factory.AppleStaticFactory&quot;</span></span><br><span class=\"line\">      factory-method=<span class=\"string\">&quot;createSweetApple&quot;</span>/&gt;</span><br></pre></td></tr></table></figure>\n<p><strong>三、工厂实例：在ioc容器中对工厂进行实例化</strong></p>\n<p>◇在factory中创建AppleFactoryInstance（苹果工厂实例）</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 工厂实例方法创建对象是指Ioc容器对工厂类进行实例化并调用相应的实例方法创建对象的过程</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">AppleFactoryInstance</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span>  Apple <span class=\"title\">createSweetApple</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">        Apple apple = <span class=\"keyword\">new</span> Apple();</span><br><span class=\"line\">        apple.setTitle(<span class=\"string\">&quot;红富士&quot;</span>);</span><br><span class=\"line\">        apple.setOrigin(<span class=\"string\">&quot;欧洲&quot;</span>);</span><br><span class=\"line\">        apple.setColor(<span class=\"string\">&quot;红色&quot;</span>);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> apple;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>◇在Ioc容器中进行实例化和使用</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">&lt;!-- 利用工厂实例方法获取对象--&gt;</span><br><span class=\"line\">    &lt;bean id=<span class=\"string\">&quot;factoryInstance&quot;</span> <span class=\"class\"><span class=\"keyword\">class</span></span>=<span class=\"string\">&quot;com.lcg.spring.ioc.factory.AppleFactoryInstance&quot;</span>/&gt;</span><br><span class=\"line\">    &lt;bean id=<span class=\"string\">&quot;apple5&quot;</span> factory-bean=<span class=\"string\">&quot;factoryInstance&quot;</span> factory-method=<span class=\"string\">&quot;createSweetApple&quot;</span>/&gt;</span><br></pre></td></tr></table></figure>\n<h2 id=\"从IoC容器获取Bean\"><a href=\"#从IoC容器获取Bean\" class=\"headerlink\" title=\"从IoC容器获取Bean\"></a>从IoC容器获取Bean</h2><figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//第一个参数BeanId，第二个Bean的实际类型</span></span><br><span class=\"line\">Apple sweetApple = context.getBean(<span class=\"string\">&quot;sweetApple&quot;</span> , Apple.class);</span><br><span class=\"line\"><span class=\"comment\">//或者单参数方法，进行强制转换</span></span><br><span class=\"line\">Apple sweetApple = (Apple)context.getBean(<span class=\"string\">&quot;sweetApple&quot;</span>);</span><br><span class=\"line\"><span class=\"comment\">//打印输出</span></span><br><span class=\"line\">System.out.println(sweetApple.getTitle());</span><br></pre></td></tr></table></figure>\n<h3 id=\"id与name属性相同点\"><a href=\"#id与name属性相同点\" class=\"headerlink\" title=\"id与name属性相同点\"></a>id与name属性相同点</h3><p>◇bean id与bean name都是设置对象在IoC容器中唯一标识<br>◇两者在同一个配置文件中都不允许出现重复<br>◇两者允许在多个配置文件中出现重复,新对象覆盖旧对象 </p>\n<h3 id=\"id与name属性区别\"><a href=\"#id与name属性区别\" class=\"headerlink\" title=\"id与name属性区别\"></a>id与name属性区别</h3><p>◇id要求更为严格,一次只能定义一个对象标识(推荐)<br>◇name更为宽松,一次允许定义多个对象标识：name=apple1,apple2，…<br>◇tips: id与name的命名要求有意义,按驼峰命名书写<br>◇当没有id与name的bean默认使用类名全称作为bean标识</p>\n<h2 id=\"路径匹配表达式\"><a href=\"#路径匹配表达式\" class=\"headerlink\" title=\"路径匹配表达式\"></a>路径匹配表达式</h2><h3 id=\"加载单个配置文件\"><a href=\"#加载单个配置文件\" class=\"headerlink\" title=\"加载单个配置文件\"></a>加载单个配置文件</h3><p>◇路径表达式用于加载配置文件</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//创建IoC容器并根据配置文件创建对象</span></span><br><span class=\"line\">ApplicationContext context = <span class=\"keyword\">new</span> </span><br><span class=\"line\">ClassPathXmlApplicationContext(<span class=\"string\">&quot;classpath:applicationContext.xml&quot;</span>);<span class=\"comment\">//参数即路径表达式</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h3 id=\"加载多个配置文件\"><a href=\"#加载多个配置文件\" class=\"headerlink\" title=\"加载多个配置文件\"></a>加载多个配置文件</h3><figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">String[] configLocations = <span class=\"keyword\">new</span> </span><br><span class=\"line\"> String[]&#123;<span class=\"string\">&quot;classpath:applicationContext.xml&quot;</span></span><br><span class=\"line\"> ,<span class=\"string\">&quot;classpath:applicationContext-1.xml&quot;</span>&#125;;</span><br><span class=\"line\">ApplicationContext context = <span class=\"keyword\">new</span> </span><br><span class=\"line\">ClassPathXmlApplicationContext(configLocations);</span><br></pre></td></tr></table></figure>\n<h3 id=\"路径表达式\"><a href=\"#路径表达式\" class=\"headerlink\" title=\"路径表达式\"></a>路径表达式</h3><p><img src=\"/p/ddb/1630911452907-cd3d11a0-5a18-48c6-acfb-8bd4d8605996.png\" class=\"lazyload\" data-srcset=\"/p/ddb/1630911452907-cd3d11a0-5a18-48c6-acfb-8bd4d8605996.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"></p>\n<h2 id=\"对象依赖注入\"><a href=\"#对象依赖注入\" class=\"headerlink\" title=\"对象依赖注入\"></a>对象依赖注入</h2><p><img src=\"/p/ddb/1630911749557-eddc3615-b954-41fc-b63d-41d88b26d3fd.png\" class=\"lazyload\" data-srcset=\"/p/ddb/1630911749557-eddc3615-b954-41fc-b63d-41d88b26d3fd.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"><br>◇依赖注入是指运行时将容器内对象利用反射赋给其他对象的操作,即将两个对象关联起来<br>◇基于setter方法注入对象<br>◇基于构造方法注入对象  </p>\n<h3 id=\"利用setter实现静态数值注入\"><a href=\"#利用setter实现静态数值注入\" class=\"headerlink\" title=\"利用setter实现静态数值注入\"></a>利用setter实现静态数值注入</h3><figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">&lt;bean id=<span class=\"string\">&quot;sweetApple&quot;</span> <span class=\"class\"><span class=\"keyword\">class</span></span>=<span class=\"string\">&quot;com.lcg.spring.ioc.entity.Apple&quot;</span>&gt;</span><br><span class=\"line\">&lt;!--IoC容器自动利用反射机制运行时调用setXXX方法给属性赋值 --&gt;</span><br><span class=\"line\"> &lt;property name=<span class=\"string\">&quot;title&quot;</span> value=<span class=\"string\">&quot;红富士&quot;</span>/&gt;</span><br><span class=\"line\"> &lt;property name=<span class=\"string\">&quot;color&quot;</span> value=<span class=\"string\">&quot;红色&quot;</span>/&gt;</span><br><span class=\"line\"> &lt;property name=<span class=\"string\">&quot;origin&quot;</span> value=<span class=\"string\">&quot;欧洲&quot;</span>/&gt;</span><br><span class=\"line\">&lt;/bean&gt;</span><br></pre></td></tr></table></figure>\n<h3 id=\"利用setter实现对象注入\"><a href=\"#利用setter实现对象注入\" class=\"headerlink\" title=\"利用setter实现对象注入\"></a>利用setter实现对象注入</h3><figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">&lt;bean id=<span class=\"string\">&quot;lily&quot;</span> <span class=\"class\"><span class=\"keyword\">class</span></span>=<span class=\"string\">&quot;com.lcg.spring.ioc.entity.Child&quot;</span>&gt;</span><br><span class=\"line\"> &lt;property name=<span class=\"string\">&quot;name&quot;</span> value=<span class=\"string\">&quot;莉莉&quot;</span>/&gt;</span><br><span class=\"line\"> &lt;!--利用ref注入依赖对象 --&gt;</span><br><span class=\"line\"> &lt;property name=<span class=\"string\">&quot;apple&quot;</span> ref=<span class=\"string\">&quot;sweetApple&quot;</span>/&gt;<span class=\"comment\">//属性ref代表&quot;关联&quot;</span></span><br><span class=\"line\">&lt;/bean&gt;</span><br></pre></td></tr></table></figure>\n<h3 id=\"IoC在实际项目中的应用\"><a href=\"#IoC在实际项目中的应用\" class=\"headerlink\" title=\"IoC在实际项目中的应用\"></a>IoC在实际项目中的应用</h3><p>◇创建两个配置文件applicationContext-dao.xml和applicationContext-service.xml供两名员工开发，前者主要有实习生来实现，因为比较简单，而后者是核心文件，需要有经验的工程师进行开发。<br>◇创建BookDao接口</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.lcg.spring.ioc.bookshop.dao;</span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">interface</span> <span class=\"title\">BookDao</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">insert</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>◇创建BookImpl实现类</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.lcg.spring.ioc.bookshop.dao;</span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">BookDaoImpl</span> <span class=\"keyword\">implements</span> <span class=\"title\">BookDao</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">insert</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;向MySQL Book表插入一条数据&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>◇创建BookService</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.lcg.spring.ioc.bookshop.service;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> com.lcg.spring.ioc.bookshop.dao.BookDao;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">BookService</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> BookDao bookDao;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">purchase</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;正在执行图书采购业务方法&quot;</span>);</span><br><span class=\"line\">        bookDao.insert();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> BookDao <span class=\"title\">getBookDao</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> bookDao;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">setBookDao</span><span class=\"params\">(BookDao bookDao)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.bookDao = bookDao;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>◇配置applicationContext-dao.xml</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">&lt;?xml version=<span class=\"string\">&quot;1.0&quot;</span> encoding=<span class=\"string\">&quot;UTF-8&quot;</span>?&gt;</span><br><span class=\"line\">&lt;beans xmlns=<span class=\"string\">&quot;http://www.springframework.org/schema/beans&quot;</span></span><br><span class=\"line\">       xmlns:xsi=<span class=\"string\">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class=\"line\">       xsi:schemaLocation=<span class=\"string\">&quot;http://www.springframework.org/schema/beans</span></span><br><span class=\"line\"><span class=\"string\">        https://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span><br><span class=\"line\">    &lt;bean id=<span class=\"string\">&quot;bookDao&quot;</span> <span class=\"class\"><span class=\"keyword\">class</span></span>=<span class=\"string\">&quot;com.lcg.spring.ioc.bookshop.dao.BookDaoImpl&quot;</span>&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">    &lt;/bean&gt;</span><br><span class=\"line\">&lt;/beans&gt;</span><br></pre></td></tr></table></figure>\n<p>◇配置applicationContext-service.xml</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">&lt;?xml version=<span class=\"string\">&quot;1.0&quot;</span> encoding=<span class=\"string\">&quot;UTF-8&quot;</span>?&gt;</span><br><span class=\"line\">&lt;beans xmlns=<span class=\"string\">&quot;http://www.springframework.org/schema/beans&quot;</span></span><br><span class=\"line\">       xmlns:xsi=<span class=\"string\">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class=\"line\">       xsi:schemaLocation=<span class=\"string\">&quot;http://www.springframework.org/schema/beans</span></span><br><span class=\"line\"><span class=\"string\">        https://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span><br><span class=\"line\">    &lt;bean id=<span class=\"string\">&quot;bookService&quot;</span> <span class=\"class\"><span class=\"keyword\">class</span></span>=<span class=\"string\">&quot;com.lcg.spring.ioc.bookshop.service.BookService&quot;</span>&gt;</span><br><span class=\"line\">        &lt;!--两个开发人员以这种id=bookDao的约定方式来进行对象的关联</span><br><span class=\"line\">        这样能够实现两者开发互不干扰，如果要进行换数据库的话，只需要</span><br><span class=\"line\">        更改dao配置文件就行了</span><br><span class=\"line\">        --&gt;</span><br><span class=\"line\">        &lt;property name=<span class=\"string\">&quot;bookDao&quot;</span> ref=<span class=\"string\">&quot;bookDao&quot;</span>/&gt;</span><br><span class=\"line\">    &lt;/bean&gt;</span><br><span class=\"line\">&lt;/beans&gt;</span><br></pre></td></tr></table></figure>\n<h3 id=\"基于构造方法注入对象\"><a href=\"#基于构造方法注入对象\" class=\"headerlink\" title=\"基于构造方法注入对象\"></a>基于构造方法注入对象</h3><p>◇使用Child类的构造方法</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">Child</span><span class=\"params\">(String name,Apple apple)</span></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.name=name;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.apple=apple;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p> ◇在applicationContext.xml中进行配置</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">&lt;bean id=<span class=\"string\">&quot;sourApple&quot;</span> <span class=\"class\"><span class=\"keyword\">class</span></span>=<span class=\"string\">&quot;com.lcg.spring.ioc.entity.Apple&quot;</span>&gt;</span><br><span class=\"line\">        &lt;property name=<span class=\"string\">&quot;title&quot;</span> value=<span class=\"string\">&quot;青苹果&quot;</span>&gt;&lt;/property&gt;</span><br><span class=\"line\">        &lt;property name=<span class=\"string\">&quot;origin&quot;</span> value=<span class=\"string\">&quot;中亚&quot;</span>&gt;&lt;/property&gt;</span><br><span class=\"line\">        &lt;property name=<span class=\"string\">&quot;color&quot;</span> value=<span class=\"string\">&quot;绿色&quot;</span>&gt;&lt;/property&gt;</span><br><span class=\"line\">&lt;/bean&gt;</span><br><span class=\"line\">&lt;bean id=<span class=\"string\">&quot;andy&quot;</span> <span class=\"class\"><span class=\"keyword\">class</span></span>=<span class=\"string\">&quot;com.lcg.spring.ioc.entity.Child&quot;</span>&gt;</span><br><span class=\"line\">     &lt;constructor-arg name=<span class=\"string\">&quot;name&quot;</span> value=<span class=\"string\">&quot;安迪&quot;</span>/&gt; <span class=\"comment\">//name表示参数，value表示赋值</span></span><br><span class=\"line\">     <span class=\"comment\">//利用反射技术将sourApple苹果对象做为参数传入带参构造函数中</span></span><br><span class=\"line\">     &lt;constructor-arg name=<span class=\"string\">&quot;apple&quot;</span> ref=<span class=\"string\">&quot;sourApple&quot;</span>/&gt;  <span class=\"comment\">//ref用于关联sourApple</span></span><br><span class=\"line\">&lt;/bean&gt;</span><br></pre></td></tr></table></figure>\n<h3 id=\"注入集合对象\"><a href=\"#注入集合对象\" class=\"headerlink\" title=\"注入集合对象\"></a>注入集合对象</h3><p> ◇注入List  </p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">&lt;bean id=<span class=\"string\">&quot;...&quot;</span> <span class=\"class\"><span class=\"keyword\">class</span></span>=<span class=\"string\">&quot;...&quot;</span>&gt;</span><br><span class=\"line\"> &lt;property name=<span class=\"string\">&quot;someList&quot;</span>&gt;</span><br><span class=\"line\"> &lt;list&gt;</span><br><span class=\"line\"> &lt;value&gt;具体值&lt;/value&gt;</span><br><span class=\"line\"> &lt;ref bean=<span class=\"string\">&quot;beanId&quot;</span>&gt;&lt;/ref&gt;</span><br><span class=\"line\"> &lt;/list&gt;</span><br><span class=\"line\"> &lt;/property&gt;</span><br><span class=\"line\">&lt;/bean&gt;</span><br></pre></td></tr></table></figure>\n<p>◇ 注入Set  </p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">&lt;bean id=<span class=\"string\">&quot;...&quot;</span> <span class=\"class\"><span class=\"keyword\">class</span></span>=<span class=\"string\">&quot;...&quot;</span>&gt;</span><br><span class=\"line\"> &lt;property name=<span class=\"string\">&quot;someSet&quot;</span>&gt;</span><br><span class=\"line\"> &lt;set&gt;</span><br><span class=\"line\"> &lt;value&gt;具体值&lt;/value&gt;</span><br><span class=\"line\"> &lt;ref bean=<span class=\"string\">&quot;beanId&quot;</span>&gt;&lt;/ref&gt;</span><br><span class=\"line\"> &lt;/set&gt;</span><br><span class=\"line\"> &lt;/propery&gt;</span><br><span class=\"line\">&lt;/bean&gt;</span><br></pre></td></tr></table></figure>\n<p> ◇注入Map  </p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">&lt;bean id=<span class=\"string\">&quot;...&quot;</span> <span class=\"class\"><span class=\"keyword\">class</span></span>=<span class=\"string\">&quot;...&quot;</span>&gt;</span><br><span class=\"line\"> &lt;property name=<span class=\"string\">&quot;someMap&quot;</span>&gt;</span><br><span class=\"line\"> &lt;map&gt;<span class=\"comment\">//子标签</span></span><br><span class=\"line\"> &lt;entry key=<span class=\"string\">&quot;k1&quot;</span> value=<span class=\"string\">&quot;v1&quot;</span>&gt;&lt;/entry&gt;<span class=\"comment\">//每一个entry就相当于一个键值对</span></span><br><span class=\"line\"> &lt;entry key=<span class=\"string\">&quot;k2&quot;</span> value-ref=<span class=\"string\">&quot;beanId&quot;</span>&gt;&lt;/entry&gt;</span><br><span class=\"line\"> &lt;/map&gt;</span><br><span class=\"line\"> &lt;/property&gt;</span><br><span class=\"line\">&lt;/bean&gt;</span><br></pre></td></tr></table></figure>\n<p>◇ 注入Properties （属性类型）</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">&lt;bean id=<span class=\"string\">&quot;...&quot;</span> <span class=\"class\"><span class=\"keyword\">class</span></span>=<span class=\"string\">&quot;...&quot;</span>&gt;</span><br><span class=\"line\"> &lt;property name=<span class=\"string\">&quot;someProperties&quot;</span>&gt;</span><br><span class=\"line\"> &lt;props&gt;</span><br><span class=\"line\"> &lt;prop key=<span class=\"string\">&quot;k1&quot;</span>&gt;v1&lt;/prop&gt;<span class=\"comment\">//key和value必须是字符串</span></span><br><span class=\"line\"> &lt;prop key=<span class=\"string\">&quot;k2&quot;</span>&gt;v2&lt;/prop&gt;</span><br><span class=\"line\"> &lt;/props&gt;</span><br><span class=\"line\"> &lt;/property&gt;</span><br><span class=\"line\">&lt;/bean&gt;</span><br></pre></td></tr></table></figure>\n<h3 id=\"案例-公司资产清单\"><a href=\"#案例-公司资产清单\" class=\"headerlink\" title=\"案例-公司资产清单\"></a>案例-公司资产清单</h3><p>◇创建Computer类（作为公司资产）</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.lcg.spring.ioc.entity;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Computer</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> String brand;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> String type;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> String sn;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> Float price;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">Computer</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">Computer</span><span class=\"params\">(String brand, String type, String sn, Float price)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.brand = brand;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.type = type;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.sn = sn;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.price = price;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">     <span class=\"comment\">//...get&amp;set..</span></span><br><span class=\"line\">    <span class=\"comment\">//重写toString方便程序演示</span></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">toString</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">&quot;Computer&#123;&quot;</span> +</span><br><span class=\"line\">                <span class=\"string\">&quot;brand=&#x27;&quot;</span> + brand + <span class=\"string\">&#x27;\\&#x27;&#x27;</span> +</span><br><span class=\"line\">                <span class=\"string\">&quot;, type=&#x27;&quot;</span> + type + <span class=\"string\">&#x27;\\&#x27;&#x27;</span> +</span><br><span class=\"line\">                <span class=\"string\">&quot;, sn=&#x27;&quot;</span> + sn + <span class=\"string\">&#x27;\\&#x27;&#x27;</span> +</span><br><span class=\"line\">                <span class=\"string\">&quot;, price=&quot;</span> + price +</span><br><span class=\"line\">                <span class=\"string\">&#x27;&#125;&#x27;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>◇创建公司类</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.lcg.spring.ioc.entity;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.List;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.Map;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.Properties;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.Set;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Company</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> Set&lt;String&gt; rooms;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> Map&lt;String,Computer&gt; computers;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> Properties info;</span><br><span class=\"line\">    <span class=\"comment\">//...get&amp;set..</span></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">toString</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">&quot;Company&#123;&quot;</span> +</span><br><span class=\"line\">                <span class=\"string\">&quot;rooms=&quot;</span> + rooms +</span><br><span class=\"line\">                <span class=\"string\">&quot;, computers=&quot;</span> + computers +</span><br><span class=\"line\">                <span class=\"string\">&quot;, info=&quot;</span> + info +</span><br><span class=\"line\">                <span class=\"string\">&#x27;&#125;&#x27;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>◇applicationContext配置</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">&lt;?xml version=<span class=\"string\">&quot;1.0&quot;</span> encoding=<span class=\"string\">&quot;UTF-8&quot;</span>?&gt;</span><br><span class=\"line\">&lt;beans xmlns=<span class=\"string\">&quot;http://www.springframework.org/schema/beans&quot;</span></span><br><span class=\"line\">       xmlns:xsi=<span class=\"string\">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class=\"line\">       xsi:schemaLocation=<span class=\"string\">&quot;http://www.springframework.org/schema/beans</span></span><br><span class=\"line\"><span class=\"string\">        https://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span><br><span class=\"line\">    &lt;bean id=<span class=\"string\">&quot;c1&quot;</span> <span class=\"class\"><span class=\"keyword\">class</span></span>=<span class=\"string\">&quot;com.lcg.spring.ioc.entity.Computer&quot;</span>&gt;</span><br><span class=\"line\">        &lt;constructor-arg name=<span class=\"string\">&quot;brand&quot;</span> value=<span class=\"string\">&quot;联想&quot;</span>/&gt;</span><br><span class=\"line\">        &lt;constructor-arg name=<span class=\"string\">&quot;type&quot;</span> value=<span class=\"string\">&quot;台式机&quot;</span>/&gt;</span><br><span class=\"line\">        &lt;constructor-arg name=<span class=\"string\">&quot;sn&quot;</span> value=<span class=\"string\">&quot;8389283012&quot;</span>/&gt;</span><br><span class=\"line\">        &lt;constructor-arg name=<span class=\"string\">&quot;price&quot;</span> value=<span class=\"string\">&quot;3085&quot;</span>/&gt;</span><br><span class=\"line\">    &lt;/bean&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">    &lt;bean <span class=\"class\"><span class=\"keyword\">class</span></span>=<span class=\"string\">&quot;com.lcg.spring.ioc.entity.Computer&quot;</span>&gt;</span><br><span class=\"line\">        &lt;constructor-arg name=<span class=\"string\">&quot;brand&quot;</span> value=<span class=\"string\">&quot;微星&quot;</span>/&gt;</span><br><span class=\"line\">        &lt;constructor-arg name=<span class=\"string\">&quot;type&quot;</span> value=<span class=\"string\">&quot;台式机&quot;</span>/&gt;</span><br><span class=\"line\">        &lt;constructor-arg name=<span class=\"string\">&quot;sn&quot;</span> value=<span class=\"string\">&quot;8389280012&quot;</span>/&gt;</span><br><span class=\"line\">        &lt;constructor-arg name=<span class=\"string\">&quot;price&quot;</span> value=<span class=\"string\">&quot;3000&quot;</span>/&gt;</span><br><span class=\"line\">    &lt;/bean&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">    &lt;bean <span class=\"class\"><span class=\"keyword\">class</span></span>=<span class=\"string\">&quot;com.lcg.spring.ioc.entity.Computer&quot;</span>&gt;</span><br><span class=\"line\">        &lt;constructor-arg name=<span class=\"string\">&quot;brand&quot;</span> value=<span class=\"string\">&quot;华硕&quot;</span>/&gt;</span><br><span class=\"line\">        &lt;constructor-arg name=<span class=\"string\">&quot;type&quot;</span> value=<span class=\"string\">&quot;笔记本&quot;</span>/&gt;</span><br><span class=\"line\">        &lt;constructor-arg name=<span class=\"string\">&quot;sn&quot;</span> value=<span class=\"string\">&quot;9089380012&quot;</span>/&gt;</span><br><span class=\"line\">        &lt;constructor-arg name=<span class=\"string\">&quot;price&quot;</span> value=<span class=\"string\">&quot;6000&quot;</span>/&gt;</span><br><span class=\"line\">    &lt;/bean&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">    &lt;bean id=<span class=\"string\">&quot;company&quot;</span> <span class=\"class\"><span class=\"keyword\">class</span></span>=<span class=\"string\">&quot;com.lcg.spring.ioc.entity.Company&quot;</span>&gt;</span><br><span class=\"line\">        &lt;property name=<span class=\"string\">&quot;rooms&quot;</span>&gt;</span><br><span class=\"line\">            &lt;set&gt;<span class=\"comment\">//set集合不允许出现重复数据，会自动去重</span></span><br><span class=\"line\">                &lt;value&gt;<span class=\"number\">2001</span>-总裁办&lt;/value&gt;</span><br><span class=\"line\">                &lt;value&gt;<span class=\"number\">2003</span>-总经理办公室&lt;/value&gt;</span><br><span class=\"line\">                &lt;value&gt;<span class=\"number\">2010</span>-研发部会议室&lt;/value&gt;</span><br><span class=\"line\">                &lt;value&gt;<span class=\"number\">2010</span>-研发部会议室&lt;/value&gt;</span><br><span class=\"line\">            &lt;/set&gt;</span><br><span class=\"line\">        &lt;/property&gt;</span><br><span class=\"line\">        &lt;property name=<span class=\"string\">&quot;computers&quot;</span>&gt;</span><br><span class=\"line\">            &lt;map&gt;</span><br><span class=\"line\">                &lt;!--方法一、使用value-ref，前提是bean c1已创建--&gt;</span><br><span class=\"line\">                &lt;entry key=<span class=\"string\">&quot;dev-88172&quot;</span> value-ref=<span class=\"string\">&quot;c1&quot;</span>/&gt;</span><br><span class=\"line\">                &lt;!--方法二、使用内置bean，不用额外创建,但这个bean对象只能用于此处--&gt;</span><br><span class=\"line\">                &lt;entry key=<span class=\"string\">&quot;dev-88173&quot;</span>&gt;</span><br><span class=\"line\">                    &lt;bean <span class=\"class\"><span class=\"keyword\">class</span></span>=<span class=\"string\">&quot;com.lcg.spring.ioc.entity.Computer&quot;</span>&gt;</span><br><span class=\"line\">                        &lt;constructor-arg name=<span class=\"string\">&quot;brand&quot;</span> value=<span class=\"string\">&quot;联想&quot;</span>/&gt;</span><br><span class=\"line\">                        &lt;constructor-arg name=<span class=\"string\">&quot;type&quot;</span> value=<span class=\"string\">&quot;笔记本&quot;</span>/&gt;</span><br><span class=\"line\">                        &lt;constructor-arg name=<span class=\"string\">&quot;sn&quot;</span> value=<span class=\"string\">&quot;1280258012&quot;</span>/&gt;</span><br><span class=\"line\">                        &lt;constructor-arg name=<span class=\"string\">&quot;price&quot;</span> value=<span class=\"string\">&quot;5060&quot;</span>/&gt;</span><br><span class=\"line\">                    &lt;/bean&gt;</span><br><span class=\"line\">                &lt;/entry&gt;</span><br><span class=\"line\">            &lt;/map&gt;</span><br><span class=\"line\">        &lt;/property&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">        &lt;property name=<span class=\"string\">&quot;info&quot;</span>&gt;</span><br><span class=\"line\">            &lt;props&gt;<span class=\"comment\">//只允许字符串</span></span><br><span class=\"line\">                &lt;prop key=<span class=\"string\">&quot;phone&quot;</span>&gt;<span class=\"number\">010</span>-<span class=\"number\">12345678</span>&lt;/prop&gt;</span><br><span class=\"line\">                &lt;prop key=<span class=\"string\">&quot;address&quot;</span>&gt;北京市朝阳区XX路XX大厦&lt;/prop&gt;</span><br><span class=\"line\">                &lt;prop key=<span class=\"string\">&quot;website&quot;</span>&gt;http:<span class=\"comment\">//www.xxx.com&lt;/prop&gt;</span></span><br><span class=\"line\">            &lt;/props&gt;</span><br><span class=\"line\">        &lt;/property&gt;</span><br><span class=\"line\">    &lt;/bean&gt;</span><br><span class=\"line\">&lt;/beans&gt;</span><br></pre></td></tr></table></figure>\n<h2 id=\"查看容器内对象\"><a href=\"#查看容器内对象\" class=\"headerlink\" title=\"查看容器内对象\"></a>查看容器内对象</h2><h3 id=\"获取对象\"><a href=\"#获取对象\" class=\"headerlink\" title=\"获取对象\"></a>获取对象</h3><p>◇如何查看容器内有多少对象，写在内部使用的bean不会产生beanID，即无法用此方法获取内部的bean</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//获取容器内所有beanId数组</span></span><br><span class=\"line\">String[] beanNames = context.getBeanDefinitionNames();</span><br></pre></td></tr></table></figure>\n<p>◇获取bean的类型、内容</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">for</span> (String beanName:beanNames)&#123;</span><br><span class=\"line\">       System.out.println(beanName);</span><br><span class=\"line\">       <span class=\"comment\">//获取类型，首先传入参数beanName,返回object对象,再通过getClass得到类对象,然后得到类名</span></span><br><span class=\"line\">       System.out.println(<span class=\"string\">&quot;类型:&quot;</span> + context.getBean(beanName).getClass().getName());</span><br><span class=\"line\">       System.out.println(<span class=\"string\">&quot;内容:&quot;</span> + context.getBean(beanName));</span><br><span class=\"line\">     &#125;</span><br></pre></td></tr></table></figure>\n<p>◇如果没有设置beanID，则默认为类的全名+#+数字序号，若要查看匿名的bean，只输入类的全名只显示第一个匿名的bean，想要具体输出哪一个匿名的bean需要+#+数字序号</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">Computer c1 = context.getBean(<span class=\"string\">&quot;com.lcg.spring.ioc.entity.Computer#2&quot;</span>, Computer.class);</span><br></pre></td></tr></table></figure>\n<h3 id=\"bean-scope属性\"><a href=\"#bean-scope属性\" class=\"headerlink\" title=\"bean scope属性\"></a>bean scope属性</h3><p>◇bean scope属性用于决定对象何时被创建与作用范围<br>◇bean scope配置将影响容器内对象的数量<br>◇bean scope默认值singleton(单例),指全局共享同一个对象实例<br>◇默认情况下bean会在IoC容器创建后自动实例化,全局唯一  </p>\n<h3 id=\"scope用法\"><a href=\"#scope用法\" class=\"headerlink\" title=\"scope用法\"></a>scope用法</h3><figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">&lt;bean id=<span class=\"string\">&quot;bookDao&quot;</span></span><br><span class=\"line\"> <span class=\"class\"><span class=\"keyword\">class</span></span>=<span class=\"string\">&quot;com.lcg.spring.ioc.bookshop.dao.BookDaoOracleImpl&quot;</span></span><br><span class=\"line\"> scope=<span class=\"string\">&quot;prototype&quot;</span> /&gt; <span class=\"comment\">//增加scope</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"bean-scope属性清单\"><a href=\"#bean-scope属性清单\" class=\"headerlink\" title=\"bean scope属性清单\"></a>bean scope属性清单</h3><p>◇bean scope有六个备选值<br><img src=\"/p/ddb/1630912828587-c5400c8d-c90f-4ec9-a45c-f97e30bd07c0.png\" class=\"lazyload\" data-srcset=\"/p/ddb/1630912828587-c5400c8d-c90f-4ec9-a45c-f97e30bd07c0.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"></p>\n<h3 id=\"singleton单例示意图\"><a href=\"#singleton单例示意图\" class=\"headerlink\" title=\"singleton单例示意图\"></a>singleton单例示意图</h3><p><img src=\"/p/ddb/1630912880476-638a2d81-eea8-40f2-8d2a-5aab6bf98b14.png\" class=\"lazyload\" data-srcset=\"/p/ddb/1630912880476-638a2d81-eea8-40f2-8d2a-5aab6bf98b14.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"></p>\n<h3 id=\"singleton的线程安全问题\"><a href=\"#singleton的线程安全问题\" class=\"headerlink\" title=\"singleton的线程安全问题\"></a>singleton的线程安全问题</h3><p>◇用户1设置num=1，然后输出<br><img src=\"/p/ddb/1630913442004-f3433618-87ea-4bfd-969b-8001de77b38c.png\" class=\"lazyload\" data-srcset=\"/p/ddb/1630913442004-f3433618-87ea-4bfd-969b-8001de77b38c.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"><br>◇用户1设置num=1，过了几毫秒，用户2设置num=2，由于全局只有一个对象，所以num=2，且当用户1的输出时，会输出2<br><img src=\"/p/ddb/1632401257175-2a43283a-7f8d-47cd-a62c-0d6c58f90bba.png\" class=\"lazyload\" data-srcset=\"/p/ddb/1632401257175-2a43283a-7f8d-47cd-a62c-0d6c58f90bba.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"></p>\n<h3 id=\"prototype多例示意图\"><a href=\"#prototype多例示意图\" class=\"headerlink\" title=\"prototype多例示意图\"></a>prototype多例示意图</h3><p>◇prototype在容器中多实例,占用更多资源,不存在线程安全问题<br><img src=\"/p/ddb/1632401691625-447396bc-7cc1-40f6-b7ec-a8aa795a2bba.png\" class=\"lazyload\" data-srcset=\"/p/ddb/1632401691625-447396bc-7cc1-40f6-b7ec-a8aa795a2bba.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"></p>\n<h3 id=\"singleton与prototype对比\"><a href=\"#singleton与prototype对比\" class=\"headerlink\" title=\"singleton与prototype对比\"></a>singleton与prototype对比</h3><p><img src=\"/p/ddb/1632401797814-885953de-835e-47e8-800e-b8fd70c0dc05.png\" class=\"lazyload\" data-srcset=\"/p/ddb/1632401797814-885953de-835e-47e8-800e-b8fd70c0dc05.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"></p>\n<h3 id=\"bean-scope的实际应用\"><a href=\"#bean-scope的实际应用\" class=\"headerlink\" title=\"bean scope的实际应用\"></a>bean scope的实际应用</h3><p>◇对于某一个属性，如果在运行过程中是恒定不变的，就可以设置单例模式。<br>◇创建UserDao</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.lcg.spring.ioc.dao;</span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">UserDao</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">UserDao</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;UserDao已创建:&quot;</span> + <span class=\"keyword\">this</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>◇创建UserService</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.lcg.spring.ioc.service;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.lcg.spring.ioc.dao.UserDao;</span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">UserService</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> UserDao userDao;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">UserService</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;UserService已创建:&quot;</span> + <span class=\"keyword\">this</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> UserDao <span class=\"title\">getUserDao</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> userDao;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">setUserDao</span><span class=\"params\">(UserDao userDao)</span> </span>&#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;调用setUserDao:&quot;</span> + userDao);</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.userDao = userDao;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>◇applicationContext.xml配置文件</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">&lt;?xml version=<span class=\"string\">&quot;1.0&quot;</span> encoding=<span class=\"string\">&quot;UTF-8&quot;</span>?&gt;</span><br><span class=\"line\">&lt;beans xmlns=<span class=\"string\">&quot;http://www.springframework.org/schema/beans&quot;</span></span><br><span class=\"line\">       xmlns:xsi=<span class=\"string\">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class=\"line\">       xsi:schemaLocation=<span class=\"string\">&quot;http://www.springframework.org/schema/beans</span></span><br><span class=\"line\"><span class=\"string\">        https://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span><br><span class=\"line\">   &lt;bean id=<span class=\"string\">&quot;userDao&quot;</span> <span class=\"class\"><span class=\"keyword\">class</span></span>=<span class=\"string\">&quot;com.lcg.spring.ioc.dao.UserDao&quot;</span> scope=<span class=\"string\">&quot;prototype&quot;</span>/&gt;</span><br><span class=\"line\">   &lt;bean id=<span class=\"string\">&quot;userService&quot;</span> <span class=\"class\"><span class=\"keyword\">class</span></span>=<span class=\"string\">&quot;com.lcg.spring.ioc.service.UserService&quot;</span> scope=<span class=\"string\">&quot;prototype&quot;</span>&gt;</span><br><span class=\"line\">        &lt;property name=<span class=\"string\">&quot;userDao&quot;</span> ref=<span class=\"string\">&quot;userDao&quot;</span>/&gt;</span><br><span class=\"line\">   &lt;/bean&gt;</span><br><span class=\"line\">&lt;/beans&gt;</span><br></pre></td></tr></table></figure>\n<p>◇主程序入口</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.lcg.spring.ioc;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> com.lcg.spring.ioc.entity.Order;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.lcg.spring.ioc.service.UserService;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.context.ApplicationContext;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.context.support.ClassPathXmlApplicationContext;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">SpringApplication</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> </span>&#123;</span><br><span class=\"line\">        ApplicationContext context =</span><br><span class=\"line\">            <span class=\"keyword\">new</span> ClassPathXmlApplicationContext(<span class=\"string\">&quot;classpath:applicationContext.xml&quot;</span>);</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;======IoC容器已初始化=======&quot;</span>);</span><br><span class=\"line\">       <span class=\"comment\">/* 创建userDao</span></span><br><span class=\"line\"><span class=\"comment\">        UserDao userDao1 = context.getBean(&quot;userDao&quot;, UserDao.class);</span></span><br><span class=\"line\"><span class=\"comment\">        UserDao userDao2 = context.getBean(&quot;userDao&quot;, UserDao.class);</span></span><br><span class=\"line\"><span class=\"comment\">        UserDao userDao3 = context.getBean(&quot;userDao&quot;, UserDao.class);*/</span></span><br><span class=\"line\">        UserService userService1 = context.getBean(<span class=\"string\">&quot;userService&quot;</span>, UserService.class);</span><br><span class=\"line\">        UserService userService2 = context.getBean(<span class=\"string\">&quot;userService&quot;</span>, UserService.class);</span><br><span class=\"line\">        UserService userService3 = context.getBean(<span class=\"string\">&quot;userService&quot;</span>, UserService.class);</span><br><span class=\"line\">        UserService userService4 = context.getBean(<span class=\"string\">&quot;userService&quot;</span>, UserService.class);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"bean的生命周期\"><a href=\"#bean的生命周期\" class=\"headerlink\" title=\"bean的生命周期\"></a>bean的生命周期</h2><p><img src=\"/p/ddb/1632468115442-463d426e-a10d-4800-8395-8a1be644f3a2.png\" class=\"lazyload\" data-srcset=\"/p/ddb/1632468115442-463d426e-a10d-4800-8395-8a1be644f3a2.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"bean生命周期.png\"></p>\n<h3 id=\"细节调整\"><a href=\"#细节调整\" class=\"headerlink\" title=\"细节调整\"></a>细节调整</h3><p>◇prototype时对象创建与init-method延迟至执行业务 代码阶段<br>◇prototype时对象不再受IoC容器管理,不会触发 destroy-method<br>◇延迟加载lazy-init属性可让对象创建与初始化延迟到 执行代码阶段  </p>\n<h3 id=\"生命周期在实战中的运用\"><a href=\"#生命周期在实战中的运用\" class=\"headerlink\" title=\"生命周期在实战中的运用\"></a>生命周期在实战中的运用</h3><p>◇创建订单实体类</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.lcg.spring.ioc.entity;</span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Order</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> Float price;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> Integer quantity;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> Float total;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">Order</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;创建Order对象,&quot;</span> + <span class=\"keyword\">this</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">init</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;执行init()方法&quot;</span>);</span><br><span class=\"line\">        total = price * quantity;<span class=\"comment\">//计算总价</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">pay</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;订单金额为:&quot;</span> + total);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> Float <span class=\"title\">getPrice</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> price;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">setPrice</span><span class=\"params\">(Float price)</span> </span>&#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;设置price:&quot;</span> + price);</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.price = price;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> Integer <span class=\"title\">getQuantity</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> quantity;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">setQuantity</span><span class=\"params\">(Integer quantity)</span> </span>&#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;设置quantity:&quot;</span> + quantity);</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.quantity = quantity;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> Float <span class=\"title\">getTotal</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> total;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">setTotal</span><span class=\"params\">(Float total)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.total = total;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">destroy</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;释放与订单对象相关的资源&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>◇配置order</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">&lt;?xml version=<span class=\"string\">&quot;1.0&quot;</span> encoding=<span class=\"string\">&quot;UTF-8&quot;</span>?&gt;</span><br><span class=\"line\">&lt;beans xmlns=<span class=\"string\">&quot;http://www.springframework.org/schema/beans&quot;</span></span><br><span class=\"line\">       xmlns:xsi=<span class=\"string\">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class=\"line\">       xsi:schemaLocation=<span class=\"string\">&quot;http://www.springframework.org/schema/beans</span></span><br><span class=\"line\"><span class=\"string\">        https://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span><br><span class=\"line\">    &lt;bean id=<span class=\"string\">&quot;order1&quot;</span> <span class=\"class\"><span class=\"keyword\">class</span></span>=<span class=\"string\">&quot;com.lcg.spring.ioc.entity.Order&quot;</span> </span><br><span class=\"line\">        init-method=<span class=\"string\">&quot;init&quot;</span> destroy-method=<span class=\"string\">&quot;destroy&quot;</span>&gt;</span><br><span class=\"line\">        &lt;property name=<span class=\"string\">&quot;price&quot;</span> value=<span class=\"string\">&quot;19.8&quot;</span>/&gt;</span><br><span class=\"line\">        &lt;property name=<span class=\"string\">&quot;quantity&quot;</span> value=<span class=\"string\">&quot;1000&quot;</span>/&gt;</span><br><span class=\"line\">    &lt;/bean&gt;</span><br><span class=\"line\">&lt;/beans&gt;</span><br></pre></td></tr></table></figure>\n<p>◇主程序</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.lcg.spring.ioc;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> com.lcg.spring.ioc.entity.Order;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.lcg.spring.ioc.service.UserService;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.context.ApplicationContext;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.context.support.ClassPathXmlApplicationContext;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">SpringApplication</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> </span>&#123;</span><br><span class=\"line\">        ApplicationContext context =</span><br><span class=\"line\">            <span class=\"keyword\">new</span> ClassPathXmlApplicationContext(<span class=\"string\">&quot;classpath:applicationContext.xml&quot;</span>);</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;======IoC容器已初始化=======&quot;</span>);</span><br><span class=\"line\">        Order order1 = context.getBean(<span class=\"string\">&quot;order1&quot;</span>, Order.class);</span><br><span class=\"line\">        order1.pay();</span><br><span class=\"line\">        <span class=\"comment\">//销毁IoC容器方法</span></span><br><span class=\"line\">        ((ClassPathXmlApplicationContext) context).registerShutdownHook();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>◇运行结果<br><img src=\"/p/ddb/1639625401117-bbde845e-26d7-464d-bbe5-eb3229f9a57d.png\" class=\"lazyload\" data-srcset=\"/p/ddb/1639625401117-bbde845e-26d7-464d-bbe5-eb3229f9a57d.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"></p>\n<h3 id=\"实现极简IoC容器\"><a href=\"#实现极简IoC容器\" class=\"headerlink\" title=\"实现极简IoC容器\"></a>实现极简IoC容器</h3><p>◇创建实体类Apple</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Apple</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> String title;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> String color;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> String origin;</span><br><span class=\"line\">    ...</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>◇创建配置文件</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">&lt;?xml version=<span class=\"string\">&quot;1.0&quot;</span> encoding=<span class=\"string\">&quot;UTF-8&quot;</span>?&gt;</span><br><span class=\"line\">&lt;beans&gt;</span><br><span class=\"line\">    &lt;bean id=<span class=\"string\">&quot;sweetApple&quot;</span> <span class=\"class\"><span class=\"keyword\">class</span></span>=<span class=\"string\">&quot;com.lcg.spring.ioc.entity.Apple&quot;</span>&gt;</span><br><span class=\"line\">        &lt;property name=<span class=\"string\">&quot;title&quot;</span> value=<span class=\"string\">&quot;红富士&quot;</span>/&gt;</span><br><span class=\"line\">        &lt;property name=<span class=\"string\">&quot;color&quot;</span> value=<span class=\"string\">&quot;红色&quot;</span>/&gt;</span><br><span class=\"line\">        &lt;property name=<span class=\"string\">&quot;origin&quot;</span> value=<span class=\"string\">&quot;欧洲&quot;</span>/&gt;</span><br><span class=\"line\">    &lt;/bean&gt;</span><br><span class=\"line\">&lt;/beans&gt;</span><br></pre></td></tr></table></figure>\n<p>◇创建接口</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.lcg.spring.ioc.context;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">interface</span> <span class=\"title\">ApplicationContext</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> Object <span class=\"title\">getBean</span><span class=\"params\">(String beanId)</span></span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>◇核心配置文件部分代码</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">&lt;repositories&gt;</span><br><span class=\"line\">    &lt;repository&gt;</span><br><span class=\"line\">        &lt;id&gt;aliyun&lt;/id&gt;</span><br><span class=\"line\">        &lt;name&gt;aliyun&lt;/name&gt;</span><br><span class=\"line\">        &lt;url&gt;https:<span class=\"comment\">//maven.aliyun.com/repository/public&lt;/url&gt;</span></span><br><span class=\"line\">    &lt;/repository&gt;</span><br><span class=\"line\">&lt;/repositories&gt;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">&lt;dependencies&gt;</span><br><span class=\"line\">    &lt;!-- Dom4j是Java的XML解析组件 --&gt;</span><br><span class=\"line\">    &lt;dependency&gt;</span><br><span class=\"line\">        &lt;groupId&gt;org.dom4j&lt;/groupId&gt;</span><br><span class=\"line\">        &lt;artifactId&gt;dom4j&lt;/artifactId&gt;</span><br><span class=\"line\">        &lt;version&gt;<span class=\"number\">2.1</span><span class=\"number\">.1</span>&lt;/version&gt;</span><br><span class=\"line\">    &lt;/dependency&gt;</span><br><span class=\"line\">    &lt;!-- Jaxen是Xpath表达式解释器 --&gt;</span><br><span class=\"line\">    &lt;dependency&gt;</span><br><span class=\"line\">        &lt;groupId&gt;jaxen&lt;/groupId&gt;</span><br><span class=\"line\">        &lt;artifactId&gt;jaxen&lt;/artifactId&gt;</span><br><span class=\"line\">        &lt;version&gt;<span class=\"number\">1.1</span><span class=\"number\">.6</span>&lt;/version&gt;</span><br><span class=\"line\">    &lt;/dependency&gt;</span><br><span class=\"line\">&lt;/dependencies&gt;</span><br></pre></td></tr></table></figure>\n<p>◇创建类<br>◇在Ioc容器初始化的过程中，遇到了对象实例化，就去调用Class.forName、newInstance方法来利用反射技术实现对象的创建;如果遇到了property这个标签，则利用Method对象实现方法的调用</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.lcg.spring.ioc.context;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> org.dom4j.Document;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.dom4j.Element;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.dom4j.Node;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.dom4j.io.SAXReader;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.io.File;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.lang.reflect.Method;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.net.URLDecoder;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.HashMap;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.List;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.Map;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ClassPathXmlApplicationContext</span> <span class=\"keyword\">implements</span> <span class=\"title\">ApplicationContext</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> Map iocContainer = <span class=\"keyword\">new</span> HashMap();</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">ClassPathXmlApplicationContext</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">try</span>&#123;</span><br><span class=\"line\">            <span class=\"comment\">//得到配置文件的地址</span></span><br><span class=\"line\">            String filePath = </span><br><span class=\"line\">                <span class=\"keyword\">this</span>.getClass().getResource(<span class=\"string\">&quot;/applicationContext.xml&quot;</span>).getPath();</span><br><span class=\"line\">            <span class=\"comment\">//使用URL解码</span></span><br><span class=\"line\">            filePath = <span class=\"keyword\">new</span> URLDecoder().decode(filePath, <span class=\"string\">&quot;UTF-8&quot;</span>);</span><br><span class=\"line\">            SAXReader reader = <span class=\"keyword\">new</span> SAXReader();</span><br><span class=\"line\">            <span class=\"comment\">//读取指定文件,所有的xml文件都会放在document中</span></span><br><span class=\"line\">            Document document = reader.read(<span class=\"keyword\">new</span> File(filePath));</span><br><span class=\"line\">            <span class=\"comment\">//按照xml格式依次读取,getRootElement()得到根节点,</span></span><br><span class=\"line\">            <span class=\"comment\">// selectNodes(&quot;bean&quot;)将所有根节点的bean标签获取</span></span><br><span class=\"line\">            List&lt;Node&gt; beans = document.getRootElement().selectNodes(<span class=\"string\">&quot;bean&quot;</span>);</span><br><span class=\"line\">            <span class=\"keyword\">for</span>(Node node : beans)&#123;</span><br><span class=\"line\">                Element  ele = (Element)node;</span><br><span class=\"line\">                <span class=\"comment\">//读取属性</span></span><br><span class=\"line\">                String id = ele.attributeValue(<span class=\"string\">&quot;id&quot;</span>);</span><br><span class=\"line\">                String className = ele.attributeValue(<span class=\"string\">&quot;class&quot;</span>);</span><br><span class=\"line\">                <span class=\"comment\">//forName(className)加载指定的类</span></span><br><span class=\"line\">                Class c = Class.forName(className);</span><br><span class=\"line\">                Object obj = c.newInstance();<span class=\"comment\">//通过默认构造方法创建Apple类的实例</span></span><br><span class=\"line\">                List&lt;Node&gt; properties = ele.selectNodes(<span class=\"string\">&quot;property&quot;</span>);</span><br><span class=\"line\">                <span class=\"comment\">//遍历属性</span></span><br><span class=\"line\">                <span class=\"keyword\">for</span>(Node p : properties)&#123;</span><br><span class=\"line\">                    Element property = (Element) p;</span><br><span class=\"line\">                     <span class=\"comment\">//读取name及其对应的值</span></span><br><span class=\"line\">                    String propName = property.attributeValue(<span class=\"string\">&quot;name&quot;</span>);</span><br><span class=\"line\">                    String propValue = property.attributeValue(<span class=\"string\">&quot;value&quot;</span>);</span><br><span class=\"line\">                    <span class=\"comment\">//组织set方法，substring(1)代表从第二个字符将之后的所有字符串进行截取</span></span><br><span class=\"line\">                    String setMethodName = <span class=\"string\">&quot;set&quot;</span> + </span><br><span class=\"line\">                        propName.substring(<span class=\"number\">0</span>,<span class=\"number\">1</span>).toUpperCase()+propName.substring(<span class=\"number\">1</span>);</span><br><span class=\"line\">                    System.out.println(<span class=\"string\">&quot;准备执行&quot;</span> + setMethodName + <span class=\"string\">&quot;方法注入数据&quot;</span>);</span><br><span class=\"line\">                    <span class=\"comment\">//通过getMethod方法调用</span></span><br><span class=\"line\">                    Method setMethod = c.getMethod(setMethodName, String.class);</span><br><span class=\"line\">                    setMethod.invoke(obj,propValue);<span class=\"comment\">//通过setter方法注入数据</span></span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                <span class=\"comment\">//将id和obj放入容器中，即ioc对刚才创建的对象赋予beanId进行管理</span></span><br><span class=\"line\">                iocContainer.put(id,obj);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            System.out.println(iocContainer);</span><br><span class=\"line\">            System.out.println(<span class=\"string\">&quot;IOC容器初始化完毕&quot;</span>);</span><br><span class=\"line\">        &#125;<span class=\"keyword\">catch</span> (Exception e)&#123;</span><br><span class=\"line\">            e.printStackTrace();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> Object <span class=\"title\">getBean</span><span class=\"params\">(String beanId)</span></span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> iocContainer.get(beanId);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>◇入口类</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.lcg.spring.ioc;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> com.lcg.spring.ioc.context.ApplicationContext;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.lcg.spring.ioc.context.ClassPathXmlApplicationContext;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.lcg.spring.ioc.entity.Apple;</span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Application</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> </span>&#123;</span><br><span class=\"line\">        ApplicationContext context =</span><br><span class=\"line\">                <span class=\"keyword\">new</span> ClassPathXmlApplicationContext();</span><br><span class=\"line\">        Apple apple = (Apple)context.getBean(<span class=\"string\">&quot;sweetApple&quot;</span>);</span><br><span class=\"line\">        System.out.println(apple);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"基于注解配置IoC容器\"><a href=\"#基于注解配置IoC容器\" class=\"headerlink\" title=\"基于注解配置IoC容器\"></a>基于注解配置IoC容器</h2><h3 id=\"基于注解的优势\"><a href=\"#基于注解的优势\" class=\"headerlink\" title=\"基于注解的优势\"></a>基于注解的优势</h3><p>◇摆脱繁琐的XML形式的bean与依赖注入配置<br>◇基于”声明式”的原则,更适合轻量级的现代企业应用<br>◇让代码可读性变得更好,研发人员拥有更好的开发体验  </p>\n<h3 id=\"三类注解\"><a href=\"#三类注解\" class=\"headerlink\" title=\"三类注解\"></a>三类注解</h3><p>◇组件类型注解-声明当前类的功能与职责<br>◇自动装配注解-根据属性特征自动注入对象<br>◇元数据注解-更细化的辅助IoC容器管理对象的注解  </p>\n<h3 id=\"四种组件类型注解\"><a href=\"#四种组件类型注解\" class=\"headerlink\" title=\"四种组件类型注解\"></a>四种组件类型注解</h3><p>◇语义注解是组件注解的细化</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Component</span>    组件注解,通用注解,被该注解描述的类将被IoC容器管理并实例化</span><br><span class=\"line\"><span class=\"meta\">@Controller</span>   语义注解,说明当前类是MVC应用中的控制器类</span><br><span class=\"line\"><span class=\"meta\">@Service</span>      语义注解,说明当前类是Service业务服务类</span><br><span class=\"line\"><span class=\"meta\">@Repository</span>   语义注解,说明当前类用于业务持久层,通常描述对应Dao类</span><br></pre></td></tr></table></figure>\n<h3 id=\"开启组件扫描\"><a href=\"#开启组件扫描\" class=\"headerlink\" title=\"开启组件扫描\"></a>开启组件扫描</h3><p>◇regex表示排除扫描，即类名符合com.imooc.exl.*的正则表达式就不会被ioc容器进行实例化<br><img src=\"/p/ddb/1632644213443-2887e008-68d5-442b-b82f-eceead2d9772.png\" class=\"lazyload\" data-srcset=\"/p/ddb/1632644213443-2887e008-68d5-442b-b82f-eceead2d9772.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"></p>\n<h3 id=\"代码示例-1\"><a href=\"#代码示例-1\" class=\"headerlink\" title=\"代码示例\"></a>代码示例</h3><p>◇创建applicationContext.xml，和传统的配置不一样,额外的增加了context命名空间</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">&lt;?xml version=<span class=\"string\">&quot;1.0&quot;</span> encoding=<span class=\"string\">&quot;UTF-8&quot;</span>?&gt;</span><br><span class=\"line\">&lt;beans xmlns=<span class=\"string\">&quot;http://www.springframework.org/schema/beans&quot;</span></span><br><span class=\"line\">       xmlns:xsi=<span class=\"string\">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class=\"line\">       xmlns:context=<span class=\"string\">&quot;http://www.springframework.org/schema/context&quot;</span></span><br><span class=\"line\">       xsi:schemaLocation=<span class=\"string\">&quot;http://www.springframework.org/schema/beans</span></span><br><span class=\"line\"><span class=\"string\">        https://www.springframework.org/schema/beans/spring-beans.xsd</span></span><br><span class=\"line\"><span class=\"string\">        http://www.springframework.org/schema/context</span></span><br><span class=\"line\"><span class=\"string\">        https://www.springframework.org/schema/context/spring-context.xsd&quot;</span>&gt;</span><br><span class=\"line\">    &lt;!-- component-scan在IoC容器初始化时自动扫描四种组件类型注解并完成实例化</span><br><span class=\"line\">        <span class=\"meta\">@Repository</span></span><br><span class=\"line\">        <span class=\"meta\">@Service</span></span><br><span class=\"line\">        <span class=\"meta\">@Controller</span></span><br><span class=\"line\">        <span class=\"meta\">@Component</span></span><br><span class=\"line\">     --&gt;</span><br><span class=\"line\">    &lt;context:component-scan base-<span class=\"keyword\">package</span>=<span class=\"string\">&quot;com.lcg&quot;</span>/&gt;</span><br><span class=\"line\">&lt;/beans&gt;</span><br></pre></td></tr></table></figure>\n<p>◇剩余代码见项目s07；</p>\n<h3 id=\"两类自动装配注解\"><a href=\"#两类自动装配注解\" class=\"headerlink\" title=\"两类自动装配注解\"></a>两类自动装配注解</h3><p>◇自动装配注解即在ioc容器运行的过程中自动的为某个属性注入数据，推荐按名称装配<br>◇在属性上方进行装配注解和在setXX方法上方进行都可以完成对象的注入，但是在属性上方进行装配Spring IoC容器会自动通过反射技术将属性private修饰符自动改为public,直接进行赋值，不再执行set方法。<em>如果装配注解放在set方法上,则自动按类型/名称对set方法参数进行注入</em><br>◇如果出现两个类(比方说不同的数据库)实现同一个接口,并且两个类都进行了语义注解(dao的注解为@Repository)，则在运行时会报错，因为出现了两个bean对象。在s07项目中Service类中进行了IUserDao的自动注解，但由于两个dao类都实现了IUserDao接口，则不知道选择哪一个。解决方法：①在userDao中去@Repository注解，这样userDao就不会被Ioc容器管理了；②引入额外的注解@Primary，表示如果出现多个bean对象的话，主要采用有此注解的；<br>◇两个不同的Dao</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//组件类型注解默认beanId为类名首字母小写</span></span><br><span class=\"line\"><span class=\"comment\">//beadId = userDao</span></span><br><span class=\"line\"><span class=\"meta\">@Repository</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">UserDao</span> <span class=\"keyword\">implements</span> <span class=\"title\">IUserDao</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">UserDao</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;正在创建UserDao:&quot;</span> + <span class=\"keyword\">this</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Repository</span></span><br><span class=\"line\"><span class=\"meta\">@Primary</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">UserOracleDao</span> <span class=\"keyword\">implements</span> <span class=\"title\">IUserDao</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">UserOracleDao</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;正在创建UserOracleDao:&quot;</span> + <span class=\"keyword\">this</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>◇因此，为了避免出现这种情况，一般采用按名称进行注入；</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.lcg.spring.ioc.service;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.lcg.spring.ioc.dao.IUserDao;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.stereotype.Service;</span><br><span class=\"line\"><span class=\"keyword\">import</span> javax.annotation.Resource;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Service</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">DepartmentService</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 1. <span class=\"doctag\">@Resource</span>设置name属性,则按name在IoC容器中将bean注入</span></span><br><span class=\"line\"><span class=\"comment\">     * 2. <span class=\"doctag\">@Resource</span>未设置name属性</span></span><br><span class=\"line\"><span class=\"comment\">     * 2.1 以属性名作为bean name在IoC容器中匹配bean,如有匹配则注入</span></span><br><span class=\"line\"><span class=\"comment\">     * 2.2 按属性名未匹配,则按类型进行匹配,同<span class=\"doctag\">@Autowired</span>,需加入<span class=\"doctag\">@Primary</span>解决类型冲突</span></span><br><span class=\"line\"><span class=\"comment\">     * 使用建议:在使用<span class=\"doctag\">@Resource</span>对象时推荐设置name或保证属性名与bean名称一致(规范属性名)</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\"><span class=\"comment\">//    @Resource(name = &quot;userOracleDao&quot;) 设置userOracleDao为name属性</span></span><br><span class=\"line\"><span class=\"comment\">//    private IUserDao uDao;</span></span><br><span class=\"line\">    <span class=\"meta\">@Resource</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> IUserDao userDao; <span class=\"comment\">//这里属性名为userDao(规范属性名),以其作为name属性</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">joinDepartment</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">        System.out.println(userDao);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p><img src=\"/p/ddb/1632657405828-7a0f304b-7b46-4865-a138-c2e341b27348.png\" class=\"lazyload\" data-srcset=\"/p/ddb/1632657405828-7a0f304b-7b46-4865-a138-c2e341b27348.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"></p>\n<h3 id=\"元数据注解\"><a href=\"#元数据注解\" class=\"headerlink\" title=\"元数据注解\"></a>元数据注解</h3><p>◇@Scope(<strong>“prototype”</strong>)<em>//设置单例/多例,XML中 bean scope完全相同 _<br>◇@PostConstruct <em>//XML中bean init-method完全相同，即初始化方法</em><br>◇@Value(<strong>“${metaData}”</strong>)</em>//读取config.properties的metaData属性值_<br><img src=\"/p/ddb/1632709510231-6f4d768f-1268-4ce8-aca7-a057100d1bb9.png\" class=\"lazyload\" data-srcset=\"/p/ddb/1632709510231-6f4d768f-1268-4ce8-aca7-a057100d1bb9.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"></p>\n<h3 id=\"Value的读取属性文件\"><a href=\"#Value的读取属性文件\" class=\"headerlink\" title=\"@Value的读取属性文件\"></a>@Value的读取属性文件</h3><p>◇@value参数书写格式为”${属性名}”<br>◇config.properties应用程序的配置信息，基于字符串的键值对，需要在applicationContext中进行加载，加载语句为：</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!--通知Spring IoC容器初始化时加载属性文件--&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">context:property-placeholder</span> <span class=\"attr\">location</span>=<span class=\"string\">&quot;classpath:config.properties&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>\n<p>◇config.properties配置信息</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">metaData=lcg.com</span><br><span class=\"line\"><span class=\"comment\">//数据库的连接属性，通过增加前缀connection来说明，在引用时也得书写完整字符串</span></span><br><span class=\"line\">connection.driver=xxxxx </span><br><span class=\"line\">connection.url=xxx</span><br><span class=\"line\">connection.username=xxx</span><br><span class=\"line\">connection.password=xxx</span><br></pre></td></tr></table></figure>\n<p>◇xml文件配置维护起来比较方便，但是不便于开发；而注解形式配置开发方便但维护的时候需要修改源代码<br>◇示例代码</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Service</span></span><br><span class=\"line\"><span class=\"meta\">@Scope(&quot;prototype&quot;)</span><span class=\"comment\">//设置单例/多例,XML中 bean scope完全相同</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">UserService</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"meta\">@Value(&quot;$&#123;metaData&#125;&quot;)</span><span class=\"comment\">//读取config.properties的metaData属性值</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> String metaData;</span><br><span class=\"line\">    <span class=\"meta\">@Value(&quot;$&#123;connection.password&#125;&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> String password;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">UserService</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;正在创建UserService:&quot;</span> + <span class=\"keyword\">this</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@PostConstruct</span> <span class=\"comment\">//XML中bean init-method完全相同</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">init</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;初始化UserService对象,metaData=&quot;</span> + metaData);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//Spring IoC容器会自动通过反射技术将属性private修饰符自动改为public,直接进行赋值</span></span><br><span class=\"line\">    <span class=\"comment\">//不再执行set方法</span></span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> IUserDao udao;<span class=\"comment\">//private-&gt;public</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> IUserDao <span class=\"title\">getUdao</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> udao;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/*@Autowired</span></span><br><span class=\"line\"><span class=\"comment\">    //如果装配注解放在set方法上,则自动按类型/名称对set方法参数进行注入</span></span><br><span class=\"line\"><span class=\"comment\">    public void setUdao(UserDao udao) &#123;</span></span><br><span class=\"line\"><span class=\"comment\">        System.out.println(&quot;setUdao:&quot; + udao);</span></span><br><span class=\"line\"><span class=\"comment\">        this.udao = udao;</span></span><br><span class=\"line\"><span class=\"comment\">    &#125;*/</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"基于Java-Config配置IoC容器\"><a href=\"#基于Java-Config配置IoC容器\" class=\"headerlink\" title=\"基于Java Config配置IoC容器\"></a>基于Java Config配置IoC容器</h2><h3 id=\"基于Java-Config的优势\"><a href=\"#基于Java-Config的优势\" class=\"headerlink\" title=\"基于Java Config的优势\"></a>基于Java Config的优势</h3><p>◇完全摆脱XML的束缚,使用独立Java类管理对象与依赖<br>◇注解配置相对分散,利用Java Config可对配置集中管理<br>◇可以在编译时进行依赖检查,不容易出错<br>◇一般用于敏捷开发</p>\n<h3 id=\"Java-Config核心注解\"><a href=\"#Java-Config核心注解\" class=\"headerlink\" title=\"Java Config核心注解\"></a>Java Config核心注解</h3><p>◇项目演示见s08。<br><img src=\"/p/ddb/1632712740006-91604ef1-c78a-44ca-b1f0-50eac3ea237c.png\" class=\"lazyload\" data-srcset=\"/p/ddb/1632712740006-91604ef1-c78a-44ca-b1f0-50eac3ea237c.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"><br>◇使用config类代替xml配置</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.lcg.spring.ioc;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> com.lcg.spring.ioc.controller.UserController;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.lcg.spring.ioc.dao.EmployeeDao;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.lcg.spring.ioc.dao.UserDao;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.lcg.spring.ioc.service.UserService;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.context.annotation.*;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Configuration</span> <span class=\"comment\">//指明当前类是一个配置类,用于替代applicationContext.xml</span></span><br><span class=\"line\"><span class=\"meta\">@ComponentScan(basePackages = &quot;com.lcg&quot;)</span><span class=\"comment\">//进行扫描</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Config</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"meta\">@Bean</span> <span class=\"comment\">//Java Config利用方法创建对象,将方法返回对象放入容器,beanId=方法名</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> UserDao <span class=\"title\">userDao</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">        UserDao userDao = <span class=\"keyword\">new</span> UserDao();</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;已创建&quot;</span> + userDao);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> userDao;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Bean</span> <span class=\"comment\">//Java Config利用方法创建对象,将方法返回对象放入容器,beanId=方法名</span></span><br><span class=\"line\">    <span class=\"meta\">@Primary</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> UserDao <span class=\"title\">userDao1</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">        UserDao userDao = <span class=\"keyword\">new</span> UserDao();</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;已创建&quot;</span> + userDao);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> userDao;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"comment\">//先按name尝试注入,name不存在则按类型注入</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> UserService <span class=\"title\">userService</span><span class=\"params\">(UserDao udao , EmployeeDao employeeDao)</span></span>&#123;</span><br><span class=\"line\">        UserService userService = <span class=\"keyword\">new</span> UserService();</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;已创建&quot;</span> + userService);</span><br><span class=\"line\">        userService.setUserDao(udao);</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;调用setUserDao:&quot;</span> + udao);</span><br><span class=\"line\">        userService.setEmployeeDao(employeeDao);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> userService;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Bean</span> <span class=\"comment\">//&lt;bean id=&quot;xxx&quot; clas=&quot;xxx&quot;&gt;</span></span><br><span class=\"line\">    <span class=\"meta\">@Scope(&quot;prototype&quot;)</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> UserController <span class=\"title\">userController</span><span class=\"params\">(UserService userService)</span></span>&#123;</span><br><span class=\"line\">        UserController userController = <span class=\"keyword\">new</span> UserController();</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;已创建&quot;</span> + userController);</span><br><span class=\"line\">        userController.setUserService(userService);</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;调用setUserService:&quot;</span> + userService);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> userController;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>◇Java Config初始化方式</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">SpringApplication</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">//基于Java Config配置IoC容器的初始化</span></span><br><span class=\"line\">        ApplicationContext context = <span class=\"keyword\">new</span> AnnotationConfigApplicationContext(Config.class);</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;=========================&quot;</span>);</span><br><span class=\"line\">        String[] ids = context.getBeanDefinitionNames();</span><br><span class=\"line\">        <span class=\"keyword\">for</span>(String id : ids)&#123;</span><br><span class=\"line\">            System.out.println(id + <span class=\"string\">&quot;:&quot;</span> + context.getBean(id));</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"Spring单元测试\"><a href=\"#Spring单元测试\" class=\"headerlink\" title=\"Spring单元测试\"></a>Spring单元测试</h2><h3 id=\"Spring-Test-测试模块\"><a href=\"#Spring-Test-测试模块\" class=\"headerlink\" title=\"Spring Test 测试模块\"></a>Spring Test 测试模块</h3><p>◇Spring Test是Spring中用于测试的模块<br>◇Spring Test对JUnit单元测试框架有良好的整合<br>◇通过Spring Test可在JUnit在单元测试时自动初始化IoC容器  </p>\n<h3 id=\"Spring与JUnit4整合过程\"><a href=\"#Spring与JUnit4整合过程\" class=\"headerlink\" title=\"Spring与JUnit4整合过程\"></a>Spring与JUnit4整合过程</h3><p>◇Maven工程依赖spring-test<br>◇利用@RunWith与@ContextConfiguration描述测试用例类<br>◇测试用例类从容器获取对象完成测试用例的执行</p>\n<h3 id=\"代码演示\"><a href=\"#代码演示\" class=\"headerlink\" title=\"代码演示\"></a>代码演示</h3><p>  ◇核心配置pom.xml</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">&lt;dependencies&gt;</span><br><span class=\"line\">        &lt;dependency&gt;</span><br><span class=\"line\">            &lt;groupId&gt;org.springframework&lt;/groupId&gt;</span><br><span class=\"line\">            &lt;artifactId&gt;spring-context&lt;/artifactId&gt;</span><br><span class=\"line\">            &lt;version&gt;<span class=\"number\">5.2</span><span class=\"number\">.6</span>.RELEASE&lt;/version&gt;</span><br><span class=\"line\">        &lt;/dependency&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">        &lt;dependency&gt;</span><br><span class=\"line\">            &lt;groupId&gt;org.springframework&lt;/groupId&gt;</span><br><span class=\"line\">            &lt;artifactId&gt;spring-test&lt;/artifactId&gt;</span><br><span class=\"line\">            &lt;version&gt;<span class=\"number\">5.2</span><span class=\"number\">.6</span>.RELEASE&lt;/version&gt;</span><br><span class=\"line\">        &lt;/dependency&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">        &lt;dependency&gt;</span><br><span class=\"line\">            &lt;groupId&gt;junit&lt;/groupId&gt;</span><br><span class=\"line\">            &lt;artifactId&gt;junit&lt;/artifactId&gt;</span><br><span class=\"line\">            &lt;version&gt;<span class=\"number\">4.12</span>&lt;/version&gt;</span><br><span class=\"line\">        &lt;/dependency&gt;</span><br><span class=\"line\">    &lt;/dependencies&gt;</span><br></pre></td></tr></table></figure>\n<p>◇applicationContext配置文件</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">&lt;?xml version=<span class=\"string\">&quot;1.0&quot;</span> encoding=<span class=\"string\">&quot;UTF-8&quot;</span>?&gt;</span><br><span class=\"line\">&lt;beans xmlns=<span class=\"string\">&quot;http://www.springframework.org/schema/beans&quot;</span></span><br><span class=\"line\">       xmlns:xsi=<span class=\"string\">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class=\"line\">       xsi:schemaLocation=<span class=\"string\">&quot;http://www.springframework.org/schema/beans</span></span><br><span class=\"line\"><span class=\"string\">        https://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span><br><span class=\"line\">    &lt;bean id=<span class=\"string\">&quot;userDao&quot;</span> <span class=\"class\"><span class=\"keyword\">class</span></span>=<span class=\"string\">&quot;com.lcg.spring.ioc.dao.UserDao&quot;</span>&gt;</span><br><span class=\"line\">    &lt;/bean&gt;</span><br><span class=\"line\">    &lt;bean id=<span class=\"string\">&quot;userService&quot;</span> <span class=\"class\"><span class=\"keyword\">class</span></span>=<span class=\"string\">&quot;com.imooc.spring.ioc.service.UserService&quot;</span>&gt;</span><br><span class=\"line\">        &lt;property name=<span class=\"string\">&quot;userDao&quot;</span> ref=<span class=\"string\">&quot;userDao&quot;</span>/&gt;</span><br><span class=\"line\">    &lt;/bean&gt;</span><br><span class=\"line\">&lt;/beans&gt;</span><br></pre></td></tr></table></figure>\n<p>◇dao类(模拟功能)</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">UserDao</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">insert</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;新增用户数据&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>◇service类</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">UserService</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> UserDao userDao;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">createUser</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;调用创建用户业务代码&quot;</span>);</span><br><span class=\"line\">        userDao.insert();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> UserDao <span class=\"title\">getUserDao</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> userDao;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">setUserDao</span><span class=\"params\">(UserDao userDao)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.userDao = userDao;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>◇测试用例类</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> com.lcg.spring.ioc.service.UserService;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.junit.Test;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.junit.runner.RunWith;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.test.context.ContextConfiguration;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.test.context.junit4.SpringJUnit4ClassRunner;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> javax.annotation.Resource;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//将Junit4的执行权交由Spring Test模块,在测试用例执行前自动初始化IoC容器</span></span><br><span class=\"line\"><span class=\"meta\">@RunWith(SpringJUnit4ClassRunner.class)</span><span class=\"comment\">//RunWith运行器</span></span><br><span class=\"line\"><span class=\"comment\">//此注解说明要加载哪个配置文件,locations是一个数组,保存配置文件位置</span></span><br><span class=\"line\"><span class=\"meta\">@ContextConfiguration(locations = &#123;&quot;classpath:applicationContext.xml&quot;&#125;)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">SpringTestor</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"meta\">@Resource</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> UserService userService;<span class=\"comment\">//进行属性的注入</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Test</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">testUserService</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">        userService.createUser();<span class=\"comment\">//在测试用例中进行调用</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"总结与回顾\"><a href=\"#总结与回顾\" class=\"headerlink\" title=\"总结与回顾\"></a>总结与回顾</h2><p>◇Spring快速入门           ◇Spring XML配置<br>◇对象实例化配置           ◇依赖注入配置<br>◇注解与Java Config       ◇Spring 单元测试</p>\n","categories":["Spring","Spring基础"],"tags":["Spring"]},{"title":"SpringMVC入门与数据绑定","url":"/p/b016.html","content":"<h2 id=\"周课介绍\"><a href=\"#周课介绍\" class=\"headerlink\" title=\"周课介绍\"></a>周课介绍</h2><h3 id=\"Spring-MVC\"><a href=\"#Spring-MVC\" class=\"headerlink\" title=\"Spring MVC\"></a>Spring MVC</h3><p><img src=\"/p/b016/1633767307961-da03edbb-a53f-461d-8013-31977b688b90.png\" class=\"lazyload\" data-srcset=\"/p/b016/1633767307961-da03edbb-a53f-461d-8013-31977b688b90.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"></p>\n<h3 id=\"Restful开发风格\"><a href=\"#Restful开发风格\" class=\"headerlink\" title=\"Restful开发风格\"></a>Restful开发风格</h3><p><img src=\"/p/b016/1633767365393-c0e20976-0aeb-4cfa-888f-e819e3ad3fe3.png\" class=\"lazyload\" data-srcset=\"/p/b016/1633767365393-c0e20976-0aeb-4cfa-888f-e819e3ad3fe3.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"></p>\n<h2 id=\"Spring-MVC-1\"><a href=\"#Spring-MVC-1\" class=\"headerlink\" title=\"Spring MVC\"></a>Spring MVC</h2><h3 id=\"课程介绍\"><a href=\"#课程介绍\" class=\"headerlink\" title=\"课程介绍\"></a>课程介绍</h3><p>◇Spring MVC入门                ◇Spring MVC数据绑定<br>◇Restful开发风格                 ◇Spring MVC拦截器</p>\n<h3 id=\"MVC到底是什么\"><a href=\"#MVC到底是什么\" class=\"headerlink\" title=\"MVC到底是什么\"></a>MVC到底是什么</h3><p>◇MVC是一种著名的架构模式；View就是我们通常说的界面部分，用于和用户进行交互，比如通过界面显示查询结果，提供表单等；而模型通常指的是数据，如果放在java代码里就是业务逻辑的部分；在MVC的设计理念中，如果前面视图中某个表格的数据来自于后端的Model中，并非视图通过java主动的调用model中的某一个方法来获取数据，而是要通过控制器；控制器相当于中介，作为控制器，是整个MVC架构中最核心的部分，其用途就是接收视图中所传入的数据，然后再根据数据调用后端的业务逻辑得到结果，再将后端得到的结果返回到视图中；<br><img src=\"/p/b016/1633767696416-64f8f281-fca5-46ac-8502-59d96086b2cc.png\" class=\"lazyload\" data-srcset=\"/p/b016/1633767696416-64f8f281-fca5-46ac-8502-59d96086b2cc.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"><br>◇Spring MVC是Spring体系的轻量级Web MVC框架<br>◇Spring MVC的核心Controller控制器，用于处理请求，产生响应；在MVC中，界面是不允许直接访问后端的Model业务逻辑的，而是通过控制器作为一个中间者传递调用，这样的好处是让我们的界面和后端的java业务逻辑解耦，提高了程序的可维护性；<br>◇Spring MVC基于Spring IOC容器运行，所有对象被IOC管理，提高了程序的健壮性与稳定性；</p>\n<h3 id=\"Spring-5-x-版本变化\"><a href=\"#Spring-5-x-版本变化\" class=\"headerlink\" title=\"Spring 5.x 版本变化\"></a>Spring 5.x 版本变化</h3><p>◇Spring 5.x最低要求JDK8与J2EE 7(Servlet 3.1/Tomcat 8.5+)<br>◇Spring 5.x支持JDK8/9,可以使用新特性<br>◇Spring 5.x最重要的新特性支持响应式编程(即基于事件来的，当触发某一事件后就会在后端自动的执行某一段代码)作为响应式编程，是一种新的开发理念和风格；</p>\n<h3 id=\"Spring-MVC官方文档学习\"><a href=\"#Spring-MVC官方文档学习\" class=\"headerlink\" title=\"Spring MVC官方文档学习\"></a>Spring MVC官方文档学习</h3><p>◇进入spring.io官网，project-&gt;spring-framework-&gt;Features-&gt;spring mvc  <a href=\"https://docs.spring.io/spring-framework/docs/current/reference/html/web.html\">链接</a></p>\n<h2 id=\"IDEA环境下创建Maven-WebApp\"><a href=\"#IDEA环境下创建Maven-WebApp\" class=\"headerlink\" title=\"IDEA环境下创建Maven WebApp\"></a>IDEA环境下创建Maven WebApp</h2><p>◇打开idea-&gt;new-&gt;Maven-&gt;SDk:java1.8以上版本-&gt;next-&gt;GroupId:com.lcg-&gt;ArtifactId:first-springmvc-&gt;next-&gt;设置工程保存路径-&gt;finish-&gt;Enable Auto-Import（自动导入依赖）<br>◇创建好以后，还需要进行如下设置使创建的标准maven工程具备web能力: 选中工程名称-&gt;File-&gt;Project Structure-&gt;Facets-&gt;+-&gt;web(进行web能力的嵌入)-&gt;选中工程名-&gt;OK-&gt;配置web描述符文件(web.xml)所存储的路径：first-springmvc\\src\\main\\webapp\\WEB-INF\\web.xml-&gt;勾选版本为3.1-&gt;设置存储页面的目录（就在上一项操作的下方）:src\\main\\webapp-&gt;下方设置默认上下文为:/-&gt;OK-&gt;是否创建目录：yes-&gt;Create Artifact（根据前面的设置自动配置运行的方式）-&gt;OK;<br>◇在webapp目录下创建一个测试页面index.html;然后进行Tomcat的配置；右上角Add Configuration-&gt;Templates(配置一个模板): TomcatServer-&gt;Local-&gt;Application server(应用服务器)-&gt;configure-&gt;Tomcat Home:Tomcat的安装路径(apache-tomcat-8.5.40)-&gt;OK-OK; 模板配置好后，再次点击Add Configuration-&gt;+-&gt;Tomcat Server -&gt;Local-&gt;Deployment-&gt;+-&gt;Artifact-&gt;Application context:/-&gt;Server-&gt;On ‘Update’ action(说明在页面发生改变以后如何来生效，默认选项为Restart server即重启服务才会生效):改为Update classes and resources(说明在Tomcat启动过程中，如果idea中的页面代码发生变化不需要重启Tomcat，直接可以更新；这种方式称为热部署)-&gt;HTTP port（可以根据自己的需要修改端口，默认为8080）:80-&gt;OK; 这样就完成了web的配置；</p>\n<h2 id=\"Spring-MVC环境配置\"><a href=\"#Spring-MVC环境配置\" class=\"headerlink\" title=\"Spring MVC环境配置\"></a>Spring MVC环境配置</h2><h3 id=\"配置步骤\"><a href=\"#配置步骤\" class=\"headerlink\" title=\"配置步骤\"></a>配置步骤</h3><p>1.Maven依赖spring-webmvc</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//阿里云的仓库</span></span><br><span class=\"line\">&lt;repositories&gt;</span><br><span class=\"line\">        &lt;repository&gt;</span><br><span class=\"line\">            &lt;id&gt;aliyun&lt;/id&gt;</span><br><span class=\"line\">            &lt;name&gt;aliyun&lt;/name&gt;</span><br><span class=\"line\">            &lt;url&gt;https:<span class=\"comment\">//maven.aliyun.com/repository/public&lt;/url&gt;</span></span><br><span class=\"line\">        &lt;/repository&gt;</span><br><span class=\"line\">    &lt;/repositories&gt;</span><br><span class=\"line\">    &lt;dependencies&gt;</span><br><span class=\"line\">    <span class=\"comment\">//依赖环境</span></span><br><span class=\"line\">        &lt;dependency&gt;</span><br><span class=\"line\">            &lt;groupId&gt;org.springframework&lt;/groupId&gt;</span><br><span class=\"line\">            &lt;artifactId&gt;spring-webmvc&lt;/artifactId&gt;</span><br><span class=\"line\">            &lt;version&gt;<span class=\"number\">5.1</span><span class=\"number\">.9</span>.RELEASE&lt;/version&gt;</span><br><span class=\"line\">        &lt;/dependency&gt;</span><br><span class=\"line\">    &lt;/dependencies&gt;</span><br></pre></td></tr></table></figure>\n<p>2.web.xml配置DispatcherServlet<br>◇DispatchServlet是springmvc最重要的一个类，其作用就是对所有请求进行拦截；类似公司的前台一样，接待不同的客户，然后根据客户的需求向公司对应的部门请求处理；</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">&lt;?xml version=<span class=\"string\">&quot;1.0&quot;</span> encoding=<span class=\"string\">&quot;UTF-8&quot;</span>?&gt;</span><br><span class=\"line\">&lt;web-app xmlns=<span class=\"string\">&quot;http://xmlns.jcp.org/xml/ns/javaee&quot;</span></span><br><span class=\"line\">         xmlns:xsi=<span class=\"string\">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class=\"line\">         xsi:schemaLocation=<span class=\"string\">&quot;http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_3_1.xsd&quot;</span></span><br><span class=\"line\">         version=<span class=\"string\">&quot;3.1&quot;</span>&gt;</span><br><span class=\"line\">   &lt;!-- DispatchServlet--&gt;</span><br><span class=\"line\">    &lt;servlet&gt;</span><br><span class=\"line\">        &lt;servlet-name&gt;springmvc&lt;/servlet-name&gt; &lt;!--这里名字是可以自定义的，但一般约定如此--&gt;</span><br><span class=\"line\">       &lt;!--DispatchServlet是Spring MVC最核心的对象</span><br><span class=\"line\">           DispatchServlet用于拦截Http请求，</span><br><span class=\"line\">           并根据请求的URL调用与之对应的Controller方法，</span><br><span class=\"line\">           来完成Http请求的处理--&gt;</span><br><span class=\"line\">        &lt;servlet-<span class=\"class\"><span class=\"keyword\">class</span>&gt;<span class=\"title\">org</span>.<span class=\"title\">springframework</span>.<span class=\"title\">web</span>.<span class=\"title\">servlet</span>.<span class=\"title\">DispatcherServlet</span>&lt;/<span class=\"title\">servlet</span>-<span class=\"title\">class</span>&gt;</span></span><br><span class=\"line\"><span class=\"class\">      &lt;!--  加载<span class=\"title\">applicationContext</span>.<span class=\"title\">xml</span></span></span><br><span class=\"line\"><span class=\"class\">            告诉<span class=\"title\">DispatcherServlet</span>在<span class=\"title\">IOC</span>容器启动时</span></span><br><span class=\"line\"><span class=\"class\">            加载哪一个目录下的哪个<span class=\"title\">xml</span>文件</span>; classpath表示类路径</span><br><span class=\"line\">            main\\resources下的xml文件会自动加载到类路径中--&gt;</span><br><span class=\"line\">        &lt;init-param&gt;</span><br><span class=\"line\">            &lt;param-name&gt;contextConfigLocation&lt;/param-name&gt;</span><br><span class=\"line\">            &lt;param-value&gt;classpath:applicationContext.xml&lt;/param-value&gt;</span><br><span class=\"line\">        &lt;/init-param&gt;</span><br><span class=\"line\">        &lt;!--在Web应用启动时自动创建Spring IOC容器，</span><br><span class=\"line\">           并初始化DispatcherServlet，以提高响应速度;如果没有这个配置，</span><br><span class=\"line\">           则会在第一次访问url的时候进行容器的创建和初始化工作--&gt;</span><br><span class=\"line\">        &lt;load-on-startup&gt;<span class=\"number\">0</span>&lt;/load-on-startup&gt;</span><br><span class=\"line\">    &lt;/servlet&gt;</span><br><span class=\"line\">    &lt;servlet-mapping&gt;</span><br><span class=\"line\">        &lt;servlet-name&gt;springmvc&lt;/servlet-name&gt;</span><br><span class=\"line\">        &lt;!--<span class=\"string\">&quot;/&quot;</span> 代表拦截所有请求--&gt;</span><br><span class=\"line\">        &lt;url-pattern&gt;/&lt;/url-pattern&gt;</span><br><span class=\"line\">    &lt;/servlet-mapping&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;/web-app&gt;</span><br></pre></td></tr></table></figure>\n<p>3.配置applicationContext的mvc标记</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//声明部分</span></span><br><span class=\"line\"><span class=\"comment\">//schema部分</span></span><br><span class=\"line\">  &lt;!--</span><br><span class=\"line\">    context:component-scan 标签作用</span><br><span class=\"line\">    在Spring IOC初始化过程中,自动创建并管理com.lcg.springmvc及子包中</span><br><span class=\"line\">    拥有以下注解的对象.</span><br><span class=\"line\">    <span class=\"meta\">@Repository</span></span><br><span class=\"line\">    <span class=\"meta\">@Service</span></span><br><span class=\"line\">    <span class=\"meta\">@Controller</span></span><br><span class=\"line\">    <span class=\"meta\">@Component</span></span><br><span class=\"line\">    --&gt;</span><br><span class=\"line\">    &lt;context:component-scan base-<span class=\"keyword\">package</span>=<span class=\"string\">&quot;com.lcg.springmvc&quot;</span>&gt;&lt;/context:component-scan&gt;</span><br><span class=\"line\">    &lt;!--启用Spring MVC的注解开发模式 --&gt;</span><br><span class=\"line\">    &lt;mvc:annotation-driven/&gt;</span><br><span class=\"line\">    &lt;!--将图片、js、css等静态资源排除在外(即不被拦截)，可提高执行效率--&gt;</span><br><span class=\"line\">    &lt;mvc:<span class=\"keyword\">default</span>-servlet-handler/&gt;</span><br></pre></td></tr></table></figure>\n<p>4.开发Controller控制器</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/*在配置文件中,context：component-scan所描述的包中包含了这个测试类</span></span><br><span class=\"line\"><span class=\"comment\">* 因此增加Controller注解，所以在IOC容器初始化时会自动的将TestController</span></span><br><span class=\"line\"><span class=\"comment\">* 初始化并由IOC容器所管理，且spring也自动该类是一个springmvc的控制器*/</span></span><br><span class=\"line\"><span class=\"meta\">@Controller</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">TestController</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"meta\">@GetMapping(&quot;/t&quot;)</span><span class=\"comment\">//用于将当前方法绑定某个get方式请求的url，比如localhost/t</span></span><br><span class=\"line\">    <span class=\"meta\">@ResponseBody</span> <span class=\"comment\">//直接向响应提供字符串数据，不跳转页面</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">test</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">&quot;SUCCESS&quot;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>5.在运行测试之前，还需要进行Tomcat的配置；因为一些底层依赖还没有加到当前的发布目录(WEB-INF)中，所以需要进行加入；具体做法为：右上角Edit Configuration-&gt;Deployment-&gt;编辑web exploded-&gt;将右侧的依赖全选，put到左边的目录中去-&gt;OK<br>◇热部署状态下，如果修改了源码，只需要右键Reload Changed Classes（对类进行重新编译）则不要重启Tomcat；</p>\n<h3 id=\"SpringMVC处理示意图\"><a href=\"#SpringMVC处理示意图\" class=\"headerlink\" title=\"SpringMVC处理示意图\"></a>SpringMVC处理示意图</h3><p><img src=\"/p/b016/1633851296390-cd695bbf-ddc8-4002-a5f5-c4f3151ed46f.png\" class=\"lazyload\" data-srcset=\"/p/b016/1633851296390-cd695bbf-ddc8-4002-a5f5-c4f3151ed46f.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"><br>◇打开浏览器输入网址以后，需要向服务器发送请求，假设请求发送的地址是：<a href=\"http://localhost/t%EF%BC%9B%E9%82%A3%E4%B9%88%E8%BF%99%E4%B8%AA%E8%AF%B7%E6%B1%82%E5%B0%B1%E4%BC%9A%E5%8F%91%E9%80%81%E5%88%B0%E6%9C%AC%E6%9C%BA%E7%9A%84Tomcat%E4%B8%8A%EF%BC%8C%E8%80%8CTomcat%E8%87%AA%E7%84%B6%E5%90%AF%E5%8A%A8%E4%BA%86springmvc%E7%9A%84%E5%BA%94%E7%94%A8%EF%BC%8C%E6%AD%A4%E6%97%B6%E8%AF%B7%E6%B1%82%E4%BC%9A%E8%A2%ABDispatcherServlet%E6%8B%A6%E6%88%AA%EF%BC%8CDispatcherServlet%E4%BC%9A%E5%9C%A8Controller%E4%B8%AD%E5%AF%BB%E6%89%BE%E5%93%AA%E4%B8%AA%E6%96%B9%E6%B3%95%E6%98%A0%E5%B0%84%E4%BA%86t%EF%BC%8C%E5%88%99DispatcherServlet%E4%BC%9A%E7%9F%A5%E9%81%93%E4%BD%BF%E7%94%A8test()%E6%96%B9%E6%B3%95%E6%9D%A5%E5%A4%84%E7%90%86%E8%BF%99%E4%B8%AA%E8%AF%B7%E6%B1%82%EF%BC%8C%E7%84%B6%E5%90%8E%E8%AF%B7%E6%B1%82%E8%BF%9B%E5%85%A5test%E6%96%B9%E6%B3%95%EF%BC%8C%E5%B9%B6%E8%BF%94%E5%9B%9E%E4%B8%80%E4%B8%AA%E5%93%8D%E5%BA%94%E4%BD%93\">http://localhost/t；那么这个请求就会发送到本机的Tomcat上，而Tomcat自然启动了springmvc的应用，此时请求会被DispatcherServlet拦截，DispatcherServlet会在Controller中寻找哪个方法映射了t，则DispatcherServlet会知道使用test()方法来处理这个请求，然后请求进入test方法，并返回一个响应体</a>;</p>\n<h2 id=\"Spring-MVC数据绑定\"><a href=\"#Spring-MVC数据绑定\" class=\"headerlink\" title=\"Spring MVC数据绑定\"></a>Spring MVC数据绑定</h2><p>◇什么是数据绑定：即springmvc中的controller控制器的某一个方法是如何与url进行绑定的，在前面的演示中我们使用了GetMapping这个注解进行绑定，那还有其他的方法吗？答案是肯定的；</p>\n<h3 id=\"URL-Mapping-URL映射\"><a href=\"#URL-Mapping-URL映射\" class=\"headerlink\" title=\"URL Mapping(URL映射)\"></a>URL Mapping(URL映射)</h3><p>◇URL Mapping指将URL于Controller方法绑定<br>◇通过将URL与方法绑定，SpringMVC便可通过Tomcat对外暴露服务</p>\n<h3 id=\"URL-Mapping注解\"><a href=\"#URL-Mapping注解\" class=\"headerlink\" title=\"URL Mapping注解\"></a>URL Mapping注解</h3><p>◇@RequestMapping - 通用绑定<br>◇@GetMapping - 绑定Get请求<br>◇@PostMapping - 绑定Post请求  </p>\n<h3 id=\"注解使用案例\"><a href=\"#注解使用案例\" class=\"headerlink\" title=\"注解使用案例\"></a>注解使用案例</h3><p>◇见firstspringmvc项目</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Controller</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">URLMappingController</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"meta\">@GetMapping(&quot;/g&quot;)</span></span><br><span class=\"line\">    <span class=\"meta\">@ResponseBody</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">getMapping</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">&quot;This is get method&quot;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"meta\">@PostMapping(&quot;/p&quot;)</span></span><br><span class=\"line\">    <span class=\"meta\">@ResponseBody</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">postMapping</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">&quot;This is post method&quot;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>◇以上代码运行后，当浏览器中输入/p时会出现405报错，因为直接在浏览器输入地址是get请求，而程序后端里”/p”映射的是post请求，出现了请求不一致的情况；那么如何处理post请求呢？可以通过html表单来完成post请求；于是修改index.htm，增加表单，并将提交的地址设置为”/p”，指明提交的方法为post；</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">&lt;!DOCTYPE html&gt;</span><br><span class=\"line\">&lt;html&gt;</span><br><span class=\"line\">&lt;head&gt;</span><br><span class=\"line\">    &lt;meta charset=<span class=\"string\">&quot;UTF-8&quot;</span>&gt;</span><br><span class=\"line\">    &lt;title&gt;Title&lt;/title&gt;</span><br><span class=\"line\">&lt;/head&gt;</span><br><span class=\"line\">&lt;body&gt;</span><br><span class=\"line\">   &lt;form action=<span class=\"string\">&quot;/p&quot;</span> method=<span class=\"string\">&quot;post&quot;</span>&gt;</span><br><span class=\"line\">       &lt;input type=<span class=\"string\">&quot;submit&quot;</span> value=<span class=\"string\">&quot;提交&quot;</span>&gt;</span><br><span class=\"line\">   &lt;/form&gt;</span><br><span class=\"line\">&lt;/body&gt;</span><br><span class=\"line\">&lt;/html&gt;</span><br></pre></td></tr></table></figure>\n<p>◇通常RequestMapping 注解是放在类上面的，大多数情况下用于URL的全局设置；作为URL可能有多级结构，比如，要求URLMappingController所有的映射地址都是以/um作为前缀来进行访问，那么GetMapping和PostMapping都要在原来的映射地址前增加/um(如/um/p)，如果方法过多的话，都要这样进行一一设置，过于繁琐；而RequestMapping 放在类上就可以进行全局设置了，直接进行注解@RequestMapping (“/um”),这样，请求的地址必须在前面加入/um才能够访问成功；<br>◇如果将RequestMapping 注解放在方法上，则不再区分get/post请求，但并不推荐这样使用；当然使用RequestMapping 注解也可以指定其请求方法，如@RequestMapping (value=”/g”, method=RequestMethod.GET)</p>\n<h2 id=\"接收请求参数\"><a href=\"#接收请求参数\" class=\"headerlink\" title=\"接收请求参数\"></a>接收请求参数</h2><p>◇在大多数情况下一个请求发过来的时候需要包含一些数据，这些数据大多以请求参数来体现的，比如说我们用户登录的时候需要输入用户名和密码，那么这些数据就会以post请求参数的形式发送到controller的方法中；</p>\n<h3 id=\"接收请求参数的常用方法\"><a href=\"#接收请求参数的常用方法\" class=\"headerlink\" title=\"接收请求参数的常用方法\"></a>接收请求参数的常用方法</h3><p>◇使用Controller方法参数接收</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">&lt;form action=<span class=\"string\">&quot;/m1&quot;</span> method=<span class=\"string\">&quot;post&quot;</span>&gt;</span><br><span class=\"line\">&lt;input name=<span class=\"string\">&quot;username&quot;</span>/&gt;</span><br><span class=\"line\">&lt;input name=<span class=\"string\">&quot;password&quot;</span>/&gt;</span><br><span class=\"line\">&lt;/form&gt;</span><br><span class=\"line\">-------------------------------------------------------------- </span><br><span class=\"line\"><span class=\"meta\">@PostMapping(&quot;/m1&quot;)</span></span><br><span class=\"line\"><span class=\"meta\">@ResponseBody</span></span><br><span class=\"line\">   <span class=\"comment\">/*SpringMVC允许进行类型转换，如果在前面进行表单校验的时候</span></span><br><span class=\"line\"><span class=\"comment\">    Password只允许输入数字，那向服务器提交以后，因为password</span></span><br><span class=\"line\"><span class=\"comment\">    只是数字，所以可以强制转换为Long类型；因此在接收时，直接可以</span></span><br><span class=\"line\"><span class=\"comment\">    将形参设置为Long类型，而不需手动转换*/</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">post</span><span class=\"params\">(String username , Long password)</span></span>&#123;</span><br><span class=\"line\"> <span class=\"keyword\">return</span> username + <span class=\"string\">&quot;:&quot;</span> + password;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>◇使用Java Bean接收数据</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">&lt;form action=<span class=\"string\">&quot;/m1&quot;</span> method=<span class=\"string\">&quot;post&quot;</span>&gt;</span><br><span class=\"line\">&lt;input name=<span class=\"string\">&quot;username&quot;</span>/&gt;</span><br><span class=\"line\">&lt;input name=<span class=\"string\">&quot;password&quot;</span>/&gt;</span><br><span class=\"line\">&lt;/form&gt;</span><br><span class=\"line\">----------------------------------------------------------------- </span><br><span class=\"line\"><span class=\"meta\">@PostMapping(&quot;/m1&quot;)</span></span><br><span class=\"line\"><span class=\"meta\">@ResponseBody</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">post</span><span class=\"params\">(User user)</span></span>&#123;</span><br><span class=\"line\"> <span class=\"keyword\">return</span> user.getUsername() + <span class=\"string\">&quot;:&quot;</span> + user.getPassword();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h3 id=\"Controller方法\"><a href=\"#Controller方法\" class=\"headerlink\" title=\"Controller方法\"></a>Controller方法</h3><p>◇html表单</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">&lt;form action=<span class=\"string\">&quot;/p&quot;</span> method=<span class=\"string\">&quot;post&quot;</span>&gt;</span><br><span class=\"line\">    &lt;input name=<span class=\"string\">&quot;username&quot;</span>&gt;&lt;br/&gt;</span><br><span class=\"line\">    &lt;input name=<span class=\"string\">&quot;password&quot;</span>&gt;&lt;br/&gt;</span><br><span class=\"line\">    &lt;input type=<span class=\"string\">&quot;submit&quot;</span> value=<span class=\"string\">&quot;提交&quot;</span>&gt;</span><br><span class=\"line\">&lt;/form&gt;</span><br></pre></td></tr></table></figure>\n<p>◇controller</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@PostMapping(&quot;/p&quot;)</span></span><br><span class=\"line\">   <span class=\"meta\">@ResponseBody</span></span><br><span class=\"line\">   <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">postMapping</span><span class=\"params\">(String username,String password)</span></span>&#123;</span><br><span class=\"line\">       System.out.println(username+<span class=\"string\">&quot;:&quot;</span>+password);</span><br><span class=\"line\">       <span class=\"keyword\">return</span> <span class=\"string\">&quot;submit success&quot;</span>;</span><br><span class=\"line\">   &#125;</span><br></pre></td></tr></table></figure>\n<p>◇ 对于get请求如何接收请求参数呢？如localhost/g?managet_name=lily就是一个带有请求参数的get请求，在java中只有驼峰命名法，所以不能使用managet_name作为参数名来接收请求参数；则需要一个特殊的注解@RequestParam(“manager_name”),其放在接收请求的参数前，括号里面填写映射的地址，即请求参数名；作为请求中的manager_name这个参数在运行时会被动态的注入到managerName这个参数中</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@GetMapping(&quot;/g&quot;)</span></span><br><span class=\"line\"><span class=\"meta\">@ResponseBody</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">getMapping</span><span class=\"params\">(<span class=\"meta\">@RequestParam(&quot;manager_name&quot;)</span> String managerName)</span></span>&#123;</span><br><span class=\"line\">    System.out.println(<span class=\"string\">&quot;mangerName:&quot;</span>+managerName);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">&quot;This is get method&quot;</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"Java-Bean方法\"><a href=\"#Java-Bean方法\" class=\"headerlink\" title=\"Java Bean方法\"></a>Java Bean方法</h3><p>◇假设表单有一百个输入项，那么问题来了，难道我们需要将这一百个参数都在controller的方法中列举出来吗？并且还需要将接收的一百个参数通过set方法进行对象的转化，这样做显然麻烦；为了解决这个问题，springmvc运行我们将前台输入的数据保存为指定的java bean，一步到位，完成了由数据到对象的转换工作；<br>◇创建entity实体包，并在实体包下创建实体类User</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.lcg.springmvc.entity;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">User</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> String username;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> Long password;</span><br><span class=\"line\">    <span class=\"comment\">//get&amp;ser方法;</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>◇controller</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/*在这里直接将实体类当做参数；springmvc会自动的创建对象</span></span><br><span class=\"line\"><span class=\"comment\">    * 并且根据前面的请求结合参数名进行一一的赋值,在实体类中属性的</span></span><br><span class=\"line\"><span class=\"comment\">    * 名字必须和前台的传入参数名保持一致*/</span></span><br><span class=\"line\">    <span class=\"meta\">@PostMapping(&quot;/p1&quot;)</span><span class=\"comment\">//也要将表单请求提交的地址改为p1</span></span><br><span class=\"line\">    <span class=\"meta\">@ResponseBody</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">postMapping1</span><span class=\"params\">(User user)</span></span>&#123;</span><br><span class=\"line\">        System.out.println(user.getUsername()+<span class=\"string\">&quot;:&quot;</span>+user.getPassword());</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">&quot;This is post method&quot;</span>;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n<p>◇**public **String postMapping1(User user，String username)；这样会对user赋值，也会给username这个参数赋值；即不管参数中写了多少个username或者多少个实体对象，只要它们用于username这个属性或者参数，只要符合这个规则那么springmvc都会对其进行赋值；</p>\n<h2 id=\"综合训练：调查问卷\"><a href=\"#综合训练：调查问卷\" class=\"headerlink\" title=\"综合训练：调查问卷\"></a>综合训练：调查问卷</h2><p><img src=\"/p/b016/1634001914013-bf055739-65e3-41f3-9c97-d97ee4285e90.png\" class=\"lazyload\" data-srcset=\"/p/b016/1634001914013-bf055739-65e3-41f3-9c97-d97ee4285e90.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"><br>◇像这种一次性选择多个数据的情况，在springmvc中如何进行处理呢？</p>\n<h3 id=\"知识点\"><a href=\"#知识点\" class=\"headerlink\" title=\"知识点\"></a>知识点</h3><p>◇利用数组或List接收请求中的复合数据<br>◇利用@RequestParam为参数设置默认值<br>◇使用Map对象接收请求参数及注意事项</p>\n<h3 id=\"URI绝对路径与相对路径\"><a href=\"#URI绝对路径与相对路径\" class=\"headerlink\" title=\"URI绝对路径与相对路径\"></a>URI绝对路径与相对路径</h3><p><img src=\"/p/b016/1634002605204-1c7322bb-cbe5-479f-afb7-1526d252a47e.png\" class=\"lazyload\" data-srcset=\"/p/b016/1634002605204-1c7322bb-cbe5-479f-afb7-1526d252a47e.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"><br>◇所谓URI是统一资源标识符的意思，它包含我们平时使用的URL；<br>◇假设<strong>左图</strong>是开发的某一个应用，我们访问的uri上下文假设叫project，而project包含如图的结构；<strong>右图</strong>表示在index.html中引用js文件使用的相对路径和绝对路径；右图错误的使用方法，以”/“开头，是一个绝对路径，但是并没有加上上下文路径，除非我们设置上下文为”/“根路径时才可以；<br>◇<strong>相对地址的应用案例</strong>：<form action=\"./apply\" method=\"post\">当使用了相对路径以后，如果访问的页面地址为<a href=\"http://localhost:8080/[%E4%B8%8A%E4%B8%8B%E6%96%87%E8%B7%AF%E5%BE%84]/form.html;%E9%82%A3%E4%B9%88%E5%BD%93%E8%A1%A8%E5%8D%95%E6%8F%90%E4%BA%A4%E4%BB%A5%E5%90%8E%EF%BC%8C%E5%85%B6%E5%A4%84%E7%90%86%E8%AF%B7%E6%B1%82%E7%9A%84%E5%9C%B0%E5%9D%80%E4%B8%BAhttp://localhost:8080/[%E4%B8%8A%E4%B8%8B%E6%96%87%E8%B7%AF%E5%BE%84]/apply%EF%BC%8C%E5%9B%A0%E4%B8%BA%E4%BD%BF%E7%94%A8%E4%BA%86%E7%9B%B8%E5%AF%B9%E8%B7%AF%E5%BE%84%EF%BC%8C%E5%88%99%E4%B8%8D%E7%AE%A1%E5%89%8D%E9%9D%A2%E7%9A%84%E4%B8%8A%E4%B8%8B%E6%96%87%E8%B7%AF%E5%BE%84%E8%AE%BE%E7%BD%AE%E7%9A%84%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%8C%E5%8F%AA%E9%9C%80%E8%A6%81%E4%BF%9D%E8%AF%81%E6%88%91%E4%BB%AC%E7%9A%84%E6%8F%90%E4%BA%A4%E5%9C%B0%E5%9D%80apply%E5%92%8C%E5%BD%93%E5%89%8D%E7%9A%84html%E5%9C%A8%E5%90%8C%E4%B8%80%E4%B8%AA%E5%B1%82%E7%BA%A7%E4%B8%8A%E9%82%A3%E4%B9%88%E8%AF%B7%E6%B1%82%E5%B0%B1%E4%BC%9A%E9%80%81%E8%BE%BE%E8%80%8C%E4%B8%8D%E4%BC%9A%E4%BA%A7%E7%94%9F404%E9%94%99%E8%AF%AF%EF%BC%9B%E9%80%9A%E8%BF%87%E4%BD%BF%E7%94%A8%E7%9B%B8%E5%AF%B9%E8%B7%AF%E5%BE%84%E5%8F%AF%E4%BB%A5%E9%99%8D%E4%BD%8E%E6%88%91%E4%BB%AC%E5%AF%B9%E4%BA%8Eweb%E5%B7%A5%E7%A8%8B%E8%AE%BE%E7%BD%AE%E7%9A%84%E4%BE%9D%E8%B5%96%EF%BC%9B\">http://localhost:8080/[上下文路径]/form.html;那么当表单提交以后，其处理请求的地址为http://localhost:8080/[上下文路径]/apply，因为使用了相对路径，则不管前面的上下文路径设置的是什么，只需要保证我们的提交地址apply和当前的html在同一个层级上那么请求就会送达而不会产生404错误；通过使用相对路径可以降低我们对于web工程设置的依赖；</a></form></p>\n<h3 id=\"代码演示\"><a href=\"#代码演示\" class=\"headerlink\" title=\"代码演示\"></a>代码演示</h3><p>◇form.html略，详见项目form;<br>◇对于我们的表单，包含了三种数据，前面两种都是单个数据，最后一种是复合数据(一次性会提交多个数据)，springmvc对复合数据的接收提供了两种方案，一种使用数组接收，另一种使用ArrayList进行接收；<br>◇创建FormController类；使用数组进行接收复合数据</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">    <span class=\"meta\">@PostMapping(&quot;/apply&quot;)</span></span><br><span class=\"line\">    <span class=\"meta\">@ResponseBody</span></span><br><span class=\"line\">    <span class=\"comment\">//假设value设置一个表单中不存在的n，如果我设置了value这个属性的话，那么以value为准，</span></span><br><span class=\"line\">不再以name进行接收，而是value接收后再出入到name中 defaultValue即默认值；如果表单不存在的话，</span><br><span class=\"line\">    默认值就是设置的ANON；由于表单中并不存在n这个参数，所以当我们提交的时候，即使填了名字</span><br><span class=\"line\">    也会使用默认的value注入到参数name中；当然，如果我们设置value=<span class=\"string\">&quot;name&quot;</span>的话，由于表单中有name</span><br><span class=\"line\">    这个参数，所以填了名字可以注入到apply的name参数中，而不填的话，就会使用默认值ANON注入；</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">apply</span><span class=\"params\">(<span class=\"meta\">@RequestParam(value = &quot;n&quot;,defaultValue = &quot;ANON&quot;)</span>String name, String course, Integer[] purpose)</span></span>&#123;</span><br><span class=\"line\">        System.out.println(name);</span><br><span class=\"line\">        System.out.println(course);</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (Integer p : purpose) &#123;</span><br><span class=\"line\">            System.out.println(p);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">&quot;SUCCESS&quot;</span>;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n<p>◇前面提到我们的controller类中方法的参数名需要和请求的参数名一致，这样就会完成自动注入；但是，在我们的表单中，有很多都是进行匿名提交的，它并没有包含name参数，在这种情况下，name必然是一个空的对象，那么对于空的对象进行操作时，程序很可能报错；解决这一问题的方法是使用@RequestParam给参数设置默认值；<br>◇如果使用List进行复合数据的接收，需要在参数前增加@RequestParam注解，这样springmvc才知道请求中的复合数据要被转换为List进行存储；</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@PostMapping(&quot;/apply&quot;)</span></span><br><span class=\"line\"><span class=\"meta\">@ResponseBody</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">apply</span><span class=\"params\">(String name, String course, <span class=\"meta\">@RequestParam</span> List&lt;Integer&gt; purpose)</span></span>&#123;</span><br><span class=\"line\">     <span class=\"comment\">//与上类似</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>◇对于一组结构化的数据，我们通常使用对象来进行接收；那么在对象情况下，这个List依然能够进行接收；<br>我们额外的创建实体包，并创建表单对象类Form;</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Form</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> String name;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> String course;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> List&lt;Integer&gt; purpose;<span class=\"comment\">//复合数据</span></span><br><span class=\"line\">    ...</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n<p>在控制器中新建方法使用对象来接收</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@PostMapping(&quot;/apply&quot;)</span></span><br><span class=\"line\"><span class=\"meta\">@ResponseBody</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">apply</span><span class=\"params\">(Form form)</span></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">&quot;SUCCESS&quot;</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>◇当然，也可以使用Map来进行参数的接收，Map可以一次性接收表单项的结果，也得在方法参数前加上注解@RequestParam</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@PostMapping(&quot;/apply&quot;)</span></span><br><span class=\"line\"><span class=\"meta\">@ResponseBody</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">apply</span><span class=\"params\">(<span class=\"meta\">@RequestParam</span> Map map)</span></span>&#123;</span><br><span class=\"line\">    System.out.println(map);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">&quot;SUCCESS&quot;</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>但是，对于复合数据，Map是无法接收的，Map默认情况下只会保留复合数据中的第一个数据，其余都会丢失；<br>​</p>\n<h2 id=\"关联对象赋值\"><a href=\"#关联对象赋值\" class=\"headerlink\" title=\"关联对象赋值\"></a>关联对象赋值</h2><p>◇关联对象赋值即在一个对象中引用了另一个对象，需要在这个被引用对象进行赋值的操作；<br>◇复杂内容表单</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">用户名:&lt;input name=<span class=\"string\">&quot;username&quot;</span>&gt;</span><br><span class=\"line\">密码: &lt;input name=<span class=\"string\">&quot;password&quot;</span>&gt;</span><br><span class=\"line\">-------------------------------------- </span><br><span class=\"line\">姓名:&lt;input name=<span class=\"string\">&quot;name&quot;</span>&gt;</span><br><span class=\"line\">身份证号:&lt;input name=<span class=\"string\">&quot;idno&quot;</span>&gt;</span><br><span class=\"line\">过期时间:&lt;input name=<span class=\"string\">&quot;expire&quot;</span>&gt;</span><br></pre></td></tr></table></figure>\n<p>◇对于这张表单来说，包含了两个内容，一个是注册信息，一个是身份信息；对于这个表单来说，可以创建一个对象，然后通过springmvc自动对其进行赋值，但是这样做并不完美；如果按照严格的面向对象的设计方式对表单进行接收的话，需要创建两个类一个User类和一个身份类，并且用户类中包含身份类；<br>◇用户类</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">User</span></span>&#123;</span><br><span class=\"line\"> <span class=\"keyword\">private</span> String username;</span><br><span class=\"line\"> <span class=\"keyword\">private</span> String password;</span><br><span class=\"line\"> <span class=\"keyword\">private</span> IDcard idcard = <span class=\"keyword\">new</span> IDCard();<span class=\"comment\">//实例化关联对象，对象名为idcard</span></span><br><span class=\"line\"> <span class=\"comment\">//getter and setter ...</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>◇身份类</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">IDcard</span></span>&#123;</span><br><span class=\"line\"> <span class=\"keyword\">private</span> String name;</span><br><span class=\"line\"> <span class=\"keyword\">private</span> String idno;</span><br><span class=\"line\"> <span class=\"keyword\">private</span> Date expire;</span><br><span class=\"line\"> <span class=\"comment\">//getter and setter ...</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>◇那么如何对这样的关联对象进行赋值呢？我们需要修改表单的属性名；将关联对象的的对象名(idcard)作为原有属性的前缀，这样通过springmvc接收数据的时候会自动的将三个属性按照名称对应关系依次进行赋值；</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">用户名:&lt;input name=<span class=\"string\">&quot;username&quot;</span>&gt;</span><br><span class=\"line\">密码: &lt;input name=<span class=\"string\">&quot;password&quot;</span>&gt;</span><br><span class=\"line\">------------------------------------------- </span><br><span class=\"line\">姓名:&lt;input name=<span class=\"string\">&quot;idcard.name&quot;</span>&gt;</span><br><span class=\"line\">身份证:&lt;input name=<span class=\"string\">&quot;idcard.idno&quot;</span>&gt;</span><br><span class=\"line\">过期时间:&lt;input name=<span class=\"string\">&quot;idcard.expire&quot;</span>&gt;</span><br></pre></td></tr></table></figure>\n<h2 id=\"日期类型转换\"><a href=\"#日期类型转换\" class=\"headerlink\" title=\"日期类型转换\"></a>日期类型转换</h2><p>◇全世界各地对日期的表达方式是不一样的；欧美一般采用月日年的表达方式，而国内采用年月日的形式；我们如何接收程序中的日期数据并将其转换为日期对象呢？<br>◇假设在注册用户的时候，需要提交注册时间(createTime)这个输入项，那么我们只需要在controller的方法中增加一个参数String createTime就可以了，但大多数的情况下，我们需要将字符串转换为日期对象，那么我们直接将参数改为Date createTime，程序运行时会产生日期格式不一致的问题，当我们输入2020-02-02时，会出现400的错误，一般400错误往往就是我们无法将数据转换为目标类型所致；因此我们需要手动转换才可以，但springmvc为我们早有准备，只需要在日期参数前加上@DateTimeFormat这个注解就行了，此注解用于按照指定的格式将前台接收的字符串转换为对应的date对象，在转换前需要指定其格式是什么，需要给此注解增加patten参数；如@DateTimeFormat(pattent=”yyyy-MM-dd”);注意这里的格式需要与前台输入的对象一致；<br>◇在实体对象中，也要给日期属性增加注解，才能够完成Date类型的转换；</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">private</span> Long password;</span><br><span class=\"line\"><span class=\"meta\">@DateTimeFormat(pattent=&quot;yyyy-MM-dd&quot;)</span></span><br><span class=\"line\"><span class=\"keyword\">private</span> Date createTime;</span><br></pre></td></tr></table></figure>\n<p>◇如果对于大量的需要进行日期类型转换的参数，那么都要一 一 加上注解，则过于麻烦，为了解决这个问题，可以设置全局的默认时间转换机制；<br>作为全局的日期转换机制，需要新建一个converter(转换器)包，其中保存的都是转换器，开发一个日期转换类MyDateConverter;<br>对于日期转换器springmvc要求必须实现Converter接口，在接口中得实现两个泛型，String和Date因为我们是希望把前台的字符串转换为日期类型；</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MyDateConverter</span> <span class=\"keyword\">implements</span> <span class=\"title\">Converter</span>&lt;<span class=\"title\">String</span>,<span class=\"title\">Date</span>&gt;</span>&#123;<span class=\"comment\">//实现接口</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> Date <span class=\"title\">convert</span><span class=\"params\">(String s)</span></span>&#123;</span><br><span class=\"line\">        SimpleDateFormat sdf = <span class=\"keyword\">new</span> SimpleDateFormat(<span class=\"string\">&quot;yyyy-MM-dd&quot;</span>);<span class=\"comment\">//定义格式</span></span><br><span class=\"line\">        <span class=\"keyword\">try</span>&#123;</span><br><span class=\"line\">             Date d = sdf.parse(s);<span class=\"comment\">//开始转换</span></span><br><span class=\"line\">            <span class=\"keyword\">return</span> d;</span><br><span class=\"line\">        &#125;<span class=\"keyword\">catch</span> (ParseException e)&#123;</span><br><span class=\"line\">           <span class=\"keyword\">return</span> <span class=\"keyword\">null</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>◇作为当前的类，需要在applicationContext.xml中进行配置，让springmvc知道该类是一个转换类;配置方法如下：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//下面的配置只是让springmvc知道有这个转换类要想和springmvc进行联动，还需要修改下面</span></span><br><span class=\"line\">的driven配置，额外增加conversion-service属性，并将下面定义好的beanid放到这个属性中；</span><br><span class=\"line\">&lt;mvc:annotation-driven conversion-service=<span class=\"string\">&quot;conversionService&quot;</span>/&gt;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//增加bean进行定义，id可自行定义，但通常如下定义，class为转换服务的工厂类，</span></span><br><span class=\"line\">其作用就是通知springmvc有哪些自定义的转换类</span><br><span class=\"line\">&lt;bean id=<span class=\"string\">&quot;conversionService&quot;</span> </span><br><span class=\"line\">    <span class=\"class\"><span class=\"keyword\">class</span></span>=<span class=\"string\">&quot;org.springframework.format.support.FormattingConversionServiceFactoryBean&quot;</span>&gt;</span><br><span class=\"line\">        &lt;property name=<span class=\"string\">&quot;converters&quot;</span>&gt;<span class=\"comment\">//转换类定义的地方</span></span><br><span class=\"line\">            &lt;set&gt;<span class=\"comment\">//作为converters这个属性，它是一个set集合，使用set标签进行描述</span></span><br><span class=\"line\">                &lt;bean <span class=\"class\"><span class=\"keyword\">class</span></span>=<span class=\"string\">&quot;com.lcg.springmvc.converter.MyDateConverter&quot;</span>/&gt;</span><br><span class=\"line\">            &lt;/set&gt;</span><br><span class=\"line\">        &lt;/property&gt;</span><br><span class=\"line\"> &lt;/bean&gt;</span><br></pre></td></tr></table></figure>\n<p>◇如果我们既配置了全局的转换类，又设置了注解，则springmvc会优先使用转换器类来进行转换而注解会被忽略掉，因此我们一般二者选其一使用；<br>◇对于转换器类只有一种日期格式，那出现了特殊的日期格式要求怎么办呢？那么这时候我们就要对转换器输入的字符串的日期格式进行判断，来使用不同的日期格式进行解析</p>\n<h2 id=\"解决中文乱码\"><a href=\"#解决中文乱码\" class=\"headerlink\" title=\"解决中文乱码\"></a>解决中文乱码</h2><h3 id=\"Web应用的中文乱码由来\"><a href=\"#Web应用的中文乱码由来\" class=\"headerlink\" title=\"Web应用的中文乱码由来\"></a>Web应用的中文乱码由来</h3><p>◇Tomcat默认使用字符集ISO-8859-1,属于西欧字符集，不支持中文；<br>◇解决乱码的核心是将ISO-8859-1转换为UTF-8<br>◇Controller中请求与响应都需要设置UTF-8字符集</p>\n<h3 id=\"中文乱码的配置\"><a href=\"#中文乱码的配置\" class=\"headerlink\" title=\"中文乱码的配置\"></a>中文乱码的配置</h3><p>◇Get请求乱码 - server.xml增加URIEncoding属性<br>◇Post请求乱码 - web.xml配置CharacterEncodingFilter<br>◇Response响应乱码 - Spring配置StringHttpMessageConverter(消息转换器)</p>\n<h3 id=\"代码演示-1\"><a href=\"#代码演示-1\" class=\"headerlink\" title=\"代码演示\"></a>代码演示</h3><p>◇<strong>解决Get请求乱码</strong>，需要在文件夹中找到Tomcat的server.xml文件，本机的路径为F:\\JAVA\\Tomcat\\apache-tomcat-8.5.34\\conf\\server.xml；进行修改，在Connector port=”8080”处的代码后增加URIEncoding=”UTF-8”</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">&lt;Connector executor=<span class=\"string\">&quot;tomcatThreadPool&quot;</span></span><br><span class=\"line\">           port=<span class=\"string\">&quot;8080&quot;</span> protocol=<span class=\"string\">&quot;HTTP/1.1&quot;</span></span><br><span class=\"line\">           connectionTimeout=<span class=\"string\">&quot;20000&quot;</span></span><br><span class=\"line\">           redirectPort=<span class=\"string\">&quot;8443&quot;</span> URIEncoding=<span class=\"string\">&quot;UTF-8&quot;</span>/&gt;</span><br></pre></td></tr></table></figure>\n<p>◇在Tomcat8.0以后的版本，URIEncoding默认就是UTF-8，所以在8.0以后的版本不需要进行配置；<br>◇<strong>解决Post请求乱码</strong>，需要在工程的web.xml中配置一个filter，filter是javabean的标准组件，用于对请求进行过滤；在这里name设置为字符集过滤，过滤类为有springmvc提供的字符编码过滤器</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!--配置过滤器--&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">filter</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">filter-name</span>&gt;</span>characterFilter<span class=\"tag\">&lt;/<span class=\"name\">filter-name</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">filter-class</span>&gt;</span>org.springframework.web.filter.CharacterEncodingFilter<span class=\"tag\">&lt;/<span class=\"name\">filter-class</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">init-param</span>&gt;</span><span class=\"comment\">&lt;!--配置参数--&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">param-name</span>&gt;</span>encoding<span class=\"tag\">&lt;/<span class=\"name\">param-name</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">param-value</span>&gt;</span>UTF-8<span class=\"tag\">&lt;/<span class=\"name\">param-value</span>&gt;</span><span class=\"comment\">&lt;!--特殊需求下会用GBK--&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">init-param</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">filter</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">&lt;!--使过滤器生效,配置filter的映射地址--&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">filter-mapping</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">filter-name</span>&gt;</span>characterFilter<span class=\"tag\">&lt;/<span class=\"name\">filter-name</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">url-pattern</span>&gt;</span>/*<span class=\"tag\">&lt;/<span class=\"name\">url-pattern</span>&gt;</span><span class=\"comment\">&lt;!--代表对所有的url进行拦截--&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">filter-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>◇<strong>解决响应中的中文乱码</strong>，需要在applicationContext配置文件中进行设置，在原有的启用注解的标签中增加消息转换器类，首先将原有的标签内容放开，然后在mvc：annotation-driven标签体中增加message-converters(用来设置消息的转换器)，在其下配置的转换器可以对响应中的消息进行调整，这里的converters是个复数，在其下增加一个bean，class为StringHttpMessageConverter(对于http响应中的文本进行转换，如何转换还需要bean下的配置)</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!--启用Spring MVC的注解开发模式 --&gt;</span></span><br><span class=\"line\">   <span class=\"tag\">&lt;<span class=\"name\">mvc:annotation-driven</span> <span class=\"attr\">conversion-service</span>=<span class=\"string\">&quot;conversionService&quot;</span>&gt;</span></span><br><span class=\"line\">       <span class=\"tag\">&lt;<span class=\"name\">mvc:message-converters</span>&gt;</span><span class=\"comment\">&lt;!--增加消息转换器类--&gt;</span></span><br><span class=\"line\">           <span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;org.springframework.http.converter.StringHttpMessageConverter&quot;</span>&gt;</span></span><br><span class=\"line\">               <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;supportedMediaTypes&quot;</span>&gt;</span></span><br><span class=\"line\">                   <span class=\"tag\">&lt;<span class=\"name\">list</span>&gt;</span><span class=\"comment\">&lt;!--supportedMediaTypes代表支持的媒体类型，是一个集合，所以用list描述--&gt;</span></span><br><span class=\"line\">                       <span class=\"comment\">&lt;!--在servlet中解决响应乱码如下配置</span></span><br><span class=\"line\"><span class=\"comment\">                       response.setContentType(&quot;text/html;charset=utf-8&quot;)--&gt;</span></span><br><span class=\"line\">                       <span class=\"tag\">&lt;<span class=\"name\">value</span>&gt;</span>text/html;charset=utf-8<span class=\"tag\">&lt;/<span class=\"name\">value</span>&gt;</span><span class=\"comment\">&lt;!--用于说明响应输出对应的字符类型--&gt;</span></span><br><span class=\"line\">                   <span class=\"tag\">&lt;/<span class=\"name\">list</span>&gt;</span></span><br><span class=\"line\">               <span class=\"tag\">&lt;/<span class=\"name\">property</span>&gt;</span></span><br><span class=\"line\">           <span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span></span><br><span class=\"line\">       <span class=\"tag\">&lt;/<span class=\"name\">mvc:message-converters</span>&gt;</span></span><br><span class=\"line\">   <span class=\"tag\">&lt;/<span class=\"name\">mvc:annotation-driven</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"响应输出结果\"><a href=\"#响应输出结果\" class=\"headerlink\" title=\"响应输出结果\"></a>响应输出结果</h2><p>◇响应中产生结果主要有两种方式，一种是采用@ResponseBody注解直接产生响应文本显示在客户端浏览器上；<br>另一种是ModelAndView对象，利用模板引擎渲染输出，也就是利用我们之前写好的JSP或者freemaker这样的模板引擎再结合数据动态渲染产生页面；</p>\n<h3 id=\"ResponseBody\"><a href=\"#ResponseBody\" class=\"headerlink\" title=\"@ResponseBody\"></a>@ResponseBody</h3><p>◇@ResponseBody直接产生响应体的数据，过程不涉及任何视图；<br>◇@ResponseBody可产生标准字符串/JSON/XML等格式数据；<br>◇@ResponseBody被StringHttpMessageConverter所影响</p>\n<h3 id=\"ModelAndView\"><a href=\"#ModelAndView\" class=\"headerlink\" title=\"ModelAndView\"></a>ModelAndView</h3><p>◇如果要在springmvc响应中进行页面展现的话，就需要使用这个ModelAndView对象；<br>◇ModelAndView对象是指”模型(数据)与视图(界面)”对象<br>◇通过ModelAndView可将包含数据对象与模板引擎进行绑定<br>◇springmvc中默认的view是jsp，也可以配置其他的模板引擎<br>◇页面展现的方法controller类中的showview方法；</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@GetMapping(&quot;/view&quot;)</span><span class=\"comment\">/*映射地址*/</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> ModelAndView <span class=\"title\">showView</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/*jsp作为模板引擎*/</span></span><br><span class=\"line\">    ModelAndView mav = <span class=\"keyword\">new</span> ModelAndView(<span class=\"string\">&quot;/view.jsp&quot;</span>);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> mav;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>◇view.jsp</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">&lt;%@ page contentType=<span class=\"string\">&quot;text/html;charset=UTF-8&quot;</span> language=<span class=\"string\">&quot;java&quot;</span> %&gt;</span><br><span class=\"line\">&lt;html&gt;</span><br><span class=\"line\">&lt;head&gt;</span><br><span class=\"line\">    &lt;title&gt;Title&lt;/title&gt;</span><br><span class=\"line\">&lt;/head&gt;</span><br><span class=\"line\">&lt;body&gt;</span><br><span class=\"line\">     &lt;h1&gt;这是一个视图页面&lt;/h1&gt;</span><br><span class=\"line\">&lt;/body&gt;</span><br><span class=\"line\">&lt;/html&gt;</span><br></pre></td></tr></table></figure>\n<p>◇这样，我们能够通过showview方法访问view.jsp的页面，但是，上面的代码我们通过url直接访问view.jsp也是可以的; 因此通过controller访问view.jsp的意义是为了完成数据的动态展现，所以假设我们需要将请求传来的用户编号，我们把数据查询出来得到一个user对象，然后在jsp中把user对象进行展现；</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@GetMapping(&quot;/view&quot;)</span><span class=\"comment\">/*映射地址*/</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> ModelAndView <span class=\"title\">showView</span><span class=\"params\">(Integer userId)</span></span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/*jsp作为模板引擎*/</span></span><br><span class=\"line\">    ModelAndView mav = <span class=\"keyword\">new</span> ModelAndView(<span class=\"string\">&quot;/view.jsp&quot;</span>);</span><br><span class=\"line\">    User user = <span class=\"keyword\">new</span> User();</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (userId == <span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">        user.setUsername(<span class=\"string\">&quot;lily&quot;</span>);</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (userId == <span class=\"number\">2</span>) &#123;</span><br><span class=\"line\">        user.setUsername(<span class=\"string\">&quot;smith&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">/*addObject的含义是在当前的请求中增加一个对象，对象的别名可以设置为u,第二个参数是</span></span><br><span class=\"line\"><span class=\"comment\">    * 我们要存放的数据，该数据可以是一个java对象*/</span></span><br><span class=\"line\">    mav.addObject(<span class=\"string\">&quot;u&quot;</span>,user);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> mav;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>◇修改jsp部分,通过EL表达式来进行数据的动态传入</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">&lt;h1&gt;这是一个视图页面&lt;/h1&gt;</span><br><span class=\"line\">     &lt;hr&gt;</span><br><span class=\"line\">     &lt;h2&gt;Username:$&#123;u.username&#125;&lt;/h2&gt;</span><br></pre></td></tr></table></figure>\n<p>然后在浏览器中输入localhost/view?userId=1;会发现页面的展现的username为lily,将userId改为2则name变为Smith；数据是由controller中动态的查询产生，而界面由jsp动态渲染；通过这个例子可以看出springmvc模式设计的核心，mvc一直强调视图和模型解耦，有利于程序的维护；</p>\n<h2 id=\"ModelAndView-1\"><a href=\"#ModelAndView-1\" class=\"headerlink\" title=\"ModelAndView\"></a>ModelAndView</h2><p>◇mav.addObject()方法设置的属性默认存放在当前请求中；<br>◇默认ModelAndView使用请求转发(forward)至页面，请求转发就是把当前送给showview方法的请求原封不动的传递给view.jsp，即jsp和controller中的请求是同一个，而mav.addObject方法只是向当前的请求中存放数据；<br>◇重定向使用new ModelAndView(“redirect:/index.jsp”)<br>◇如果我们使用页面重定向，即将new ModelAndView(“redirect:/view.jsp”),那么我们的jsp页面将接收不到数据；因为重定向是controller通知客户端浏览器重新建立一个新的请求来访问view.jsp的地址；<br>◇那么重定向使用的场景也有很多，例如那种需要调转的页面和当前请求中的数据没有关系的时候，比如在用户注册的时候，需要跳转到网站首页，那么网站首页就和用户注册的数据没有太大关系；<br>◇ ModelAndView mav = new ModelAndView(“/view.jsp”)；也可写为 ModelAndView mav = new ModelAndView()；mav.setViewName(“/view.jsp”);如果/view.jsp去掉”/“的话，就代表相对地址，相对于我们当前的访问地址(在控制类上通过@RequestMapping(<strong>“/um”</strong>)设置的全局地址)，也就是说，去掉以后我们在浏览器访问到的页面是在程序中的webapp/um/view.jsp；而不是webapp/view.jsp；um文件夹是自己创建的，和RequestMapping设置的一致；<br>◇如何利用String与ModelMap实现和ModelAndView一样的作用；如果没有数据需要传递的话，可以没有ModelMap对象参数；</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/*String与ModelMap</span></span><br><span class=\"line\"><span class=\"comment\">* ModelMap对应模型数据，通过ModelMap向里设值可以给我们的页面提供数据</span></span><br><span class=\"line\"><span class=\"comment\">* 方法直接返回string字符串</span></span><br><span class=\"line\"><span class=\"comment\">* Controller方法返回String的两种情况</span></span><br><span class=\"line\"><span class=\"comment\">* 1.方法被@ResponseBody注解描述，SpringMVC直接响应String字符串本身</span></span><br><span class=\"line\"><span class=\"comment\">* 2.方法不存在@ResponseBody，则SpringMVC处理String指代的视图(页面)</span></span><br><span class=\"line\"><span class=\"comment\">* */</span></span><br><span class=\"line\"><span class=\"comment\">//@ResponseBody //直接向响应提供字符串数据，不跳转页面</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">showView1</span><span class=\"params\">(Integer userId, ModelMap modelMap)</span> </span>&#123;</span><br><span class=\"line\">    String view = <span class=\"string\">&quot;/view.jsp&quot;</span>;<span class=\"comment\">/*设置显示的页面*/</span></span><br><span class=\"line\">    User user = <span class=\"keyword\">new</span> User();</span><br><span class=\"line\">    <span class=\"comment\">/*模拟数据获取*/</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (userId == <span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">        user.setUsername(<span class=\"string\">&quot;lily&quot;</span>);</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (userId == <span class=\"number\">2</span>) &#123;</span><br><span class=\"line\">        user.setUsername(<span class=\"string\">&quot;smith&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    modelMap.addAttribute(<span class=\"string\">&quot;u&quot;</span>,user);<span class=\"comment\">/*与addObject的作用完全相同*/</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> view;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"SpringMVC整合Freemarker\"><a href=\"#SpringMVC整合Freemarker\" class=\"headerlink\" title=\"SpringMVC整合Freemarker\"></a>SpringMVC整合Freemarker</h2><h3 id=\"三个步骤\"><a href=\"#三个步骤\" class=\"headerlink\" title=\"三个步骤\"></a>三个步骤</h3><p>◇一般分为以下三步：**pom.xml引入依赖、启用Freemarker模板引擎、 配置Freemarker参数  **<br>◇pox.xml引入freemarker的依赖,还要引入spring上下文的依赖包spring-context-support(该模块提供了spring对freemaker的整合支持类)</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">&lt;dependency&gt;</span><br><span class=\"line\"> &lt;groupId&gt;org.freemarker&lt;/groupId&gt;</span><br><span class=\"line\"> &lt;artifactId&gt;freemarker&lt;/artifactId&gt;</span><br><span class=\"line\"> &lt;version&gt;<span class=\"number\">2.3</span><span class=\"number\">.28</span>&lt;/version&gt;</span><br><span class=\"line\"> &lt;/dependency&gt;</span><br><span class=\"line\"> &lt;dependency&gt;</span><br><span class=\"line\"> &lt;groupId&gt;org.springframework&lt;/groupId&gt;</span><br><span class=\"line\"> &lt;artifactId&gt;spring-context-support&lt;/artifactId&gt;</span><br><span class=\"line\"> &lt;version&gt;<span class=\"number\">5.1</span><span class=\"number\">.9</span>.RELEASE&lt;/version&gt;</span><br><span class=\"line\"> &lt;/dependency&gt;</span><br></pre></td></tr></table></figure>\n<p>◇第二步需要通知springmvc我们要使用用Freemarker模板引擎，在applicationContext.xml中增加如下配置，其作用是通知springmvc我们的默认引擎有jsp改为了FreeMarkerViewResolver；</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">&lt;bean id=<span class=\"string\">&quot;ViewResolver&quot;</span> </span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span></span>=<span class=\"string\">&quot;org.springframework.web.servlet.view.freemarker.FreeMarkerViewResolver&quot;</span>&gt;</span><br><span class=\"line\"> &lt;!-- 设置响应输出，并解决中文乱码 --&gt;</span><br><span class=\"line\"> &lt;property name=<span class=\"string\">&quot;contentType&quot;</span> value=<span class=\"string\">&quot;text/html;charset=utf-8&quot;</span>&gt;&lt;/property&gt;</span><br><span class=\"line\"> &lt;!-- 指定Freemarker模板文件扩展名 --&gt;</span><br><span class=\"line\"> &lt;property name=<span class=\"string\">&quot;suffix&quot;</span> value=<span class=\"string\">&quot;.ftl&quot;</span>/&gt;</span><br><span class=\"line\"> &lt;/bean&gt;</span><br></pre></td></tr></table></figure>\n<p>◇第三步，对Freemarker本身进行参数设置，定义一个bean，类指向Freemarker的配置类；<br>注意第三步设置的UTF-8是在模板与数据绑定渲染过程中使用的字符集，而在上一步设置utf-8是指在渲染完成后，向客户端浏览器响应时，响应体中使用的字符集；</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">&lt;bean id=<span class=\"string\">&quot;freemarkerConfig&quot;</span> <span class=\"class\"><span class=\"keyword\">class</span></span>=<span class=\"string\">&quot;org.springframework.web.servlet.view.freemarker.FreeMarkerConfigurer&quot;</span>&gt;</span><br><span class=\"line\">&lt;!--设置模板保存的目录；WEB-INF目录是无法被直接访问的，Tomcat无法直接解析freemarker</span><br><span class=\"line\">    模板引擎，因此为了保证模板的安全，就需要把模板文件放在外侧无法访问的WEB-INF目录下</span><br><span class=\"line\">    一般新增一个ftl文件用于存放freemarker文件--&gt;</span><br><span class=\"line\">&lt;property name=<span class=\"string\">&quot;templateLoaderPath&quot;</span> value=<span class=\"string\">&quot;/WEB-INF/ftl&quot;</span>/&gt;</span><br><span class=\"line\">&lt;!--其他模板引擎设置--&gt;</span><br><span class=\"line\">&lt;property name=<span class=\"string\">&quot;freemarkerSettings&quot;</span>&gt;</span><br><span class=\"line\">&lt;props&gt;</span><br><span class=\"line\">&lt;!--设置Freemarker脚本与数据渲染时使用的字符集--&gt;</span><br><span class=\"line\">&lt;prop key=<span class=\"string\">&quot;defaultEncoding&quot;</span>&gt;UTF-<span class=\"number\">8</span>&lt;/prop&gt;</span><br><span class=\"line\">&lt;/props&gt;</span><br><span class=\"line\">&lt;/property&gt;</span><br><span class=\"line\">&lt;/bean&gt;</span><br></pre></td></tr></table></figure>\n<h3 id=\"代码示例\"><a href=\"#代码示例\" class=\"headerlink\" title=\"代码示例\"></a>代码示例</h3><p>◇首先按上面步骤进行配置<br>◇在controller包中新增FreemarkerController类</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.lcg.springmvc.controller;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> com.lcg.springmvc.entity.User;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.stereotype.Controller;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.servlet.ModelAndView;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Controller</span></span><br><span class=\"line\"><span class=\"meta\">@RequestMapping(&quot;/fm&quot;)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">FreemarkerController</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> ModelAndView <span class=\"title\">showTest</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">/*只写/test,而不写扩展名是因为前面我们已经设置了扩展名为.ftl</span></span><br><span class=\"line\"><span class=\"comment\">        * &#x27;/&#x27;代表了根路径，而此时根路径并不是指webapp目录，而是我们定义的</span></span><br><span class=\"line\"><span class=\"comment\">        * WEB-INF/ftl,在这里我们写的文件名为test，则应该在ftl目录下创建</span></span><br><span class=\"line\"><span class=\"comment\">        * test.ftl文件*/</span></span><br><span class=\"line\">        ModelAndView mav = <span class=\"keyword\">new</span> ModelAndView(<span class=\"string\">&quot;/test&quot;</span>);</span><br><span class=\"line\">        User user = <span class=\"keyword\">new</span> User();</span><br><span class=\"line\">        user.setUsername(<span class=\"string\">&quot;张珊&quot;</span>);</span><br><span class=\"line\">        mav.addObject(<span class=\"string\">&quot;u&quot;</span>, user);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> mav;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>◇创建test.ftl模板文件，语法在前面的章节有讲</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">&lt;h1&gt;$&#123;u.username&#125;&lt;/h1&gt;</span><br></pre></td></tr></table></figure>\n<p>◇因为引入了依赖，但是IDEA并不会将依赖发布，因此需要对发布的信息进行配置，即编辑Web exploded，加入新增的两个依赖，使其运行时能发布到Tomcat中；只要pom.xml配置文件中增加了新的依赖，都要编辑Web exploded<br>◇在浏览器中输入:localhost/fm/test，即可出现张珊字样；<br>​</p>\n","categories":["Spring","SpringMVC基础"],"tags":["Spring"]},{"title":"ThreadLocal","url":"/p/4b81.html","content":"<h2 id=\"简介\"><a href=\"#简介\" class=\"headerlink\" title=\"简介\"></a>简介</h2><p><img src=\"/p/4b81/1636029314385-0925d930-5ccd-4a82-acfe-d85f4b01778b.png\" class=\"lazyload\" data-srcset=\"/p/4b81/1636029314385-0925d930-5ccd-4a82-acfe-d85f4b01778b.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"></p>\n<h2 id=\"两大使用场景\"><a href=\"#两大使用场景\" class=\"headerlink\" title=\"两大使用场景\"></a>两大使用场景</h2><h3 id=\"典型场景1\"><a href=\"#典型场景1\" class=\"headerlink\" title=\"典型场景1\"></a>典型场景1</h3><p>◇每个线程需要一个独享的对象（通常是工具类，典型需要使用的类有SimpleDateFormat和Random）多个线程共享同一个静态工具类是有风险的，所以需要使用ThreadLocal来帮每一个线程制作一个独享的对象，让线程和线程之间拥有的工具类对象是不同的实例；<br>◇每个线程需要一个独享的对象；每个Thread内有自己的实例副本，不共享；例如：教材只有一本，一起做笔记有线程安全问题，而复印后没问题；<br> ◇SimpleDateFormat的进化之路；两个线程分别用自己的SimpleDateFormat；一共有两个线程，都需要去打印日期，所以都需要使用到SimpleDateFormat这个工具类；<br><img src=\"/p/4b81/1636030209415-975b6792-edab-46f9-ab36-cd6f8a2ca8db.png\" class=\"lazyload\" data-srcset=\"/p/4b81/1636030209415-975b6792-edab-46f9-ab36-cd6f8a2ca8db.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"></p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 描述：     两个线程打印日期</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ThreadLocalNormalUsage00</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">//第一个线程</span></span><br><span class=\"line\">        <span class=\"keyword\">new</span> Thread(<span class=\"keyword\">new</span> Runnable() &#123;</span><br><span class=\"line\">            <span class=\"meta\">@Override</span></span><br><span class=\"line\">            <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">                String date = <span class=\"keyword\">new</span> ThreadLocalNormalUsage00().date(<span class=\"number\">10</span>);<span class=\"comment\">//10s以后的时间是多少</span></span><br><span class=\"line\">                System.out.println(date);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;).start();</span><br><span class=\"line\">        <span class=\"comment\">//第二个线程</span></span><br><span class=\"line\">        <span class=\"keyword\">new</span> Thread(<span class=\"keyword\">new</span> Runnable() &#123;</span><br><span class=\"line\">            <span class=\"meta\">@Override</span></span><br><span class=\"line\">            <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">                String date = <span class=\"keyword\">new</span> ThreadLocalNormalUsage00().date(<span class=\"number\">104707</span>);</span><br><span class=\"line\">                System.out.println(date);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;).start();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">date</span><span class=\"params\">(<span class=\"keyword\">int</span> seconds)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">//参数的单位是毫秒，从1970.1.1 00:00:00 GMT计时</span></span><br><span class=\"line\">        Date date = <span class=\"keyword\">new</span> Date(<span class=\"number\">1000</span> * seconds);</span><br><span class=\"line\">        SimpleDateFormat dateFormat = <span class=\"keyword\">new</span> SimpleDateFormat(<span class=\"string\">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> dateFormat.format(date);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>◇如果当需求变成了1000个，那么必然要用线程池(否则消耗内存太多)；<br><img src=\"/p/4b81/1636031239944-aa331fd8-8081-4f33-bd58-0a986e0c6e7e.png\" class=\"lazyload\" data-srcset=\"/p/4b81/1636031239944-aa331fd8-8081-4f33-bd58-0a986e0c6e7e.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"></p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//固定10个数量的线程池</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> ExecutorService threadPool = Executors.newFixedThreadPool(<span class=\"number\">10</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> <span class=\"keyword\">throws</span> InterruptedException </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">1000</span>; i++) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">int</span> finalI = i;</span><br><span class=\"line\">        threadPool.submit(<span class=\"keyword\">new</span> Runnable() &#123;</span><br><span class=\"line\">            <span class=\"meta\">@Override</span></span><br><span class=\"line\">            <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">                String date = <span class=\"keyword\">new</span> ThreadLocalNormalUsage02().date(finalI);</span><br><span class=\"line\">                System.out.println(date);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    threadPool.shutdown();<span class=\"comment\">//关闭线程池</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>◇1000个任务新建了1000个SimpleDateFormat对象，这样开销太大了；优化代码，不需要每一个任务都新建SimpleDateFormat对象；即在外部创建一个静态的SimpleDateFormat对象，每一次执行任务时直接使用，而不新建；</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">static</span> SimpleDateFormat dateFormat = <span class=\"keyword\">new</span> SimpleDateFormat(<span class=\"string\">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>);</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">date</span><span class=\"params\">(<span class=\"keyword\">int</span> seconds)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">//参数的单位是毫秒，从1970.1.1 00:00:00 GMT计时</span></span><br><span class=\"line\">        Date date = <span class=\"keyword\">new</span> Date(<span class=\"number\">1000</span> * seconds);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> dateFormat.format(date);</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n<p>◇但是这样就会出现前面提到过的线程安全问题，导致会出现打印出相同的时间(我们的目的是没一次打印的时间都会增加1s)；即当所有的线程都共用同一个SimpleDateFormat对象就有可能产生线程安全；<br><img src=\"/p/4b81/1636033488916-943cfbef-0f5d-47b3-a6dd-b02b99be9c6e.png\" class=\"lazyload\" data-srcset=\"/p/4b81/1636033488916-943cfbef-0f5d-47b3-a6dd-b02b99be9c6e.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"><br>◇尝试利用加锁的方法来解决线程安全问题；锁应该加在危险的代码行，即return dateFormat.format(date)处；这样就能避免多个线程共同使用SimpleDateFormat对象；</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">String s = <span class=\"keyword\">null</span>;</span><br><span class=\"line\"><span class=\"comment\">//类锁</span></span><br><span class=\"line\"><span class=\"keyword\">synchronized</span> (ThreadLocalNormalUsage04.class) &#123;</span><br><span class=\"line\">    s = dateFormat.format(date);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">return</span> s;</span><br></pre></td></tr></table></figure>\n<p>◇通过加锁的方式能够有效避免多个线程共同使用SimpleDateFormat对象；但是这样的方法会导致线程使用对象时排队，这样效率就比较低;那么，更好的解决方案是使用ThreadLocal；即给每一个线程内部使用一个df(dateformate)；线程池有十个线程，那就创建十个dateformate对象；</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 描述：利用ThreadLocal，给每个线程分配自己的dateFormat对象，保证了线程安全，高效利用内存</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ThreadLocalNormalUsage05</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> ExecutorService threadPool = Executors.newFixedThreadPool(<span class=\"number\">10</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> <span class=\"keyword\">throws</span> InterruptedException </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">5</span>; i++) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">int</span> finalI = i;</span><br><span class=\"line\">            threadPool.submit(<span class=\"keyword\">new</span> Runnable() &#123;</span><br><span class=\"line\">                <span class=\"meta\">@Override</span></span><br><span class=\"line\">                <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">                    String date = <span class=\"keyword\">new</span> ThreadLocalNormalUsage05().date(finalI);</span><br><span class=\"line\">                    System.out.println(date);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        threadPool.shutdown();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">date</span><span class=\"params\">(<span class=\"keyword\">int</span> seconds)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">//参数的单位是毫秒，从1970.1.1 00:00:00 GMT计时</span></span><br><span class=\"line\">        Date date = <span class=\"keyword\">new</span> Date(<span class=\"number\">1000</span> * seconds);</span><br><span class=\"line\"><span class=\"comment\">//       利用get()方法获取dateFormat对象</span></span><br><span class=\"line\"><span class=\"comment\">//       相当于前面的SimpleDateFormat dateFormat = new SimpleDateFormat(&quot;yyyy-MM-dd HH:mm:ss&quot;);</span></span><br><span class=\"line\">        SimpleDateFormat dateFormat = ThreadSafeFormatter.dateFormatThreadLocal2.get();</span><br><span class=\"line\">        <span class=\"keyword\">return</span> dateFormat.format(date);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">//创建线程安全的对象</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ThreadSafeFormatter</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//创建静态的ThreadLocal,即想调用就调用</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> ThreadLocal&lt;SimpleDateFormat&gt; dateFormatThreadLocal = <span class=\"keyword\">new</span> ThreadLocal&lt;SimpleDateFormat&gt;() &#123;</span><br><span class=\"line\">        <span class=\"meta\">@Override</span></span><br><span class=\"line\">        <span class=\"function\"><span class=\"keyword\">protected</span> SimpleDateFormat <span class=\"title\">initialValue</span><span class=\"params\">()</span> </span>&#123;<span class=\"comment\">//重写初始化函数</span></span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> SimpleDateFormat(<span class=\"string\">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/*使用lambda表达式重写函数*/</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> ThreadLocal&lt;SimpleDateFormat&gt; dateFormatThreadLocal2 = ThreadLocal</span><br><span class=\"line\">            .withInitial(() -&gt; <span class=\"keyword\">new</span> SimpleDateFormat(<span class=\"string\">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>));</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"典型场景2\"><a href=\"#典型场景2\" class=\"headerlink\" title=\"典型场景2\"></a>典型场景2</h3><p>◇每个线程内需要保存全局变量（例如在拦截器中获 取用户信息），可以让不同方法直接使用，避免参数传递的麻烦；<br>◇实例：当前用户信息需要被线程内所有方法共享；一个比较繁琐的解决方案是把user作为参数层层传递，从service-1传到service-2，再传到service-3，以此类推，但这样做会导致代码冗余且不易维护；<br><img src=\"/p/4b81/1636097267562-7880070c-af75-47e4-bfee-eb13664fbfb3.png\" class=\"lazyload\" data-srcset=\"/p/4b81/1636097267562-7880070c-af75-47e4-bfee-eb13664fbfb3.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"><br>◇设想直接给一个全局的用户信息，每一次想要用的时候直接调用就行了；这种想法也是不可取的，因为在这种场景下，每个请求对应着不同的用户；那么又设想使用UserMap，来保存登录用户的信息；如下图，第一个方法生成user对象放到UserMap中，后面的方法需要用时就往里面取；<br><img src=\"/p/4b81/1636097775121-cade40c3-0097-4185-b225-41646225916d.png\" class=\"lazyload\" data-srcset=\"/p/4b81/1636097775121-cade40c3-0097-4185-b225-41646225916d.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"><br>◇但是，这样一来就会产生新的问题：usermap是很有可能被多个线程同时使用的，必须保证线程安全；<br>◇当多个线程同时工作时，我们需要保证线程安全，可以用synchroized,也可以用ConcurrentHashMap,但无论用什么，都会对性能有所影响；<br><img src=\"/p/4b81/1636097961863-031c3d97-0c09-491f-aa64-14c04ae02658.png\" class=\"lazyload\" data-srcset=\"/p/4b81/1636097961863-031c3d97-0c09-491f-aa64-14c04ae02658.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"><br>◇更好的办法是使用ThreadLocal，这样无需synchronized,可以在不影响性能的情况下，也无需层层传递参数，就可以达到保存当前线程对应的用户信息的目的；用ThreadLocal保存一些业务内容(用户权限信息、从用户系统获取到的用户名、user ID等)；这些信息在同一个线程内相同，但是不同的线程使用的业务内容是不相同的；<br>◇在线程生命周期内，都通过这个静态ThreadLocal实例的get()方法取得自己set过的那个对象，避免了将这个对象(例如user对象)作为参数传递的麻烦；<br>◇与场景一不同，这里强调的是同一个请求内(同一个线程内)不同方法间的共享；不需要重写initialValue()方法，但是必须手动调用set()方法；<br>◇代码演示</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 描述：     演示ThreadLocal用法2：避免传递参数的麻烦</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ThreadLocalNormalUsage06</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">new</span> Service1().process(<span class=\"string\">&quot;&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//用来设置用户信息;</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Service1</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">process</span><span class=\"params\">(String name)</span> </span>&#123;</span><br><span class=\"line\">        User user = <span class=\"keyword\">new</span> User(<span class=\"string\">&quot;张珊&quot;</span>);</span><br><span class=\"line\">        UserContextHolder.holder.set(user);</span><br><span class=\"line\">        <span class=\"keyword\">new</span> Service2().process();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Service2</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">process</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        User user = UserContextHolder.holder.get();</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;Service2拿到用户名：&quot;</span> + user.name);</span><br><span class=\"line\">        <span class=\"keyword\">new</span> Service3().process();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Service3</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">process</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        User user = UserContextHolder.holder.get();</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;Service3拿到用户名：&quot;</span> + user.name);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//持有用户信息的类;</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">UserContextHolder</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">//这里不需要重写initialValue方法;</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> ThreadLocal&lt;User&gt; holder = <span class=\"keyword\">new</span> ThreadLocal&lt;&gt;();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//用户实体类</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">User</span> </span>&#123;</span><br><span class=\"line\">    String name;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">User</span><span class=\"params\">(String name)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.name = name;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>◇如下图，第一个线程进来之后执行service-1，会将user信息设置进去；然后service-2,3,4就可以直接获取；<br>同样对于第二个请求(对应第二个线程)来讲，也是用1设置信息，2,3,4来读取<br><img src=\"/p/4b81/1636100528679-67455bb1-069d-4c41-b5b3-d3fa9e4d0443.png\" class=\"lazyload\" data-srcset=\"/p/4b81/1636100528679-67455bb1-069d-4c41-b5b3-d3fa9e4d0443.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"></p>\n<h2 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h2><h3 id=\"ThreadLocal的两个作用\"><a href=\"#ThreadLocal的两个作用\" class=\"headerlink\" title=\"ThreadLocal的两个作用\"></a>ThreadLocal的两个作用</h3><ol>\n<li>让某个需要用到的对象在线程间隔离（每个线程都有自己的独立的对象） </li>\n<li>在任何方法中都可以轻松获取到该对象<br>◇根据共享对象的生成时机不同，选择initialValue或set来保存对象；<br>◇例如，在场景一中，使用initialValue；在ThreadLocal第一次get的时候把对象给初始化出来，对象的初始化时机可以由我们控制；<br>◇在场景二中，使用set；因为如果需要保存到ThreadLocal里的对象的生成时机不由我们随意控制(在上例中的拦截器生成的用户信息)；因此使用ThreadLocal.set直接放到我们的ThreadLocal中去，以便后续使用；<h3 id=\"使用ThreadLocal带来的好处\"><a href=\"#使用ThreadLocal带来的好处\" class=\"headerlink\" title=\"使用ThreadLocal带来的好处\"></a>使用ThreadLocal带来的好处</h3>◇达到线程安全<br>◇不需要加锁(线程之间的对象是独立的)，提高执行效率<br>◇更高效地利用内存、节省开销 <pre><code> --相比于每个任务都新建一个SimpleDateFormat，显然用ThreadLocal可以节省内存和开销  \n</code></pre>\n◇免去传参的繁琐 <pre><code> -- 不需要每次都传同样的参数 \n -- ThreadLocal使得代码耦合度更低，更优雅  \n</code></pre>\n<h3 id=\"主要方法介绍\"><a href=\"#主要方法介绍\" class=\"headerlink\" title=\"主要方法介绍\"></a>主要方法介绍</h3>◇**T initialValue( )：初始化 <strong>；<br>①该方法会返回当前线程对应的“初始值”，这是一个延迟加载的方法，只有在调用get的时候，才会触发 ；<br>②当线程第一次使用get方法访问变量时，将调用此方法，除非线程先前调用了set方法，在这种情况下，不会为线程调用本 initialValue方法<br>③ 通常，每个线程最多调用一次此方法，但如果已经调用了remove()来删除后，再调用get()，则可以再次调用此方法<br>④ 如果不重写本方法，这个方法会返回null。一般使用匿名内部类的方法来重写initialValue()方法，以便在后续使用中可以初始化副本对象。<br>◇</strong>void set(T t)<strong>：为这个线程设置一个新值<br>◇</strong>T get( )<strong>：得到这个线程对应的value。如果是首次调用 get()，则会调用initialize来得到这个值<br>◇</strong>void remove( )**：删除对应这个线程的值；如：UserContextHolder.holder.remove(); <h3 id=\"图解ThreadLocal原理\"><a href=\"#图解ThreadLocal原理\" class=\"headerlink\" title=\"图解ThreadLocal原理\"></a>图解ThreadLocal原理</h3>◇搞清楚Thread，ThreadLocal以及 ThreadLocalMap三者之间的关系<br>◇每个Thread对象中都持有且仅有一个ThreadLocalMap成员变量<br><img src=\"/p/4b81/1636183873959-5116d7b0-f90b-4e47-92b8-8fcd8b85bad1.png\" class=\"lazyload\" data-srcset=\"/p/4b81/1636183873959-5116d7b0-f90b-4e47-92b8-8fcd8b85bad1.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"><br>◇一个ThreadLocalMap存储很多ThreadLocal，这是因为一个线程可能有多个ThreadLocal对象；<br>◇get方法； get方法是先取出当前线程的ThreadLocalMap ；然后调用map.getEntry方法，把ThreadLocal的引用作为key参数传入 ； 取出map中属于本ThreadLocal的value ；<br>◇注意：这个map以及map中的key和value都是保存在线程中的，而不是保存在ThreadLocal中；ThreadLocal可以理解为只是对ThreadLocalMap进行了封装，传递了变量值；<br>◇ initialValue方法 </li>\n</ol>\n<p>– 没有默认实现<br>– 如果要用initialValue方法，需要自己实现<br>– 通常使用匿名内部类的方式实现<br>◇ remove方法用来删除保存的自定义对象；这里要注意的是，从线程中获取到的ThreadLocalMap对象是包含了很多个ThreadLocal的，但需要删除的只是当前的ThreadLocal对象，所以使用this引用作为参数执行m.remove()方法；</p>\n<h3 id=\"ThreadLocalMap-类\"><a href=\"#ThreadLocalMap-类\" class=\"headerlink\" title=\"ThreadLocalMap 类\"></a>ThreadLocalMap 类</h3><p>◇ThreadLocalMap类，也就是Thread.threadLocals<br>◇ThreadLocalMap类是每个线程Thread类里面的变量，里面最重要的是一个键值对数组Entry[] table，可以认为是一个 map，键值对：<br>◇键：这个ThreadLocal<br>◇值：实际需要的成员变量，比如User或者 SimpleDateFormat对象<br>◇类似于HashMap的结构，但是遇到冲突的解决方法和HashMap不同；在HashMap中使用拉链法和红黑树来解决冲突；<br><img src=\"/p/4b81/1636189148017-6d7a924f-1470-44d5-a396-ed6396587189.png\" class=\"lazyload\" data-srcset=\"/p/4b81/1636189148017-6d7a924f-1470-44d5-a396-ed6396587189.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"><br>◇而在ThreadLocalMap中采用线性探测法，也就是如果发生冲突，就继续找下一个空位置而不是用链表拉链；</p>\n<h3 id=\"两种使用场景殊途同归\"><a href=\"#两种使用场景殊途同归\" class=\"headerlink\" title=\"两种使用场景殊途同归\"></a>两种使用场景殊途同归</h3><p>◇通过源码分析可以看出，setInitialValue和直接set最后都是利用map.set()方法来设置值<br>◇也就是说，最后都会对应到ThreadLocalMap的一个Entry，只不过是起点和入口不一样  </p>\n<h3 id=\"内存泄漏\"><a href=\"#内存泄漏\" class=\"headerlink\" title=\"内存泄漏\"></a>内存泄漏</h3><p>◇什么是内存泄漏：某个对象不再有用，但是占用的内存却不能被回收<br>◇泄露有两种情况：ThreadLocal的泄露和key的泄露<br>◇key的泄漏：ThreadLocalMap中的Entry(即键值对)继承自 WeakReference，是弱引用  </p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//ThreadLocal部分源码       </span></span><br><span class=\"line\"><span class=\"keyword\">static</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Entry</span> <span class=\"keyword\">extends</span> <span class=\"title\">WeakReference</span>&lt;<span class=\"title\">ThreadLocal</span>&lt;?&gt;&gt; </span>&#123;</span><br><span class=\"line\">            <span class=\"comment\">/** The value associated with this ThreadLocal. */</span></span><br><span class=\"line\">            Object value;</span><br><span class=\"line\"></span><br><span class=\"line\">            Entry(ThreadLocal&lt;?&gt; k, Object v) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">super</span>(k);</span><br><span class=\"line\">                value = v;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br></pre></td></tr></table></figure>\n<p>◇弱引用的特点：如果这个对象只被弱引用关联（没有任何强引用关联），那么这个对象就可以被回收;我们平常的赋值如Object value; value=v都是强引用；<br>◇由于Value是强引用，则会导致内存的泄露；<br>◇ThreadLocalMap 的每个Entry 都是一个对key的弱引用，同时， 每个 Entry 都包含了一个对value的强引用<br>◇正常情况下，当线程终止，保存在ThreadLocal里的value会被垃圾回收，因为没有任何强引用了<br>◇但是，如果线程不终止（比如线程需要保持很久），那么key对应的value就不能被回收，因为有以下的调用链：  Thread→ ThreadLocalMap→ Entry（key为null）→ Value<br>◇因为value和Thread之间还存在这个强引用链路，所以导致value 无法回收，就可能会出现OOM<br>◇JDK已经考虑到了这个问题，所以在set, remove, rehash方法中会扫描key为null的Entry，并把对应的value设置为null，这样value对象就可以被回收；如下面ThreadLocal中resize()方法的源码，它会判断如果k==null的话，就将其value也置空； </p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">resize</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">           Entry[] oldTab = table;</span><br><span class=\"line\">           <span class=\"keyword\">int</span> oldLen = oldTab.length;</span><br><span class=\"line\">           <span class=\"keyword\">int</span> newLen = oldLen * <span class=\"number\">2</span>;</span><br><span class=\"line\">           Entry[] newTab = <span class=\"keyword\">new</span> Entry[newLen];</span><br><span class=\"line\">           <span class=\"keyword\">int</span> count = <span class=\"number\">0</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">           <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> j = <span class=\"number\">0</span>; j &lt; oldLen; ++j) &#123;</span><br><span class=\"line\">               Entry e = oldTab[j];</span><br><span class=\"line\">               <span class=\"keyword\">if</span> (e != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">                   ThreadLocal&lt;?&gt; k = e.get();</span><br><span class=\"line\">                   <span class=\"keyword\">if</span> (k == <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">                       e.value = <span class=\"keyword\">null</span>; <span class=\"comment\">// Help the GC</span></span><br><span class=\"line\">                   &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                       <span class=\"keyword\">int</span> h = k.threadLocalHashCode &amp; (newLen - <span class=\"number\">1</span>);</span><br><span class=\"line\">                       <span class=\"keyword\">while</span> (newTab[h] != <span class=\"keyword\">null</span>)</span><br><span class=\"line\">                           h = nextIndex(h, newLen);</span><br><span class=\"line\">                       newTab[h] = e;</span><br><span class=\"line\">                       count++;</span><br><span class=\"line\">                   &#125;</span><br><span class=\"line\">               &#125;</span><br><span class=\"line\">           &#125;</span><br></pre></td></tr></table></figure>\n<p>◇但是如果一个ThreadLocal不被使用，那么实际上set, remove, rehash方法也不会被调用，如果同时线程又不停止，那么调用链就一直存在，那么就导致了value的内存泄漏<br>◇那么如何避免内存泄漏呢？答案是使用阿里规约；<br>◇ 调用remove方法，就会删除对应的Entry对象，可以避免内存泄漏，所以使用完ThreadLocal之后，应该调用remove方法；如在场景二中假设最后一个service3使用完ThreadLocal后，调用remove方法；</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Service3</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">process</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        User user = UserContextHolder.holder.get();</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;Service3拿到用户名：&quot;</span> + user.name);</span><br><span class=\"line\">        UserContextHolder.holder.remove();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"空指针异常\"><a href=\"#空指针异常\" class=\"headerlink\" title=\"空指针异常\"></a>空指针异常</h3><p>◇代码示例</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ThreadLocalNPE</span> </span>&#123;</span><br><span class=\"line\">    ThreadLocal&lt;Long&gt; longThreadLocal = <span class=\"keyword\">new</span> ThreadLocal&lt;Long&gt;();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">set</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        longThreadLocal.set(Thread.currentThread().getId());</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">long</span> <span class=\"title\">get</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> longThreadLocal.get();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        Thread t1 = <span class=\"keyword\">new</span> Thread(<span class=\"keyword\">new</span> Runnable() &#123;</span><br><span class=\"line\">            <span class=\"meta\">@Override</span></span><br><span class=\"line\">            <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">                ThreadLocalNPE threadLocalNPE = <span class=\"keyword\">new</span> ThreadLocalNPE();</span><br><span class=\"line\">                <span class=\"comment\">//threadLocalNPE.set();</span></span><br><span class=\"line\">                System.out.println(threadLocalNPE.get());</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">        <span class=\"comment\">//执行线程</span></span><br><span class=\"line\">        t1.start();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>以上代码没有set而是自己get，就会抛出空指针异常；<br><img src=\"/p/4b81/1636200155873-2e704ac9-8308-4f6d-9183-43eafa80e208.png\" class=\"lazyload\" data-srcset=\"/p/4b81/1636200155873-2e704ac9-8308-4f6d-9183-43eafa80e208.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"><br>但是，如果将get方法的返回值类型有long改为Long，就会打印出null，而不报空指针异常；这是因为我们的泛型指定的是Long包装类型的长整形，而返回类型是基本类型的长整型，它就会做一下装箱拆箱，这样一来在装箱拆箱过程中尝试将get得到到对象转回基本类型long；由于对象是空的，所以在转换的时候抛出空指针异常；即空指针异常的问题通常是由于转换不当造成的；</p>\n","categories":["分布式与微服务"],"tags":["线程"]},{"title":"SpringMVC拦截器","url":"/p/b7ed.html","content":"<h2 id=\"拦截器-Interceptor\"><a href=\"#拦截器-Interceptor\" class=\"headerlink\" title=\"拦截器-Interceptor\"></a>拦截器-Interceptor</h2><p>◇拦截器(Interceptor)用于对URL请求进行前置/后置过滤<br>◇Interceptor与Filter用途相似,但实现方式不同<br>◇Interceptor底层就是基于Spring AOP面向切面编程实现  </p>\n<h2 id=\"HandlerInterceptor接口\"><a href=\"#HandlerInterceptor接口\" class=\"headerlink\" title=\"HandlerInterceptor接口\"></a>HandlerInterceptor接口</h2><p>◇preHandle - 前置执行处理 ；即一个请求产生以后，还没有进controller之前先要执行preHandle，对这个请求进行预制处理<br>◇postHandle - 目标资源已被Spring MVC框架处理 ；即内部方法return之后，但是并没有产生响应文本之前执行<br>◇afterCompletion - 响应文本已经产生；即响应文本产生之后执行，例如如果我们返回的是对象时，当对象进行JSON序列化以后就代表响应文本已经产生；</p>\n<h2 id=\"拦截器开发流程\"><a href=\"#拦截器开发流程\" class=\"headerlink\" title=\"拦截器开发流程\"></a>拦截器开发流程</h2><p>◇项目见interceptor</p>\n<h3 id=\"Maven依赖servlet-api\"><a href=\"#Maven依赖servlet-api\" class=\"headerlink\" title=\"Maven依赖servlet-api\"></a>Maven依赖servlet-api</h3><p>◇在pom.xml中增加依赖</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>javax.servlet<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>javax.servlet-api<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>3.1.0<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!--作为我们Tomcat的最终运行环境，它是自带servlet-api这个jar包的</span></span><br><span class=\"line\"><span class=\"comment\">    如果在我们进行打包发布的时候，将当前的依赖也放在war包中，会与Tomcat的</span></span><br><span class=\"line\"><span class=\"comment\">    jar包造成冲突；因此需要scope设置范围provided,表示只有在开发、编译时</span></span><br><span class=\"line\"><span class=\"comment\">    才会引用;当进行打包、最终使用的时候这个jar会被排除在外;--&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">scope</span>&gt;</span>provided<span class=\"tag\">&lt;/<span class=\"name\">scope</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"实现HandlerInterceptor接口\"><a href=\"#实现HandlerInterceptor接口\" class=\"headerlink\" title=\"实现HandlerInterceptor接口\"></a>实现HandlerInterceptor接口</h3><p>◇新增interceptor包，其下开发的都是拦截器类；创建一个java类MyInterceptor</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/*该类需要实现HandlerInterceptor接口的三个方法</span></span><br><span class=\"line\"><span class=\"comment\">* 选择接口-&gt;Code-&gt;Implement Methods-&gt;全选方法-&gt;OK*/</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MyInterceptor</span> <span class=\"keyword\">implements</span> <span class=\"title\">HandlerInterceptor</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/*如果返回为true，就将请求送达给后面的拦截器或者控制器；返回false，则当前的请求会被阻止直接</span></span><br><span class=\"line\"><span class=\"comment\">    * 产生响应返回客户端;*/</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">boolean</span> <span class=\"title\">preHandle</span><span class=\"params\">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</span><br><span class=\"line\">        System.out.println(request.getRequestURL()+<span class=\"string\">&quot;准备执行&quot;</span>);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">true</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">postHandle</span><span class=\"params\">(HttpServletRequest request, HttpServletResponse response, Object handler, ModelAndView modelAndView)</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</span><br><span class=\"line\">        System.out.println(request.getRequestURL()+<span class=\"string\">&quot;目标处理成功&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">afterCompletion</span><span class=\"params\">(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex)</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</span><br><span class=\"line\">        System.out.println(request.getRequestURL()+<span class=\"string\">&quot;响应内容已产生&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"applicationContext配置过滤地址\"><a href=\"#applicationContext配置过滤地址\" class=\"headerlink\" title=\"applicationContext配置过滤地址\"></a>applicationContext配置过滤地址</h3><p>◇进行配置</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">mvc:interceptors</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">mvc:interceptor</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">mvc:mapping</span> <span class=\"attr\">path</span>=<span class=\"string\">&quot;/**&quot;</span>/&gt;</span><span class=\"comment\">&lt;!--配置要对哪些路径进行拦截，/**表示所有路径--&gt;</span></span><br><span class=\"line\">        <span class=\"comment\">&lt;!--指明哪个类对拦截的URL进行处理--&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;com.lcg.restful.interceptor.MyInterceptor&quot;</span>/&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">mvc:interceptor</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">mvc:interceptors</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>◇运行结果 浏览器输入<a href=\"http://localhost:8080/restful/persons\">http://localhost:8080/restful/persons</a></p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">http:<span class=\"comment\">//localhost:8080/restful/persons准备执行</span></span><br><span class=\"line\">RestfulController.findPersons() - <span class=\"keyword\">return</span> list</span><br><span class=\"line\">http:<span class=\"comment\">//localhost:8080/restful/persons目标处理成功</span></span><br><span class=\"line\">http:<span class=\"comment\">//localhost:8080/restful/persons响应内容已产生</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"拦截器使用细则\"><a href=\"#拦截器使用细则\" class=\"headerlink\" title=\"拦截器使用细则\"></a>拦截器使用细则</h2><p>◇当我们输入<a href=\"http://localhost:8080/client.html%E5%9C%B0%E5%9D%80%E5%90%8E%EF%BC%8C%E6%9F%A5%E7%9C%8B%E5%90%8E%E5%8F%B0%E4%BC%9A%E5%8F%91%E7%8E%B0%E9%99%A4%E4%BA%86client%E7%9A%84%E4%BF%A1%E6%81%AF%E8%BF%98%E6%9C%89%E5%85%B6%E4%BB%96%E5%9C%B0%E5%9D%80%E7%9A%84%E4%BF%A1%E6%81%AF%EF%BC%9B\">http://localhost:8080/client.html地址后，查看后台会发现除了client的信息还有其他地址的信息；</a><br>这是因为作为原始的client.html在这里每一次发送localhost这个url的时候其本质都是通过Tomcat调用springmvc的解析功能来获取对应的资源，因为这些资源都符合”/**”的规则而被拦截；作为拦截器，不受_<!--default-servlet-handler将静态资源排除过滤--><em>&lt;**mvc:default-servlet-handler**/&gt;这个配置的控制；如果希望这些静态资源不受拦截器所拦截，需要额外的设置标签；&lt;**mvc:exclude-mapping path=”/**.ico”**/&gt;</em><!--如果遇到了ico为后缀的则排除拦截-->_；</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">&lt;!--排除一系列静态资源--&gt;</span><br><span class=\"line\">&lt;mvc:exclude-mapping path=<span class=\"string\">&quot;/**.ico&quot;</span>/&gt;</span><br><span class=\"line\">&lt;mvc:exclude-mapping path=<span class=\"string\">&quot;/**.jpg&quot;</span>/&gt;</span><br><span class=\"line\">&lt;mvc:exclude-mapping path=<span class=\"string\">&quot;/**.js&quot;</span>/&gt;</span><br><span class=\"line\">&lt;mvc:exclude-mapping path=<span class=\"string\">&quot;/**.css&quot;</span>/&gt;</span><br></pre></td></tr></table></figure>\n<p>◇由于今天资源有许多，如果都用exclude-mapping的配置方式会显得过于麻烦；其实在大多数时候我们的静态资源并不是直接存放在我们webapp的根路径上，而是在webapp目录下创建额外的目录如resources(资源)，并且在该资源目录下创建js、css、image等静态资源按目录进行保存；那么这样的话我们可以直接配置&lt;**mvc:exclude-mapping path=”/resoutces/**”**/&gt;就能够将所有静态资源进行排除；<br>◇如果一个请求被多个拦截器拦截的话，会按照什么顺序呢？我们再增加一个拦截器，interceptor-1，并且进行配置，配置方法和第一个拦截器一样；<br>当我们运行后，结果如下</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">http:<span class=\"comment\">//localhost:8080/restful/persons准备执行</span></span><br><span class=\"line\">http:<span class=\"comment\">//localhost:8080/restful/persons准备执行-1</span></span><br><span class=\"line\">RestfulController.findPersons() - <span class=\"keyword\">return</span> list</span><br><span class=\"line\">http:<span class=\"comment\">//localhost:8080/restful/persons目标处理成功-1</span></span><br><span class=\"line\">http:<span class=\"comment\">//localhost:8080/restful/persons目标处理成功</span></span><br><span class=\"line\">http:<span class=\"comment\">//localhost:8080/restful/persons响应内容已产生-1</span></span><br><span class=\"line\">http:<span class=\"comment\">//localhost:8080/restful/persons响应内容已产生</span></span><br></pre></td></tr></table></figure>\n<p>◇可以发现，准备执行时顺序按照我们的配置顺序执行，而后面却反了过来；通过图示我们来进行说明；<br>◇多Interceptor执行顺序  ，其中前置请求就是preHandle<br><img src=\"/p/b7ed/1634461611607-3921b40f-9fe2-48b9-b353-ad2d2833d2d8.png\" class=\"lazyload\" data-srcset=\"/p/b7ed/1634461611607-3921b40f-9fe2-48b9-b353-ad2d2833d2d8.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"></p>\n<h2 id=\"开发”用户流量”拦截器\"><a href=\"#开发”用户流量”拦截器\" class=\"headerlink\" title=\"开发”用户流量”拦截器\"></a>开发”用户流量”拦截器</h2><p>◇所谓用户流量就是在用户访问我们应用时自动的收集一些底层信息:如访问的时间、网址，用户使用的浏览器、系统、ip等；<br>◇我们在前面的项目interceptor中进行开发；在拦截器包中新建一个拦截器类 访问历史拦截器AccessHistoryInterceptor；在所有请求在被处理之前要被该拦截器所记录，所以该拦截器为前置处理；所以实现preHandle方法，又因为不涉及到任何请求阻断，所以直接return true；通常拦截器所记录的数据我们用日志文件进行保存；<br>◇引入依赖</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">&lt;!--引入日志依赖--&gt;</span><br><span class=\"line\">&lt;dependency&gt;</span><br><span class=\"line\">    &lt;groupId&gt;ch.qos.logback&lt;/groupId&gt;</span><br><span class=\"line\">    &lt;artifactId&gt;logback-classic&lt;/artifactId&gt;</span><br><span class=\"line\">    &lt;version&gt;<span class=\"number\">1.2</span><span class=\"number\">.3</span>&lt;/version&gt;</span><br><span class=\"line\">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>\n<p>◇配置日志文件，新增logback.xml</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">&lt;?xml version=<span class=\"string\">&quot;1.0&quot;</span> encoding=<span class=\"string\">&quot;UTF-8&quot;</span>?&gt;</span><br><span class=\"line\">&lt;configuration&gt;&lt;!--根节点--&gt;</span><br><span class=\"line\">    &lt;!--定义一个向控制台书写日志的追加器appender--&gt;</span><br><span class=\"line\">    &lt;appender name=<span class=\"string\">&quot;console&quot;</span> <span class=\"class\"><span class=\"keyword\">class</span></span>=<span class=\"string\">&quot;ch.qos.logback.core.ConsoleAppender&quot;</span>&gt;</span><br><span class=\"line\">        &lt;encoder&gt;&lt;!--输出日志的格式--&gt;</span><br><span class=\"line\">            &lt;!--定义格式:线程名 产生日志时间 日志级别 产生日志的类&#123;包名长度限制&#125;--&gt;</span><br><span class=\"line\">            &lt;pattern&gt;[%thread] %d %level %logger&#123;<span class=\"number\">10</span>&#125; - %msg%n&lt;/pattern&gt;</span><br><span class=\"line\">        &lt;/encoder&gt;</span><br><span class=\"line\">    &lt;/appender&gt;</span><br><span class=\"line\">    </span><br><span class=\"line\">    &lt;!--RollingFileAppender表示生成按天滚动的日志,该输出器向文件中进行写入，以天为单位；</span><br><span class=\"line\">    --&gt;</span><br><span class=\"line\">    &lt;appender name=<span class=\"string\">&quot;accessHistoryLog&quot;</span> <span class=\"class\"><span class=\"keyword\">class</span></span>=<span class=\"string\">&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;</span>&gt;</span><br><span class=\"line\">        &lt;!--rollingPolicy表示滚动策略,TimeBasedRollingPolicy表示按照时间进行滚动--&gt;</span><br><span class=\"line\">        &lt;rollingPolicy <span class=\"class\"><span class=\"keyword\">class</span></span>=<span class=\"string\">&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;</span>&gt;</span><br><span class=\"line\">            &lt;!--日志文件的保存路径 %d表示产生日期--&gt;</span><br><span class=\"line\">            &lt;fileNamePattern&gt;G:/logs/history.%d.log&lt;/fileNamePattern&gt;</span><br><span class=\"line\">        &lt;/rollingPolicy&gt;</span><br><span class=\"line\">        &lt;encoder&gt;</span><br><span class=\"line\">            &lt;pattern&gt;[%thread] %d %level %logger&#123;<span class=\"number\">10</span>&#125; - %msg%n&lt;/pattern&gt;</span><br><span class=\"line\">        &lt;/encoder&gt;</span><br><span class=\"line\">    &lt;/appender&gt;</span><br><span class=\"line\">    </span><br><span class=\"line\">    &lt;root level=<span class=\"string\">&quot;debug&quot;</span>&gt;&lt;!--定义当前输出级别最低为debug--&gt;</span><br><span class=\"line\">        &lt;appender-ref ref=<span class=\"string\">&quot;console&quot;</span>/&gt;&lt;!--引用定义的追加器--&gt;</span><br><span class=\"line\">    &lt;/root&gt;</span><br><span class=\"line\">    &lt;!--配置拦截器类的日志,指定使用定义的accessHistoryLog追加器,</span><br><span class=\"line\">    additivity=<span class=\"string\">&quot;false&quot;</span>表示不叠加，即只向文件中输入日志</span><br><span class=\"line\">    而不打印在控制台中--&gt;</span><br><span class=\"line\">    &lt;logger name=<span class=\"string\">&quot;com.lcg.restful.interceptor.AccessHistoryInterceptor&quot;</span> </span><br><span class=\"line\">            level=<span class=\"string\">&quot;INFO&quot;</span> additivity=<span class=\"string\">&quot;false&quot;</span>&gt;</span><br><span class=\"line\">        &lt;appender-ref ref=<span class=\"string\">&quot;accessHistoryLog&quot;</span>/&gt;&lt;!--引用--&gt;</span><br><span class=\"line\">    &lt;/logger&gt;</span><br><span class=\"line\">&lt;/configuration&gt;</span><br></pre></td></tr></table></figure>\n<p>◇拦截器开发</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.lcg.restful.interceptor;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> org.slf4j.Logger;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.slf4j.LoggerFactory;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.servlet.HandlerInterceptor;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.servlet.ModelAndView;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class=\"line\"><span class=\"keyword\">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">AccessHistoryInterceptor</span> <span class=\"keyword\">implements</span> <span class=\"title\">HandlerInterceptor</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/*利用LoggerFactory的get方法得到logger日志对象*/</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> Logger logger = LoggerFactory.getLogger(AccessHistoryInterceptor.class);</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">boolean</span> <span class=\"title\">preHandle</span><span class=\"params\">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</span><br><span class=\"line\">        StringBuilder log = <span class=\"keyword\">new</span> StringBuilder();</span><br><span class=\"line\">        log.append(request.getRemoteAddr());<span class=\"comment\">//用户地址</span></span><br><span class=\"line\">        log.append(<span class=\"string\">&quot;|&quot;</span>);<span class=\"comment\">//分隔符</span></span><br><span class=\"line\">        log.append(request.getRequestURL());<span class=\"comment\">//用户访问的URL地址</span></span><br><span class=\"line\">        log.append(<span class=\"string\">&quot;|&quot;</span>);</span><br><span class=\"line\">        log.append(request.getHeaders(<span class=\"string\">&quot;user-agent&quot;</span>));<span class=\"comment\">//用户浏览器环境</span></span><br><span class=\"line\">        logger.info(log.toString());</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">true</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>◇拦截器配置</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">&lt;mvc:interceptors&gt;</span><br><span class=\"line\">    &lt;mvc:interceptor&gt;</span><br><span class=\"line\">        &lt;mvc:mapping path=<span class=\"string\">&quot;/**&quot;</span>/&gt;</span><br><span class=\"line\">        &lt;mvc:exclude-mapping path=<span class=\"string\">&quot;/resources/**&quot;</span>/&gt;</span><br><span class=\"line\">        &lt;bean <span class=\"class\"><span class=\"keyword\">class</span></span>=<span class=\"string\">&quot;com.lcg.restful.interceptor.AccessHistoryInterceptor&quot;</span>/&gt;</span><br><span class=\"line\">    &lt;/mvc:interceptor&gt;</span><br><span class=\"line\">&lt;/mvc:interceptors&gt;</span><br></pre></td></tr></table></figure>\n<h2 id=\"Spring-MVC处理流程\"><a href=\"#Spring-MVC处理流程\" class=\"headerlink\" title=\"Spring MVC处理流程\"></a>Spring MVC处理流程</h2><p><img src=\"/p/b7ed/1634547937578-4486aad0-b09c-4b1a-b8b1-9d5e1d691805.png\" class=\"lazyload\" data-srcset=\"/p/b7ed/1634547937578-4486aad0-b09c-4b1a-b8b1-9d5e1d691805.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"><br>◇所有请求首先由DispactherServlet进行拦截，然后把请求交由springmvc处理；<br>◇DispactherServlet拦截后的第一步就是查找Handler，Handler也叫处理器，查找Handler的任务由处理器映射器来完成，即通过当前的URL得到执行链；作为HandlerMapper只会获取执行链，而不会对其进行处理；<br>执行链的处理由中央处理器向处理器适配器来发起执行请求，然后由HandlerAdapter根据Handler的类型(可能是一个拦截器或者控制器)去执行对应的方法；执行方法后会返回一个对象(例如MAV)，被HandlerAdapter接收，然后返回给中央处理器；中央处理器会去选择与之对应的视图解析器来进行视图对象的创建，视图会随着处理完返回给中央处理器，当中央处理器拿到对象以后就会将模板和从处理器适配器得到的数据进行渲染，得到最终的html返回给浏览器；</p>\n<h2 id=\"执行链\"><a href=\"#执行链\" class=\"headerlink\" title=\"执行链\"></a>执行链</h2><p><img src=\"/p/b7ed/1634548426067-a5e5abc6-193c-4efd-b36e-b9042a45ee5e.png\" class=\"lazyload\" data-srcset=\"/p/b7ed/1634548426067-a5e5abc6-193c-4efd-b36e-b9042a45ee5e.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"><br>◇如果Handler类型为拦截器，HandlerAdapter首先会执行前置处理方法，之后请求向后送；</p>\n","categories":["Spring","SpringMVC基础"],"tags":["Spring"]},{"title":"分布式基础","url":"/p/38b2.html","content":"<h2 id=\"介绍\"><a href=\"#介绍\" class=\"headerlink\" title=\"介绍\"></a>介绍</h2><ol>\n<li>什么是分布式 </li>\n<li>分布式的作用 </li>\n<li>分布式和单体结构的对比  </li>\n<li>CAP定理 </li>\n<li>集群、分布式、微服务的区别  <h2 id=\"什么是分布式\"><a href=\"#什么是分布式\" class=\"headerlink\" title=\"什么是分布式\"></a>什么是分布式</h2>◇权威定义： 利用物理架构形成多个自治的处理元素，不共享主内存，但是通过发送信息合作。——Leslie Lamport<br>◇饭店厨师的例子；一个顾客(用户)来到饭店(网站服务器)点餐；对于顾客而言，只需要点菜；对于饭店而言，尽可能准确地满足顾客的要求；如上菜时间短(性能好)，菜品卫生(系统安全), 添加调料(系统拓展性好)， 营业时间24小时(系统高可用);这些服务在顾客数量不多的时候能够尽可能满足，所以请了一个厨师(单体系统)来复制洗菜，炒菜等等；但由于顾客数量增多，那么一个厨师忙不过来；所以聘请多个厨师，但厨师的任务任然是洗菜，炒菜等，当顾客多的时候，哪个厨师空闲，就安排那个厨师干活；在计算机中的例子就是集群部署，将一个单体系统部署到不同的服务器上去；但是，这样的话厨师执行的任务多了，无法专注于某一个领域，因此，术业有专攻，根据不同的任务聘请不同的工人：洗菜工，配菜师，炒菜师；<br>◇ 实际项目的演进过程<br>一个项目，大而全<br>多台机器，部属同样的应用，即每台服务器上的代码一样；但实际上这是一种资源的浪费，因为不是每一个系统的使用频率都比较高；<br>分布式：权限系统、员工系统、请假系统  <h2 id=\"分布式的作用\"><a href=\"#分布式的作用\" class=\"headerlink\" title=\"分布式的作用\"></a>分布式的作用</h2><h3 id=\"为什么需要分布式\"><a href=\"#为什么需要分布式\" class=\"headerlink\" title=\"为什么需要分布式\"></a>为什么需要分布式</h3>◇实际工作中的痛点：工程臃肿、测试，上线繁琐、开发效率低；<h3 id=\"单体应用的问题\"><a href=\"#单体应用的问题\" class=\"headerlink\" title=\"单体应用的问题\"></a>单体应用的问题</h3>◇应用代码耦合严重，功能扩展难<br>◇新需求开发交互周期长，测试工作量大<br>◇新加入的开发人员需要很长时间才能熟悉系统<br>◇升级维护也很困难(改动任何一点地方都有升级整个系统)<br>◇系统性能提升艰难，可用性低，不稳定<h3 id=\"分布式的好处\"><a href=\"#分布式的好处\" class=\"headerlink\" title=\"分布式的好处\"></a>分布式的好处</h3>◇增大系统容量<br>◇加强系统可用<br>◇因为模块化，所以系统模块重用度更高<br>◇因为软件服务模块被拆分，开发和发布速度可以并行而变得更快<br>◇系统扩展性更高<br>◇团队协作流程也会得到改善<br>◇技术升级<h2 id=\"分布式和单体结构的对比\"><a href=\"#分布式和单体结构的对比\" class=\"headerlink\" title=\"分布式和单体结构的对比\"></a>分布式和单体结构的对比</h2><img src=\"/p/38b2/1636207103509-c347cb09-8899-4441-90ae-768c30b0d74b.png\" class=\"lazyload\" data-srcset=\"/p/38b2/1636207103509-c347cb09-8899-4441-90ae-768c30b0d74b.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"><br><img src=\"/p/38b2/1636290374648-8b006cf0-5d96-4d77-868b-abdd893c114e.png\" class=\"lazyload\" data-srcset=\"/p/38b2/1636290374648-8b006cf0-5d96-4d77-868b-abdd893c114e.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"><br><img src=\"/p/38b2/1636290406131-35f96600-5400-46f7-beec-7e0e1ed3e619.png\" class=\"lazyload\" data-srcset=\"/p/38b2/1636290406131-35f96600-5400-46f7-beec-7e0e1ed3e619.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"></li>\n</ol>\n<h2 id=\"CAP定理\"><a href=\"#CAP定理\" class=\"headerlink\" title=\"CAP定理\"></a>CAP定理</h2><ol>\n<li>CAP的重要性 </li>\n<li>CAP理论是什么？ </li>\n<li>分区容错  </li>\n<li>一致性 </li>\n<li>可用性 </li>\n<li>CAP怎么选择？<h3 id=\"CAP的重要性\"><a href=\"#CAP的重要性\" class=\"headerlink\" title=\"CAP的重要性\"></a>CAP的重要性</h3>◇是分布式系统设计中最基础最关键的理论；它指明分布式不可能同时满足CAP这三个条件；<h3 id=\"CAP理论是什么\"><a href=\"#CAP理论是什么\" class=\"headerlink\" title=\"CAP理论是什么\"></a>CAP理论是什么</h3>C（Consistency，一致性）：读操作是否总能读到前一个写操作的结果<br>A（Availability，可用性）：非故障节点应该在合理的时间内作出合理的响应（不是错误或超时的响应），但是可能不是最新的数据<br>P（Partition tolerance，分区容错性）：当出现网络分区现象后，系统能够继续“履行职责”， 尽管任意数量的消息被节点间的网络丢失（或延迟），系统仍继续运行。<br>◇三者只能选其二<br><img src=\"/p/38b2/1636290882392-a49df654-3f0b-4672-8bfb-25828c480261.png\" class=\"lazyload\" data-srcset=\"/p/38b2/1636290882392-a49df654-3f0b-4672-8bfb-25828c480261.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"><br>◇分区容错(P)：指结点之间通信可能出错；且分区容错是不可避免的；<br><img src=\"/p/38b2/1636291093494-014f9e3f-9760-476c-be9f-c585bcbe8fb3.png\" class=\"lazyload\" data-srcset=\"/p/38b2/1636291093494-014f9e3f-9760-476c-be9f-c585bcbe8fb3.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"><br>◇一致性(C);一个内容被改变后，第二个人能读到这种改变；<br>如：client(客户)发消息给服务器G1，将v0改为v1;并且G1给client一个返回说明更改成功；<br><img src=\"/p/38b2/1636291535088-d9aa0a2c-0f00-44c2-802c-66d0dac34b27.png\" class=\"lazyload\" data-srcset=\"/p/38b2/1636291535088-d9aa0a2c-0f00-44c2-802c-66d0dac34b27.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"><br>然后client去读取服务器G2的与G1保存的相同参数v的值，如果返回的是v0的话，说明G2与G1不一致，没有达到一致性；<br><img src=\"/p/38b2/1636291664444-c7477db9-ffc2-499e-8fd6-5ad4f8a0eaa9.png\" class=\"lazyload\" data-srcset=\"/p/38b2/1636291664444-c7477db9-ffc2-499e-8fd6-5ad4f8a0eaa9.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"><br>为了让G1和G2保持一致性，他们之间是需要发送消息来保持同步的；<br><img src=\"/p/38b2/1636291888103-328d2f70-7fa7-4918-88a4-135fa042d40d.png\" class=\"lazyload\" data-srcset=\"/p/38b2/1636291888103-328d2f70-7fa7-4918-88a4-135fa042d40d.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"><br>◇可用性(A); 非故障节点应该在合理的时间内作出合理的响应（不是错误或超时的响应)，但是可能不是最新的数据,因为如果一致性不能保证的话就拿不到最新的数据；</li>\n</ol>\n<h3 id=\"CAP怎么选择\"><a href=\"#CAP怎么选择\" class=\"headerlink\" title=\"CAP怎么选择\"></a>CAP怎么选择</h3><p>◇火车票；如果火车票很紧张，抢票的人很多，那这个时候售票系统就需要保持一致性；如果不保持一致性的话，就会导致两个人购买了同一张票；<br>◇银行转账；我们在跨行转账的时候在一致性上可以有延迟，但一定能够成功转账，所以银行转账系统需要保证可用性；<br>◇由于P即分区容错一定存在，所以只能有两种选择：CP或者AP；<br>◇在什么场合，可用性高于一致性？比如一个网站需要更新，可以让一些用户使用老版本，一些用户使用新版本，这种一致性可以慢慢达到，但是必须保证可用性，即用户都能够访问到网站；<br>◇根据具体的业务场景进行选择；</p>\n<h2 id=\"集群、分布式、微服务的区别\"><a href=\"#集群、分布式、微服务的区别\" class=\"headerlink\" title=\"集群、分布式、微服务的区别\"></a>集群、分布式、微服务的区别</h2><h3 id=\"集群和分布式的区别\"><a href=\"#集群和分布式的区别\" class=\"headerlink\" title=\"集群和分布式的区别\"></a>集群和分布式的区别</h3><p>◇集群：同一个业务，部署在多个服务器上<br>◇集群的多个服务器可以没有通信，但分布式不同的服务器之间需要互相通信；<br>◇分布式：一个业务分拆多个子业务，部署在不同的服务器上 </p>\n<h3 id=\"集群和微服务的区别\"><a href=\"#集群和微服务的区别\" class=\"headerlink\" title=\"集群和微服务的区别\"></a>集群和微服务的区别</h3><p>◇集群：分散压力<br>◇微服务：分散能力</p>\n<h3 id=\"分布式和微服务的区别\"><a href=\"#分布式和微服务的区别\" class=\"headerlink\" title=\"分布式和微服务的区别\"></a>分布式和微服务的区别</h3><p>◇分布式是系统部署方式，是物理上的架构<br>◇微服务是架构设计方式，是一种逻辑上的架构<br>◇微服务是一种架构设计方式，把一个大的服务拆分成一个小的服务，每个小的服务只有一个功能，能够独立开发，测试以及部署，服务之间通过通信进行调用；<br>◇微服务是通过分布式实现的；</p>\n","categories":["分布式与微服务"],"tags":["分布式"]},{"title":"【转载】如何成为优秀的程序员","url":"/p/6380.html","content":"<p>​        本文转自:<a href=\"http://www.akaedu.org/pages/news_detail.php?id=294\">http://www.akaedu.org/pages/news_detail.php?id=294</a> </p>\n<p>​        我们的老师每天都要应对报名者和学员提出的很多同样的问题，以下是这类典型问题的汇总：嵌入式行业（或者IT业）有没有前途？我听说编程编到三十五 岁就没人要了，一定要转行找出路是吗？做驱动开发和做应用开发哪个更有前途？我一开始看什么书都看不懂，怎么才能理出一个学习顺序？诸如此类。这使我迫切 地感觉到，应该总结这样一份非具体技术问题的FAQ了。本文仅代表我个人观点，有问题欢迎Email: <a href=\"mailto:songjinshan@akaedu.org\">songjinshan@akaedu.org</a>。</p>\n<p>​        在看这份FAQ之前，你必须先读完ESR的《如何成为一名黑客》（本文末尾附有中译版），该文所讲过的道理我不再重复。该文用很大的篇幅讲什么是黑客文 化，虽然态度和信仰的确是成功的最关键因素，但是你肯定会想，做不做黑客跟我没关系，我只是想学个一技之长，找个好工作而已，对吧？那么肯定更希望获得一 些具体的可操作的指导。</p>\n<h4 id=\"1、各种软件技术之间是怎样的关系？\"><a href=\"#1、各种软件技术之间是怎样的关系？\" class=\"headerlink\" title=\"1、各种软件技术之间是怎样的关系？\"></a>1、各种软件技术之间是怎样的关系？</h4><p>  我把软件技术分为三个层次：<br>        <strong>问题域</strong>：计算机图形学、音视频编码、信息安全、模式识别、信息检索、自然语言分析、人工智能、科学计算等；<br>        <strong>系统集成</strong>：C++和Java等面向对象语言、Python等解释型语言、LISP等函数式编程语言、GUI、中间件、编译器与解释器、虚拟机、数据库、网络服务、并行计算、集群、Peer2Peer、系统管理等；</p>\n<p><strong>系统功能</strong>：硬件描述语言、计算机体系结构与编程模型、指令集与汇编语言、C语言、内核、文件系统、设备驱动、网络协议、POSIX等。</p>\n<p>​        计算机最终是做什么用的呢？最终是通过问题域的各种技术为用户解决问题的，这些技术都包含很高深的算法，然而它们必须在一个平台上运行，它们需要利用平台 提供的各种基础设施，比如计算能力、I/O能力和网络互联能力。系统功能和系统集成层就是用来实现这个平台的。系统功能层实现计算、I/O和网络的基本功 能，系统集成层对这些基本功能做一些抽象和包装，提供更方便灵活的接口。</p>\n<h4 id=\"2、为什么要学习嵌入式技术？\"><a href=\"#2、为什么要学习嵌入式技术？\" class=\"headerlink\" title=\"2、为什么要学习嵌入式技术？\"></a>2、为什么要学习嵌入式技术？</h4><p>​        在亚嵌的学习期间，你将详细了解系统功能层的各部分是如何工作的，也会在面向对象编程、GUI、数据库、网络服务等系统集成层的技术方向进行探索。嵌入式 系统可说是麻雀虽小五脏俱全，虽然没有PC和服务器那么复杂，但计算机系统的各种组成一样也不缺。因此，以嵌入式系统作为切入点开始学习软件技术是非常好 的选择，避开不必要的复杂性，把握计算机系统最根本的概念和技术要点。打下扎实的基础之后，你的职业发展则完全不必局限于嵌入式领域，即使你日后做PC或 服务器开发，在亚嵌所学的知识和技能同样使你终生受益。正如庖丁解牛，心中有全牛，自然就能游刃有余。</p>\n<p>​        另一方面，你一定见到各大网站都有大量的宣传，说现在嵌入式行业前景空前的好，嵌入式人才紧缺，有几百万职位空缺等等。这些说法也是对的，但我们需要更深 入地理解这说明了什么问题。刚才我们说，嵌入式系统也是一个完整的计算机系统，和PC或服务器没有本质的区别，事实上，嵌入式、PC和服务器的界限已经越 来越模糊了。以前的嵌入式就是单片机，只能做简单的运算处理，现在的ARM处理器性能比从前的奔腾还强，打游戏、看电影都没问题，谁能说它不是PC呢？另 外有些专用的嵌入式系统已经在充当服务器的功能了，而集群技术更是可以使许多廉价的处理器组合在一起发挥大型服务器的作用。由于嵌入式越来越多地应用到电 器、汽车和各种设施上，无处不在，并且与PC、服务器呈融合的趋势，所以嵌入式行业前景空前的好。</p>\n<p>​        那么，为什么说嵌入式人才紧缺呢？其实，学嵌入式系统就是学计算机系统，本质上并没有什么特殊的只有嵌入式系统才有的技术。说嵌入式人才紧缺，其实质上是 说真正懂计算机的人才紧缺。现在很多学校的所谓“软件学院”培养的软件人才都是一叶障目不见泰山的：只懂J2EE和.NET，没学过C和汇编；只会调库函 数sort()，而对各种排序算法一无所知；设计模式、软件工程讲得头头是道，却不知道好的软件还是要靠牛人靠智商来做的。培养人像蒸包子一样一屉一屉地 出，靠软件工程搭一条生产线，然后让熟练工人站在生产线上拧螺丝，幻想着这样就能生产出好的软件，那是把软件工程和程序员的作用本末倒置了。现在嵌入式开 发对程序员的素质要求更高了，以上这类“软件人才”不能胜任了，因此说嵌入式人才紧缺。亚嵌的就业班虽然只有几个月，但培养目标是有完整的计算机系统概念 的软件人才，而不是只会拧螺丝的软件工人，这正得益于我们始终坚持做嵌入式培训而不是Java或.NET培训。</p>\n<h4 id=\"3、有人说软件技术变化太快，现在学的东西过两年就要完全淘汰，是吗？\"><a href=\"#3、有人说软件技术变化太快，现在学的东西过两年就要完全淘汰，是吗？\" class=\"headerlink\" title=\"3、有人说软件技术变化太快，现在学的东西过两年就要完全淘汰，是吗？\"></a>3、有人说软件技术变化太快，现在学的东西过两年就要完全淘汰，是吗？</h4><p>​        你知道这话是什么人说的吗？必然是已经被淘汰的人说的。比如Delphi、BCB、PB这些开发工具和语言，都曾经很是风光了一阵，但现在已经完全被 Java和.NET取代了。那么Java和.NET会不会被取代呢，也许在相当长的时间内还不会，但是我看好Python。</p>\n<p>​        这些被淘汰的程序员有一些共同的特点：只会用鼠标拖拽控件，离开IDE就不知道如何工作，学点儿花拳绣腿的功夫就想吃一辈子，对学习新技术不感兴趣，做一 天和尚撞一天钟。现在请回头看看FAQ1，在整个软件技术领域，这些变化快的技术其实只占了很小的一块，却成了这些人的全部看家本领，这样的人能不被淘汰 吗？</p>\n<p>​        与这些流行的开发工具和语言相反，很多技术和思想是很少变化的。比如，POSIX和SUS标准规定了一套系统函数接口和基本命令的语义，只有实现了这些才 可以称作UNIX，因此今天的Linux、Solaris跟20多年前的UNIX在系统功能层上是基本一致的。而指导计算机科学发展的数学理论，甚至是老 祖宗们在计算机还没诞生的年代就替我们想好的：布尔代数发表于19世纪，直到一个世纪后发明了计算机和数字电路才有了用武之地；数论在17世纪就出现了， 一直都被数学家们当成一套好玩的理论，但只是好玩而已，直到计算机密码学诞生后才发现它的实际用处。</p>\n<p>​        各种流行的开发工具和高级语言虽然变化很快，但是底层的编程语言却非常稳定，各种操作系统的内核都是用C语言写的，以前是这样，以后也不会改变。另一方 面，各种编程语言的设计思想也是非常稳定的。其实世界上只有两种编程语言，一种是C，一种是LISP，前者是imperative的，是对计算机模型的抽 象，后者是functional的，是对数学函数模型的抽象。面向对象是一种重要的软件工程思想，却算不上一种新的语言模型，应该归在C的一类。属于同一 类的各种语言其实都大同小异，一个精通C++的人学习Java需要多长时间？熟悉语法一个星期，熟悉类库三个星期，一个月足矣，以往的经验都可以套到新的 编程语言上。然而要想习得深厚的算法功底、逻辑思维和抽象思维修养，能够真正说清楚“系统”是什么，如何分析和设计“系统”，需要多长时间？恐怕要数十 年。</p>\n<h4 id=\"4、C和Java哪种语言更好？\"><a href=\"#4、C和Java哪种语言更好？\" class=\"headerlink\" title=\"4、C和Java哪种语言更好？\"></a>4、C和Java哪种语言更好？</h4><p>​        计算机科学与编程语言无关，甚至与计算机本身也没太大关系，它研究的对象并不是计算机，而是人分析问题解决问题的方法论。程序写出来最主要不是为了给计算 机执行的，而是为了给人看的，使用编程语言和使用自然语言一样是为了表达和交流，只不过程序还可以顺便给计算机执行而已。</p>\n<p>​        以上这些话并不是我说的，而是一位著名的计算机科学家说的。所以，在编程语言的层面上争论是没有意义的。很多初学者错误地认为掌握了编程语言就等于学会了 计算机，一种编程语言都还没有掌握好，更没有上升到方法论的层面，只有这种无知的人才会去争论哪种语言好的问题。掌握了编程语言远远不等于学会了计算机， 而只是最开始的一步，最简单的一步，到了工作中，用到什么语言就去学什么语言，什么语言过时了就丢掉，编程语言不需要积累因为它太简单了，真正需要积累的 是方法论。</p>\n<p>​        很多人喜欢参与到这类争论之中，毫无例外，每个人都在为自己熟练掌握的编程语言辩护，就是“我会的语言最好，我不会的语言都不好”，其实这些人真正想说的 是“我会的语言最好是千秋万代，我就不必学新的语言，不必适应新的变化了”，概括起来说就是一个字，懒。真正的高手都是会很多编程语言的，国外有些做技术 咨询的，每年都要学好几门新的编程语言，这样才能应对市场的变化。不断丢掉旧的编程语言学习新的，看起来好像完全是白费力气，没有积累，其实，每种编程语 言的设计都有独到之处，体现了每种语言的精髓，在融汇百家之后积累下来的正是方法论。</p>\n<p>​       争论哪种语言能做的事情更多、功能更强是没有意义的。从理论上说，任何一种符合图灵机模型的编程语言，加上适当的I/O扩展都可以做任何事情，用 shell脚本也可以写出很像样的游戏来。只不过各种语言的设计目标不同，表达能力不同，做不同的事情所需的代码量不同而已。</p>\n<p>​        另外一种错误认识是：哪种语言的市场最大，开发人员最多，哪种语言就最好。单从这种意义上说，Java的确比C更好，所以往届有学员问我们为什么只教C语 言。请你注意，操作系统内核是用C写的，各种底层的应用程序包括Java虚拟机也是用C写的。如果你想学Java，在亚嵌的学习完成后你将有能力分析 Java虚拟机的实现，站在计算机系统的高度来学Java才会使你成为真正的Java高手。如果你只想速成，想早点学成一门技术去做拧螺丝的工作，那么亚嵌不适合你。</p>\n<p>​       在FAQ3里说过，世界上有C和LISP两种编程语言，你现在学了C，以后学了C++、Java、.NET等等，也仍然只认识了半个世界。LISP和 Haskell构成了另外半个世界，现在很常见的Python和JavaScript等解释型语言也借用了functional programming的思想。如果你只管闷着头写代码，而不去广泛涉猎，那么你将错过很多精彩。</p>\n<h4 id=\"5、我听说编程编到三十五岁就没人要了一定要转行找出路是吗？\"><a href=\"#5、我听说编程编到三十五岁就没人要了一定要转行找出路是吗？\" class=\"headerlink\" title=\"5、我听说编程编到三十五岁就没人要了一定要转行找出路是吗？\"></a>5、我听说编程编到三十五岁就没人要了一定要转行找出路是吗？</h4><p>​      这个观点虽然很流行，但根本不值一驳。现在三十五岁转行的那些人，都具有前面所说的那些特征，对学习新技术不感兴趣，对探索计算机的本质不感兴趣，得过且 过，下了班就是打游戏、看电视，总之就是懒。如果是开出租、摆摊，勤快人懒人都有饭吃，而IT这一行对懒人是非常无情的，懒人就不该入IT这一行，不从自 身找原因，却到处散布这种言论，怪社会不好，打击新人的信心，着实可恨。</p>\n<p>​       另外一种情况，编程编到三十五岁，进入公司的管理层，或者自己创业，这都是很勤快的人，如果他们把这种勤快用在技术上肯定也可以做得更好，所以也无法证明编程编到三十五岁会因为没有出路而转行。</p>\n<p>​       编程不是个体力活，需要高强度的思考和智力投入，分析能力、思考能力都需要时间积累起来，所以并不是越年轻干得越好。相反，我认为三十岁以前写的代码都是 垃圾，三十岁以后才能写出像样的程序来。如果希望一辈子走技术的道路而不会被迫转行，就要不断地把自己的工作性质从“体力活”变成“脑力活”。什么叫“不 断地”变呢？这里的“体力活”并不是指种地、盖房子这种劳动，而是指简单重复地编写代码，这时你会感觉，派给你的工作都能凭以往的经验轻松应付了，但是千 万不要满足于现状，就像温水煮青蛙一样，这是危险的处境！要摆脱这种处境就需要学习、思考、提高，让公司派给你更有挑战性的工作，在工作中应用新学到的知 识和技术就是“脑力活”了，但是用得久了又会变成简单重复的“体力活”，这时就需要再学习、再提高，所以叫做“不断地”把自己的工作性质从“体力活”变成 “脑力活”。如果有一天你发现，自己长期陷于简单重复的劳动之中，并且业余时间非常少，无法学习提高，这说明公司不会用人，你就该考虑跳糟了。</p>\n<p>​       从另外一个角度来说，如果希望一辈子走技术的道路，就要有自己的核心竞争力，这个核心竞争力决不是凭以往的经验能够做某些工作的能力，而是学习能力、思考 能力和解决有挑战性的新问题的潜力。在IT这一行，凭借以往的经验干重复的活是干不长久的，原因很简单，一个问题不会被解决两次，当你发现你的经验能够解 决一类问题时，别人早把解决这一类问题的套路编写成framework，新上手的人即使不具备你的这些经验也可以调用framework中的类和函数来解 决问题，然后在这个framework的基础上积累新的经验解决新的问题。正因为如此，全世界开发人员的经验才会积累起来，促使软件技术发展得如此迅速。 这并不是说经验完全没有用，最关键的，学习和思考也是建立在以往经验的基础之上的。另一方面，现有的framework并不一定是某方面开发经验的完美整 合，也需要不断发展，用新的办法重新解决老问题，以Web开发为例，从早期的ASP、PHP到后来的.NET、J2EE，到现在的Ruby on Rails、Django等等，这些framework解决的是同一问题，就是如何快速有效地开发Web应用，这方面的经验被不断重新整合，推陈出新。总 结一下，什么才是核心竞争力呢？应该是在经验的基础上学习新技术、解决新问题的能力。</p>\n<h4 id=\"6、做驱动开发还是做应用开发更有前途？\"><a href=\"#6、做驱动开发还是做应用开发更有前途？\" class=\"headerlink\" title=\"6、做驱动开发还是做应用开发更有前途？\"></a>6、做驱动开发还是做应用开发更有前途？</h4><p>​       意思就是说，“你告诉我哪个更有前途，我就好好学哪个，另外一个就不用学了”。问这种问题的学员往往会同时问另外一些问题：我以后就想做驱动开发，你教我这些应用开发的技术有什么用？C++用得多吗？学了有什么用？我以后不想做GUI，你教我Qt有什么用？</p>\n<p>​        学习最忌讳的就是“有用的就学，没有用的就不学”这种功利的态度。两个问题：第一，在你还没学进去、还不了解这种技术时，要如何判断这种技术学了有没有 用？只能是根据道听途说，看各种论坛上都怎么说的，岂不知论坛上参与这种讨论的100%都是菜鸟，有的水平还不如你。第二，就算你学的技术没有用上，有什 么损失吗？从亚嵌毕业的学员从事各种各样的开发工作，有做驱动的，有做系统编程的，有做GUI的，有做Web开发的，只要确定了做一类工作，就不可能把在 亚嵌四个月学的知识都用上，但至少也用得上3/4的知识，假设剩下的1/4你一辈子也没机会用上了，那也就损失你一个月的学习时间而已，相比于你的收获， 这算是很大的损失吗？请注意，上面的假设是不成立的，没用上的那1/4也只是暂时没用上而已，程序员要换工作或者换项目是很常见的，任何人都不可能只涉及 一类开发工作，只要有扎实的基础、完备的知识体系，任何工作都能轻松上手。</p>\n<p>​        扎实的基础，完备的知识体系，我们在安排就业班课程体系的时候，正是以这两点为依据的。有的课程内容很少有学员在以后工作中会用到，但是缺了这一环就不成 为一个完备的知识体系，例如MMU和Cache，那这种课该不该上呢？毫无疑问该上。有的课程培养一种基本的编程思想，例如通过C++来讲面向对象编程， 通过Qt来讲面向对象、事件驱动和状态机编程，这些编程思想是程序员必备的基本素质，而C++和Qt可能有些学员以后工作用不到，那这种课该不该上呢？毫 无疑问该上。至于还有些人争论说C++不如Java用得多，Qt不如GTK用得多，请翻回去看FAQ4，这种争论是无意义的，有工夫争论谁优谁劣，不如把 两种都学了，会更有收获。</p>\n<p>​        回到做驱动开发还是做应用开发更有前途的问题。我只能说，做好了都有前途，做不好都没有前途，只会做一样而完全不懂另一样是最没前途的。不要以为内核开发 者就不写应用程序，Linus写了一个源代码管理系统git来维护内核，因为觉得现有的源代码管理系统都不好用。牛人都是这样，需要什么就写什么，才不管 是kernel space还是user space。同样，做应用开发如果不懂内核，也没有办法很好地利用内核提供的服务写出性能最优的程序。做内核难，因为调试难，要跟踪大量的并发线程，因为 入门难，要写一个hello world都需要学很多知识。做应用也难，回头去看FAQ1，计算机科学从理论到实践大部分都在上面两层做文章。所以不存在哪个更难哪个更有前途的问题， 任何关于哪个更难的讨论都是too naive的。</p>\n<h4 id=\"7、我一开始看什么书都看不懂，怎么才能理出一个学习顺序？\"><a href=\"#7、我一开始看什么书都看不懂，怎么才能理出一个学习顺序？\" class=\"headerlink\" title=\"7、我一开始看什么书都看不懂，怎么才能理出一个学习顺序？\"></a>7、我一开始看什么书都看不懂，怎么才能理出一个学习顺序？</h4><p>​       以前有个学员在学C语言时说，“C语言很多地方都很奇怪，都得用内核的知识去解释，可是你又不先教我内核，我没法学C语言。我只好自己看操作系统的书，看 内核代码，可是看不懂。”当然看不懂了，内核代码都是用C写的，如果不学内核就没法学C语言，那不学C语言又怎么可能看懂内核？看来这是一个鸡生蛋还是蛋 生鸡的问题。</p>\n<p>​        懒真的是人的本性，就连学习的过程都希望是一条路顺利地走下去，不用动脑就能学会的：身后走过的路都是“已知”，每走一步就把眼前新的“未知”变成“已 知”，如此一路走来，把所有的“未知”都变成“已知”就算学成了。可惜，知识不是一条路，而是一个圈，你从任何一个地方跳进这个圈开始走，身后都是“未 知”，眼前也都是“未知”。有的人就是不能容忍自己的身后是“未知”：看一本书，一个新的概念A是用我不了解的概念B、C来解释的，我连B、C都不懂怎么 学A？没法学了！</p>\n<p>  不是人家书写得不好，而是没有任何办法能把一个圈扯成一条直线的。学习的过程本质上就是一个循环往复的过程，唯一的办法就是“存疑”：在本子上记着，有 B、C这样两个概念是我暂时不理解的，然后就不再去想这回事，而是相信自己已经理解了B、C，基于自己的理解和假设去学习A，由A再去理解X、Y，这样学 下去，走完一圈之后再回来，自然就明白当初对B、C的假设正确不正确了，理解了这两个概念，就从本子上划掉，这时需要再走一圈，把原来的一些错误认识纠正 过来。所以，任何书都要至少看两遍，第二遍看的时候你会对很多概念有新的认识，因为你看过这个概念后面的章节，在此基础上产生了新的认识。古人早就明白这 个道理，所以提出了“温故而知新”。</p>\n<p>​        亚嵌的课程体系经过多年教学实践的锤炼，已经很好地理顺了知识之间的关系，使你从最佳的位置跳进这个圈开始学习，所谓“最佳位置”是指，在你初学的时候需 要容忍的“未知”尽可能少，需要做的假设尽可能少，但要想消除所有的“未知”是不可能的，例如没有学内核就要学C语言。根据你以往的经验和一些运气因素， 你对内核的一些假设可能正确也可能错误，但这并不影响你学C语言，对内核的一些错误假设可能会导致在学C语言的过程中有些误解，但没关系，只要跟着我们的 课程体系一步一步走下来，这些误解和错误的假设最终都会纠正过来。</p>\n<h4 id=\"8、有哪些好书可以推荐一下吗？\"><a href=\"#8、有哪些好书可以推荐一下吗？\" class=\"headerlink\" title=\"8、有哪些好书可以推荐一下吗？\"></a>8、有哪些好书可以推荐一下吗？</h4><p>​        能问出这个问题的都是聪明的学员。看书学习是入门过程中非常重要的一环，如果用一本烂书入门，浪费时间还是小事，如果被误导了就麻烦了，如果形成的错误认 识不能及时纠正，变得根深蒂固了就更麻烦了。所以，看书一定要有“品牌意识”，在决定看书学习一门技术时先问问这一领域最权威的书是哪本，这里列举一些 Bible级别的书：<br>  <em>T</em>he C Programming Language, 2nd Edition；*<br>  <em>C++ Primer, 4th Edition；</em><br>  <em>Structure and Interpretation of Computer Programs, 2nd Edition；</em><br>  <em>Introduction to Algorithms, 2nd Edition；</em><br>  <em>Compilers: Principles, Techniques, and Tools；</em><br>  <em>Advanced Programming in the UNIX Environment, 2nd Edition；</em><br>  <em>TCP/IP Illustrated, Volume 1: The Protocols；</em><br>  <em>UNIX Network Programming Volume 1, 3rd Edition: The Sockets Networking API；</em><br>  <em>Understanding the Linux Kernel, 3rd Edition；</em><br>  Linux Device Drivers, 3rd Edition。*</p>\n<p>  在学习过程中，眼界一定要开阔，不要学到一点东西就沾沾自喜，坐井观天，以为这就是技术的全部。要多和别人交流，多了解别人在看什么书、别人对技术的认识是怎样的。书是看不完的，活到老学到老，对于程序员来说尤其如此。</p>\n<h4 id=\"9、如何处理打游戏和学习的关系？\"><a href=\"#9、如何处理打游戏和学习的关系？\" class=\"headerlink\" title=\"9、如何处理打游戏和学习的关系？\"></a>9、如何处理打游戏和学习的关系？</h4><p>​        ESR的文章中也说过，黑客们都有一些特别的业余爱好，并且往往是非理性思维的爱好，大概是需要换换脑子吧。典型的例子是因滑翔机事故去世的 Stevens，他写了FAQ8所推荐的Bible当中的三本。爱打游戏的优秀程序员肯定大有人在，有一些还成了优秀的游戏开发人员。但是我认为，要想成 为优秀的程序员，必须有两点基本素质，一是对编程非常感兴趣，二是对所有别的事情都不感兴趣，或者都不如对编程感兴趣。有人说，人的一天有24小时，8小时休息，8小时上班，另外的8小时在干什么就决定了你以后有多大发展。一有时间就看书学习，这就是一个程序员应该做的。今天打游戏，明天看电影，后天炒股，那么你就等着三十五岁下岗。如果你不能够认同编程和思考是比其它事情更有吸引力的，那么你不必学编程，集中精力去做最喜欢的事情或许会有更大的成就。</p>\n","categories":["杂谈"],"tags":["程序员"]},{"title":"工厂模式","url":"/p/177d.html","content":"<h2 id=\"课程介绍\"><a href=\"#课程介绍\" class=\"headerlink\" title=\"课程介绍\"></a>课程介绍</h2><p>◇ 介绍工厂模式的用途与特点<br>◇ 介绍设计模式<br>◇ 掌握工厂模式的项目应用  </p>\n<h2 id=\"设计模式\"><a href=\"#设计模式\" class=\"headerlink\" title=\"设计模式\"></a>设计模式</h2><p>◇ 设计模式是前辈总结的设计经验<br>◇ 设计模式的目标是代码更容易理解,更容易维护<br>◇ 通过设计模式可以让代码更加可靠  </p>\n<h2 id=\"设计模式的分类\"><a href=\"#设计模式的分类\" class=\"headerlink\" title=\"设计模式的分类\"></a>设计模式的分类</h2><p>◇ 创建型模式<br>◇ 结构型模式<br>◇ 行为型模式 </p>\n<h2 id=\"工厂模式\"><a href=\"#工厂模式\" class=\"headerlink\" title=\"工厂模式\"></a>工厂模式</h2><p>◇ 工厂模式用于隐藏创建对象的细节<br>◇ 工厂模式核心:工厂类(Factory)<br>◇ 工厂模式可细分为简单工厂、工厂方法与抽象工厂  </p>\n<h2 id=\"简单工厂\"><a href=\"#简单工厂\" class=\"headerlink\" title=\"简单工厂\"></a>简单工厂</h2><p><img src=\"/p/177d/1627975803385-c3f9255b-05f0-4a31-874c-4b893aaf5838.png\" class=\"lazyload\" data-srcset=\"/p/177d/1627975803385-c3f9255b-05f0-4a31-874c-4b893aaf5838.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"></p>\n<h2 id=\"项目应用-i18n国际化\"><a href=\"#项目应用-i18n国际化\" class=\"headerlink\" title=\"项目应用-i18n国际化\"></a>项目应用-i18n国际化</h2><p>◇工程结构<br><img src=\"/p/177d/1627977675883-ad7ab257-f14f-42ad-aafe-390fd88d3ca1.png\" class=\"lazyload\" data-srcset=\"/p/177d/1627977675883-ad7ab257-f14f-42ad-aafe-390fd88d3ca1.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"><br>◇软件类</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Software</span> </span>&#123;</span><br><span class=\"line\">   <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> </span>&#123;</span><br><span class=\"line\">\t   I18N i18n = I18NFactory.geI18NObject(<span class=\"string\">&quot;China&quot;</span>);<span class=\"comment\">//静态的，不需要new，直接调用方法即可</span></span><br><span class=\"line\">\t   System.out.println(i18n.getTitle());</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>◇国际化工厂类</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">I18NFactory</span> </span>&#123;</span><br><span class=\"line\">   <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> I18N <span class=\"title\">geI18NObject</span><span class=\"params\">(String area)</span> </span>&#123;<span class=\"comment\">//静态工厂</span></span><br><span class=\"line\">\t   <span class=\"keyword\">if</span>(area.equals(<span class=\"string\">&quot;China&quot;</span>)) &#123;</span><br><span class=\"line\">\t\t   <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> Chinese();</span><br><span class=\"line\">\t   &#125;<span class=\"keyword\">else</span> <span class=\"keyword\">if</span>(area.equals(<span class=\"string\">&quot;UK&quot;</span>)) &#123;</span><br><span class=\"line\">\t\t   <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> English();</span><br><span class=\"line\">\t   &#125;<span class=\"keyword\">else</span> <span class=\"keyword\">if</span>(area.equals(<span class=\"string\">&quot;Japan&quot;</span>)) &#123;</span><br><span class=\"line\">\t\t   <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> Japanese();</span><br><span class=\"line\">\t   &#125;<span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\t   <span class=\"keyword\">return</span> <span class=\"keyword\">null</span>;</span><br><span class=\"line\">\t   &#125;</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>◇语言类</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Chinese</span> <span class=\"keyword\">implements</span> <span class=\"title\">I18N</span> </span>&#123;</span><br><span class=\"line\">   <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">getTitle</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">\t   <span class=\"keyword\">return</span> <span class=\"string\">&quot;这是中文&quot;</span>;</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>◇接口</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">interface</span> <span class=\"title\">I18N</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">getTitle</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>◇面向接口的开发</p>\n<h2 id=\"项目应用-多端应用切换\"><a href=\"#项目应用-多端应用切换\" class=\"headerlink\" title=\"项目应用-多端应用切换\"></a>项目应用-多端应用切换</h2><p>◇工程目录<br><img src=\"/p/177d/1627993810721-d64e385b-e0f7-4dd9-ab02-1b4bc564436e.png\" class=\"lazyload\" data-srcset=\"/p/177d/1627993810721-d64e385b-e0f7-4dd9-ab02-1b4bc564436e.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"><br>◇工厂类</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">DeviceFactory</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> Device <span class=\"title\">getDevice</span><span class=\"params\">(HttpServletRequest req)</span> </span>&#123;</span><br><span class=\"line\">\t  String userAgent=req.getHeader(<span class=\"string\">&quot;user-agent&quot;</span>);</span><br><span class=\"line\">\t  System.out.println(userAgent);</span><br><span class=\"line\">\t  <span class=\"keyword\">if</span>(userAgent.indexOf(<span class=\"string\">&quot;Windows NT&quot;</span>)!=-<span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">\t\t  <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> DesktopDevice();</span><br><span class=\"line\">\t  &#125;<span class=\"keyword\">else</span> <span class=\"keyword\">if</span>(userAgent.indexOf(<span class=\"string\">&quot;iPhone&quot;</span>)!=-<span class=\"number\">1</span> || userAgent.indexOf(<span class=\"string\">&quot;Android&quot;</span>)!=-<span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">\t\t  <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> MobileDevice();</span><br><span class=\"line\">\t  &#125;<span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\t  <span class=\"keyword\">return</span> <span class=\"keyword\">null</span>;</span><br><span class=\"line\">\t  &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n","categories":["Java数据库","框架前置知识"]},{"title":"删除功能出现的BUG","url":"/p/de80.html","content":"<h3 id=\"功能简介\"><a href=\"#功能简介\" class=\"headerlink\" title=\"功能简介\"></a>功能简介</h3><p>​        开发一个删除油画功能模块，要求能够在前台中点击某一油画进行删除后，弹出对话框进行确认删除，若确认则发送ajax请求到后台，然后后台根据发送过来的id进行相应的删除，并且使用json对象返回处理的结果；</p>\n<h3 id=\"实现思路\"><a href=\"#实现思路\" class=\"headerlink\" title=\"实现思路\"></a>实现思路</h3><p>​        对于底层的数据删除，使用dom4j进行对xml的删除操作；首先根据id筛选出指定的节点p；然后根据此节点获取到其父节点，使用父节点的remove方法来删除此节点；代码如下：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//得到P的根节点然后用根节点删去P;</span></span><br><span class=\"line\">p.getParent().remove(p);</span><br></pre></td></tr></table></figure>\n\n<p>​        然后就是根据MVC的调用要求，依次创建Dao、Service、Controller中的方法；在Controller方法中进行与前台的交互即可；</p>\n<h3 id=\"出现的BUG\"><a href=\"#出现的BUG\" class=\"headerlink\" title=\"出现的BUG\"></a>出现的BUG</h3><p>​        当在前台页面点击删除油画后，发现删除成功，然后不刷新页面。再次删除此油画，这幅油画实际上已经被删除了，所以根据后台的逻辑，应该会删除失败，并提示该油画已经被删除或者不存在；但是前台确提示删除成功，按F12查看浏览器控制台打印的json对象如下:</p>\n<p><img src=\"https://s2.loli.net/2021/12/09/oAaKdbu2tNm4iYP.png\" class=\"lazyload\" data-srcset=\"https://s2.loli.net/2021/12/09/oAaKdbu2tNm4iYP.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"console.png\"></p>\n<p>这说明在控制器中根本没有执行catch块里的代码，而是执行了try里的代码，<wavy>没有捕捉到</wavy>XmlDataSource中抛出的异常；后端控制台打印的信息如下：</p>\n<figure class=\"highlight tex\"><table><tr><td class=\"code\"><pre><span class=\"line\">获取ajax请求发送过来的id为:16</span><br><span class=\"line\">/F:/JAVA/Tomcat/apache-tomcat-8.5.34/webapps/mgallery/WEB-INF/classes/painting.xml</span><br><span class=\"line\">java.lang.RuntimeException: 编号为16的油画不存在或已删除</span><br><span class=\"line\">\tat com.lcg.mgallery.utils.XmlDataSource.delete(XmlDataSource.java:186)</span><br><span class=\"line\">\tat com.lcg.mgallery.dao.PaintingDao.delete(PaintingDao.java:68)</span><br><span class=\"line\">\tat com.lcg.mgallery.service.PaintingService.delete(PaintingService.java:69)</span><br><span class=\"line\">\tat com.lcg.mgallery.controller.ManagementController.delete(ManagementController.java:247)</span><br><span class=\"line\">\tat com.lcg.mgallery.controller.ManagementController.doGet(ManagementController.java:64)</span><br><span class=\"line\">\tat com.lcg.mgallery.controller.ManagementController.doPost(ManagementController.java:73)</span><br><span class=\"line\">\tat javax.servlet.http.HttpServlet.service(HttpServlet.java:661)</span><br><span class=\"line\">\tat javax.servlet.http.HttpServlet.service(HttpServlet.java:742)</span><br><span class=\"line\">\tat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:231)</span><br><span class=\"line\">\tat org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)</span><br><span class=\"line\">\tat org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:52)</span><br><span class=\"line\">\tat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)</span><br><span class=\"line\">\tat org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)</span><br><span class=\"line\">\tat org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:198)</span><br><span class=\"line\">\tat org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:96)</span><br><span class=\"line\">\tat org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:493)</span><br><span class=\"line\">\tat org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:140)</span><br><span class=\"line\">\tat org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:81)</span><br><span class=\"line\">\tat org.apache.catalina.valves.AbstractAccessLogValve.invoke(AbstractAccessLogValve.java:650)</span><br><span class=\"line\">\tat org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:87)</span><br><span class=\"line\">\tat org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:342)</span><br><span class=\"line\">\tat org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:800)</span><br><span class=\"line\">\tat org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:66)</span><br><span class=\"line\">\tat org.apache.coyote.AbstractProtocol<span class=\"built_in\">$</span>ConnectionHandler.process(AbstractProtocol.java:806)</span><br><span class=\"line\">\tat org.apache.tomcat.util.net.NioEndpoint<span class=\"built_in\">$</span>SocketProcessor.doRun(NioEndpoint.java:1498)</span><br><span class=\"line\">\tat org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:49)</span><br><span class=\"line\">\tat java.util.concurrent.ThreadPoolExecutor.runWorker(Unknown Source)</span><br><span class=\"line\">\tat java.util.concurrent.ThreadPoolExecutor<span class=\"built_in\">$</span>Worker.run(Unknown Source)</span><br><span class=\"line\">\tat org.apache.tomcat.util.threads.TaskThread<span class=\"built_in\">$</span>WrappingRunnable.run(TaskThread.java:61)</span><br><span class=\"line\">\tat java.lang.Thread.run(Unknown Source)</span><br><span class=\"line\">/F:/JAVA/Tomcat/apache-tomcat-8.5.34/webapps/mgallery/WEB-INF/classes/painting.xml</span><br><span class=\"line\">成功执行了删除的操作</span><br></pre></td></tr></table></figure>\n\n<p>​        可以发现确实出现了异常，但出现异常后却仍然打印出”成功执行了删除的操作”；这是什么原因呢？<strong>为什么在控制器的方法中无法捕捉到XmlDataSource中抛出的异常？</strong>我们来分析一下后台的代码；</p>\n<p>对Xml文件进行直接操作的XmlDataSource类中的删除方法代码如下：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">delete</span><span class=\"params\">(Integer id)</span> </span>&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">\t\t\tdocument = reader.read(dataFile);</span><br><span class=\"line\">\t\t\tList&lt;Node&gt; nodes = document.selectNodes(<span class=\"string\">&quot;/root/painting[@id=&quot;</span> + id + <span class=\"string\">&quot;]&quot;</span>);</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span>(nodes.size() == <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> RuntimeException(<span class=\"string\">&quot;编号为&quot;</span> + id + <span class=\"string\">&quot;的油画不存在或已删除&quot;</span>);</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">             <span class=\"comment\">//省略执行删除操作代码..</span></span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"comment\">// TODO Auto-generated catch block</span></span><br><span class=\"line\">\t\t\te.printStackTrace();</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> RuntimeException(<span class=\"string\">&quot;编号为&quot;</span> + id + <span class=\"string\">&quot;的油画不存在或已删除&quot;</span>);</span><br><span class=\"line\">\t\t&#125;<span class=\"keyword\">finally</span> &#123;</span><br><span class=\"line\">            <span class=\"comment\">//...部分代码</span></span><br><span class=\"line\">\t\t\treload();</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br></pre></td></tr></table></figure>\n\n<p>​        控制器中的删除方法代码如下(控制器中调用的是Service中的delete方法，按照MVC的架构模式会<u>逐级调用</u>到XmlDataSource中的方法)</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//删除油画</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">delete</span><span class=\"params\">(HttpServletRequest request,HttpServletResponse response)</span> <span class=\"keyword\">throws</span> IOException </span>&#123;</span><br><span class=\"line\">    String id = request.getParameter(<span class=\"string\">&quot;id&quot;</span>);<span class=\"comment\">//获取ajax请求发送过来的参数</span></span><br><span class=\"line\">    System.out.println(<span class=\"string\">&quot;获取ajax请求发送过来的id为:&quot;</span>+id);</span><br><span class=\"line\">    Map result = <span class=\"keyword\">new</span> HashMap();</span><br><span class=\"line\">    <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">//调用方法进行油画的删除</span></span><br><span class=\"line\">        paintingService.delete(Integer.parseInt(id));</span><br><span class=\"line\">        result.put(<span class=\"string\">&quot;code&quot;</span>, <span class=\"string\">&quot;0&quot;</span>);</span><br><span class=\"line\">        result.put(<span class=\"string\">&quot;msg&quot;</span>, <span class=\"string\">&quot;success&quot;</span>);</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;成功执行了删除的操作&quot;</span>);</span><br><span class=\"line\">    &#125;<span class=\"keyword\">catch</span>(Exception e) &#123;</span><br><span class=\"line\">        e.printStackTrace();</span><br><span class=\"line\">        result.put(<span class=\"string\">&quot;code&quot;</span>, <span class=\"string\">&quot;1&quot;</span>);</span><br><span class=\"line\">        result.put(<span class=\"string\">&quot;msg&quot;</span>, e.getMessage());</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;遇到了异常&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    String json = JSON.toJSONString(result);</span><br><span class=\"line\">    response.setContentType(<span class=\"string\">&quot;text/html;charset=UTF-8&quot;</span>);</span><br><span class=\"line\">    response.getWriter().println(json);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>​        通过对控制台中的打印结果分析想到，既然在Controller中并没有捕捉到，那么为什么会打印出异常的信息呢？很快就想到可能在XmlDataSource中就把异常给捕捉了，于是在XmlDataSource中将catch块中的e.printStackTrace();注释掉，在前台执行重复删除的操作，发现后台<emp>果然没有打印出</emp>异常信息!</p>\n<h3 id=\"BUG解决方法\"><a href=\"#BUG解决方法\" class=\"headerlink\" title=\"BUG解决方法\"></a>BUG解决方法</h3><p>​        在知道了为什么在控制器的方法中无法捕捉到XmlDataSource中抛出的异常后，就能想到出错的原因在哪里了；因为在XmlDataSource的删除方法中，前面的一些代码也会抛出异常，为了寻求方便我索性使用Exception来捕捉这些异常，这就导致将我们自定义的异常给捕获并处理了（因为RuntimeException继承自Exception），进而在Controller中无法捕捉到异常，给前台的反馈消息总是删除成功的；</p>\n<p>​        所以解决方法是分别捕捉可能出现的每一种异常(除RuntimeException以外)；修改后的方法如下：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">public static void delete(Integer id) &#123;</span><br><span class=\"line\">\t\tSAXReader reader = new SAXReader();</span><br><span class=\"line\">\t\tWriter writer = null;</span><br><span class=\"line\">\t\tDocument document;</span><br><span class=\"line\">\t\ttry &#123;</span><br><span class=\"line\">\t\t\tdocument = reader.read(dataFile);</span><br><span class=\"line\">\t\t\tList&lt;Node&gt; nodes = document.selectNodes(&quot;/root/painting[@id=&quot; + id + &quot;]&quot;);</span><br><span class=\"line\">\t\t\tif(nodes.size() == 0) &#123;</span><br><span class=\"line\">\t\t\t\tthrow new RuntimeException(&quot;编号为&quot; + id + &quot;的油画不存在或已删除&quot;);</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t\tElement p = (Element)nodes.get(0);</span><br><span class=\"line\">\t\t\t//得到P的根节点然后用根节点删去P;</span><br><span class=\"line\">\t\t\tp.getParent().remove(p);</span><br><span class=\"line\">\t\t\t//修改后的数据回写到原来的xml文件中;</span><br><span class=\"line\">\t\t\twriter = new OutputStreamWriter(new FileOutputStream(dataFile),&quot;UTF-8&quot;);</span><br><span class=\"line\">\t\t\tdocument.write(writer);</span><br><span class=\"line\">\t\t&#125; catch (DocumentException e) &#123;</span><br><span class=\"line\">\t\t\t// TODO Auto-generated catch block</span><br><span class=\"line\">\t\t\te.printStackTrace();</span><br><span class=\"line\">\t\t&#125; catch (UnsupportedEncodingException e) &#123;</span><br><span class=\"line\">\t\t\t// TODO Auto-generated catch block</span><br><span class=\"line\">\t\t\te.printStackTrace();</span><br><span class=\"line\">\t\t&#125; catch (FileNotFoundException e) &#123;</span><br><span class=\"line\">\t\t\t// TODO Auto-generated catch block</span><br><span class=\"line\">\t\t\te.printStackTrace();</span><br><span class=\"line\">\t\t&#125; catch (IOException e) &#123;</span><br><span class=\"line\">\t\t\t// TODO Auto-generated catch block</span><br><span class=\"line\">\t\t\te.printStackTrace();</span><br><span class=\"line\">\t\t&#125;finally &#123;</span><br><span class=\"line\">\t\t\tif(writer != null) &#123;</span><br><span class=\"line\">\t\t\t\ttry &#123;</span><br><span class=\"line\">\t\t\t\t\twriter.close();</span><br><span class=\"line\">\t\t\t\t&#125; catch (IOException e) &#123;</span><br><span class=\"line\">\t\t\t\t\t// TODO Auto-generated catch block</span><br><span class=\"line\">\t\t\t\t\te.printStackTrace();</span><br><span class=\"line\">\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t\treload();</span><br><span class=\"line\">\t\t&#125;\t\t</span><br><span class=\"line\">\t&#125;</span><br></pre></td></tr></table></figure>\n\n<p>​        这样以后，成功解决了前面出现的问题；这里附上前台页面的代码，弹出窗口使用了<a href=\"https://sweetalert2.github.io/\">SweetAlert</a></p>\n<figure class=\"highlight jsp\"><table><tr><td class=\"code\"><pre><span class=\"line\">&lt;script&gt;</span><br><span class=\"line\"><span class=\"comment\">//提示删除</span></span><br><span class=\"line\">\t<span class=\"function\">function <span class=\"title\">del</span><span class=\"params\">(previewObj)</span></span>&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">var</span> preview = $(previewObj).attr(<span class=\"string\">&quot;data-preview&quot;</span>);<span class=\"comment\">//获取自定义属性</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">var</span> pname = $(previewObj).attr(<span class=\"string\">&quot;data-pname&quot;</span>);</span><br><span class=\"line\">\t\t<span class=\"keyword\">var</span> id = $(previewObj).attr(<span class=\"string\">&quot;data-id&quot;</span>);\t\t</span><br><span class=\"line\">\t\tSwal.fire(&#123;</span><br><span class=\"line\">\t\t\t  title: <span class=\"string\">&#x27;删除&#x27;</span>+pname+<span class=\"string\">&#x27;?&#x27;</span>,</span><br><span class=\"line\">\t\t\t  html: <span class=\"string\">&quot;&lt;img src=&#x27;&quot;</span> + preview + <span class=\"string\">&quot;&#x27; style=&#x27;width:361px;height:240px&#x27;&gt;&quot;</span>,</span><br><span class=\"line\">\t\t\t  icon: <span class=\"string\">&#x27;warning&#x27;</span>,</span><br><span class=\"line\">\t\t\t  showCancelButton: <span class=\"keyword\">true</span>,</span><br><span class=\"line\">\t\t\t  confirmButtonColor: <span class=\"string\">&#x27;#3085d6&#x27;</span>,</span><br><span class=\"line\">\t\t\t  cancelButtonColor: <span class=\"string\">&#x27;#d33&#x27;</span>,</span><br><span class=\"line\">\t\t\t  confirmButtonText: <span class=\"string\">&#x27;是的&#x27;</span>,</span><br><span class=\"line\">\t\t\t  cancelButtonText: <span class=\"string\">&#x27;取消&#x27;</span></span><br><span class=\"line\">\t\t\t&#125;).then(function(isConfirm)&#123;</span><br><span class=\"line\">\t\t\t  <span class=\"keyword\">if</span> (isConfirm.value) &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"comment\">//发送ajax请求</span></span><br><span class=\"line\">\t\t\t\t\t$.ajax(&#123;</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"string\">&quot;url&quot;</span> : <span class=\"string\">&quot;/management?method=delete&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"string\">&quot;type&quot;</span> : <span class=\"string\">&quot;post&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"string\">&quot;data&quot;</span> : &#123;<span class=\"string\">&quot;id&quot;</span>:id&#125;,</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"string\">&quot;dataType&quot;</span> : <span class=\"string\">&quot;json&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"string\">&quot;success&quot;</span> : function(json)&#123;</span><br><span class=\"line\">\t\t\t\t\t\t\tconsole.log(json);</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"keyword\">if</span>(json.code==<span class=\"string\">&quot;0&quot;</span>)&#123;</span><br><span class=\"line\">\t\t\t\t\t\t\t\tSwal.fire(<span class=\"string\">&#x27;删除成功!&#x27;</span>,<span class=\"string\">&#x27;油画已经成功删除&#x27;</span>,<span class=\"string\">&#x27;success&#x27;</span>).then(function(isConfirm)&#123;</span><br><span class=\"line\">\t\t\t\t\t\t\t\t\t<span class=\"keyword\">if</span> (isConfirm.value)&#123;</span><br><span class=\"line\">\t\t\t\t\t\t\t\t\t\t<span class=\"comment\">//点击确认后刷新页面</span></span><br><span class=\"line\">\t\t\t\t\t\t\t\t\t\twindow.location.reload();</span><br><span class=\"line\">\t\t\t\t\t\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\t\t\t\t\t&#125;)</span><br><span class=\"line\">\t\t\t\t\t\t\t&#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">\t\t\t\t\t\t\t\tSwal.fire(<span class=\"string\">&#x27;删除失败!&#x27;</span>,json.msg,<span class=\"string\">&#x27;error&#x27;</span>).then(function(isConfirm)&#123;</span><br><span class=\"line\">\t\t\t\t\t\t\t\t\t<span class=\"keyword\">if</span> (isConfirm.value)&#123;</span><br><span class=\"line\">\t\t\t\t\t\t\t\t\t\t<span class=\"comment\">//点击确认后刷新页面</span></span><br><span class=\"line\">\t\t\t\t\t\t\t\t\t\twindow.location.reload();</span><br><span class=\"line\">\t\t\t\t\t\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\t\t\t\t\t&#125;)</span><br><span class=\"line\">\t\t\t\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\t\t&#125;)</span><br><span class=\"line\">\t\t\t  &#125;</span><br><span class=\"line\">\t\t&#125;)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&lt;/script&gt;</span><br><span class=\"line\">  &lt;!-- 省略部分代码 --&gt;</span><br><span class=\"line\">&lt;a <span class=\"class\"><span class=\"keyword\">class</span></span>=<span class=\"string\">&quot;oplink&quot;</span> data-id=<span class=\"string\">&quot;$&#123;painting.id&#125;&quot;</span> data-preview=<span class=\"string\">&quot;$&#123;painting.preview&#125;&quot;</span> data-pname=<span class=\"string\">&quot;$&#123;painting.pname&#125;&quot;</span> href=<span class=\"string\">&quot;javascript:void(0)&quot;</span> onclick=<span class=\"string\">&quot;del(this)&quot;</span>&gt;删除&lt;/a&gt;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h3><p>​        try-catch-finally执行的基本步骤是：如果try块中出现了<emp>异常</emp>,不管是自定义抛出的还是系统抛出的，在catch块中只要符合捕捉的范围，都会对该异常进行处理，最后执行finally块中的代码； 如果没有出现异常，则直接执行try块中的代码，然后执行finally中的代码；因此在开发过程中不要一时图方便，将捕捉异常的范围扩大，还应当业务逻辑进行仔细分析，采用最佳的处理方法；</p>\n","categories":["Java开发"],"tags":["BUG"]},{"title":"项目实现-后台","url":"/p/28f1.html","content":"<h2 id=\"富文本编辑器wangEditor\"><a href=\"#富文本编辑器wangEditor\" class=\"headerlink\" title=\"富文本编辑器wangEditor\"></a>富文本编辑器<a href=\"https://www.wangeditor.com/\">wangEditor</a></h2><h3 id=\"简介\"><a href=\"#简介\" class=\"headerlink\" title=\"简介\"></a>简介</h3><p>◇基于javascript与css开发的Web富文本编辑器，类似于word可以进行图文混排的工具；<br><img src=\"/p/28f1/1635512115522-da065370-16e0-47da-848e-b050a6b70137.png\" class=\"lazyload\" data-srcset=\"/p/28f1/1635512115522-da065370-16e0-47da-848e-b050a6b70137.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"></p>\n<h3 id=\"使用方法\"><a href=\"#使用方法\" class=\"headerlink\" title=\"使用方法\"></a>使用方法</h3><p>◇下载wangEditor的js文件，在test.ftl页面中进行引用；<br>◇基本使用方法写入和读取</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">&lt;!DOCTYPE html&gt;</span><br><span class=\"line\">&lt;html lang=<span class=\"string\">&quot;en&quot;</span>&gt;</span><br><span class=\"line\">&lt;head&gt;</span><br><span class=\"line\">    &lt;meta charset=<span class=\"string\">&quot;UTF-8&quot;</span>&gt;</span><br><span class=\"line\">    &lt;title&gt;Title&lt;/title&gt;</span><br><span class=\"line\">    &lt;#--引用wangEditor--&gt;</span><br><span class=\"line\">    &lt;script src=<span class=\"string\">&quot;/resources/wangEditor.min.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class=\"line\">&lt;/head&gt;</span><br><span class=\"line\">&lt;body&gt;</span><br><span class=\"line\">&lt;div&gt;</span><br><span class=\"line\">    &lt;button id=<span class=\"string\">&quot;btnRead&quot;</span>&gt;读取内容&lt;/button&gt;</span><br><span class=\"line\">    &lt;button id=<span class=\"string\">&quot;btnWrite&quot;</span>&gt;写入内容&lt;/button&gt;</span><br><span class=\"line\">&lt;/div&gt;</span><br><span class=\"line\">&lt;#--使用div容器来显示富文本编辑器--&gt;</span><br><span class=\"line\">&lt;div id=<span class=\"string\">&quot;divEditor&quot;</span> style=<span class=\"string\">&quot;width: 800px;height:600px&quot;</span>&gt;&lt;/div&gt;</span><br><span class=\"line\">&lt;script&gt;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> E = window.wangEditor;<span class=\"comment\">//获取对象</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> editor = <span class=\"keyword\">new</span> E(<span class=\"string\">&quot;#divEditor&quot;</span>);<span class=\"comment\">//完成富文本编辑器初始化</span></span><br><span class=\"line\">    editor.create();<span class=\"comment\">//创建富文本编辑器，显示在页面上</span></span><br><span class=\"line\">    <span class=\"comment\">//为按钮绑定单击事件，因为没有引入jquery，所以使用原生的document；</span></span><br><span class=\"line\">    document.getElementById(<span class=\"string\">&quot;btnRead&quot;</span>).onclick = function () &#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> content = editor.txt.html();<span class=\"comment\">//获取编辑器现有的html内容</span></span><br><span class=\"line\">        alert(content);</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">    <span class=\"comment\">//写入,可以看出和jQuery的语法很像,html无参则为读取，有参则为写入</span></span><br><span class=\"line\">    document.getElementById(<span class=\"string\">&quot;btnWrite&quot;</span>).onclick = function () &#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> content = <span class=\"string\">&quot;&lt;li style=&#x27;color:red&#x27;&gt;李凭中国弹箜篌&lt;/li&gt;&quot;</span>;</span><br><span class=\"line\">        editor.txt.html(content);</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">&lt;/script&gt;</span><br><span class=\"line\">&lt;/body&gt;</span><br><span class=\"line\">&lt;/html&gt;</span><br></pre></td></tr></table></figure>\n<h2 id=\"实现图书管理功能\"><a href=\"#实现图书管理功能\" class=\"headerlink\" title=\"实现图书管理功能\"></a>实现图书管理功能</h2><h3 id=\"图片上传功能\"><a href=\"#图片上传功能\" class=\"headerlink\" title=\"图片上传功能\"></a>图片上传功能</h3><p>◇在训练素材中将后台页面图书管理页复制到项目中，放在ftl/management目录下(与前台进行区别),并重命名为book.ftl;<br>◇book.ftl部分代码</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//显示新增图书对话框</span></span><br><span class=\"line\">    <span class=\"function\">function <span class=\"title\">showCreate</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">\t\t<span class=\"comment\">//弹出&quot;新增图书&quot;对话框</span></span><br><span class=\"line\">        layui.layer.open(&#123;</span><br><span class=\"line\">            id: <span class=\"string\">&quot;dlgBook&quot;</span>,</span><br><span class=\"line\">            title: <span class=\"string\">&quot;新增图书&quot;</span>,</span><br><span class=\"line\">            type: <span class=\"number\">1</span>,</span><br><span class=\"line\">            content: $(<span class=\"string\">&#x27;#dialog&#x27;</span>).html(),</span><br><span class=\"line\">            area: [<span class=\"string\">&#x27;820px&#x27;</span>, <span class=\"string\">&#x27;730px&#x27;</span>], <span class=\"comment\">//宽，高</span></span><br><span class=\"line\">            resize: <span class=\"keyword\">false</span></span><br><span class=\"line\">        &#125;)</span><br><span class=\"line\">\t\t<span class=\"comment\">//初始化wangEditor</span></span><br><span class=\"line\">        editor = <span class=\"keyword\">new</span> wangEditor(<span class=\"string\">&#x27;#dlgBook #editor&#x27;</span>);</span><br><span class=\"line\">        editor.customConfig.uploadImgServer = <span class=\"string\">&#x27;/management/book/upload&#x27;</span>;<span class=\"comment\">//设置图片上传地址</span></span><br><span class=\"line\">        editor.customConfig.uploadFileName = <span class=\"string\">&#x27;img&#x27;</span>;<span class=\"comment\">//设置图片上传参数，在springmvc接收时会用到</span></span><br><span class=\"line\">        editor.create();<span class=\"comment\">//创建wangEditor</span></span><br><span class=\"line\"></span><br><span class=\"line\">        layui.form.render(); <span class=\"comment\">//LayUI表单重新渲染</span></span><br><span class=\"line\">        $(<span class=\"string\">&quot;#dlgBook #optype&quot;</span>).val(<span class=\"string\">&quot;create&quot;</span>);<span class=\"comment\">//设置当前表单提交时提交至&quot;create&quot;新增地址</span></span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;;</span><br></pre></td></tr></table></figure>\n<p>◇新建子包management并重建controller类以显示后台管理页面以及后面的交互；<br>◇wangEditor<a href=\"https://www.wangeditor.com/doc/pages/07-%E4%B8%8A%E4%BC%A0%E5%9B%BE%E7%89%87/\">官方文档</a>对上传图片功能的介绍；<br>◇在pom.xml中增加底层的文件上传依赖;对于springmvc底层上传依赖于Apache的commons-fileupload组件</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">&lt;!-- Spring MVC文件上传底层依赖 --&gt;</span><br><span class=\"line\">&lt;dependency&gt;</span><br><span class=\"line\">    &lt;groupId&gt;commons-fileupload&lt;/groupId&gt;</span><br><span class=\"line\">    &lt;artifactId&gt;commons-fileupload&lt;/artifactId&gt;</span><br><span class=\"line\">    &lt;version&gt;<span class=\"number\">1.4</span>&lt;/version&gt;</span><br><span class=\"line\">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>\n<p>◇然后在applicationContext.xml中配置激活springmvc的文件上传功能</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">&lt;!-- 激活Spring MVC 文件上传 --&gt;</span><br><span class=\"line\">&lt;bean id=<span class=\"string\">&quot;multipartResolver&quot;</span> <span class=\"class\"><span class=\"keyword\">class</span></span>=<span class=\"string\">&quot;org.springframework.web.multipart.commons.CommonsMultipartResolver&quot;</span>&gt;</span><br><span class=\"line\">    &lt;property name=<span class=\"string\">&quot;defaultEncoding&quot;</span> value=<span class=\"string\">&quot;UTF-8&quot;</span>/&gt;</span><br><span class=\"line\">&lt;/bean&gt;</span><br></pre></td></tr></table></figure>\n<p>◇在controller中开发文件上传功能</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//这里的地址要和book.ftl中设置的文件上传地址/management/book/upload一致</span></span><br><span class=\"line\"><span class=\"comment\">/*MultipartFile用于接收文件,前面注解里的参数要和前面设置的上传参数一致</span></span><br><span class=\"line\"><span class=\"comment\">* 原生的request用来获取发布路径*/</span></span><br><span class=\"line\"><span class=\"meta\">@PostMapping(&quot;/upload&quot;)</span></span><br><span class=\"line\"><span class=\"meta\">@ResponseBody</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> Map <span class=\"title\">upload</span><span class=\"params\">(<span class=\"meta\">@RequestParam(&quot;img&quot;)</span> MultipartFile file, HttpServletRequest request)</span> <span class=\"keyword\">throws</span> IOException </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/*这行代码在运行时执行，即在web应用发布以后才执行，所以实际得到的路径是在</span></span><br><span class=\"line\"><span class=\"comment\">    * 工程发布的目录下(即out/artifacts/xxx_Web_expload)的路径,而不是webapp下的*/</span></span><br><span class=\"line\">    String uploadPath = request.getServletContext().getResource(<span class=\"string\">&quot;/&quot;</span>).getPath() + <span class=\"string\">&quot;/upload&quot;</span>;</span><br><span class=\"line\">    <span class=\"comment\">//生成文件名,利用SimpleDateFormat生成毫秒级文件名，以防止命名冲突</span></span><br><span class=\"line\">    String fileName = <span class=\"keyword\">new</span> SimpleDateFormat(<span class=\"string\">&quot;yyyyMMddHHmmssSSS&quot;</span>).format(<span class=\"keyword\">new</span> Date());</span><br><span class=\"line\">    <span class=\"comment\">//文件扩展名，来自原始文件,所以将原始文件进行字符串的截取,从最后一次出现&quot;.&quot;开始截取剩余的字符串</span></span><br><span class=\"line\">    String suffix = file.getOriginalFilename().substring(file.getOriginalFilename().lastIndexOf(<span class=\"string\">&quot;.&quot;</span>));</span><br><span class=\"line\">    <span class=\"comment\">//利用transferTo()(另存为方法)将上传的文件报存到我们指定的目录中;new File（）新建文件</span></span><br><span class=\"line\">    file.transferTo(<span class=\"keyword\">new</span> File(uploadPath+fileName+suffix));</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">//按照wangEditor的要求组织返回结果</span></span><br><span class=\"line\">    Map result = <span class=\"keyword\">new</span> HashMap();</span><br><span class=\"line\">    result.put(<span class=\"string\">&quot;errno&quot;</span>, <span class=\"number\">0</span>);<span class=\"comment\">//0,代表服务器处理正常</span></span><br><span class=\"line\">    <span class=\"comment\">//data要求是数组，所以新建一个数组,而上传的文件可以直接访问，所以返回的data填上其访问地址</span></span><br><span class=\"line\">    result.put(<span class=\"string\">&quot;data&quot;</span>,<span class=\"keyword\">new</span> String[]&#123;<span class=\"string\">&quot;/upload/&quot;</span>+fileName+suffix&#125;);</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">return</span> result;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>◇图片上传成功返回的json字符串<br><img src=\"/p/28f1/1635518539958-ee415fc0-f347-448c-b0bd-71f2679dc2ea.png\" class=\"lazyload\" data-srcset=\"/p/28f1/1635518539958-ee415fc0-f347-448c-b0bd-71f2679dc2ea.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"><br>◇指定的目录下<br><img src=\"/p/28f1/1635518575411-6ee8bb12-4d04-44ad-857c-f1bcb5f1ef15.png\" class=\"lazyload\" data-srcset=\"/p/28f1/1635518575411-6ee8bb12-4d04-44ad-857c-f1bcb5f1ef15.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"></p>\n<h3 id=\"图书新增功能\"><a href=\"#图书新增功能\" class=\"headerlink\" title=\"图书新增功能\"></a>图书新增功能</h3><p>◇图书封面的第一张作为封面在前台展示；如果没有增加图片就提交的话弹出提示增加图片作为封面；<br>◇提交后发送至后台的数据<br><img src=\"/p/28f1/1635560197806-f4fd6c73-48cf-4816-a8ad-920f04bc0b03.png\" class=\"lazyload\" data-srcset=\"/p/28f1/1635560197806-f4fd6c73-48cf-4816-a8ad-920f04bc0b03.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"><br>◇在BookService中书写相关接口及接口实现类，然后在MBookController中用前台传来的参数进行调用；<br>◇我们看到发送后台的数据没有评分，图书封面，评论的信息，所以还需要我们在controller中进行补全；那么如何从description描述的html文本中将第一幅图作为图书封面呢？<br>◇<a href=\"https://jsoup.org/\">jsoup</a>是一款java html解析器，利用jsoup可以将第一张图片截取出来；</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.lcg.reader.controller.management;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@PostMapping(&quot;/create&quot;)</span></span><br><span class=\"line\">    <span class=\"meta\">@ResponseBody</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> Map <span class=\"title\">createBook</span><span class=\"params\">(Book book)</span></span>&#123;</span><br><span class=\"line\">        Map result = <span class=\"keyword\">new</span> HashMap();</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            book.setEvaluationQuantity(<span class=\"number\">0</span>);<span class=\"comment\">//补全评论数量</span></span><br><span class=\"line\">            book.setEvaluationScore(<span class=\"number\">0f</span>);<span class=\"comment\">//补全评分</span></span><br><span class=\"line\">            <span class=\"comment\">/*利用jsoup进行html的解析*/</span></span><br><span class=\"line\">            Document doc = Jsoup.parse(book.getDescription());</span><br><span class=\"line\">            <span class=\"comment\">//选中图书详情中所有的img标签,然后获取第一个</span></span><br><span class=\"line\">            Element img = doc.select(<span class=\"string\">&quot;img&quot;</span>).first();</span><br><span class=\"line\">            <span class=\"comment\">//获取当前元素指定的属性值,作为图片是在img标签中存在于src这个属性中的;</span></span><br><span class=\"line\">            String cover = img.attr(<span class=\"string\">&quot;src&quot;</span>);</span><br><span class=\"line\">            book.setCover(cover);<span class=\"comment\">//补全图书封面</span></span><br><span class=\"line\">            bookService.createBook(book);</span><br><span class=\"line\">            result.put(<span class=\"string\">&quot;code&quot;</span>,<span class=\"string\">&quot;0&quot;</span>);</span><br><span class=\"line\">            result.put(<span class=\"string\">&quot;msg&quot;</span>, <span class=\"string\">&quot;success&quot;</span>);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (BussinessException e) &#123;</span><br><span class=\"line\">            e.printStackTrace();</span><br><span class=\"line\">            result.put(<span class=\"string\">&quot;code&quot;</span>,e.getCode());</span><br><span class=\"line\">            result.put(<span class=\"string\">&quot;msg&quot;</span>, e.getMsg());</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> result;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"后台图书分页\"><a href=\"#后台图书分页\" class=\"headerlink\" title=\"后台图书分页\"></a>后台图书分页</h3><p> ◇layui的数据列表在初始化以后会利用ajax向服务器发送请求来自动获取分页数据；即发起一个请求，该请求附带了page和limit两个参数，如图(表示查询第一页数据，每页显示10条)；这两个参数只有在layui数据表格开启分页后才会显示;<br><img src=\"/p/28f1/1635562567548-4228df18-7a6c-44ab-82d7-47e0de7a33a5.png\" class=\"lazyload\" data-srcset=\"/p/28f1/1635562567548-4228df18-7a6c-44ab-82d7-47e0de7a33a5.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"><br>◇下面针对这个请求网址来实现图书分页查询；<br>◇在开发前台的时候我们已经在BookService中创建了分页功能方法paging,参数为图书分类，排序方法，页数，每页几行4个参数；对于前面两个参数，如果想要进行忽略的话设置为null即可；基于paging方法进行后台查询功能的开发；</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.lcg.reader.controller.management;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@GetMapping(&quot;/list&quot;)</span></span><br><span class=\"line\"><span class=\"meta\">@ResponseBody</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> Map <span class=\"title\">list</span><span class=\"params\">(Integer page, Integer limit)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (page == <span class=\"keyword\">null</span>) &#123;<span class=\"comment\">//容错处理，设置为空时的默认值</span></span><br><span class=\"line\">        page = <span class=\"number\">1</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (limit == <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">        limit = <span class=\"number\">10</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">//调用前面创建的分页方法获取图书分页对象</span></span><br><span class=\"line\">    IPage&lt;Book&gt; iPage = bookService.paging(<span class=\"keyword\">null</span>, <span class=\"keyword\">null</span>, page, limit);</span><br><span class=\"line\">    <span class=\"comment\">//按Layui的数据规范书写返回数据</span></span><br><span class=\"line\">    Map result = <span class=\"keyword\">new</span> HashMap();</span><br><span class=\"line\">    result.put(<span class=\"string\">&quot;code&quot;</span>, <span class=\"string\">&quot;0&quot;</span>);</span><br><span class=\"line\">    result.put(<span class=\"string\">&quot;msg&quot;</span>, <span class=\"string\">&quot;success&quot;</span>);</span><br><span class=\"line\">    result.put(<span class=\"string\">&quot;data&quot;</span>, iPage.getRecords());<span class=\"comment\">//当前页面数据</span></span><br><span class=\"line\">    result.put(<span class=\"string\">&quot;count&quot;</span>, iPage.getTotal());<span class=\"comment\">//未分页时记录总数</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> result;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"图书修改功能\"><a href=\"#图书修改功能\" class=\"headerlink\" title=\"图书修改功能\"></a>图书修改功能</h3><p>◇作为图书修改功能需要和服务器建立两次通信：第一次是点击修改按钮的时候需要把要修改的图书信息进行返回，回填到修改框中；第二次是点击提交时将修改后的数据发送到后台；<br>◇book.ftl修改部分的代码</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//obj对应点击的&quot;修改&quot;按钮对象</span></span><br><span class=\"line\">   <span class=\"function\">function <span class=\"title\">showUpdate</span><span class=\"params\">(obj)</span></span>&#123;</span><br><span class=\"line\">\t<span class=\"comment\">//弹出&quot;编辑图书&quot;对话框</span></span><br><span class=\"line\">       layui.layer.open(&#123;</span><br><span class=\"line\">           id: <span class=\"string\">&quot;dlgBook&quot;</span>, <span class=\"comment\">//指定div</span></span><br><span class=\"line\">           title: <span class=\"string\">&quot;编辑图书&quot;</span>, <span class=\"comment\">//标题</span></span><br><span class=\"line\">           type: <span class=\"number\">1</span>, </span><br><span class=\"line\">           content: $(<span class=\"string\">&#x27;#dialog&#x27;</span>).html(), <span class=\"comment\">//设置对话框内容,复制自dialog DIV</span></span><br><span class=\"line\">           area: [<span class=\"string\">&#x27;820px&#x27;</span>, <span class=\"string\">&#x27;730px&#x27;</span>], <span class=\"comment\">//设置对话框宽度高度</span></span><br><span class=\"line\">           resize: <span class=\"keyword\">false</span> <span class=\"comment\">//是否允许调整尺寸</span></span><br><span class=\"line\">       &#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">       <span class=\"keyword\">var</span> bookId = $(obj).data(<span class=\"string\">&quot;id&quot;</span>); <span class=\"comment\">//获取&quot;修改&quot;按钮附带的图书编号</span></span><br><span class=\"line\">       $(<span class=\"string\">&quot;#dlgBook #bookId&quot;</span>).val(bookId); <span class=\"comment\">//为表单隐藏域赋值,提交表单时用到</span></span><br><span class=\"line\"></span><br><span class=\"line\">       editor = <span class=\"keyword\">new</span> wangEditor(<span class=\"string\">&#x27;#dlgBook #editor&#x27;</span>); <span class=\"comment\">//初始化富文本编辑器</span></span><br><span class=\"line\">       editor.customConfig.uploadImgServer = <span class=\"string\">&#x27;/management/book/upload&#x27;</span> <span class=\"comment\">//设置图片上传路径</span></span><br><span class=\"line\">       editor.customConfig.uploadFileName = <span class=\"string\">&#x27;img&#x27;</span>; <span class=\"comment\">//图片上传时的参数名</span></span><br><span class=\"line\">       editor.create(); <span class=\"comment\">//创建wangEditor</span></span><br><span class=\"line\">       $(<span class=\"string\">&quot;#dlgBook #optype&quot;</span>).val(<span class=\"string\">&quot;update&quot;</span>); <span class=\"comment\">//设置当前表单提交时提交至&quot;update&quot;更新地址</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">//发送ajax请求,获取对应图书信息</span></span><br><span class=\"line\">       $.get(<span class=\"string\">&quot;/management/book/id/&quot;</span> + bookId , &#123;&#125; , function(json)&#123;</span><br><span class=\"line\">\t\t<span class=\"comment\">//文本框回填已有数据</span></span><br><span class=\"line\">           $(<span class=\"string\">&quot;#dlgBook #bookName&quot;</span>).val(json.data.bookName);<span class=\"comment\">//书名</span></span><br><span class=\"line\">           $(<span class=\"string\">&quot;#dlgBook #subTitle&quot;</span>).val(json.data.subTitle); <span class=\"comment\">//子标题</span></span><br><span class=\"line\">           $(<span class=\"string\">&quot;#dlgBook #author&quot;</span>).val(json.data.author);<span class=\"comment\">//作者</span></span><br><span class=\"line\">           $(<span class=\"string\">&quot;#dlgBook #categoryId&quot;</span>).val(json.data.categoryId); <span class=\"comment\">//分类选项</span></span><br><span class=\"line\">           editor.txt.html(json.data.description); <span class=\"comment\">//设置图文内容</span></span><br><span class=\"line\">           layui.form.render();<span class=\"comment\">//重新渲染LayUI表单</span></span><br><span class=\"line\">       &#125; , <span class=\"string\">&quot;json&quot;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">   &#125;</span><br></pre></td></tr></table></figure>\n<p>◇MBookController中增加两个方法：数据查询和数据修改;<br>◇在进行数据修改操作时，正确的方法为：先查询出原始数据，然后在原始数据上进行相应的更改；</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//获取数据进行回填</span></span><br><span class=\"line\">    <span class=\"meta\">@GetMapping(&quot;/id/&#123;id&#125;&quot;)</span> <span class=\"comment\">//与前台保持一致的路径变量</span></span><br><span class=\"line\">    <span class=\"meta\">@ResponseBody</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> Map <span class=\"title\">selectById</span><span class=\"params\">(<span class=\"meta\">@PathVariable(&quot;id&quot;)</span> Long bookId)</span> </span>&#123;</span><br><span class=\"line\">        Book book = bookService.selectById(bookId);</span><br><span class=\"line\">        Map result = <span class=\"keyword\">new</span> HashMap();</span><br><span class=\"line\">        result.put(<span class=\"string\">&quot;code&quot;</span>, <span class=\"string\">&quot;0&quot;</span>);</span><br><span class=\"line\">        result.put(<span class=\"string\">&quot;msg&quot;</span>, <span class=\"string\">&quot;success&quot;</span>);</span><br><span class=\"line\">        result.put(<span class=\"string\">&quot;data&quot;</span>, book);<span class=\"comment\">//data在前端对应的是book数据，这里要和前面保持一致</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> result;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"meta\">@PostMapping(&quot;/update&quot;)</span></span><br><span class=\"line\">    <span class=\"meta\">@ResponseBody</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> Map <span class=\"title\">updateBook</span><span class=\"params\">(Book book)</span> </span>&#123;</span><br><span class=\"line\">        Map result = <span class=\"keyword\">new</span> HashMap();</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            <span class=\"comment\">/*这里注意不能直接对book进行更新，因为从前台传入过来的book对象中没有评分以及评论数量的信息</span></span><br><span class=\"line\"><span class=\"comment\">            * 需要根据前台传入的book通过id进行查询获取到原始的Book记录后才能进行更新操作*/</span></span><br><span class=\"line\">            Book rawBook = bookService.selectById(book.getBookId());<span class=\"comment\">//原始(未编辑前)的记录</span></span><br><span class=\"line\">            rawBook.setAuthor(book.getAuthor());</span><br><span class=\"line\">            rawBook.setBookName(book.getBookName());</span><br><span class=\"line\">            rawBook.setSubTitle(book.getSubTitle());</span><br><span class=\"line\">            rawBook.setCategoryId(book.getCategoryId());</span><br><span class=\"line\">            rawBook.setDescription(book.getDescription());</span><br><span class=\"line\">            <span class=\"comment\">//获取封面</span></span><br><span class=\"line\">            Document doc = Jsoup.parse(book.getDescription());</span><br><span class=\"line\">            Element img = doc.select(<span class=\"string\">&quot;img&quot;</span>).first();</span><br><span class=\"line\">            String cover = img.attr(<span class=\"string\">&quot;src&quot;</span>);</span><br><span class=\"line\">            rawBook.setCover(cover);<span class=\"comment\">//设置封面</span></span><br><span class=\"line\">            <span class=\"comment\">//并且修改要基于原始的rawBook，这样不容易出错</span></span><br><span class=\"line\">            bookService.updateBook(rawBook);</span><br><span class=\"line\">            result.put(<span class=\"string\">&quot;code&quot;</span>, <span class=\"string\">&quot;0&quot;</span>);</span><br><span class=\"line\">            result.put(<span class=\"string\">&quot;msg&quot;</span>, <span class=\"string\">&quot;success&quot;</span>);</span><br><span class=\"line\">            <span class=\"comment\">//result.put(&quot;data&quot;, book); 更新不需要返回数据，数据通过其他方法在前端显示</span></span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (BussinessException e) &#123;</span><br><span class=\"line\">            e.printStackTrace();</span><br><span class=\"line\">            result.put(<span class=\"string\">&quot;code&quot;</span>, e.getCode());</span><br><span class=\"line\">            result.put(<span class=\"string\">&quot;msg&quot;</span>, e.getMsg());</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">       <span class=\"keyword\">return</span> result;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"图书删除功能\"><a href=\"#图书删除功能\" class=\"headerlink\" title=\"图书删除功能\"></a>图书删除功能</h3><p>◇删除的请求<br><img src=\"/p/28f1/1635578378966-7d348a9f-dd0f-4b21-931c-a0f2db6cb7af.png\" class=\"lazyload\" data-srcset=\"/p/28f1/1635578378966-7d348a9f-dd0f-4b21-931c-a0f2db6cb7af.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"><br>◇注意，在删除图书的同时，也应该将用户对该图书的阅读状态以及评论进行级联删除；</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Service(&quot;bookService&quot;)</span></span><br><span class=\"line\"><span class=\"meta\">@Transactional(propagation = Propagation.NOT_SUPPORTED,readOnly = true)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">BookServiceImpl</span> <span class=\"keyword\">implements</span> <span class=\"title\">BookService</span> </span>&#123; </span><br><span class=\"line\">    <span class=\"meta\">@Resource</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> BookMapper bookMapper;</span><br><span class=\"line\">    <span class=\"meta\">@Resource</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> MemberReadStateMapper memberReadStateMapper;</span><br><span class=\"line\">    <span class=\"meta\">@Resource</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> EvaluationMapper evaluationMapper;</span><br><span class=\"line\">    <span class=\"meta\">@Transactional</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">deleteBook</span><span class=\"params\">(Long bookId)</span> </span>&#123;</span><br><span class=\"line\">        bookMapper.deleteById(bookId);</span><br><span class=\"line\">        <span class=\"comment\">/*构造条件删除某一本图书的所有阅读状态*/</span></span><br><span class=\"line\">        QueryWrapper&lt;MemberReadState&gt; mrsQueryWrapper = <span class=\"keyword\">new</span> QueryWrapper&lt;MemberReadState&gt;();</span><br><span class=\"line\">        mrsQueryWrapper.eq(<span class=\"string\">&quot;book_id&quot;</span>, bookId);<span class=\"comment\">//即删除的where book_id = bookId</span></span><br><span class=\"line\">        memberReadStateMapper.delete(mrsQueryWrapper);</span><br><span class=\"line\">        QueryWrapper&lt;Evaluation&gt; evaluationQueryWrapper = <span class=\"keyword\">new</span> QueryWrapper&lt;Evaluation&gt;();</span><br><span class=\"line\">        evaluationQueryWrapper.eq(<span class=\"string\">&quot;book_id&quot;</span>, bookId);</span><br><span class=\"line\">        evaluationMapper.delete(evaluationQueryWrapper);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"后台首页\"><a href=\"#后台首页\" class=\"headerlink\" title=\"后台首页\"></a>后台首页</h2><p>◇在训练素材中把后台首页复制到项目中<br>◇在management包下新增ManagementController类，即后台系统的管理控制器;提供了后台系统的通用功能：默认首页的显示等等；</p>\n<h2 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h2><h3 id=\"开发整体思路\"><a href=\"#开发整体思路\" class=\"headerlink\" title=\"开发整体思路\"></a>开发整体思路</h3><p>◇基于MVC开发理念：逐级调用方法;</p>\n<h3 id=\"开发注意避坑\"><a href=\"#开发注意避坑\" class=\"headerlink\" title=\"开发注意避坑\"></a>开发注意避坑</h3><p>◇注意注解不要写在接口里面；<br>◇显示首页logo的时候，我直接把图片命名为logo.png结果前台无法显示，报404错误，然后改为gamest_logo.png后可以显示，猜想可能和一些框架的命名有冲突导致的；</p>\n<h3 id=\"待完善的地方\"><a href=\"#待完善的地方\" class=\"headerlink\" title=\"待完善的地方\"></a>待完善的地方</h3><p>◇项目开发的很简陋，还有很多带完善的地方；<br>◇用户评论回复功能、用户个人信息查看功能、图书的搜索功能、用户密码修改功能等等；</p>\n","categories":["Spring","SSM开发项目"],"tags":["SSM"]},{"title":"微服务基础","url":"/p/1b72.html","content":"<h2 id=\"周课介绍\"><a href=\"#周课介绍\" class=\"headerlink\" title=\"周课介绍\"></a>周课介绍</h2><p>◇微服务的基本概念、设计与拆分原则<br>◇微服务和Spring Cloud的关系<br>◇微服务常见的组件和功能<br>◇课程查询案例基本介绍、系统架构设计和接口设计<br>◇分模块构建Spring Cloud项目<br>◇完成课程列表、课程价格服务开发<br>◇课程服务整合，服务注册与发现<br>◇整合OpenFeign实现服务间调用<br>◇网关的集成与开发，并接入服务<br>◇引入服务的熔断与降级，并进行实操演练</p>\n<h2 id=\"微服务基础介绍\"><a href=\"#微服务基础介绍\" class=\"headerlink\" title=\"微服务基础介绍\"></a>微服务基础介绍</h2><h3 id=\"要点\"><a href=\"#要点\" class=\"headerlink\" title=\"要点\"></a>要点</h3><ol>\n<li>什么是微服务 </li>\n<li>微服务的特点 </li>\n<li>微服务优缺点</li>\n<li>微服务的两大门派 springcloud和dubbo</li>\n<li>微服务拆分 </li>\n<li>微服务扩展 </li>\n<li>微服务重要模块    <h3 id=\"单体应用的缺点\"><a href=\"#单体应用的缺点\" class=\"headerlink\" title=\"单体应用的缺点\"></a>单体应用的缺点</h3>◇单体应用架构图<br><img src=\"/p/1b72/1637134079406-7d001d48-20f4-4f89-9013-99fea6d2c68f.png\" class=\"lazyload\" data-srcset=\"/p/1b72/1637134079406-7d001d48-20f4-4f89-9013-99fea6d2c68f.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"img\"><br>◇部署效率低下；单体应用的代码会越来越多，依赖也越来越多；pom文件会特别长，则导致部署时间变长；<br>◇团队协作开发成本高<br>◇系统高可用性差；因为最后所有功能都会部署到同一个包里面，且共用一个进程；那么如果一个功能出现问题很有可能整个系统出现问题；</li>\n</ol>\n<h3 id=\"什么是服务化\"><a href=\"#什么是服务化\" class=\"headerlink\" title=\"什么是服务化\"></a>什么是服务化</h3><p>◇ 把传统的单机应⽤中通过JAR包依赖产⽣的本地⽅法调⽤，改造成通过RPC、HTTP产⽣的远程⽅法调⽤<br>◇ 把模块从单体应⽤中拆分出来，独⽴成⼀个服务部署<br>◇ 模块就可以独⽴开发、测试、上线和运维，可以交由专门的团队来做，与主模块不耦合  </p>\n<h3 id=\"从单体到微服务架构\"><a href=\"#从单体到微服务架构\" class=\"headerlink\" title=\"从单体到微服务架构\"></a>从单体到微服务架构</h3><p>◇单体到微服务的架构图<br><img src=\"/p/1b72/1637134734874-79b80c53-5584-4a39-bd81-eb55d900aea1.png\" class=\"lazyload\" data-srcset=\"/p/1b72/1637134734874-79b80c53-5584-4a39-bd81-eb55d900aea1.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"></p>\n<h3 id=\"什么是微服务\"><a href=\"#什么是微服务\" class=\"headerlink\" title=\"什么是微服务\"></a>什么是微服务</h3><p>◇一种架构风格<br>◇开发单个应用作为一系列小型服务的套件，其中每个服务都运行在自己的进程中，并且通过轻量级的机制实现彼此间的通信， 这通常是HTTP资源API。<br>◇这些服务是围绕着业务功能构建的，并且可以通过完全自动化的部署机制进行独立部署<br>◇这些服务的集中式管理做到了最小化（例如docker相关技 术），每一种服务都可以通过不同的编程语言进行编写，并且可以使用不同的数据存储技术。  </p>\n<h3 id=\"微服务的特点\"><a href=\"#微服务的特点\" class=\"headerlink\" title=\"微服务的特点\"></a>微服务的特点</h3><p>◇组件以服务形式来提供<br>◇产品而不是项目<br>◇轻量级通信、独立进程<br>◇分散治理、去中心化治理<br>◇容错性设计<br>◇会带来团队的组织架构的调整；如有原来水平团队变成垂直的团队，微服务下一个业务就有整套技术人员；<br><img src=\"/p/1b72/1637135262247-ccfb963f-6436-48a4-88a7-9f91c1a87450.png\" class=\"lazyload\" data-srcset=\"/p/1b72/1637135262247-ccfb963f-6436-48a4-88a7-9f91c1a87450.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"></p>\n<h3 id=\"微服务优缺点\"><a href=\"#微服务优缺点\" class=\"headerlink\" title=\"微服务优缺点\"></a>微服务优缺点</h3><p><strong>优点</strong><br>◇服务简单、便于学习和上手，相对易于维护<br>◇独立部署，灵活扩展<br>◇技术栈丰富，包括开发工具，数据库，中间件等；<br><strong>缺点</strong><br>◇运维成本过高<br>◇接口可能不匹配;因为以前我们进行本地方法调用的时候，不会出现接口不匹配的问题，在本地可以直接查看接口的返回类型；但变成微服务之后，假设我们都不知道对方的代码，只能通过简单的描述，就有可能造成接口不匹配；<br>◇代码可能重复<br>◇架构复杂度提高</p>\n<p>◇在不同系统复杂度的情况下单体应用(Monolith)和微服务应用(Microservice)的优势区别<br><img src=\"/p/1b72/1637154816697-fc8ca31e-ad8b-47e5-b35a-0a67dd393543.png\" class=\"lazyload\" data-srcset=\"/p/1b72/1637154816697-fc8ca31e-ad8b-47e5-b35a-0a67dd393543.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"></p>\n<h2 id=\"微服务的两大门派\"><a href=\"#微服务的两大门派\" class=\"headerlink\" title=\"微服务的两大门派\"></a>微服务的两大门派</h2><h3 id=\"介绍\"><a href=\"#介绍\" class=\"headerlink\" title=\"介绍\"></a>介绍</h3><p>◇Spring Cloud：众多子项目；比如说像网关、配置中心、智能路由等等；<br>◇Dubbo：高性能、轻量级的开源 Java RPC 框架，它提供了三大核心能力：面向接口的远程方法调用，智能容错和负载均衡， 以及服务自动注册和发现 ；<br>◇Dubbo提供的能力只是Spring Cloud的一部分子集<br>◇Dubbo中无是指不提供该功能，但可以通过其他框架组合实现；比如说在Dubbo中分布式配置功能可以采用百度的disconf或者淘宝的diamond实现；利用京东开源的Hydra实现服务跟踪；当当开源的Elastic-Job实现批量任务等等；<br><img src=\"/p/1b72/1637155733539-83469425-a6d5-4e77-a50f-3499c5490cb5.png\" class=\"lazyload\" data-srcset=\"/p/1b72/1637155733539-83469425-a6d5-4e77-a50f-3499c5490cb5.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"></p>\n<h3 id=\"通信协议对比\"><a href=\"#通信协议对比\" class=\"headerlink\" title=\"通信协议对比\"></a>通信协议对比</h3><p>◇Dubbo基于RPC，Spring Cloud基于REST<br>◇RPC 服务提供方与调用方接口依赖方式太强<br>◇RPC服务对平台敏感，难以简单复用<br>◇ 效率RPC更高  </p>\n<h3 id=\"文档质量对比\"><a href=\"#文档质量对比\" class=\"headerlink\" title=\"文档质量对比\"></a>文档质量对比</h3><p>◇ Dubbo的文档可以说在国内开源框架中算是一流的，提供了中文与英文两种版本<br>◇ Spring Cloud文档体量大，更多的是偏向整合，更深入的使用方法还是需要查看其整合组件的详细文档  </p>\n<h3 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h3><p>◇Dubbo诞生于阿里系，其他组件不够全面；而Spring Cloud专注于企业级的微服务框架，开发便利；生态上Spring Cloud更强大；<br>◇Dubbo就像组装电脑，有很高的自由度，但是需要承担兼容性的风险；Spring Cloud相当于品牌机，保证了一套系统的稳定性；<br>◇需要根据自身的研发水平和所处阶段选择</p>\n<h2 id=\"微服务拆分\"><a href=\"#微服务拆分\" class=\"headerlink\" title=\"微服务拆分\"></a>微服务拆分</h2><h3 id=\"什么时候进行服务化拆分\"><a href=\"#什么时候进行服务化拆分\" class=\"headerlink\" title=\"什么时候进行服务化拆分\"></a>什么时候进行服务化拆分</h3><p>◇第一阶段的主要目标是快速开发和验证想法，即采用单体应用模式快速开发应用上线；<br>◇进一步增加更多的新特性来吸引更多的目标用户<br>◇同时进行开发的人员超过10人(视业务大小决定人数)，这个时候就该考虑进行服务化拆分</p>\n<h3 id=\"不适合拆分的情况\"><a href=\"#不适合拆分的情况\" class=\"headerlink\" title=\"不适合拆分的情况\"></a>不适合拆分的情况</h3><p>◇小团队，技术基础比较薄弱<br>◇流量不高，压力小，业务变化也不大；比如企业内部的系统，虽然功能多，但是只是企业内部员工使用，流量不是很高；<br>◇对延迟很敏感的低延迟高并发系统；对于微服务而言，延迟是很高的，因为各个模块间的调用是通过网络通信完成的；</p>\n<h3 id=\"服务化拆分的两种姿势\"><a href=\"#服务化拆分的两种姿势\" class=\"headerlink\" title=\"服务化拆分的两种姿势\"></a>服务化拆分的两种姿势</h3><p>◇纵向拆分；按照业务维度去拆分，比如说关联程度比较近的拆分为一个微服务，功能比较独立的拆分为一个微服务；如社交APP，评论功能是一个微服务，消息通知是一个微服务，个人主页是一个微服务；<br>◇横向拆分；按照公共领域拆分；比如说上面的评论，消息通知，个人主页都有公共的需求，都需要用到用户模块；则把用户服务作为一个横向拆分出来，并且把功能提供给各个模块，这样一来用户服务就得到了大量的复用；<br>◇结合业务综合分析</p>\n<h2 id=\"微服务扩展\"><a href=\"#微服务扩展\" class=\"headerlink\" title=\"微服务扩展\"></a>微服务扩展</h2><h3 id=\"服务扩展\"><a href=\"#服务扩展\" class=\"headerlink\" title=\"服务扩展\"></a>服务扩展</h3><p>◇ x 轴-水平复制；就是单体应用的典型扩展方式，把整个系统作为一个整体重新部署几套然后在前面加几个负载均衡器即可；水平复制往往效果不好，而且造成资源浪费；<br>◇ y 轴-功能解耦 ；即指微服务的拆解，效率比X轴的维度高；<br>◇ z 轴-数据分区 ；在我们系统过大后，存储空间可能不足；所以就需要进行数据库的拆分；<br><img src=\"/p/1b72/1637158294647-b32edcc5-5f8b-49ab-9fdd-f125a602b175.png\" class=\"lazyload\" data-srcset=\"/p/1b72/1637158294647-b32edcc5-5f8b-49ab-9fdd-f125a602b175.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"></p>\n<h3 id=\"自动按需扩展\"><a href=\"#自动按需扩展\" class=\"headerlink\" title=\"自动按需扩展\"></a>自动按需扩展</h3><p>◇ 根据CPU负载程度、特定时间（比如周末）、消息中间件的队 列长度、业务具体规则、预测等来决定是否扩展<br>◇ 自动分配一个新的服务实例，提高可用性<br>◇ 提高了可伸缩性（双11之后，自动减少服务器）<br>◇ 具有最佳使用率，节约成本  </p>\n<h2 id=\"微服务重要模块\"><a href=\"#微服务重要模块\" class=\"headerlink\" title=\"微服务重要模块\"></a>微服务重要模块</h2><p>◇服务描述；我们服务提供方需要把自己的服务描述出来，比如是什么类型的服务，接口是什么类型等等；<br>◇注册中⼼；服务提供方需要到注册中心进行注册；<br>◇服务框架；采用什么协议（TCP、UDP），传输的方式是同步还是异步，数据是否需要压缩等等内容由服务框架进行统一；<br>◇负载均衡；服务提供方有很多个，需要有负载均衡技术；<br>◇熔断和降级；保证整体的可用性，不因某一个服务瘫痪导致整个系统故障；<br>◇网关；当服务增多之后，用户是不可能每一个请求达到不同的地址上去，需要一个统一的网关接收用户的请求，然后进行分发；具有统一转换，权限控制等功能；</p>\n","categories":["分布式与微服务"],"tags":["微服务"]},{"title":"项目实现-前台","url":"/p/aeec.html","content":"<h2 id=\"本周学习内容简介\"><a href=\"#本周学习内容简介\" class=\"headerlink\" title=\"本周学习内容简介\"></a>本周学习内容简介</h2><p>◇讲解Spring/Spring MVC/Mybatis(SSM)整合配置过程<br>◇讲解MyBatis-Plus敏捷开发插件的用法<br>◇开发javaweb应用”书评网”<br>◇由于篇幅有限，项目的全部代码见<a href=\"https://github.com/618dt/JavaPractice/tree/main/gamest-reader\">gamest-reader</a></p>\n<h2 id=\"主要知识点\"><a href=\"#主要知识点\" class=\"headerlink\" title=\"主要知识点\"></a>主要知识点</h2><p>◇SSM整合配置<br>◇Mybatis-Plus配置与应用<br>◇Boostrap UI框架入门<br>◇Kaptcha验证码组件使用<br>◇富文本编辑器wangEditor<br>◇Spring Task任务调度  </p>\n<h2 id=\"SSM整合的意义\"><a href=\"#SSM整合的意义\" class=\"headerlink\" title=\"SSM整合的意义\"></a>SSM整合的意义</h2><h3 id=\"什么是整合\"><a href=\"#什么是整合\" class=\"headerlink\" title=\"什么是整合\"></a>什么是整合</h3><p>◇整合通过Spring IoC容器管理第三方框架对象,让多框架形成整体<br>◇Spring/Spring MVC/MyBatis是业内最主流的框架搭配<br>◇SSM配置与使用是所有Java工程师必须掌握的技能  </p>\n<h3 id=\"SSM整合三阶段\"><a href=\"#SSM整合三阶段\" class=\"headerlink\" title=\"SSM整合三阶段\"></a>SSM整合三阶段</h3><p>◇Spring与Spring MVC环境配置<br>◇Spring与MyBatis的整合配置<br>◇整合其他组件:声明式事务/日志/任务调度/…  </p>\n<h3 id=\"Spring与Spring-MVC环境配置\"><a href=\"#Spring与Spring-MVC环境配置\" class=\"headerlink\" title=\"Spring与Spring MVC环境配置\"></a>Spring与Spring MVC环境配置</h3><p>◇依赖spring-webmvc   </p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">--pom.xml文件</span><br><span class=\"line\">&lt;!--Freemarker--&gt;</span><br><span class=\"line\">&lt;!-- Jackson --&gt;</span><br></pre></td></tr></table></figure>\n<p>◇配置DispatcherServlet              –web.xml文件<br>◇启用Spring MVC注解模式        –applicationContext.xml文件<br>◇配置请求与响应字符集            –applicationContext.xml文件<br>◇配置FreeMarker模板引擎        –applicationContext.xml文件<br>◇配置Json序列化组件                –applicationContext.xml文件</p>\n<h3 id=\"Spring与MyBatis整合配置\"><a href=\"#Spring与MyBatis整合配置\" class=\"headerlink\" title=\"Spring与MyBatis整合配置\"></a>Spring与MyBatis整合配置</h3><p>◇Spring的整合其核心目的是通过spring去管理其他组件或框架的核心对象，让这些对象之间形成一个整体；<br>◇创建数据库gamest_reader<br>◇依赖mybatis-spring及驱动     –pom.xml文件<br>◇配置数据源与连接池              –applicationContext.xml文件<br>◇配置SqlSessionFactory           –applicationContext.xml文件<br>◇配置Mapper扫描器                –applicationContext.xml文件<br>◇创建mybatis-config.xml </p>\n<h3 id=\"整合其他组件\"><a href=\"#整合其他组件\" class=\"headerlink\" title=\"整合其他组件\"></a>整合其他组件</h3><p>◇配置logback日志输出 ，新建logback.xml文件，日志组件会自动识别；<br>◇声明式事务配置 ;引入依赖spring-jdbc后，事务的依赖spring-tx也会自动被引入，在applicationContext中配置声明式事务<br>◇整合junit单元测试  </p>\n<h2 id=\"MyBatis-Plus\"><a href=\"#MyBatis-Plus\" class=\"headerlink\" title=\"MyBatis-Plus\"></a>MyBatis-Plus</h2><h3 id=\"MyBatis-Plus简介\"><a href=\"#MyBatis-Plus简介\" class=\"headerlink\" title=\"MyBatis-Plus简介\"></a>MyBatis-Plus简介</h3><p>◇ MyBatis-Plus（简称 MP）是一个 MyBatis 的增强工具<br>◇ 自动实现Mapper CRUD操作,极致提高数据库开发效率<br>◇ MP在MyBatis 的基础上只做增强不做改变<br>◇<a href=\"https://mp.baomidou.com/\">MyBatis-Plus官网</a></p>\n<h3 id=\"MyBatis-Plus整合三部曲\"><a href=\"#MyBatis-Plus整合三部曲\" class=\"headerlink\" title=\"MyBatis-Plus整合三部曲\"></a>MyBatis-Plus整合三部曲</h3><p>◇pom引入mybatis-plus依赖 </p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">&lt;dependency&gt;</span><br><span class=\"line\">    &lt;groupId&gt;com.baomidou&lt;/groupId&gt;</span><br><span class=\"line\">    &lt;artifactId&gt;mybatis-plus&lt;/artifactId&gt;</span><br><span class=\"line\">    &lt;version&gt;<span class=\"number\">3.3</span><span class=\"number\">.2</span>&lt;/version&gt;</span><br><span class=\"line\">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>\n<p>◇Spring XML更改配置SqlSessionFactory实现类<br>◇mybatis-config.xml增加MP分页插件(plugin) </p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">&lt;plugins&gt;</span><br><span class=\"line\">    &lt;!-- 配置MyBatis-Plus分页插件 --&gt;</span><br><span class=\"line\">    &lt;plugin interceptor=<span class=\"string\">&quot;com.baomidou.mybatisplus.extension.plugins.PaginationInterceptor&quot;</span>&gt;&lt;/plugin&gt;</span><br><span class=\"line\">&lt;/plugins&gt;</span><br></pre></td></tr></table></figure>\n<h3 id=\"MyBatis-Plus开发三部曲\"><a href=\"#MyBatis-Plus开发三部曲\" class=\"headerlink\" title=\"MyBatis-Plus开发三部曲\"></a>MyBatis-Plus开发三部曲</h3><p>◇创建实体类，实体类中的属性需要与数据库中表的字段保持一致,基于@Table/@TableId/@TableField进行与表的自动映射<br>◇创建Mapper接口继承BaseMapper,创建Mapper XML<br>◇开发时注入Mapper对象,通过内置API实现CRUD(增删改查)操作 </p>\n<h3 id=\"MyBatis-Plus核心注解\"><a href=\"#MyBatis-Plus核心注解\" class=\"headerlink\" title=\"MyBatis-Plus核心注解\"></a>MyBatis-Plus核心注解</h3><p>◇@TableName - 将实体类与表名映射<br>◇@TableId - 说明对应属性是表的主键 ,Tabled(type=IdType.AUTO)，type即设置主键的生成方式，IdType.AUTO表示使用数据库底层的自增主键来完成数据的插入；<br>◇@TableField - 设置属性与列名(字段)的对应关系  ，如果字段名与属性名相同或者符合驼峰命名转换规则，则TableField可省略</p>\n<h3 id=\"BaseMapper接口核心API\"><a href=\"#BaseMapper接口核心API\" class=\"headerlink\" title=\"BaseMapper接口核心API\"></a>BaseMapper接口核心API</h3><p>◇在所有的Mapper文件中都要实现BaseMapper接口，BaseMapper是由Mybatis-plus提供的核心父接口，在实现的时候需要加入泛型说明定义的实体是哪一个例如BaseMapper&lt;test&gt;；当我们继承自接口以后，实现增删改查直接使用继承的方法就行了，如果需要自定义增删改查方法的话，方法名不应与父接口的方法产生混淆；<br><img src=\"/p/aeec/1634779418318-3d3df12d-ee20-4c2f-9f42-ab25df66569f.png\" class=\"lazyload\" data-srcset=\"/p/aeec/1634779418318-3d3df12d-ee20-4c2f-9f42-ab25df66569f.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"></p>\n<h2 id=\"案例分析与数据库建表\"><a href=\"#案例分析与数据库建表\" class=\"headerlink\" title=\"案例分析与数据库建表\"></a>案例分析与数据库建表</h2><h3 id=\"案例分析\"><a href=\"#案例分析\" class=\"headerlink\" title=\"案例分析\"></a>案例分析</h3><p><img src=\"/p/aeec/1634888234791-174ffddc-68f1-4bd7-9baa-450f8b55e69c.png\" class=\"lazyload\" data-srcset=\"/p/aeec/1634888234791-174ffddc-68f1-4bd7-9baa-450f8b55e69c.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"><br>◇最核心的数据是图书信息，包含了书名、作者、描述等等；<br>◇作为网站，也会内置会员部分，也就是用户；而围绕着会员与图书会衍生出两个状态信息：阅读状态和评论；</p>\n<h3 id=\"数据库建表\"><a href=\"#数据库建表\" class=\"headerlink\" title=\"数据库建表\"></a>数据库建表</h3><p>◇围绕着上面分析的五个数据，可以建立五张表<br>◇图书表<br><img src=\"/p/aeec/1634889164832-405d915b-9837-4e38-881e-ecacbf54238b.png\" class=\"lazyload\" data-srcset=\"/p/aeec/1634889164832-405d915b-9837-4e38-881e-ecacbf54238b.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"><br>◇会员表<br><img src=\"/p/aeec/1634889215160-169dab43-7425-4f8e-9a6b-7315a9c784a9.png\" class=\"lazyload\" data-srcset=\"/p/aeec/1634889215160-169dab43-7425-4f8e-9a6b-7315a9c784a9.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"></p>\n<p>◇评价表<br><img src=\"/p/aeec/1634889032203-d15faf1f-d68c-4c26-b808-5d873b080bef.png\" class=\"lazyload\" data-srcset=\"/p/aeec/1634889032203-d15faf1f-d68c-4c26-b808-5d873b080bef.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"><br>◇阅读状态表<br><img src=\"/p/aeec/1634889085837-5794340d-25cd-49fb-90d2-8c20fa67d668.png\" class=\"lazyload\" data-srcset=\"/p/aeec/1634889085837-5794340d-25cd-49fb-90d2-8c20fa67d668.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"><br>◇分类表<br><img src=\"/p/aeec/1634889137631-3ac9ff3d-2d3a-4d74-a5b2-1a4a3838172c.png\" class=\"lazyload\" data-srcset=\"/p/aeec/1634889137631-3ac9ff3d-2d3a-4d74-a5b2-1a4a3838172c.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"><br>◇额外建立一张user表用于后台管理<br><img src=\"/p/aeec/1634889260690-4e7ad4df-dd46-47d3-8433-d9f1833f2aa0.png\" class=\"lazyload\" data-srcset=\"/p/aeec/1634889260690-4e7ad4df-dd46-47d3-8433-d9f1833f2aa0.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"></p>\n<h2 id=\"实现图书列表页面\"><a href=\"#实现图书列表页面\" class=\"headerlink\" title=\"实现图书列表页面\"></a>实现图书列表页面</h2><p>◇将训练素材里的三个基础文件目录粘贴到项目的webapp目录下<br>◇images包含了前端页面的图片信息<br>◇resources包含了一系列js、css组件<br>◇upload是文件上传的目录，在程序运行时所有远程上传的图片都会保存于此；<br><img src=\"/p/aeec/1634889626531-f9d30ee9-fe34-460f-8233-5f3840e4b782.png\" class=\"lazyload\" data-srcset=\"/p/aeec/1634889626531-f9d30ee9-fe34-460f-8233-5f3840e4b782.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"><br>◇将素材里的首页.html文件复制到项目的WEB-INF\\ftl路径下，并将文件名改为index.ftl；<br>◇前端的UI框架由Bootstrap来实现</p>\n<h3 id=\"Bootstrap\"><a href=\"#Bootstrap\" class=\"headerlink\" title=\"Bootstrap\"></a>Bootstrap</h3><p>◇Bootstrap是全球最受欢迎的前端组件库,由推特(TWitter)开源<br>◇Bootstrap用于开发响应式布局、移动设备优先的WEB项目<br>◇Bootstrap提供完整的HTML、CSS 和 JS 开发工具集<br>◇Boostrap<a href=\"https://www.bootcss.com/\">中文网</a></p>\n<h3 id=\"显示图书类别\"><a href=\"#显示图书类别\" class=\"headerlink\" title=\"显示图书类别\"></a>显示图书类别</h3><p>◇queryWrapper即条件构造器，按条件对数据库进行查询;<br>◇具体步骤为创建类别实体-&gt;创建Mapper接口-&gt;创建与接口对应的xml-&gt;创建service接口-&gt;为接口创建实现类（这里要在service包下创建一个子包impl，专门用来存放接口的实现类）impl.CategoryServiceImpl-&gt;在该实现类中实现查询方法，并进行事务管理<br>◇实现类实现了接口的方法，因此在使用查询数据时，直接给接口注入数据，然后用接口的方法进行查询；<br>◇完成上面的实现后就要进入Controller开发环节,创建一个BookController，在这个控制器中完成一系列url与方法的绑定；在该类的showXXX方法是将数据展示到页面，通常返回一个mav来进行数据的传递；因此创建showIndex（）方法来显示图书分类信息；<br>◇完成showXXX方法后进入ftl文件中</p>\n<h3 id=\"实现图书分页\"><a href=\"#实现图书分页\" class=\"headerlink\" title=\"实现图书分页\"></a>实现图书分页</h3><p>◇首先创建图书实体类Book-&gt;创建接口-&gt;接口对应的xml文件-&gt;service接口（图书的分页查询属于业务逻辑类，在service中实现）-&gt;生成service的实现类(快捷键：选中类然后Alt+Enter)<br>◇基于Mybatis-plus的分页查询：<br>核心方法为selectPage()；</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.lcg.reader.service.impl;</span><br><span class=\"line\"><span class=\"keyword\">import</span> *</span><br><span class=\"line\"><span class=\"meta\">@Service(&quot;bookService&quot;)</span></span><br><span class=\"line\"><span class=\"meta\">@Transactional(propagation = Propagation.NOT_SUPPORTED,readOnly = true)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">BookServiceImpl</span> <span class=\"keyword\">implements</span> <span class=\"title\">BookService</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"meta\">@Resource</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> BookMapper bookMapper;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> IPage&lt;Book&gt; <span class=\"title\">paging</span><span class=\"params\">(Integer page, Integer rows)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">//分页信息：哪一页，每页的记录数</span></span><br><span class=\"line\">        Page&lt;Book&gt; p = <span class=\"keyword\">new</span> Page&lt;Book&gt;(page, rows);</span><br><span class=\"line\">        <span class=\"comment\">//条件构造器，为空表示没有条件</span></span><br><span class=\"line\">        QueryWrapper&lt;Book&gt; queryWrapper = <span class=\"keyword\">new</span> QueryWrapper&lt;Book&gt;();</span><br><span class=\"line\">        <span class=\"comment\">//参数为分页信息，条件构造器</span></span><br><span class=\"line\">        IPage&lt;Book&gt; pageObject =  bookMapper.selectPage(p, queryWrapper);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> pageObject;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>◇其原理为SELECT COUNT(1) FROM book查询出未分页前的所有图书总数，然后根据总数除以每页记录数求出一共有多少页；然后再<br>SELECT book_id,book_name,sub_title,author,cover,description,category_id,evaluation_score,evaluation_quantity FROM book LIMIT ?,?  //两个问号分别代表本次查询的其实位置和终止位置</p>\n<h3 id=\"Ajax动态加载图书信息\"><a href=\"#Ajax动态加载图书信息\" class=\"headerlink\" title=\"Ajax动态加载图书信息\"></a>Ajax动态加载图书信息</h3><p>◇在BookController类中新增图书查询方法selectBook;<br>◇修改index.ftl文件进行动态渲染，在其&lt;head&gt;内部增加javascript块&lt;script&gt;用来发送ajax和BookController中的/books进行交互，需要引入jquery；<br>◇如何将book中的信息填充到页面中？因为所有的操作都是通过JavaScript来完成的，所以不能够像freemarker一样直接在页面中加入freemarker标签来完成服务器端的渲染；而是需要利用JavaScript动态的将这些分页信息组织成html插入到当前页面中；而html的实现使用拼接字符串来完成；<br>◇但是如果页面信息很多的话，通过拼接字符串的方法显然不现实；需要使用js的模板引擎来完成复杂页面的构建工作；</p>\n<h3 id=\"Art-Template-腾讯JS模板引擎\"><a href=\"#Art-Template-腾讯JS模板引擎\" class=\"headerlink\" title=\"Art-Template 腾讯JS模板引擎\"></a>Art-Template 腾讯JS模板引擎</h3><p>◇上述说到，利用字符串拼接来实现html对于复杂页面不太好；那么可以利用JS模板引擎来对复杂的html进行模板化；<br>◇官网<a href=\"http://aui.github.io/art-template/\">http://aui.github.io/art-template/</a><br>◇应用数据的时候 {{}} 里的名字要和ajax返回数据的属性名一致<br><img src=\"/p/aeec/1635062178732-187705b8-6471-48e5-a44e-7756002d2c69.png\" class=\"lazyload\" data-srcset=\"/p/aeec/1635062178732-187705b8-6471-48e5-a44e-7756002d2c69.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"><br>◇创建的模板</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\">&lt;#--定义js模板,type说明script中内容的类型,id设置为tpl--&gt;</span><br><span class=\"line\">&#123;% raw %&#125;</span><br><span class=\"line\">    &lt;script type=<span class=\"string\">&quot;text/html&quot;</span> id=<span class=\"string\">&quot;tpl&quot;</span>&gt;</span><br><span class=\"line\">        &lt;#--看ajax返回数据的时候的属性名和 &#123;&#123;&#125;&#125; 里的一致--&gt;</span><br><span class=\"line\">        &lt;a href=&quot;/book/&#123;&#123;bookId&#125;&#125;&quot; style=&quot;color: inherit&quot;&gt;&lt;#--每一块超链接都对应了图书的详细信息--&gt;</span><br><span class=\"line\">            &lt;div class=&quot;row mt-2 book&quot;&gt;</span><br><span class=\"line\">                &lt;div class=&quot;col-4 mb-2 pr-2&quot;&gt;</span><br><span class=\"line\">                    &lt;#--图书封面--&gt;</span><br><span class=\"line\">                    &lt;img class=&quot;img-fluid&quot; src=&quot;&#123;&#123;cover&#125;&#125;&quot;&gt;</span><br><span class=\"line\">                &lt;/div&gt;</span><br><span class=\"line\">                &lt;div class=&quot;col-8  mb-2 pl-0&quot;&gt;</span><br><span class=\"line\">                    &lt;h5 class=&quot;text-truncate&quot;&gt;&#123;&#123;bookName&#125;&#125;&lt;/h5&gt;&lt;#--图书名称--&gt;</span><br><span class=\"line\">                    &lt;#--作者--&gt;</span><br><span class=\"line\">                    &lt;div class=&quot;mb-2 bg-light small  p-2 w-100 text-truncate&quot;&gt;&#123;&#123;author&#125;&#125;&lt;/div&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">                    &lt;#--图书子标题--&gt;</span><br><span class=\"line\">                    &lt;div class=&quot;mb-2 w-100&quot;&gt;&#123;&#123;subTitle&#125;&#125;&lt;/div&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">                    &lt;p&gt;&lt;#--评分信息--&gt;</span><br><span class=\"line\">                        &lt;span class=&quot;stars&quot; data-score=&quot;&#123;&#123;evaluationScore&#125;&#125;&quot; \ttitle=&quot;gorgeous&quot;&gt;&lt;img alt=&quot;1&quot; src=&quot;./resources/raty/lib/images/star-on.png&quot; title=&quot;gorgeous&quot;&gt;&amp;nbsp;&lt;img alt=&quot;2&quot; src=&quot;./resources/raty/lib/images/star-on.png&quot; title=&quot;gorgeous&quot;&gt;&amp;nbsp;&lt;img alt=&quot;3&quot; src=&quot;./resources/raty/lib/images/star-on.png&quot; title=&quot;gorgeous&quot;&gt;&amp;nbsp;&lt;img alt=&quot;4&quot; src=&quot;./resources/raty/lib/images/star-on.png&quot; title=&quot;gorgeous&quot;&gt;&amp;nbsp;&lt;img alt=&quot;5&quot; src=&quot;./resources/raty/lib/images/star-on.png&quot; title=&quot;gorgeous&quot;&gt;&lt;input name=&quot;score&quot; type=&quot;hidden&quot; value=&quot;&#123;&#123;evaluationScore&#125;&#125;&quot; readonly=&quot;&quot;&gt;&lt;/span&gt;</span><br><span class=\"line\">                        &lt;span class=&quot;mt-2 ml-2&quot;&gt;&#123;&#123;evaluationScore&#125;&#125;&lt;/span&gt;</span><br><span class=\"line\">                        &lt;span class=&quot;mt-2 ml-2&quot;&gt;&#123;&#123;evaluationQuantity&#125;&#125;人已评&lt;/span&gt;</span><br><span class=\"line\">                    &lt;/p&gt;</span><br><span class=\"line\">                &lt;/div&gt;</span><br><span class=\"line\">            &lt;/div&gt;</span><br><span class=\"line\">        &lt;/a&gt;</span><br><span class=\"line\">    &lt;/script&gt;</span><br><span class=\"line\">&#123;% endraw %&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"实现发评分插件\"><a href=\"#实现发评分插件\" class=\"headerlink\" title=\"实现发评分插件\"></a>实现发评分插件</h3><p>◇Jquery评分插件<a href=\"https://www.jq22.com/jquery-info6430\">raty</a><br>◇引用raty的css和js</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">&lt;link rel=<span class=\"string\">&quot;stylesheet&quot;</span> href=<span class=\"string\">&quot;./resources/raty/lib/jquery.raty.css&quot;</span>&gt;</span><br><span class=\"line\">&lt;script src=<span class=\"string\">&quot;./resources/raty/lib/jquery.raty.js&quot;</span>&gt;&lt;/script&gt;</span><br></pre></td></tr></table></figure>\n<p>◇将评价部分的静态部分星星图片删除，即删除&lt;img&gt;标签</p>\n<h3 id=\"实现加载更多\"><a href=\"#实现加载更多\" class=\"headerlink\" title=\"实现加载更多\"></a>实现加载更多</h3><p>◇点击加载更多时显示下一页的数据；则要设置一个数据域：nextpage用于保存下一页的页号是多少；<br>◇在javascript块中新增点击事件；</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/*定义一个加载更多函数 标志位isReset表示重置*/</span></span><br><span class=\"line\">&#123;% raw %&#125;</span><br><span class=\"line\">        <span class=\"function\">function <span class=\"title\">loadMore</span><span class=\"params\">(isReset)</span> </span>&#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (isReset == <span class=\"keyword\">true</span>) &#123;</span><br><span class=\"line\">                $(<span class=\"string\">&quot;#nextPage&quot;</span>).val = <span class=\"number\">1</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">var</span> nextPage = $(<span class=\"string\">&quot;#nextPage&quot;</span>).val();</span><br><span class=\"line\">            $.ajax(&#123;</span><br><span class=\"line\">                url : <span class=\"string\">&quot;/books&quot;</span>,</span><br><span class=\"line\">                data : &#123;p:nextPage&#125;,</span><br><span class=\"line\">                type : <span class=\"string\">&quot;get&quot;</span>,</span><br><span class=\"line\">                dataType : <span class=\"string\">&quot;json&quot;</span>,</span><br><span class=\"line\">                success: function (json) &#123;</span><br><span class=\"line\">                    console.info(json);</span><br><span class=\"line\">                    <span class=\"keyword\">var</span> list = json.records;</span><br><span class=\"line\">                    <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i = <span class=\"number\">0</span>; i &lt; list.length; i++) &#123;</span><br><span class=\"line\">                        <span class=\"keyword\">var</span> book = json.records[i];</span><br><span class=\"line\">                        <span class=\"keyword\">var</span> html = template(<span class=\"string\">&quot;tpl&quot;</span>, book);</span><br><span class=\"line\">                        $(<span class=\"string\">&quot;#bookList&quot;</span>).append(html);</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                    $(<span class=\"string\">&quot;.stars&quot;</span>).raty(&#123;readOnly:<span class=\"keyword\">true</span>&#125;);</span><br><span class=\"line\">                    <span class=\"comment\">/*如果当前页小于总页数,则显示点击更多按钮*/</span></span><br><span class=\"line\">                    <span class=\"keyword\">if</span>(json.current &lt; json.pages)&#123;</span><br><span class=\"line\">                        $(<span class=\"string\">&quot;#nextPage&quot;</span>).val(parseInt(json.current) + <span class=\"number\">1</span>);</span><br><span class=\"line\">                        $(<span class=\"string\">&quot;#btnMore&quot;</span>).show();<span class=\"comment\">//显示组件</span></span><br><span class=\"line\">                        $(<span class=\"string\">&quot;#divNoMore&quot;</span>).hide();<span class=\"comment\">//隐藏组件</span></span><br><span class=\"line\">                    &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">                        $(<span class=\"string\">&quot;#btnMore&quot;</span>).hide();<span class=\"comment\">//显示组件</span></span><br><span class=\"line\">                        $(<span class=\"string\">&quot;#divNoMore&quot;</span>).show();<span class=\"comment\">//隐藏组件</span></span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//绑定加载更多按钮单击事件</span></span><br><span class=\"line\">        $(function () &#123;</span><br><span class=\"line\">            $(<span class=\"string\">&quot;#btnMore&quot;</span>).click(function () &#123;</span><br><span class=\"line\">                loadMore();</span><br><span class=\"line\">            &#125;);</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">&#123;% endraw %&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"多条件分页查询\"><a href=\"#多条件分页查询\" class=\"headerlink\" title=\"多条件分页查询\"></a>多条件分页查询</h3><p>◇实现的第一个步骤：当我吗点击查询条件的连接后需要将其高亮显示；第二，在点击之后根据所选的条件在后台进行动态查询；<br>◇在按钮单击事件中对category进行捕获然后设置单击事件；</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/*.category是进行类选择*/</span></span><br><span class=\"line\">            $(<span class=\"string\">&quot;.category&quot;</span>).click(function () &#123;</span><br><span class=\"line\">                $(<span class=\"string\">&quot;.category&quot;</span>).removeClass(<span class=\"string\">&quot;highlight&quot;</span>);<span class=\"comment\">//移除原先所拥有的高亮css</span></span><br><span class=\"line\">                $(<span class=\"string\">&quot;.category&quot;</span>).addClass(<span class=\"string\">&quot;text-black-50&quot;</span>);<span class=\"comment\">//设置为灰色</span></span><br><span class=\"line\">                $(<span class=\"keyword\">this</span>).addClass(<span class=\"string\">&quot;highlight&quot;</span>);<span class=\"comment\">//设置当前点击的为高亮</span></span><br><span class=\"line\">            &#125;);</span><br></pre></td></tr></table></figure>\n<p>◇修改service进行数据联动，在paging方法中增加两个参数categoryId, order;然后在其实现类中进行条件的判断；</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> IPage&lt;Book&gt; <span class=\"title\">paging</span><span class=\"params\">(Long categoryId,String order,Integer page, Integer rows)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">//分页信息：哪一页，每页的记录数</span></span><br><span class=\"line\">        Page&lt;Book&gt; p = <span class=\"keyword\">new</span> Page&lt;Book&gt;(page, rows);</span><br><span class=\"line\">        <span class=\"comment\">//条件构造器，为空表示没有条件</span></span><br><span class=\"line\">        QueryWrapper&lt;Book&gt; queryWrapper = <span class=\"keyword\">new</span> QueryWrapper&lt;Book&gt;();</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (categoryId != <span class=\"keyword\">null</span> &amp;&amp; categoryId != -<span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">            <span class=\"comment\">//设置条件为分类的id ,查询等于指定字段的数据</span></span><br><span class=\"line\">            queryWrapper.eq(<span class=\"string\">&quot;category_id&quot;</span>, categoryId);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (order != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (order.equals(<span class=\"string\">&quot;quantity&quot;</span>)) &#123;</span><br><span class=\"line\">                <span class=\"comment\">//设置条件按照指定的字段进行降序排序</span></span><br><span class=\"line\">                queryWrapper.orderByDesc(<span class=\"string\">&quot;evaluation_quantity&quot;</span>);</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (order.equals(<span class=\"string\">&quot;score&quot;</span>)) &#123;</span><br><span class=\"line\">                queryWrapper.orderByDesc(<span class=\"string\">&quot;evaluation_score&quot;</span>);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">//参数为分页信息，条件构造器</span></span><br><span class=\"line\">        IPage&lt;Book&gt; pageObject =  bookMapper.selectPage(p, queryWrapper);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> pageObject;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n<p>◇然后在controller调用paging方法处进行修改，增加两个参数</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@GetMapping(&quot;/books&quot;)</span></span><br><span class=\"line\">    <span class=\"meta\">@ResponseBody</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> IPage&lt;Book&gt; <span class=\"title\">selectBook</span><span class=\"params\">(Long categoryId,String order,Integer p)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (p == <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">            p=<span class=\"number\">1</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        IPage&lt;Book&gt; iPage = bookService.paging(categoryId,order,p,<span class=\"number\">5</span>);<span class=\"comment\">//默认每页显示5条数据</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> iPage;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n<p>◇以上方法设置完后，需要把前台的分类和排序数据传到控制器中；即在index.ftl中进行设置，点击不同的超链接或者span后，给对应的<a href=\"https://www.w3school.com.cn/jsref/dom_obj_hidden.asp\">隐藏域</a>进行赋值；其中使用到了<a href=\"https://www.w3school.com.cn/tags/att_global_data.asp\">自定义属性，data-*</a> ；<br>◇最后进行数据的查询，需要修改发送请求的方法（在loadMore中），在发送请求的数据data中附加分类和排序信息，在点击选择类别、排序规则的点击事件中增加loadMore方法，并将是否重置设置为true，因为每一次点击选择类别或排序方法的时候就相当于重新进行查询，那自然是重第一页进行的；</p>\n<h2 id=\"图书详情页\"><a href=\"#图书详情页\" class=\"headerlink\" title=\"图书详情页\"></a>图书详情页</h2><h3 id=\"实现主页面\"><a href=\"#实现主页面\" class=\"headerlink\" title=\"实现主页面\"></a>实现主页面</h3><p>◇在训练素材中将详情页复制到项目中，并改为detail.ftl；<br>◇在BookService接口中开发新的查询方法，根据图书编号查询图书对象；并完成其实现类；在本项目中使用面向接口编程的思想，所以每一个service都有接口及其实现类；<br>◇接下来实现controller，在controller中根据index.ftl提供的url(book/id)进行相应的绑定；</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">&#123;% raw %&#125;</span><br><span class=\"line\"><span class=\"meta\">@GetMapping(&quot;/book/&#123;id&#125;&quot;)</span><span class=\"comment\">//路径变量用&#123;&#125;包裹</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> ModelAndView <span class=\"title\">showDetail</span><span class=\"params\">(<span class=\"meta\">@PathVariable(&quot;id&quot;)</span>Long id)</span> </span>&#123;</span><br><span class=\"line\">        Book book = bookService.selectById(id);</span><br><span class=\"line\">        ModelAndView mav = <span class=\"keyword\">new</span> ModelAndView(<span class=\"string\">&quot;/detail&quot;</span>);</span><br><span class=\"line\">        mav.addObject(<span class=\"string\">&quot;book&quot;</span>, book);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> mav;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#123;% endraw %&#125;</span><br></pre></td></tr></table></figure>\n<p>◇当我们运行后，会发现js、css等未加载；F12查看NetWork选择all，会发现有css、js的请求为404；点击查看发现路径是localhost/book/resources/bootstrap/bootstrap.css，这是因为我们使用了相对路径，而相对路径是基于目前我们url所在的路径(localhost/book)之后进行附加；所以我们访问的资源错误，则应该改为绝对路径来开发(在这里去掉 . 即可)</p>\n<h3 id=\"实现评论列表\"><a href=\"#实现评论列表\" class=\"headerlink\" title=\"实现评论列表\"></a>实现评论列表</h3><p>◇首先创建评论的实体类Evaluation；<br>◇创建EvaluationMapper；<br>◇创建evaluation.xml<br>◇创建EvaluationService，并完成其实现类；<br>◇进入BookController中修改showDetail方法，使其得到evaluationList对象，并添加到mav中<br>◇在detail.ftl中对evaluationList进行遍历显示；<br>◇由于评论列表需要显示用户名，所以需要增加用户的实现类以及Mapper等等；然后在Evaluation实体类中增加关联对象</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//设置关联对象</span></span><br><span class=\"line\">    <span class=\"meta\">@TableField(exist = false)</span><span class=\"comment\">//说明book属性在数据库表中没有对应的字段,不会参与到sql自动生成</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> Book book;</span><br><span class=\"line\">    <span class=\"meta\">@TableField(exist = false)</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> Member member;</span><br></pre></td></tr></table></figure>\n<p>◇在EvaluationService接口的实现类中进行获取每一条评论的用户信息的实现；</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> List&lt;Evaluation&gt; <span class=\"title\">selectByBookId</span><span class=\"params\">(Long bookId)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">//获取图书对象</span></span><br><span class=\"line\">        Book book = bookMapper.selectById(bookId);</span><br><span class=\"line\">        QueryWrapper&lt;Evaluation&gt; queryWrapper = <span class=\"keyword\">new</span> QueryWrapper&lt;Evaluation&gt;();</span><br><span class=\"line\">        queryWrapper.eq(<span class=\"string\">&quot;book_id&quot;</span>, bookId);</span><br><span class=\"line\">        queryWrapper.eq(<span class=\"string\">&quot;state&quot;</span>, <span class=\"string\">&quot;enable&quot;</span>);</span><br><span class=\"line\">        queryWrapper.orderByDesc(<span class=\"string\">&quot;create_time&quot;</span>);</span><br><span class=\"line\">        List&lt;Evaluation&gt; evaluationList = evaluationMapper.selectList(queryWrapper);</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (Evaluation eva : evaluationList) &#123;</span><br><span class=\"line\">            <span class=\"comment\">/*遍历每一个评论列表，然后根据评论列表的memberId在数据库中查询member对象</span></span><br><span class=\"line\"><span class=\"comment\">            * 再把查到的对象赋值给Evaluation类里面关联的对象Member*/</span></span><br><span class=\"line\">            Member member = (Member) memberMapper.selectById(eva.getMemberId());</span><br><span class=\"line\">            eva.setMember(member);</span><br><span class=\"line\">            eva.setBook(book);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> evaluationList;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n<p>◇获取每一条评论的图书信息和获取用户信息类似，只不过每一个图书下面有许多评论，而每一条评论和其评论者是一 一对应的；因此图书对象的获取放在循环外面；</p>\n<h2 id=\"开发验证码功能\"><a href=\"#开发验证码功能\" class=\"headerlink\" title=\"开发验证码功能\"></a>开发验证码功能</h2><h3 id=\"Kaptcha验证码组件\"><a href=\"#Kaptcha验证码组件\" class=\"headerlink\" title=\"Kaptcha验证码组件\"></a>Kaptcha验证码组件</h3><p>◇Kaptcha是谷歌开源的可高度配置的实用验证码生成工具<br>◇通过Kaptcha可阻拦大多数机器人脚本操作<br>◇Kaptcha典型应用于注册、登录、重要信息提交等用户交互</p>\n<h3 id=\"Kaptcha使用步骤\"><a href=\"#Kaptcha使用步骤\" class=\"headerlink\" title=\"Kaptcha使用步骤\"></a>Kaptcha使用步骤</h3><p>◇Kaptcha配置验证码生成参数<br>◇开发KapatchaController生成验证码图片<br>◇将前台输入验证码与session保存的验证码进行比对  </p>\n<h3 id=\"Kaptcha的配置及使用\"><a href=\"#Kaptcha的配置及使用\" class=\"headerlink\" title=\"Kaptcha的配置及使用\"></a>Kaptcha的配置及使用</h3><p>◇pom.xml加载依赖</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!-- Kaptcha验证码组件 --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.github.penggle<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>kaptcha<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>2.3.2<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>◇applicationContext.xml进行配置</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!-- 配置Kaptcha --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;kaptchaProducer&quot;</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;com.google.code.kaptcha.impl.DefaultKaptcha&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;config&quot;</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;com.google.code.kaptcha.util.Config&quot;</span>&gt;</span><span class=\"comment\">&lt;!--该bean不需要id，只需要指明类--&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">constructor-arg</span>&gt;</span><span class=\"comment\">&lt;!--构造参数--&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">props</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"comment\">&lt;!--验证码图片不生成边框--&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">prop</span> <span class=\"attr\">key</span>=<span class=\"string\">&quot;kaptcha.border&quot;</span>&gt;</span>no<span class=\"tag\">&lt;/<span class=\"name\">prop</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"comment\">&lt;!-- 验证码图片宽度为120像素 --&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">prop</span> <span class=\"attr\">key</span>=<span class=\"string\">&quot;kaptcha.image.width&quot;</span>&gt;</span>120<span class=\"tag\">&lt;/<span class=\"name\">prop</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"comment\">&lt;!-- 验证码图片字体颜色为蓝色 --&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">prop</span> <span class=\"attr\">key</span>=<span class=\"string\">&quot;kaptcha.textproducer.font.color&quot;</span>&gt;</span>blue<span class=\"tag\">&lt;/<span class=\"name\">prop</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"comment\">&lt;!-- 每个字符最大占用40像素 --&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">prop</span> <span class=\"attr\">key</span>=<span class=\"string\">&quot;kaptcha.textproducer.font.size&quot;</span>&gt;</span>40<span class=\"tag\">&lt;/<span class=\"name\">prop</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"comment\">&lt;!-- 验证码包含4个字符 --&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">prop</span> <span class=\"attr\">key</span>=<span class=\"string\">&quot;kaptcha.textproducer.char.length&quot;</span>&gt;</span>4<span class=\"tag\">&lt;/<span class=\"name\">prop</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;/<span class=\"name\">props</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">constructor-arg</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">property</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>◇创建新的控制器KaptchaController</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">KaptchaController</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/*引用Producer接口*/</span></span><br><span class=\"line\">    <span class=\"meta\">@Resource</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> Producer kaptchaProducer;<span class=\"comment\">//这里的属性名需要和配置的beanId一致;</span></span><br><span class=\"line\">    <span class=\"comment\">/*参数为原生的http请求和响应对象</span></span><br><span class=\"line\"><span class=\"comment\">    * 这样书写，把原生的对象放在参数列表中，则会在运行时由springIOC容器将当前的请求与</span></span><br><span class=\"line\"><span class=\"comment\">    * 响应对象动态的注入到对应的参数中*/</span></span><br><span class=\"line\">    <span class=\"meta\">@GetMapping(&quot;/verify_code&quot;)</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">createVerifyCode</span><span class=\"params\">(HttpServletRequest request, HttpServletResponse response)</span> <span class=\"keyword\">throws</span> IOException </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">//设置响应过期时间,0为立即过期</span></span><br><span class=\"line\">        response.setDateHeader(<span class=\"string\">&quot;Expires&quot;</span>,<span class=\"number\">0</span>);</span><br><span class=\"line\">        <span class=\"comment\">/*设置缓存控制;因为每一次要求生成的验证码都是全新的；所以需要把浏览器的缓存都进行清空</span></span><br><span class=\"line\"><span class=\"comment\">        *no-store不存储  no-cache不缓存 must-revalidate必须重新校验*/</span></span><br><span class=\"line\">        response.setHeader(<span class=\"string\">&quot;Cache-Control&quot;</span>, <span class=\"string\">&quot;no-store,no-cache,must-revalidate&quot;</span>);</span><br><span class=\"line\">        <span class=\"comment\">//处于兼容性考虑，平时一般用不到</span></span><br><span class=\"line\">        response.setHeader(<span class=\"string\">&quot;Cache-Control&quot;</span>,<span class=\"string\">&quot;post-check=0,pre-check=0&quot;</span>);</span><br><span class=\"line\">        response.setHeader(<span class=\"string\">&quot;Pragma&quot;</span>,<span class=\"string\">&quot;no-cache&quot;</span>);<span class=\"comment\">//以上三行都是设置浏览器不缓存任何图片数据</span></span><br><span class=\"line\">        response.setContentType(<span class=\"string\">&quot;image/png&quot;</span>);<span class=\"comment\">//返回类型为图片</span></span><br><span class=\"line\">        <span class=\"comment\">//生成验证码字符文本</span></span><br><span class=\"line\">        String verifyCode = kaptchaProducer.createText();</span><br><span class=\"line\">        <span class=\"comment\">//将验证码放到会话(Session)中</span></span><br><span class=\"line\">        request.getSession().setAttribute(<span class=\"string\">&quot;kaptchaVerifyCode&quot;</span>,verifyCode);</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;验证码为：&quot;</span> + request.getSession().getAttribute(<span class=\"string\">&quot;kaptchaVerifyCode&quot;</span>));</span><br><span class=\"line\">        <span class=\"comment\">//创建验证码图片,返回为二进制的图片</span></span><br><span class=\"line\">        BufferedImage image = kaptchaProducer.createImage(verifyCode);</span><br><span class=\"line\">        <span class=\"comment\">/*用getOutputStream方法向浏览器输出二进制文件(如图片等)*/</span></span><br><span class=\"line\">        ServletOutputStream out = response.getOutputStream();</span><br><span class=\"line\">        <span class=\"comment\">//将图片以png形式写入out输出流中</span></span><br><span class=\"line\">        ImageIO.write(image, <span class=\"string\">&quot;png&quot;</span>, out);</span><br><span class=\"line\">        out.flush();<span class=\"comment\">//立即输出</span></span><br><span class=\"line\">        out.close();<span class=\"comment\">//关闭输出流</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"实现用户注册功能\"><a href=\"#实现用户注册功能\" class=\"headerlink\" title=\"实现用户注册功能\"></a>实现用户注册功能</h2><p>◇将训练素材的注册页复制到项目中并改名为register.ftl；<br>◇创建用户控制器类</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Controller</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MemberController</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"meta\">@GetMapping(&quot;/register.html&quot;)</span><span class=\"comment\">/*这里的后缀可写可不写*/</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> ModelAndView <span class=\"title\">showRegister</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">//没有数据传到前台，因此直接return</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> ModelAndView(<span class=\"string\">&quot;/register&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>◇实现点击验证码图片刷新功能</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//重新发送请求,刷新验证码</span></span><br><span class=\"line\">   <span class=\"function\">function <span class=\"title\">reloadVerifyCode</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">       <span class=\"comment\">//attr设置组件属性（属性名，属性值）</span></span><br><span class=\"line\">       <span class=\"comment\">/*ts代表timestamp(时间戳),get请求容易被浏览器缓存起来,所以有可能</span></span><br><span class=\"line\"><span class=\"comment\">       * 点击图片后尽管执行了代码但图片还是原来的，则增加时间戳使每次get请求的url不一样*/</span></span><br><span class=\"line\">       $(<span class=\"string\">&quot;#imgVerifyCode&quot;</span>).attr(<span class=\"string\">&quot;src&quot;</span>, <span class=\"string\">&quot;/verify_code?ts=&quot;</span> + <span class=\"keyword\">new</span> Date().getTime());</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//点击事件，点击验证码图片刷新验证码</span></span><br><span class=\"line\">   $(<span class=\"string\">&quot;#imgVerifyCode&quot;</span>).click(function () &#123;</span><br><span class=\"line\">       reloadVerifyCode();</span><br><span class=\"line\">   &#125;);</span><br></pre></td></tr></table></figure>\n<h3 id=\"验证码校验\"><a href=\"#验证码校验\" class=\"headerlink\" title=\"验证码校验\"></a>验证码校验</h3><p>◇在register页面中发送ajax请求<br>◇在Member控制器中进行接收</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/*因为无论哪一个web应用框架都是基于底层的Servlet进行实现，所以这里我们</span></span><br><span class=\"line\"><span class=\"comment\">    * 可以直接将原生的HttpServletRequest对象写入参数中进行使用*/</span></span><br><span class=\"line\">    <span class=\"meta\">@PostMapping(&quot;/register&quot;)</span><span class=\"comment\">//ajax采用post方式提交的</span></span><br><span class=\"line\">    <span class=\"meta\">@ResponseBody</span> <span class=\"comment\">//直接进行序列化的响应返回</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> Map <span class=\"title\">register</span><span class=\"params\">(String vc, String username, String password, String nickname, HttpServletRequest request)</span> </span>&#123;</span><br><span class=\"line\">       <span class=\"comment\">//获取当前会话中的kaptchaVerifyCode属性的值(即验证码)</span></span><br><span class=\"line\">        String verifyCode = (String) request.getSession().getAttribute(<span class=\"string\">&quot;kaptchaVerifyCode&quot;</span>);</span><br><span class=\"line\">        <span class=\"comment\">/*验证码校验,返回result Map对象*/</span></span><br><span class=\"line\">        Map result = <span class=\"keyword\">new</span> HashMap();</span><br><span class=\"line\">        <span class=\"comment\">//没有写入验证码||后台没有产生验证码||忽略大小写比对验证码</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (vc == <span class=\"keyword\">null</span>||verifyCode == <span class=\"keyword\">null</span>||vc.equalsIgnoreCase(verifyCode)) &#123;</span><br><span class=\"line\">            result.put(<span class=\"string\">&quot;code&quot;</span>,<span class=\"string\">&quot;VC01&quot;</span>);</span><br><span class=\"line\">            result.put(<span class=\"string\">&quot;msg&quot;</span>, <span class=\"string\">&quot;验证码错误&quot;</span>);</span><br><span class=\"line\">        &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">            result.put(<span class=\"string\">&quot;code&quot;</span>,<span class=\"string\">&quot;0&quot;</span>);</span><br><span class=\"line\">            result.put(<span class=\"string\">&quot;msg&quot;</span>, <span class=\"string\">&quot;success&quot;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> result;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"实现业务逻辑\"><a href=\"#实现业务逻辑\" class=\"headerlink\" title=\"实现业务逻辑\"></a>实现业务逻辑</h3><p>◇新增MemberService接口，定义createMember()方法用于创建新的用户；完成其实现类，在实现类中注入mapper用于查询；<br>◇在service下创建子包exception然后新增一个异常类BussinessException，用来处理我们注册登录等相关异常;<br>◇在pom.xml中增加加密/解密组件，用来对密码进行加密;创建utils工具包，在其下创建MD5Utils类；</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MD5Utils</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> String <span class=\"title\">md5Digest</span><span class=\"params\">(String source, Integer salt)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">char</span>[] ca = source.toCharArray();<span class=\"comment\">//获取到字符数组</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; ca.length; i++) &#123;</span><br><span class=\"line\">            ca[i] = (<span class=\"keyword\">char</span>) (ca[i] + salt);<span class=\"comment\">//对原始字符串的每一位字符加盐混淆</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        String target = <span class=\"keyword\">new</span> String(ca);<span class=\"comment\">//再将字符数组转换为原始字符串</span></span><br><span class=\"line\">        String md5 = DigestUtils.md5Hex(target);<span class=\"comment\">//MD5摘要</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> md5;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>◇用户注册底层逻辑</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 会员注册,创建新的会员</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> username 用户名</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> password 密码</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> nickname 昵称</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> 新的会员对象</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> Member <span class=\"title\">createMember</span><span class=\"params\">(String username, String password, String nickname)</span> </span>&#123;</span><br><span class=\"line\">        QueryWrapper&lt;Member&gt; queryWrapper = <span class=\"keyword\">new</span> QueryWrapper&lt;Member&gt;();</span><br><span class=\"line\">        queryWrapper.eq(<span class=\"string\">&quot;username&quot;</span>, username);</span><br><span class=\"line\">        List&lt;Member&gt; memberList = memberMapper.selectList(queryWrapper);</span><br><span class=\"line\">        <span class=\"comment\">//判断用户名是否已存在</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (memberList.size()&gt;<span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">            <span class=\"comment\">//抛出我们自定义的异常</span></span><br><span class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> BussinessException(<span class=\"string\">&quot;M01&quot;</span>, <span class=\"string\">&quot;用户名已存在&quot;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        Member member = <span class=\"keyword\">new</span> Member();</span><br><span class=\"line\">        member.setUsername(username);</span><br><span class=\"line\">        member.setNickname(nickname);</span><br><span class=\"line\">        <span class=\"comment\">//生成小于1000的随机数加上1000相当于随机的4位数用来当作盐值；</span></span><br><span class=\"line\">        <span class=\"keyword\">int</span> salt = <span class=\"keyword\">new</span> Random().nextInt(<span class=\"number\">1000</span>) + <span class=\"number\">1000</span>;</span><br><span class=\"line\">        String md5 = MD5Utils.md5Digest(password, salt);</span><br><span class=\"line\">        member.setSalt(salt);</span><br><span class=\"line\">        member.setPassword(md5);</span><br><span class=\"line\">        member.setCreateTime(<span class=\"keyword\">new</span> Date());</span><br><span class=\"line\">        memberMapper.insert(member);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> member;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n<p>◇在MemberController中注入memberService进行用户注册功能的完善；</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Controller</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MemberController</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"meta\">@Resource</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> MemberService memberService;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@GetMapping(&quot;/register.html&quot;)</span><span class=\"comment\">/*这里的后缀可写可不写*/</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> ModelAndView <span class=\"title\">showRegister</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> ModelAndView(<span class=\"string\">&quot;/register&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/*因为无论哪一个web应用框架都是基于底层的Servlet进行实现，所以这里我们</span></span><br><span class=\"line\"><span class=\"comment\">    * 可以直接将原生的HttpServletRequest对象写入参数中进行使用</span></span><br><span class=\"line\"><span class=\"comment\">    在register方法中的参数必须和前台的一致，这样才能将前台的数据传递到方法的参数中；</span></span><br><span class=\"line\"><span class=\"comment\">    */</span></span><br><span class=\"line\">    <span class=\"meta\">@PostMapping(&quot;/register&quot;)</span><span class=\"comment\">//ajax采用post方式提交的</span></span><br><span class=\"line\">    <span class=\"meta\">@ResponseBody</span> <span class=\"comment\">//直接进行序列化的响应返回</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> Map <span class=\"title\">register</span><span class=\"params\">(String vc, String username, String password, String nickname, HttpServletRequest request)</span> </span>&#123;</span><br><span class=\"line\">       <span class=\"comment\">//获取当前会话中的kaptchaVerifyCode属性的值(即验证码)</span></span><br><span class=\"line\">        String verifyCode = (String) request.getSession().getAttribute(<span class=\"string\">&quot;kaptchaVerifyCode&quot;</span>);</span><br><span class=\"line\">        <span class=\"comment\">/*验证码校验,返回result Map对象*/</span></span><br><span class=\"line\">        Map result = <span class=\"keyword\">new</span> HashMap();</span><br><span class=\"line\">        <span class=\"comment\">//没有写入验证码||后台没有产生验证码||忽略大小写比对验证码</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (vc == <span class=\"keyword\">null</span>||verifyCode == <span class=\"keyword\">null</span>||vc.equalsIgnoreCase(verifyCode)) &#123;</span><br><span class=\"line\">            result.put(<span class=\"string\">&quot;code&quot;</span>,<span class=\"string\">&quot;VC01&quot;</span>);</span><br><span class=\"line\">            result.put(<span class=\"string\">&quot;msg&quot;</span>, <span class=\"string\">&quot;验证码错误&quot;</span>);</span><br><span class=\"line\">        &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">            <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                <span class=\"comment\">//创建用户</span></span><br><span class=\"line\">                memberService.createMember(username, password, nickname);</span><br><span class=\"line\">                result.put(<span class=\"string\">&quot;code&quot;</span>, <span class=\"string\">&quot;0&quot;</span>);</span><br><span class=\"line\">                result.put(<span class=\"string\">&quot;msg&quot;</span>, <span class=\"string\">&quot;success&quot;</span>);</span><br><span class=\"line\">            &#125; <span class=\"keyword\">catch</span> (BussinessException e) &#123;</span><br><span class=\"line\">                e.printStackTrace();</span><br><span class=\"line\">                result.put(<span class=\"string\">&quot;code&quot;</span>, e.getCode());</span><br><span class=\"line\">                result.put(<span class=\"string\">&quot;msg&quot;</span>, e.getMsg());</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> result;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"实现用户登录\"><a href=\"#实现用户登录\" class=\"headerlink\" title=\"实现用户登录\"></a>实现用户登录</h2><p>◇加载登录页.html改为login.ftl<br>◇在MemberService中增加检查登录的方法checkLogin(返回对象为Member):根据前台传来的用户名拿到整个用户对象，然后根据对象里的salt值和前台传来的密码进行MD5摘要，比对生成的md5字符串是否和对象里的密码一致；<br>◇service里的业务逻辑代码写好后需要在控制器中进行调用;在控制器中创建方法checkLogin,返回对象为Map，因为需要与前台交互；</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/*这里采用session,session比request的范围更广,用来保存页面的用户信息*/</span></span><br><span class=\"line\">    <span class=\"meta\">@ResponseBody</span></span><br><span class=\"line\">    <span class=\"meta\">@PostMapping(&quot;/login&quot;)</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> Map <span class=\"title\">checkLogin</span><span class=\"params\">(String username, String password, String vc, HttpSession session)</span> </span>&#123;</span><br><span class=\"line\">        String verifyCode = (String) session.getAttribute(<span class=\"string\">&quot;kaptchaVerifyCode&quot;</span>);</span><br><span class=\"line\">        Map result = <span class=\"keyword\">new</span> HashMap();</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (vc == <span class=\"keyword\">null</span>||verifyCode == <span class=\"keyword\">null</span>||vc.equalsIgnoreCase(verifyCode)) &#123;</span><br><span class=\"line\">            result.put(<span class=\"string\">&quot;code&quot;</span>,<span class=\"string\">&quot;VC01&quot;</span>);</span><br><span class=\"line\">            result.put(<span class=\"string\">&quot;msg&quot;</span>, <span class=\"string\">&quot;验证码错误&quot;</span>);</span><br><span class=\"line\">        &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">            <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                <span class=\"comment\">//先进行验证码的比对，然后校验登录的用户信息，信息不正确的话会自动抛出异常</span></span><br><span class=\"line\">                Member member = memberService.checkLogin(username, password);</span><br><span class=\"line\">                <span class=\"comment\">//保存登录用户的信息，在首页中进行展现</span></span><br><span class=\"line\">                session.setAttribute(<span class=\"string\">&quot;loginMember&quot;</span>, member);</span><br><span class=\"line\">                result.put(<span class=\"string\">&quot;code&quot;</span>, <span class=\"string\">&quot;0&quot;</span>);</span><br><span class=\"line\">                result.put(<span class=\"string\">&quot;msg&quot;</span>, <span class=\"string\">&quot;success&quot;</span>);</span><br><span class=\"line\">            &#125; <span class=\"keyword\">catch</span> (BussinessException e) &#123;</span><br><span class=\"line\">                e.printStackTrace();</span><br><span class=\"line\">                result.put(<span class=\"string\">&quot;code&quot;</span>, e.getCode());</span><br><span class=\"line\">                result.put(<span class=\"string\">&quot;msg&quot;</span>, e.getMsg());</span><br><span class=\"line\">            &#125; <span class=\"keyword\">finally</span> &#123;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> result;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n<p>◇如果发现if语句没有执行,一定要仔细检查条件是否正确；</p>\n<h2 id=\"用户交互功能\"><a href=\"#用户交互功能\" class=\"headerlink\" title=\"用户交互功能\"></a>用户交互功能</h2><h3 id=\"阅读状态变更\"><a href=\"#阅读状态变更\" class=\"headerlink\" title=\"阅读状态变更\"></a>阅读状态变更</h3><p>◇阅读状态的变更只能选择想看和看过其一；<br>◇为阅读状态创建实体类MemberReadState;然后创建相关的Mapper接口及xml；<br>◇在MemberService接口中实现用户的交互功能，新增方法selectMemberReadState()，用来查询传入的两个参数用户与图书是否有阅读状态；<br>◇查询阅读状态方法执行的时机: 当我们跳转到图书详情页面时；因此修改BookController.showDetail（）方法，增加session参数用来获取当前用户的信息；</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@GetMapping(&quot;/book/&#123;bid&#125;&quot;)</span><span class=\"comment\">//路径变量用&#123;&#125;包裹,即将index中book/后的bookId定义为id;</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> ModelAndView <span class=\"title\">showDetail</span><span class=\"params\">(<span class=\"meta\">@PathVariable(&quot;bid&quot;)</span>Long id, HttpSession session)</span> </span>&#123;</span><br><span class=\"line\">        Member member = (Member) session.getAttribute(<span class=\"string\">&quot;loginMember&quot;</span>);</span><br><span class=\"line\">        ModelAndView mav = <span class=\"keyword\">new</span> ModelAndView(<span class=\"string\">&quot;/detail&quot;</span>);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (member != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">            <span class=\"comment\">//获取会员阅读状态</span></span><br><span class=\"line\">            MemberReadState memberReadState = memberService.selectMemberReadState(member.getMemberId(), id);</span><br><span class=\"line\">            mav.addObject(<span class=\"string\">&quot;memberReadState&quot;</span>, memberReadState);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        Book book = bookService.selectById(id);</span><br><span class=\"line\">        List&lt;Evaluation&gt; evaluationList = evaluationService.selectByBookId(id);</span><br><span class=\"line\">        mav.addObject(<span class=\"string\">&quot;book&quot;</span>, book);</span><br><span class=\"line\">        mav.addObject(<span class=\"string\">&quot;evaluationList&quot;</span>, evaluationList);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> mav;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n<p>◇由于用户的阅读状态很有可能为空，所以我们要在detail详情页面的script块中增加javascript语句进行相应的判断;</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/*页面就绪函数，书写freemarker的脚本*/</span></span><br><span class=\"line\">        $(function () &#123;</span><br><span class=\"line\">            &lt;#<span class=\"keyword\">if</span> memberReadState ??&gt;<span class=\"comment\">//存在阅读状态</span></span><br><span class=\"line\">            <span class=\"comment\">/*利用JavaScript的属性选择器，‘*’表示所有名为data-read-state且值为&#x27;&#x27;的属性</span></span><br><span class=\"line\"><span class=\"comment\">            * 并将该属性设置为高亮，那么就可以将对应的想看或者看过的按钮设置为高亮显示了</span></span><br><span class=\"line\"><span class=\"comment\">            * 这里的值是后台通过mav传过来的*/</span></span><br><span class=\"line\">            $(<span class=\"string\">&quot;*[data-read-state=&#x27;$&#123;memberReadState.readState&#125;&#x27;]&quot;</span>).addClass(<span class=\"string\">&quot;highlight&quot;</span>);</span><br><span class=\"line\">            &lt;/#<span class=\"keyword\">if</span>&gt;</span><br><span class=\"line\">        &#125;);</span><br></pre></td></tr></table></figure>\n<p>◇更新会员阅读状态，即点击相应的按钮实现交互功能；<br>◇首先需要在detail页面中进行用户是否登录的判断,只有用户登录了才能进行相应的交互；在刚才的页面就绪函数中添加判断语句；</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">&lt;#<span class=\"keyword\">if</span> !loginMember ??&gt;<span class=\"comment\">/*如果用户没有登录*/</span></span><br><span class=\"line\"><span class=\"comment\">/*选择拥有data-read-state这个自定义属性的标签，而不管自定义属性的值是多少*/</span></span><br><span class=\"line\">$(<span class=\"string\">&quot;*[data-read-state]&quot;</span>).click(function () &#123;</span><br><span class=\"line\">    <span class=\"comment\">/*通过id选择bootstrap的对话框,然后根据其对话框函数执行show(显示)动作*/</span></span><br><span class=\"line\">    $(<span class=\"string\">&quot;#exampleModalCenter&quot;</span>).modal(<span class=\"string\">&quot;show&quot;</span>);</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"><span class=\"comment\">//将写短评以及点赞等功能进行相应的登录控制,这里利用组合选择减少代码</span></span><br><span class=\"line\">$(<span class=\"string\">&quot;#btnEvaluation,*[data-evaluation-id]&quot;</span>).click(function () &#123;</span><br><span class=\"line\">    $(<span class=\"string\">&quot;#exampleModalCenter&quot;</span>).modal(<span class=\"string\">&quot;show&quot;</span>);</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\">&lt;/#<span class=\"keyword\">if</span>&gt;</span><br></pre></td></tr></table></figure>\n<p>◇在MemberService中新增方法写入阅读状态;<br>◇在控制器中进行调用并与前台交互；</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@PostMapping(&quot;/update_read_state&quot;)</span></span><br><span class=\"line\"><span class=\"meta\">@ResponseBody</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> Map <span class=\"title\">updateReadState</span><span class=\"params\">(Long memberId, Long bookId, Integer readState)</span> </span>&#123;</span><br><span class=\"line\">    Map result = <span class=\"keyword\">new</span> HashMap();</span><br><span class=\"line\">    <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">        memberService.updateMemberReadState(memberId, bookId, readState);</span><br><span class=\"line\">        result.put(<span class=\"string\">&quot;code&quot;</span>, <span class=\"string\">&quot;0&quot;</span>);</span><br><span class=\"line\">        result.put(<span class=\"string\">&quot;msg&quot;</span>, <span class=\"string\">&quot;success&quot;</span>);</span><br><span class=\"line\">    &#125; <span class=\"keyword\">catch</span> (BussinessException e) &#123;</span><br><span class=\"line\">        e.printStackTrace();</span><br><span class=\"line\">        result.put(<span class=\"string\">&quot;code&quot;</span>, e.getCode());</span><br><span class=\"line\">        result.put(<span class=\"string\">&quot;msg&quot;</span>, e.getMsg());</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> result;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>◇在页面中发送ajax进行处理；</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">&lt;#<span class=\"keyword\">if</span> loginMember ??&gt;</span><br><span class=\"line\">$(<span class=\"string\">&quot;*[data-read-state]&quot;</span>).click(function () &#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> readState = $(<span class=\"keyword\">this</span>).data(<span class=\"string\">&quot;read-state&quot;</span>);<span class=\"comment\">//获取当前点击按钮的自定义属性的值；</span></span><br><span class=\"line\">    <span class=\"comment\">/*ajax方法的简化形式四个参数为</span></span><br><span class=\"line\"><span class=\"comment\">    (发送的地址，发送的参数列表,处理函数（用来处理服务器返回的数据）,服务器返回的数据类型)*/</span></span><br><span class=\"line\">    $.post(<span class=\"string\">&quot;/update_read_state&quot;</span>,&#123;</span><br><span class=\"line\">        memberId:$&#123;loginMember.memberId&#125;,</span><br><span class=\"line\">        bookId:$&#123;book.bookId&#125;,</span><br><span class=\"line\">        readState:readState</span><br><span class=\"line\">    &#125;,function (json)&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (json.code == <span class=\"string\">&quot;0&quot;</span>) &#123;</span><br><span class=\"line\">            <span class=\"comment\">//将原有高亮的css全部清除，让两个按钮回到默认的状态</span></span><br><span class=\"line\">            $(<span class=\"string\">&quot;*[data-read-state]&quot;</span>).removeClass(<span class=\"string\">&quot;highlight&quot;</span>);</span><br><span class=\"line\">            <span class=\"comment\">/*通过拼接字符串的方式选择刚才点击的那个按钮*/</span></span><br><span class=\"line\">            $(<span class=\"string\">&quot;*[data-read-state=&#x27;&quot;</span> + readState + <span class=\"string\">&quot;&#x27;]&quot;</span>).addClass(<span class=\"string\">&quot;highlight&quot;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;,<span class=\"string\">&quot;json&quot;</span>)</span><br><span class=\"line\">    </span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">//ajax一般写法</span></span><br><span class=\"line\">    $.ajax(&#123;</span><br><span class=\"line\">        url:<span class=\"string\">&quot;/update_read_state&quot;</span>,</span><br><span class=\"line\">        data:&#123;memberId:$&#123;loginMember.memberId&#125;,bookId:$&#123;book.bookId&#125;,readState:readState&#125;,</span><br><span class=\"line\">        type:<span class=\"string\">&quot;post&quot;</span>,</span><br><span class=\"line\">        dataType:<span class=\"string\">&quot;json&quot;</span>,</span><br><span class=\"line\">        success: function (json) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (json.code == <span class=\"string\">&quot;0&quot;</span>) &#123;</span><br><span class=\"line\">                <span class=\"comment\">//将原有高亮的css全部清除，让两个按钮回到默认的状态</span></span><br><span class=\"line\">                $(<span class=\"string\">&quot;*[data-read-state]&quot;</span>).removeClass(<span class=\"string\">&quot;highlight&quot;</span>);</span><br><span class=\"line\">                <span class=\"comment\">/*通过拼接字符串的方式选择刚才点击的那个按钮*/</span></span><br><span class=\"line\">                $(<span class=\"string\">&quot;*[data-read-state=&#x27;&quot;</span> + readState + <span class=\"string\">&quot;&#x27;]&quot;</span>).addClass(<span class=\"string\">&quot;highlight&quot;</span>);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\">&lt;/#<span class=\"keyword\">if</span>&gt;</span><br></pre></td></tr></table></figure>\n<p>◇一点小坑<br>这里的一个小坑，由于忘记设置了主键注解，导致后面在更新阅读状态的时候发现只有没有任何阅读状态的时候</p>\n<ul>\n<li>点击阅读状态会生效；但当切换阅读状态的时候发现请求报500错误，一开始以为是前台的问题，但想着增加阅读状态没问题</li>\n<li>只有修改阅读状态才有问题，以为是后台修改语句的问题，所以检查了后台的业务逻辑，却发现修改语句没有问题，然后慢慢的</li>\n<li>查看日志发现updateById的sql语句是where null = ?才发现可能是忘记了实体类中主键的设置<br><img src=\"/p/aeec/1635326132436-25eb54ae-f219-4c7f-b305-e200ea9931b9.png\" class=\"lazyload\" data-srcset=\"/p/aeec/1635326132436-25eb54ae-f219-4c7f-b305-e200ea9931b9.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"><h3 id=\"图书写短评\"><a href=\"#图书写短评\" class=\"headerlink\" title=\"图书写短评\"></a>图书写短评</h3>◇点击事件弹出写短评的对话框，并加载评分组件；点击提交按钮后边向后台发送数据；<br>◇memberService中新增写短评的方法，并完成其实现类，在controller中进行调用与前台交互<br>◇图书短评的回复功能暂时不开发；</li>\n</ul>\n<h3 id=\"短评点赞\"><a href=\"#短评点赞\" class=\"headerlink\" title=\"短评点赞\"></a>短评点赞</h3><p>◇短评功能只显示短评获得的点赞数量;<br>◇在MemberService中进行短评点赞功能，新增方法enjoy();<br>◇这里发现的一个新bug：就是自己新写的短评然后进行点赞会报错，查看DEBUG:value of type ‘java.lang.String’ to required type ‘java.lang.Long’;说明我们写评论的时候，id值太大了导致系统认为应该是一个字符串而不是Long，这里的原因是使用mybatis-plus增加评论时，ID直接从2000多开始；解决方法是把数据库表删除，然后将主键的自动增长取消，保存；然后设置主键自动增长，保存；最后在前台写入评论，在数据库表中发现id从1开始了（非常玄学）;</p>\n<h2 id=\"Spring-Task定时任务\"><a href=\"#Spring-Task定时任务\" class=\"headerlink\" title=\"Spring-Task定时任务\"></a>Spring-Task定时任务</h2><h2 id=\"介绍\"><a href=\"#介绍\" class=\"headerlink\" title=\"介绍\"></a>介绍</h2><p>◇Spring Task是Spring 3.0后推出的定时任务模块<br>◇Spring Task的职责是按周期后台自动执行任务<br>◇Spring Task可利用Cron表达式实现灵活的定时处理</p>\n<h3 id=\"Cron表达式实例\"><a href=\"#Cron表达式实例\" class=\"headerlink\" title=\"Cron表达式实例\"></a>Cron表达式实例</h3><p><img src=\"/p/aeec/1635496332290-5fb87671-f60c-418e-ad8e-5fc64d31a1c1.png\" class=\"lazyload\" data-srcset=\"/p/aeec/1635496332290-5fb87671-f60c-418e-ad8e-5fc64d31a1c1.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"><br>◇本质是七位的字符串，分别对应秒分…年；<br>◇在大多数情况下只需要前六位就可以了<br>◇ 0代表具体的数字，放在秒这个位置上即表示时间是0秒的时候对应的任务自动执行，*代表任意的时间点；关于具体的日期和星期是互斥的，二者选其一，忽略的用?，则第一行的六位表达式(省略了年)具体含义为任一年，任一月、日、时、分的0秒；<br>◇0-5表示每小时的前5分钟， 0,30表示第0秒和第30秒；</p>\n<h3 id=\"子查询\"><a href=\"#子查询\" class=\"headerlink\" title=\"子查询\"></a>子查询</h3><p>◇ifnull表示为空时设置默认值(此处设置为0)</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\">update book b <span class=\"keyword\">SET</span> evaluation_score <span class=\"operator\">=</span> (</span><br><span class=\"line\">   <span class=\"keyword\">select</span> ifnull(<span class=\"built_in\">avg</span>(score),<span class=\"number\">0</span>) <span class=\"keyword\">from</span> evaluation <span class=\"keyword\">where</span> book_id <span class=\"operator\">=</span> b.book_id <span class=\"keyword\">and</span> state<span class=\"operator\">=</span>&quot;enable&quot;</span><br><span class=\"line\">),evaluation_quantity<span class=\"operator\">=</span>(</span><br><span class=\"line\">   <span class=\"keyword\">select</span> ifnull(<span class=\"built_in\">count</span>(<span class=\"operator\">*</span>),<span class=\"number\">0</span>) <span class=\"keyword\">from</span> evaluation <span class=\"keyword\">where</span> book_id <span class=\"operator\">=</span> b.book_id <span class=\"keyword\">and</span> state<span class=\"operator\">=</span>&quot;enable&quot;</span><br><span class=\"line\">)</span><br></pre></td></tr></table></figure>\n<p>◇现在我们来完成自动执行上面的sql语句；<br>◇mybatis-plus对于简单的sql语句可以直接继承父类，但是对于上面这种复杂的sql语句还是的在mapper中的xml文件里定义；如：</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"operator\">&lt;</span><span class=\"operator\">!</span><span class=\"comment\">--如果命名空间里的接口中没有方法定义，则mapper标签下也无子标签--&gt;</span></span><br><span class=\"line\"><span class=\"operator\">&lt;</span>mapper namespace<span class=\"operator\">=</span>&quot;com.lcg.reader.mapper.BookMapper&quot;<span class=\"operator\">&gt;</span></span><br><span class=\"line\">    <span class=\"operator\">&lt;</span>update id<span class=\"operator\">=</span>&quot;updateEvaluation&quot;<span class=\"operator\">&gt;</span></span><br><span class=\"line\">        update book b <span class=\"keyword\">SET</span> evaluation_score <span class=\"operator\">=</span> (</span><br><span class=\"line\">   <span class=\"keyword\">select</span> ifnull(<span class=\"built_in\">avg</span>(score),<span class=\"number\">0</span>) <span class=\"keyword\">from</span> evaluation <span class=\"keyword\">where</span> book_id <span class=\"operator\">=</span> b.book_id <span class=\"keyword\">and</span> state<span class=\"operator\">=</span>&quot;enable&quot;</span><br><span class=\"line\">),evaluation_quantity<span class=\"operator\">=</span>(</span><br><span class=\"line\">   <span class=\"keyword\">select</span> ifnull(<span class=\"built_in\">count</span>(<span class=\"operator\">*</span>),<span class=\"number\">0</span>) <span class=\"keyword\">from</span> evaluation <span class=\"keyword\">where</span> book_id <span class=\"operator\">=</span> b.book_id <span class=\"keyword\">and</span> state<span class=\"operator\">=</span>&quot;enable&quot;</span><br><span class=\"line\">)</span><br><span class=\"line\">    <span class=\"operator\">&lt;</span><span class=\"operator\">/</span>update<span class=\"operator\">&gt;</span></span><br><span class=\"line\"><span class=\"operator\">&lt;</span><span class=\"operator\">/</span>mapper<span class=\"operator\">&gt;</span></span><br></pre></td></tr></table></figure>\n<p>◇然后在接口中进行定义</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">interface</span> <span class=\"title\">BookMapper</span> <span class=\"keyword\">extends</span> <span class=\"title\">BaseMapper</span>&lt;<span class=\"title\">Book</span>&gt; </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 更新图书评分、评价数量</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">updateEvaluation</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>◇然后在service接口中增加方法</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">updateEvaluation</span><span class=\"params\">()</span></span>;</span><br></pre></td></tr></table></figure>\n<p>◇在接口实现类中具体实现</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">    <span class=\"comment\">/*既然只是调用bookMapper提供的方法，为什么不直接在前台调用呢？</span></span><br><span class=\"line\"><span class=\"comment\">    * 这是因为我们基于MVC的按层逐级调用，禁止从controller直接调用mapper的方法来</span></span><br><span class=\"line\"><span class=\"comment\">    * 进行与数据库的操作,中间必须经过service；遵循这样的开发规范，会使程序维护更加轻松*/</span></span><br><span class=\"line\"><span class=\"meta\">@Transactional</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">updateEvaluation</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        bookMapper.updateEvaluation();</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n<p>◇那么下面如何让updateEvaluation()方法每分钟调用一次呢？那就需要使用spring-Task模块了，该模块包含在spring-context中 在前面我们已经加载了，所以不需要额外引入jar包；<br>◇在applicationContext.xml文件中开启定时任务的注解模式;</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">&lt;!-- 开启Spring Task定时任务的注解模式--&gt;</span><br><span class=\"line\">&lt;task:annotation-driven/&gt;</span><br></pre></td></tr></table></figure>\n<p>◇在reader下创建一个子包：task(任务)，创建一个类ComputeTask(计算任务)</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.lcg.reader.task;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> com.lcg.reader.service.BookService;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.scheduling.annotation.Scheduled;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.stereotype.Component;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> javax.annotation.Resource;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 完成自动计算任务</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"meta\">@Component</span> <span class=\"comment\">//组件注解，当一个类不好确定是service还是controller时增加该注解让spring进行管理</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ComputeTask</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"meta\">@Resource</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> BookService bookService;</span><br><span class=\"line\">    <span class=\"comment\">//任务调度,每分钟0秒的时候执行一次</span></span><br><span class=\"line\">    <span class=\"meta\">@Scheduled(cron=&quot;0 * * * * ?&quot;)</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">updateEvaluation</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        bookService.updateEvaluation();</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;已更新所有图书评分&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n","categories":["Spring","SSM开发项目"],"tags":["SSM"]},{"title":"数据库的基本查询","url":"/p/f427.html","content":"<h2 id=\"数据操作语言：普通查询\"><a href=\"#数据操作语言：普通查询\" class=\"headerlink\" title=\"数据操作语言：普通查询\"></a>数据操作语言：普通查询</h2><h3 id=\"记录查询\"><a href=\"#记录查询\" class=\"headerlink\" title=\"记录查询\"></a>记录查询</h3><p>◇ 最基本的查询语句是由 SELECT 和 FROM 关键字组成的<br>◇ SELECT语句屏蔽了物理层的操作，用户不必关心数据的真 实存储，交由数据库高效的查找数据  </p>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">SELECT</span> <span class=\"operator\">*</span> <span class=\"keyword\">FROM</span> t_student;</span><br><span class=\"line\"><span class=\"keyword\">SELECT</span> id,name,sex <span class=\"keyword\">FROM</span> t_student;</span><br></pre></td></tr></table></figure>\n<h3 id=\"使用列别名\"><a href=\"#使用列别名\" class=\"headerlink\" title=\"使用列别名\"></a>使用列别名</h3><p>◇ 通常情况下，SELECT子句中使用了表达式，那么这列的名 字就默认为表达式，因此需要一种对列名重命名的机制  </p>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">SELECT</span></span><br><span class=\"line\"> ename,</span><br><span class=\"line\"> sal <span class=\"operator\">*</span> <span class=\"number\">12</span> <span class=\"keyword\">AS</span> &quot;annual_salary&quot;</span><br><span class=\"line\"> <span class=\"keyword\">FROM</span></span><br><span class=\"line\"> emp;</span><br></pre></td></tr></table></figure>\n<p>◇ 重命名只在显示输出的时候使用，数据表列名不会真的改变<br>◇ 查询语句的子句执行顺序<br><img src=\"/p/f427/1625994166757-969465a0-9e0f-4a0b-ad16-e6d3ae59731c.png\" class=\"lazyload\" data-srcset=\"/p/f427/1625994166757-969465a0-9e0f-4a0b-ad16-e6d3ae59731c.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"></p>\n<h2 id=\"数据操作语言：数据分页\"><a href=\"#数据操作语言：数据分页\" class=\"headerlink\" title=\"数据操作语言：数据分页\"></a>数据操作语言：数据分页</h2><h3 id=\"数据分页\"><a href=\"#数据分页\" class=\"headerlink\" title=\"数据分页\"></a>数据分页</h3><p>◇ 比如我们查看朋友圈，只会加载少量部分信息，不用一次性加载全 部朋友圈，那样只会浪费CPU时间、内存和网络带宽<br>◇ 如果结果集的记录很多，则可以使用LIMIT关键字限定结果集数量。  </p>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">SELECT</span> …… <span class=\"keyword\">FROM</span> …… LIMIT 起始位置 , 偏移量 ;</span><br><span class=\"line\"><span class=\"keyword\">SELECT</span> empno,ename <span class=\"keyword\">FROM</span> t_emp LIMIT <span class=\"number\">0</span>,<span class=\"number\">20</span>;<span class=\"operator\">/</span><span class=\"operator\">/</span><span class=\"number\">20</span>是偏移量而不是终止的</span><br></pre></td></tr></table></figure>\n<h3 id=\"数据分页的简写用法\"><a href=\"#数据分页的简写用法\" class=\"headerlink\" title=\"数据分页的简写用法\"></a>数据分页的简写用法</h3><p>◇如果LIMIT子句只有一个参数，它表示的是偏移量，起始值默认为0<br>◇执行顺序： FROM -&gt; SELECT -&gt; LIMIT  </p>\n<h2 id=\"数据操作语言：结果集排序\"><a href=\"#数据操作语言：结果集排序\" class=\"headerlink\" title=\"数据操作语言：结果集排序\"></a>数据操作语言：结果集排序</h2><h3 id=\"结果集排序\"><a href=\"#结果集排序\" class=\"headerlink\" title=\"结果集排序\"></a>结果集排序</h3><p>◇ 如果没有设置，查询语句不会对结果集进行排序。也就是说，如果 想让结果集按照某种顺序排列，就必须使用ORDER BY子句。  </p>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">SELECT</span> …… <span class=\"keyword\">FROM</span> …… <span class=\"keyword\">ORDER</span> <span class=\"keyword\">BY</span> 列名 [ <span class=\"keyword\">ASC</span> <span class=\"operator\">|</span> <span class=\"keyword\">DESC</span> ] ;</span><br></pre></td></tr></table></figure>\n<h3 id=\"排序关键字\"><a href=\"#排序关键字\" class=\"headerlink\" title=\"排序关键字\"></a>排序关键字</h3><p> ◇ASC代表升序（默认），DESC代表降序 如果排序列是数字类型，数据库就按照数字大小排序，如果是日期 类型就按照日期大小排序，如果是字符串就按照字符集序号排序。  </p>\n<h3 id=\"排序字段内容相同的情况\"><a href=\"#排序字段内容相同的情况\" class=\"headerlink\" title=\"排序字段内容相同的情况\"></a>排序字段内容相同的情况</h3><p>◇ 默认情况下，如果两条数据排序字段内容相同，那么排序会是什么 样子？<br>◇ 如果排序字段内容相同，MySQL会按照主键大小来排序两条数据  </p>\n<h3 id=\"多个排序字段\"><a href=\"#多个排序字段\" class=\"headerlink\" title=\"多个排序字段\"></a>多个排序字段</h3><p> ◇我们可以使用ORDER BY规定首要排序条件和次要排序条件。数据 库会先按照首要排序条件排序，如果遇到首要排序内容相同的记录 ，那么就会启用次要排序条件接着排序  </p>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">SELECT</span> empno,ename,sal,hiredate</span><br><span class=\"line\"><span class=\"keyword\">FROM</span> t_emp</span><br><span class=\"line\"><span class=\"keyword\">ORDER</span> <span class=\"keyword\">BY</span> sal <span class=\"keyword\">DESC</span>,hiredate <span class=\"keyword\">ASC</span>;</span><br></pre></td></tr></table></figure>\n<h3 id=\"排序-分页\"><a href=\"#排序-分页\" class=\"headerlink\" title=\"排序+分页\"></a>排序+分页</h3><p>◇ ORDER BY子句书写的时候放在LIMIT子句的前面<br> FROM -&gt; SELECT -&gt; ORDER BY -&gt; LIMIT  </p>\n<h2 id=\"数据操作语言：去除重复记录\"><a href=\"#数据操作语言：去除重复记录\" class=\"headerlink\" title=\"数据操作语言：去除重复记录\"></a>数据操作语言：去除重复记录</h2><p>◇ 假如我们要查询员工表有多少种职业， 如果我们需要去除重复的数据，可以使用DISTINCT关键字来实现  ；</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">SELECT</span> <span class=\"keyword\">DISTINCT</span> 字段 <span class=\"keyword\">FROM</span> …… ;</span><br></pre></td></tr></table></figure>\n<p>◇ 注意事项  ： ①使用DISTINCT的SELECT子句中只能查询一列数据，如果查询多列， 去除重复记录就会失效。<br>② DISTINCT关键字只能在SELECT子句中使用一次  ；</p>\n<h2 id=\"数据操作语言：条件查询\"><a href=\"#数据操作语言：条件查询\" class=\"headerlink\" title=\"数据操作语言：条件查询\"></a>数据操作语言：条件查询</h2><h3 id=\"条件查询\"><a href=\"#条件查询\" class=\"headerlink\" title=\"条件查询\"></a>条件查询</h3><p>◇ 很多时候，用户感兴趣的并不是逻辑表里的全部记录，而只是它们 当中能够满足某一种或某几种条件的记录。这类条件要用WHERE子 句来实现数据的筛选  </p>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">SELECT</span> …… <span class=\"keyword\">FROM</span> …… <span class=\"keyword\">WHERE</span> 条件 [ <span class=\"keyword\">AND</span> <span class=\"operator\">|</span> <span class=\"keyword\">OR</span> ] 条件 …… ;</span><br></pre></td></tr></table></figure>\n<h3 id=\"四类运算符\"><a href=\"#四类运算符\" class=\"headerlink\" title=\"四类运算符\"></a>四类运算符</h3><p> WHERE语句中的条件运算会用到以下四种运算符：<br><img src=\"/p/f427/1625997158623-77abf14a-54c7-475f-b681-9b41a645994f.png\" class=\"lazyload\" data-srcset=\"/p/f427/1625997158623-77abf14a-54c7-475f-b681-9b41a645994f.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"></p>\n<h3 id=\"算数运算符\"><a href=\"#算数运算符\" class=\"headerlink\" title=\"算数运算符\"></a>算数运算符</h3><p><img src=\"/p/f427/1626506515565-3a9d08ca-5c97-4fbd-84e7-3fcdfa11bca4.png\" class=\"lazyload\" data-srcset=\"/p/f427/1626506515565-3a9d08ca-5c97-4fbd-84e7-3fcdfa11bca4.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"></p>\n<h3 id=\"比较运算符\"><a href=\"#比较运算符\" class=\"headerlink\" title=\"比较运算符\"></a>比较运算符</h3><p><img src=\"/p/f427/1626506532025-a81b1d45-0bcb-4b12-99af-3bf2f1ac8c56.png\" class=\"lazyload\" data-srcset=\"/p/f427/1626506532025-a81b1d45-0bcb-4b12-99af-3bf2f1ac8c56.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"><br><img src=\"/p/f427/1626506751691-a643c08a-1c57-46a6-8a9e-0f7478ade47b.png\" class=\"lazyload\" data-srcset=\"/p/f427/1626506751691-a643c08a-1c57-46a6-8a9e-0f7478ade47b.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"></p>\n<h3 id=\"逻辑运算符\"><a href=\"#逻辑运算符\" class=\"headerlink\" title=\"逻辑运算符\"></a>逻辑运算符</h3><p><img src=\"/p/f427/1626506615665-ab58a3e7-4c84-4cb3-b3ce-b8d089816b3e.png\" class=\"lazyload\" data-srcset=\"/p/f427/1626506615665-ab58a3e7-4c84-4cb3-b3ce-b8d089816b3e.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"></p>\n<h3 id=\"二进制按位运算\"><a href=\"#二进制按位运算\" class=\"headerlink\" title=\"二进制按位运算\"></a>二进制按位运算</h3><p>◇ 二进制位运算的实质是将参与运算的两个操作数，按对应的二进制数逐位进行逻辑运算。<br><img src=\"/p/f427/1626506691986-8cb9c71e-23fe-4243-a98f-61ecaeb2037e.png\" class=\"lazyload\" data-srcset=\"/p/f427/1626506691986-8cb9c71e-23fe-4243-a98f-61ecaeb2037e.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"></p>\n<h3 id=\"按位运算符\"><a href=\"#按位运算符\" class=\"headerlink\" title=\"按位运算符\"></a>按位运算符</h3><p><img src=\"/p/f427/1626506705766-5f082cda-69bc-4213-8776-6b307ec394b4.png\" class=\"lazyload\" data-srcset=\"/p/f427/1626506705766-5f082cda-69bc-4213-8776-6b307ec394b4.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"></p>\n<h3 id=\"WHERE子句的注意事项\"><a href=\"#WHERE子句的注意事项\" class=\"headerlink\" title=\"WHERE子句的注意事项\"></a>WHERE子句的注意事项</h3><p>◇ WHERE子句中，条件执行的顺序是从左到右的。所以我们应该把索引条件，或者筛选掉记录最多的条件写在最左侧  </p>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">SELECT</span> empno,ename <span class=\"keyword\">FROM</span> t_emp</span><br><span class=\"line\"><span class=\"keyword\">WHERE</span> ename <span class=\"operator\">=</span> &quot;FORD&quot; <span class=\"keyword\">AND</span> sal <span class=\"operator\">&gt;=</span> <span class=\"number\">2000</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">SELECT</span> empno,ename <span class=\"keyword\">FROM</span> t_emp</span><br><span class=\"line\"><span class=\"keyword\">WHERE</span> deptno <span class=\"operator\">=</span> <span class=\"number\">10</span> <span class=\"keyword\">AND</span> sal <span class=\"operator\">&gt;=</span> <span class=\"number\">2000</span>;</span><br></pre></td></tr></table></figure>\n\n\n<h3 id=\"各种子句的执行顺序\"><a href=\"#各种子句的执行顺序\" class=\"headerlink\" title=\"各种子句的执行顺序\"></a>各种子句的执行顺序</h3><p> 条件查询中，WHERE子句应该是第几个执行？ FROM -&gt; WHERE -&gt; SELECT -&gt; ORDER BY -&gt; LIMIT  </p>\n","categories":["Java数据库","MySQL基础"],"tags":["数据库"]},{"title":"数据库简介","url":"/p/f849.html","content":"<h2 id=\"学习目标\"><a href=\"#学习目标\" class=\"headerlink\" title=\"学习目标\"></a>学习目标</h2><p><strong>了解关系型数据库的重要性</strong><br>  -为什么会出现关系型数据库？有哪些常见的关系型数据库？<br><strong>掌握MySQL的安装和配置</strong><br>  -怎么安装MySQL数据库？怎么配置MySQL的字符集、端口号、IP 地址绑定、数据目录等等？<br><strong>实践用户创建、分配权限和密码找回</strong></p>\n<ul>\n<li>如何创建root之外的帐户并分配权限？忘记数据库密码，应该如何 找回？  <h2 id=\"课程内容\"><a href=\"#课程内容\" class=\"headerlink\" title=\"课程内容\"></a>课程内容</h2><img src=\"/p/f849/1625745885993-bc3f8091-5671-49b0-b883-2deeb93953d8.png\" class=\"lazyload\" data-srcset=\"/p/f849/1625745885993-bc3f8091-5671-49b0-b883-2deeb93953d8.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"><h2 id=\"操作系统中数据存放的载体\"><a href=\"#操作系统中数据存放的载体\" class=\"headerlink\" title=\"操作系统中数据存放的载体\"></a>操作系统中数据存放的载体</h2>◇ Windows、Linux和MacOS都是基于文件的操作系统<br>◇ 文件能保存数据，为什么不用文件来管理数据？<h2 id=\"什么是-关系型-数据库系统？\"><a href=\"#什么是-关系型-数据库系统？\" class=\"headerlink\" title=\"什么是(关系型)数据库系统？\"></a>什么是(关系型)数据库系统？</h2>◇ 数据库系统（DBMS）是指一个能为用户提供信息服务 的系统。它实现了有组织地、动态地储存大量相关数据 的功能，提供了数据处理和信息资源共享的便利手段。<br>◇ 关系型数据库系统（RDBMS）是指使用了关系模型的数 据库系统<br>◇ 关系模型中，数据是分类存放的，数据之间可以有联系<br><img src=\"/p/f849/1625747084668-a2ccf897-723b-4ed3-b2ff-7306028578de.png\" class=\"lazyload\" data-srcset=\"/p/f849/1625747084668-a2ccf897-723b-4ed3-b2ff-7306028578de.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"></li>\n</ul>\n<h2 id=\"关系型数据库的应用\"><a href=\"#关系型数据库的应用\" class=\"headerlink\" title=\"关系型数据库的应用\"></a>关系型数据库的应用</h2><p>◇ 关系型数据库被应用在非常多的领域<br><img src=\"/p/f849/1625746899055-c7f7b681-d7e6-404e-adf4-955b8c3fbb72.png\" class=\"lazyload\" data-srcset=\"/p/f849/1625746899055-c7f7b681-d7e6-404e-adf4-955b8c3fbb72.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"><br> 关系型数据库可以有效组织和管理大量复杂的数据，所 以关系型数据库才是最重要的数据库产品<br>◇数据库的大规模应用<br><img src=\"/p/f849/1625746981059-77d2bbc5-76f7-433c-b1f3-1579d1cb15a1.png\" class=\"lazyload\" data-srcset=\"/p/f849/1625746981059-77d2bbc5-76f7-433c-b1f3-1579d1cb15a1.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"><br>◇主流关系型数据库<br><img src=\"/p/f849/1625747003200-98e2e0e6-1830-4277-8891-7d4db47274b3.png\" class=\"lazyload\" data-srcset=\"/p/f849/1625747003200-98e2e0e6-1830-4277-8891-7d4db47274b3.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"></p>\n<h2 id=\"什么是NoSQL数据库系统？\"><a href=\"#什么是NoSQL数据库系统？\" class=\"headerlink\" title=\"什么是NoSQL数据库系统？\"></a>什么是NoSQL数据库系统？</h2><p>◇ NoSQL数据库指的是数据分类存放，但是数据之间没有关联关系的数据库系统<br><img src=\"/p/f849/1625747164092-f6498682-6d07-4ab0-9c56-c7977aa8d09c.png\" class=\"lazyload\" data-srcset=\"/p/f849/1625747164092-f6498682-6d07-4ab0-9c56-c7977aa8d09c.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"><br>◇ 主流NoSQL数据库<br><img src=\"/p/f849/1625747213311-ffaffb43-e795-4115-95a5-89ee1ef45a6f.png\" class=\"lazyload\" data-srcset=\"/p/f849/1625747213311-ffaffb43-e795-4115-95a5-89ee1ef45a6f.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"></p>\n<h2 id=\"用户管理\"><a href=\"#用户管理\" class=\"headerlink\" title=\"用户管理\"></a>用户管理</h2><p>◇MySQL客户端  Navicat</p>\n<h3 id=\"重设root密码\"><a href=\"#重设root密码\" class=\"headerlink\" title=\"重设root密码\"></a>重设root密码</h3><p>◇ 密码忘记后<br>◇ 创建一个TXT文件，定义修改密码的SQL语句  </p>\n<figure class=\"highlight csharp\"><table><tr><td class=\"code\"><pre><span class=\"line\">ALTER USER <span class=\"string\">&#x27;root&#x27;</span>@<span class=\"string\">&#x27;localhost&#x27;</span> IDENTIFIED BY</span><br><span class=\"line\"><span class=\"string\">&#x27;123456&#x27;</span> ;</span><br></pre></td></tr></table></figure>\n<p>◇以管理员身份打开PowerShell窗口<br><img src=\"/p/f849/1625755297789-549f2cdd-2307-4e23-b0cf-b6306fc853d3.png\" class=\"lazyload\" data-srcset=\"/p/f849/1625755297789-549f2cdd-2307-4e23-b0cf-b6306fc853d3.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"><br><img src=\"/p/f849/1625755485452-38a0d75a-c473-4e30-ba8b-2a4ab32121e1.png\" class=\"lazyload\" data-srcset=\"/p/f849/1625755485452-38a0d75a-c473-4e30-ba8b-2a4ab32121e1.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"><br>◇ 修改my.ini文件，删除之前添加的参数<br>C:\\ProgramData\\MySQL\\MySQL Server 8.0，先打开隐藏文件；<br>◇ 重启MySQL服务，用新密码登陆root帐户</p>\n<h2 id=\"MySQL配置文件\"><a href=\"#MySQL配置文件\" class=\"headerlink\" title=\"MySQL配置文件\"></a>MySQL配置文件</h2><p>◇ 在my.ini文件中，我们可以设置各种MySQL的配置，例 如字符集、端口号、目录地址等等<br><img src=\"/p/f849/1625755710987-887e0744-ef37-4276-9da1-1150300ab70b.png\" class=\"lazyload\" data-srcset=\"/p/f849/1625755710987-887e0744-ef37-4276-9da1-1150300ab70b.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"></p>\n<figure class=\"highlight csharp\"><table><tr><td class=\"code\"><pre><span class=\"line\">[<span class=\"meta\">client</span>]</span><br><span class=\"line\">port=<span class=\"number\">3306</span>   </span><br><span class=\"line\">[<span class=\"meta\">mysql</span>]</span><br><span class=\"line\">no-beep    <span class=\"meta\">#关闭蜂鸣器</span></span><br><span class=\"line\">[<span class=\"meta\">mysqld</span>]</span><br><span class=\"line\">port=<span class=\"number\">3306</span>  <span class=\"meta\">#端口号</span></span><br><span class=\"line\">datadir=C:/ProgramData/MySQL/MySQL Server <span class=\"number\">8.0</span>\\Data  <span class=\"meta\">#数据目录</span></span><br><span class=\"line\">default_authentication_plugin=mysql_native_password <span class=\"meta\">#密码认证插件</span></span><br><span class=\"line\"><span class=\"literal\">default</span>-storage-engine=INNODB  <span class=\"meta\">#默认存储引擎</span></span><br><span class=\"line\">sql-mode=<span class=\"string\">&quot;STRICT_TRANS_TABLES,NO_ENGINE_SUBSTITUTION&quot;</span>  <span class=\"meta\">#开启严格模式</span></span><br><span class=\"line\">log-output=FILE  <span class=\"meta\">#用文件记录日志</span></span><br><span class=\"line\">general-log=<span class=\"number\">0</span>  <span class=\"meta\">#关闭日志输出</span></span><br><span class=\"line\">general_log_file=<span class=\"string\">&quot;LAPTOP-3NL7HPNI.log&quot;</span>  <span class=\"meta\">#日志文件名称</span></span><br><span class=\"line\">slow-query-log=<span class=\"number\">1</span>  <span class=\"meta\">#开启慢查询日志</span></span><br><span class=\"line\">slow_query_log_file=<span class=\"string\">&quot;LAPTOP-3NL7HPNI-slow.log&quot;</span> <span class=\"meta\">#慢查询日志文件名称</span></span><br><span class=\"line\">long_query_time=<span class=\"number\">10</span>  <span class=\"meta\">#大于多少秒的执行SQL被记录在慢查询</span></span><br><span class=\"line\">log-error=<span class=\"string\">&quot;LAPTOP-3NL7HPNI.err&quot;</span> <span class=\"meta\">#错误日志名称</span></span><br><span class=\"line\">log-bin=<span class=\"string\">&quot;LAPTOP-3NL7HPNI-bin&quot;</span></span><br><span class=\"line\">server-id=<span class=\"number\">1</span> <span class=\"meta\">#数据库ID，集群时用到</span></span><br><span class=\"line\">report_port=<span class=\"number\">3306</span></span><br><span class=\"line\">lower_case_table_names=<span class=\"number\">1</span> <span class=\"meta\">#把表名转换成小写</span></span><br><span class=\"line\">secure-file-priv=<span class=\"string\">&quot;C:/ProgramData/MySQL/MySQL Server 8.0/Uploads&quot;</span> <span class=\"meta\">#导入导出数据的目录地址</span></span><br><span class=\"line\">max_connections=<span class=\"number\">151</span> <span class=\"meta\">#最大连接数</span></span><br><span class=\"line\">table_open_cache=<span class=\"number\">2000</span></span><br><span class=\"line\">tmp_table_size=<span class=\"number\">21</span>M</span><br><span class=\"line\">thread_cache_size=<span class=\"number\">10</span> <span class=\"meta\">#线程数量</span></span><br><span class=\"line\">.......</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n","categories":["Java数据库","MySQL基础"],"tags":["数据库"]},{"title":"数据库范式","url":"/p/77e3.html","content":"<h2 id=\"概念\"><a href=\"#概念\" class=\"headerlink\" title=\"概念\"></a>概念</h2><p>◇ 构造数据库必须遵循一定的规则，这种规则就是范式<br>◇ 目前关系数据库有6种范式，一般情况下，只满足第三范式即可  </p>\n<h2 id=\"第一范式：原子性\"><a href=\"#第一范式：原子性\" class=\"headerlink\" title=\"第一范式：原子性\"></a>第一范式：原子性</h2><p>◇ 第一范式是数据库的基本要求，不满足这一点就不是关系数据库<br>◇ 数据表的每一列都是不可分割的基本数据项，同一列中不能有多个值，也不能存在重复的属性。<br><img src=\"/p/77e3/1625840047827-6aee66b4-51fa-4462-9315-661dcc5bbc8c.png\" class=\"lazyload\" data-srcset=\"/p/77e3/1625840047827-6aee66b4-51fa-4462-9315-661dcc5bbc8c.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"></p>\n<h2 id=\"第二范式：唯一性\"><a href=\"#第二范式：唯一性\" class=\"headerlink\" title=\"第二范式：唯一性\"></a>第二范式：唯一性</h2><p>◇ 数据表中的每条记录必须是唯一的。为了实现区分，通常要为表加上一个列用来存储唯一标识，这个唯一属性列被称作主键列<br><img src=\"/p/77e3/1625840463558-faa7b806-aebf-4fa1-83d6-1fa49132c68f.png\" class=\"lazyload\" data-srcset=\"/p/77e3/1625840463558-faa7b806-aebf-4fa1-83d6-1fa49132c68f.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"></p>\n<h2 id=\"第三范式：关联性\"><a href=\"#第三范式：关联性\" class=\"headerlink\" title=\"第三范式：关联性\"></a>第三范式：关联性</h2><p>◇ 每列都与主键有直接关系，不存在传递依赖<br><img src=\"/p/77e3/1625840515859-2c1f2750-a72c-4ca8-9693-0097054d1a89.png\" class=\"lazyload\" data-srcset=\"/p/77e3/1625840515859-2c1f2750-a72c-4ca8-9693-0097054d1a89.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"><br> ◇依照第三范式，数据可以拆分保存到不同的数据表，彼此保持关联<br><img src=\"/p/77e3/1625840617006-d3552f4a-77d7-4734-8d1b-f4347315568f.png\" class=\"lazyload\" data-srcset=\"/p/77e3/1625840617006-d3552f4a-77d7-4734-8d1b-f4347315568f.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"></p>\n<h2 id=\"字段约束\"><a href=\"#字段约束\" class=\"headerlink\" title=\"字段约束\"></a>字段约束</h2><p>◇ MySQL中的字段约束共有四种：<br><img src=\"/p/77e3/1625990627379-e5fb0810-df5e-4398-bd38-3841fc1be58b.png\" class=\"lazyload\" data-srcset=\"/p/77e3/1625990627379-e5fb0810-df5e-4398-bd38-3841fc1be58b.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"></p>\n<h3 id=\"主键约束\"><a href=\"#主键约束\" class=\"headerlink\" title=\"主键约束\"></a>主键约束</h3><p>◇ 主键约束要求字段的值在全表必须唯一，而且不能为NULL值<br>◇ 建议主键一定要使用数字类型，因为数字的检索速度会非常快<br>◇ 如果主键是数字类型，还可以设置自动增长  </p>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">CREATE</span> <span class=\"keyword\">TABLE</span> t_teacher(</span><br><span class=\"line\">id <span class=\"type\">INT</span> <span class=\"keyword\">PRIMARY</span> KEY AUTO_INCREMENT,</span><br><span class=\"line\">.......</span><br><span class=\"line\">)</span><br></pre></td></tr></table></figure>\n<h3 id=\"非空约束\"><a href=\"#非空约束\" class=\"headerlink\" title=\"非空约束\"></a>非空约束</h3><p>◇ 非空约束要求字段的值不能为NULL值<br>◇ NULL值以为没有值，而不是” “空字符串  </p>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">CREATE</span> <span class=\"keyword\">TABLE</span> t_teacher(</span><br><span class=\"line\">id <span class=\"type\">INT</span> <span class=\"keyword\">PRIMARY</span> KEY AUTO_INCREMENT,</span><br><span class=\"line\">name <span class=\"type\">VARCHAR</span>(<span class=\"number\">200</span>) <span class=\"keyword\">NOT</span> <span class=\"keyword\">NULL</span>,</span><br><span class=\"line\">married <span class=\"type\">BOOLEAN</span> <span class=\"keyword\">NOT</span> <span class=\"keyword\">NULL</span> <span class=\"keyword\">DEFAULT</span> <span class=\"literal\">FALSE</span> <span class=\"operator\">/</span><span class=\"operator\">/</span>设置默认值为<span class=\"literal\">false</span></span><br><span class=\"line\">);</span><br></pre></td></tr></table></figure>\n<h3 id=\"唯一约束\"><a href=\"#唯一约束\" class=\"headerlink\" title=\"唯一约束\"></a>唯一约束</h3><p>◇ 唯一约束要求字段值如果不为NULL，那么在全表必须唯一  </p>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">CREATE</span> <span class=\"keyword\">TABLE</span> t_teacher(</span><br><span class=\"line\">...</span><br><span class=\"line\">tel <span class=\"type\">CHAR</span>(<span class=\"number\">11</span>) <span class=\"keyword\">NOT</span> <span class=\"keyword\">NULL</span> <span class=\"keyword\">UNIQUE</span></span><br><span class=\"line\">);</span><br></pre></td></tr></table></figure>\n<h3 id=\"外键约束\"><a href=\"#外键约束\" class=\"headerlink\" title=\"外键约束\"></a>外键约束</h3><p>◇ 外键约束用来保证关联数据的逻辑关系<br><img src=\"/p/77e3/1625991461738-358528fb-416f-4cef-b409-575041655201.png\" class=\"lazyload\" data-srcset=\"/p/77e3/1625991461738-358528fb-416f-4cef-b409-575041655201.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"><br>◇ 外键约束的定义是写在子表上的  </p>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">CREATE</span> <span class=\"keyword\">TABLE</span> t_emp(</span><br><span class=\"line\">empno <span class=\"type\">INT</span> UNSIGNED <span class=\"keyword\">PRIMARY</span> KEY,</span><br><span class=\"line\">ename <span class=\"type\">VARCHAR</span>(<span class=\"number\">20</span>) <span class=\"keyword\">NOT</span> <span class=\"keyword\">NULL</span>,</span><br><span class=\"line\">sex ENUM(&quot;MAN&quot;,&quot;WOMAN&quot;) <span class=\"keyword\">NOT</span> <span class=\"keyword\">NULL</span>,</span><br><span class=\"line\">deptno <span class=\"type\">INT</span> UNSIGNED <span class=\"keyword\">NOT</span> <span class=\"keyword\">NULL</span>,</span><br><span class=\"line\">hiredate <span class=\"type\">DATE</span> <span class=\"keyword\">NOT</span> <span class=\"keyword\">NULL</span>,</span><br><span class=\"line\"><span class=\"keyword\">FOREIGN</span> KEY (deptno) <span class=\"keyword\">REFERENCES</span> t_dept(deptno)</span><br><span class=\"line\">);</span><br></pre></td></tr></table></figure>\n<p>** 外键约束的闭环问题  **<br>◇ 如果形成外键闭环，我们将无法删除任何一张表的记录<br><img src=\"/p/77e3/1625992112385-0da833a2-88ca-4eed-8643-262a3b35b40d.png\" class=\"lazyload\" data-srcset=\"/p/77e3/1625992112385-0da833a2-88ca-4eed-8643-262a3b35b40d.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"></p>\n<h2 id=\"数据定义语言：索引\"><a href=\"#数据定义语言：索引\" class=\"headerlink\" title=\"数据定义语言：索引\"></a>数据定义语言：索引</h2><h3 id=\"数据排序的好处\"><a href=\"#数据排序的好处\" class=\"headerlink\" title=\"数据排序的好处\"></a>数据排序的好处</h3><p>◇ 一旦数据排序之后，查找的速度就会翻倍，现实世界跟程序世界都是如此  </p>\n<h3 id=\"数据表的索引\"><a href=\"#数据表的索引\" class=\"headerlink\" title=\"数据表的索引\"></a>数据表的索引</h3><p>◇ MySQL利用B+树的结构，对数据表的记录排序，从而加速数据的检索速度<br><img src=\"/p/77e3/1625992297169-2ea7a513-51e5-40b6-b3ca-2aca1f27912d.png\" class=\"lazyload\" data-srcset=\"/p/77e3/1625992297169-2ea7a513-51e5-40b6-b3ca-2aca1f27912d.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"></p>\n<h3 id=\"如何创建索引\"><a href=\"#如何创建索引\" class=\"headerlink\" title=\"如何创建索引\"></a>如何创建索引</h3><figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">CREATE</span> <span class=\"keyword\">TABLE</span> 表名称 ( ……，</span><br><span class=\"line\">INDEX [ 索引名称 ] ( 字段 ) ……<span class=\"operator\">/</span><span class=\"operator\">/</span>给哪一个字段设置索引</span><br><span class=\"line\">) ;</span><br></pre></td></tr></table></figure>\n<h3 id=\"如何添加与删除索引\"><a href=\"#如何添加与删除索引\" class=\"headerlink\" title=\"如何添加与删除索引\"></a>如何添加与删除索引</h3><figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">CREATE</span> INDEX 索引名称 <span class=\"keyword\">ON</span> 表名( 字段 ) ；</span><br><span class=\"line\"><span class=\"keyword\">ALTER</span> <span class=\"keyword\">TABLE</span> 表名称 <span class=\"keyword\">ADD</span> INDEX [ 索引名 ]( 字段 ) ;</span><br><span class=\"line\"><span class=\"keyword\">SHOW</span> INDEX <span class=\"keyword\">FROM</span> 表名 ;   <span class=\"operator\">/</span><span class=\"operator\">/</span>查看索引情况</span><br><span class=\"line\"><span class=\"keyword\">DROP</span> INDEX 索引名称 <span class=\"keyword\">ON</span> 表名 ;</span><br></pre></td></tr></table></figure>\n<h3 id=\"索引的使用原则\"><a href=\"#索引的使用原则\" class=\"headerlink\" title=\"索引的使用原则\"></a>索引的使用原则</h3><p>◇ 数据量很大，而且经常被查询的数据表可以设置索引<br>◇ 索引只添加在经常被用作检索条件的字段上面<br>◇ 不要在大字段上创建索引</p>\n","categories":["Java数据库","MySQL基础"],"tags":["数据库"]},{"title":"数据库的高级查询","url":"/p/1648.html","content":"<h2 id=\"数据操作语言：聚合函数\"><a href=\"#数据操作语言：聚合函数\" class=\"headerlink\" title=\"数据操作语言：聚合函数\"></a>数据操作语言：聚合函数</h2><h3 id=\"什么是聚合函数\"><a href=\"#什么是聚合函数\" class=\"headerlink\" title=\"什么是聚合函数\"></a>什么是聚合函数</h3><p>◇ 聚合函数在数据的查询分析中，应用十分广泛。聚合函数可以对数 据求和、求最大值和最小值、求平均值等等。<br>◇ 求公司员工的平均月收入是多少？  </p>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">--IFNULL(comm,0)判断如果comm字段为空则返回0,否则返回comm值</span></span><br><span class=\"line\"><span class=\"keyword\">SELECT</span> <span class=\"built_in\">AVG</span>(sal<span class=\"operator\">+</span>IFNULL(comm,<span class=\"number\">0</span>)) <span class=\"keyword\">FROM</span> t_emp;</span><br></pre></td></tr></table></figure>\n<h3 id=\"SUM函数\"><a href=\"#SUM函数\" class=\"headerlink\" title=\"SUM函数\"></a>SUM函数</h3><p> ◇ SUM函数用于求和，只能用于数字类型，字符类型的统计结果为0 ，日期类型统计结果是毫秒数相加<br> ◇ SUM函数求和会排除NULL值  </p>\n<h3 id=\"MAX函数\"><a href=\"#MAX函数\" class=\"headerlink\" title=\"MAX函数\"></a>MAX函数</h3><p> ◇ MAX函数用于获得非空值的最大值。<br> ◇ 问题1：查询10和20部门中，月收入最高的员工？  </p>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">SELECT</span> <span class=\"built_in\">MAX</span>(sal<span class=\"operator\">+</span>IFNULL(comm,<span class=\"number\">0</span>)) <span class=\"keyword\">FROM</span> t_emp</span><br><span class=\"line\"><span class=\"keyword\">WHERE</span> deptno <span class=\"keyword\">IN</span>(<span class=\"number\">10</span>,<span class=\"number\">20</span>);</span><br></pre></td></tr></table></figure>\n<p> ◇ 问题2：查询员工名字最长的是几个字符？  </p>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">SELECT</span> <span class=\"built_in\">MAX</span>(LENGTH(ename)) <span class=\"keyword\">FROM</span> t_emp;</span><br></pre></td></tr></table></figure>\n<h3 id=\"MIN函数\"><a href=\"#MIN函数\" class=\"headerlink\" title=\"MIN函数\"></a>MIN函数</h3><p> ◇ MIN函数用于获得非空值的最小值。  </p>\n<h3 id=\"AVG函数\"><a href=\"#AVG函数\" class=\"headerlink\" title=\"AVG函数\"></a>AVG函数</h3><p> ◇ AVG函数用于获得非空值的平均值，非数字数据统计结果为0  </p>\n<h3 id=\"COUNT函数\"><a href=\"#COUNT函数\" class=\"headerlink\" title=\"COUNT函数\"></a>COUNT函数</h3><p> ◇ COUNT(*)用于获得包含空值的记录数，COUNT(列名)用于获得包 含非空值的记录数。<br> ◇ 查询10和20部门中，底薪超过2000元并且工龄超过15年的员工人数？  </p>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">SELECT</span> <span class=\"built_in\">COUNT</span>(<span class=\"operator\">*</span>) <span class=\"keyword\">FROM</span> t_emp</span><br><span class=\"line\"><span class=\"keyword\">WHERE</span> deptno <span class=\"keyword\">IN</span>(<span class=\"number\">10</span>,<span class=\"number\">20</span>) <span class=\"keyword\">AND</span> sal<span class=\"operator\">&gt;=</span><span class=\"number\">2000</span></span><br><span class=\"line\"><span class=\"keyword\">AND</span> DATEDIFF(NOW(),hiredate)<span class=\"operator\">/</span><span class=\"number\">365</span><span class=\"operator\">&gt;=</span><span class=\"number\">15</span>; <span class=\"comment\">--DATEDIFF指相差的天数</span></span><br></pre></td></tr></table></figure>\n<p> ◇ 查询1985年以后入职的员工，底薪超过公司平均底薪的员工数量？  </p>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">SELECT</span> <span class=\"built_in\">COUNT</span>(<span class=\"operator\">*</span>) <span class=\"keyword\">FROM</span> t_emp</span><br><span class=\"line\"><span class=\"keyword\">WHERE</span> hiredate<span class=\"operator\">&gt;=</span>&quot;1985-01-01&quot;</span><br><span class=\"line\"><span class=\"keyword\">AND</span> sal<span class=\"operator\">&gt;</span>ROUND(<span class=\"built_in\">AVG</span>(sal));<span class=\"comment\">--ROUND()四舍五入 </span></span><br><span class=\"line\"><span class=\"comment\">--WHERE 子句不能有聚合函数，所以这里是错误的,</span></span><br><span class=\"line\"><span class=\"comment\">--因为聚合函数需要根据WHERE子句确定的数据范围进行计算</span></span><br><span class=\"line\"><span class=\"comment\">--正确的做法是将平均成绩作为一个子查询获取</span></span><br><span class=\"line\">sal<span class=\"operator\">&gt;</span>(<span class=\"keyword\">SELECT</span> ROUND(<span class=\"built_in\">AVG</span>(sal)) <span class=\"keyword\">FROM</span> t_emp)</span><br></pre></td></tr></table></figure>\n<h2 id=\"数据操作语言：分组查询\"><a href=\"#数据操作语言：分组查询\" class=\"headerlink\" title=\"数据操作语言：分组查询\"></a>数据操作语言：分组查询</h2><h3 id=\"为什么要分组？\"><a href=\"#为什么要分组？\" class=\"headerlink\" title=\"为什么要分组？\"></a>为什么要分组？</h3><p> ◇ 默认情况下汇总函数是对全表范围内的数据做统计<br> ◇ GROUP BY子句的作用是通过一定的规则将一个数据集划分成若干 个小的区域，然后针对每个小区域分别进行数据汇总处理  </p>\n<h3 id=\"逐级分组\"><a href=\"#逐级分组\" class=\"headerlink\" title=\"逐级分组\"></a>逐级分组</h3><p> ◇ 数据库支持多列分组条件，执行的时候逐级分组。<br> ◇ 查询每个部门里，每种职位的人员数量和平均底薪  </p>\n<h3 id=\"对SELECT子句的要求\"><a href=\"#对SELECT子句的要求\" class=\"headerlink\" title=\"对SELECT子句的要求\"></a>对SELECT子句的要求</h3><p> ◇ 查询语句中如果含有GROUP BY子句，那么SELECT子句中的内容就 必须要遵守规定：SELECT子句中可以包括聚合函数，或者GROUP BY子句的分组列，其余内容均不可以出现在SELECT子句中<br>如下sql语句就是错误的：</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">--sal字段并不是GROUP BY子句的分组列,如果按照部门分组的话,一个部门中的sal不是唯一的(员工不止一个)</span></span><br><span class=\"line\"><span class=\"keyword\">SELECT</span> deptno,<span class=\"built_in\">COUNT</span>(<span class=\"operator\">*</span>),<span class=\"built_in\">AVG</span>(sal),sal </span><br><span class=\"line\"><span class=\"keyword\">FROM</span> t_emp <span class=\"keyword\">GROUP</span> <span class=\"keyword\">BY</span> deptno;</span><br></pre></td></tr></table></figure>\n<h3 id=\"对分组结果集再次做汇总计算\"><a href=\"#对分组结果集再次做汇总计算\" class=\"headerlink\" title=\"对分组结果集再次做汇总计算\"></a>对分组结果集再次做汇总计算</h3><figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">--ROLLUP关键字会在底部增加一行记录对分组查询后的结果进行的汇总</span></span><br><span class=\"line\"><span class=\"keyword\">SELECT</span> deptno,<span class=\"built_in\">COUNT</span>(<span class=\"operator\">*</span>),<span class=\"built_in\">AVG</span>(sal),<span class=\"built_in\">MAX</span>(sal),<span class=\"built_in\">MIN</span>(sal)</span><br><span class=\"line\"><span class=\"keyword\">FROM</span> t_emp <span class=\"keyword\">GROUP</span> <span class=\"keyword\">BY</span> deptno <span class=\"keyword\">WITH</span> <span class=\"keyword\">ROLLUP</span>;</span><br></pre></td></tr></table></figure>\n<h3 id=\"GROUP-CONCAT函数\"><a href=\"#GROUP-CONCAT函数\" class=\"headerlink\" title=\"GROUP_CONCAT函数\"></a>GROUP_CONCAT函数</h3><p> ◇ GROUP_CONCAT函数可以把分组查询中的某个字段拼接成一个字符串<br> ◇ 查询每个部门内底薪超过2000元的人数和员工姓名    </p>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">SELECT</span> deptno,GROUP_CONCAT(ename),<span class=\"built_in\">COUNT</span>(<span class=\"operator\">*</span>)</span><br><span class=\"line\"><span class=\"keyword\">FROM</span> t_emp <span class=\"keyword\">WHERE</span> sal<span class=\"operator\">&gt;=</span><span class=\"number\">2000</span></span><br><span class=\"line\"><span class=\"keyword\">GROUP</span> <span class=\"keyword\">BY</span> deptno;</span><br></pre></td></tr></table></figure>\n<h3 id=\"各种子句的执行顺序\"><a href=\"#各种子句的执行顺序\" class=\"headerlink\" title=\"各种子句的执行顺序\"></a>各种子句的执行顺序</h3><p> ◇ 查询语句中，GROUP BY子句应该第几个执行？ 先由FROM选择查询的表，然后WHERE子句进行筛选，符合条件的记录交由GROUP BY子句进行分组，分完组后由SELECT里的聚合函数进行计算，然后由ORDER BY子句排序，最后由LIMIT子句返回分页的数据<br>FROM -&gt; WHERE -&gt; GROUP BY -&gt; SELECT -&gt; ORDER BY -&gt; LIMIT  </p>\n<h2 id=\"数据操作语言：HAVING子句\"><a href=\"#数据操作语言：HAVING子句\" class=\"headerlink\" title=\"数据操作语言：HAVING子句\"></a>数据操作语言：HAVING子句</h2><h3 id=\"分组查询遇到的困难？\"><a href=\"#分组查询遇到的困难？\" class=\"headerlink\" title=\"分组查询遇到的困难？\"></a>分组查询遇到的困难？</h3><p> ◇ 查询部门平均底薪超过2000元的部门编号<br> ◇ 因为WHERE子句先于GROUP BY执行，一旦WHERE子句中出现了 汇总函数，数据库根本不知道按照什么范围计算汇总值  </p>\n<h3 id=\"HAVING子句的用途\"><a href=\"#HAVING子句的用途\" class=\"headerlink\" title=\"HAVING子句的用途\"></a>HAVING子句的用途</h3><p> ◇ 可以将聚集函数写在HAVING子句中,HAVING子句中的字段只能是GROUP BY分组表中的字段，例如果经过GROUP BY分组后得到的表中没有sal(员工工资)字段，则在HAVING中不能使用sal字段<br> ◇ 查询每个部门中，1982年以后入职的员工超过2个人的部门编号  </p>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">SELECT</span> deptno <span class=\"keyword\">FROM</span> t_emp</span><br><span class=\"line\"><span class=\"keyword\">WHERE</span> hiredate<span class=\"operator\">&gt;=</span>&quot;1982-01-01&quot;</span><br><span class=\"line\"><span class=\"keyword\">GROUP</span> <span class=\"keyword\">BY</span> deptno <span class=\"keyword\">HAVING</span> <span class=\"built_in\">COUNT</span>(<span class=\"operator\">*</span>)<span class=\"operator\">&gt;=</span><span class=\"number\">2</span>;</span><br><span class=\"line\"><span class=\"keyword\">ORDER</span> <span class=\"keyword\">BY</span> deptno <span class=\"keyword\">ASC</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"HAVING子句的特殊用法\"><a href=\"#HAVING子句的特殊用法\" class=\"headerlink\" title=\"HAVING子句的特殊用法\"></a>HAVING子句的特殊用法</h3><p> ◇ 按照数字1分组，MySQL会依据SELECT子句中的列进行分组， HAVING子句也可以正常使用  </p>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">SELECT</span> deptno,<span class=\"built_in\">COUNT</span>(<span class=\"operator\">*</span>), <span class=\"keyword\">FROM</span> t_emp</span><br><span class=\"line\"><span class=\"keyword\">GROUP</span> <span class=\"keyword\">BY</span> <span class=\"number\">1</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">SELECT</span> deptno,<span class=\"built_in\">COUNT</span>(<span class=\"operator\">*</span>), <span class=\"keyword\">FROM</span> t_emp</span><br><span class=\"line\"><span class=\"keyword\">GROUP</span> <span class=\"keyword\">BY</span> <span class=\"number\">1</span> <span class=\"keyword\">HAVING</span> deptno <span class=\"keyword\">IN</span> (<span class=\"number\">10</span>,<span class=\"number\">20</span>);</span><br></pre></td></tr></table></figure>\n<h2 id=\"数据操作语言：表连接查询\"><a href=\"#数据操作语言：表连接查询\" class=\"headerlink\" title=\"数据操作语言：表连接查询\"></a>数据操作语言：表连接查询</h2><h3 id=\"从多张表中提取数据\"><a href=\"#从多张表中提取数据\" class=\"headerlink\" title=\"从多张表中提取数据\"></a>从多张表中提取数据</h3><p> ◇ 从多张表中提取数据，必须指定关联的条件。如果不定义关联条件 就会出现无条件连接，两张表的数据会交叉连接，产生笛卡尔积。<br><img src=\"/p/1648/1626527536343-fe29719d-f14e-4f1f-b2dd-0b875407529f.png\" class=\"lazyload\" data-srcset=\"/p/1648/1626527536343-fe29719d-f14e-4f1f-b2dd-0b875407529f.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"><br> ◇ 规定了连接条件的表连接语句，就不会出现笛卡尔积<br><img src=\"/p/1648/1626527554966-ef6bd0c6-0869-473a-807a-aaf8bb2b0479.png\" class=\"lazyload\" data-srcset=\"/p/1648/1626527554966-ef6bd0c6-0869-473a-807a-aaf8bb2b0479.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"></p>\n<h3 id=\"表连接的分类\"><a href=\"#表连接的分类\" class=\"headerlink\" title=\"表连接的分类\"></a>表连接的分类</h3><p> ◇ 表连接分为两种：内连接和外连接<br> ◇ 内连接是结果集中只保留符合连接条件的记录<br> ◇ 外连接是不管符不符合连接条件，记录都要保留在结果集中  </p>\n<h3 id=\"内连接的简介\"><a href=\"#内连接的简介\" class=\"headerlink\" title=\"内连接的简介\"></a>内连接的简介</h3><p> ◇ 内连接是最常见的一种表连接，用于查询多张关系表符合连接条件 的记录。INNER关键字可省略<br><img src=\"/p/1648/1626527706776-ea571078-3649-4f98-8763-458cf7d9bea1.png\" class=\"lazyload\" data-srcset=\"/p/1648/1626527706776-ea571078-3649-4f98-8763-458cf7d9bea1.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"></p>\n<h3 id=\"内连接的多种语法形式\"><a href=\"#内连接的多种语法形式\" class=\"headerlink\" title=\"内连接的多种语法形式\"></a>内连接的多种语法形式</h3><figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">SELECT</span> …… <span class=\"keyword\">FROM</span> 表<span class=\"number\">1</span> <span class=\"keyword\">JOIN</span> 表<span class=\"number\">2</span> <span class=\"keyword\">ON</span> 连接条件 ;</span><br><span class=\"line\"><span class=\"keyword\">SELECT</span> …… <span class=\"keyword\">FROM</span> 表<span class=\"number\">1</span> <span class=\"keyword\">JOIN</span> 表<span class=\"number\">2</span> <span class=\"keyword\">WHERE</span> 连接条件 ;</span><br><span class=\"line\"><span class=\"keyword\">SELECT</span> …… <span class=\"keyword\">FROM</span> 表<span class=\"number\">1</span> , 表<span class=\"number\">2</span> <span class=\"keyword\">WHERE</span> 连接条件 ;<span class=\"operator\">/</span><span class=\"operator\">/</span>常用</span><br></pre></td></tr></table></figure>\n<h3 id=\"内连接练习\"><a href=\"#内连接练习\" class=\"headerlink\" title=\"内连接练习\"></a>内连接练习</h3><p> ◇ 查询每个员工的工号、姓名、部门名称、底薪、职位、工资等级？ </p>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">SELECT</span> e.empno,e.ename,d.deptno,e.sal,e.job,s.grade</span><br><span class=\"line\"><span class=\"keyword\">FROM</span> t_emp e,t_dept d,t_salgrade s </span><br><span class=\"line\"><span class=\"keyword\">WHERE</span> e.deptno<span class=\"operator\">=</span>d.deptno <span class=\"keyword\">AND</span> e.sal <span class=\"keyword\">BETWEEN</span> s.losal <span class=\"keyword\">AND</span> s.hisal;</span><br></pre></td></tr></table></figure>\n<p> ◇ 内连接的数据表不一定必须有同名字段，只要字段之间符合逻辑关系就可以<br> ◇ 相同的数据表也可以做表连接<br> ◇ 结果集也可以作为一张“表”来跟其他表连接  </p>\n<h3 id=\"为什么要使用外连接\"><a href=\"#为什么要使用外连接\" class=\"headerlink\" title=\"为什么要使用外连接\"></a>为什么要使用外连接</h3><p> ◇ 如果说陈浩是一名临时人员，没有固定的部门编制，那么我们想查询每名员工和他的部门名称，用内连接就会漏掉陈浩，所以要引入外连接的语法才能解决这个问题<br><img src=\"/p/1648/1626529078875-5839b367-ab6b-4302-adab-a26f1cb433cf.png\" class=\"lazyload\" data-srcset=\"/p/1648/1626529078875-5839b367-ab6b-4302-adab-a26f1cb433cf.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"></p>\n<h3 id=\"外连接简介\"><a href=\"#外连接简介\" class=\"headerlink\" title=\"外连接简介\"></a>外连接简介</h3><p> ◇ 外连接与内连接的区别在于，除了符合条件的记录之外，结果集中 还会保留不符合条件的记录。<br><img src=\"/p/1648/1626579588053-e5d55de3-cb32-46d2-a9b3-aac5f56aee42.png\" class=\"lazyload\" data-srcset=\"/p/1648/1626579588053-e5d55de3-cb32-46d2-a9b3-aac5f56aee42.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"></p>\n<h3 id=\"左连接和右连接\"><a href=\"#左连接和右连接\" class=\"headerlink\" title=\"左连接和右连接\"></a>左连接和右连接</h3><p> ◇ 左外连接就是保留左表所有的记录，与右表做连接。如果右表有符 合条件的记录就与左表连接。如果右表没有符合条件的记录，就用 NULL与左表连接。右外连接也是如此。  </p>\n<h3 id=\"外连接练习\"><a href=\"#外连接练习\" class=\"headerlink\" title=\"外连接练习\"></a>外连接练习</h3><p> ◇ 查询每个部门的名称和部门的人数？  </p>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">SELECT</span>  d.dname,<span class=\"built_in\">COUNT</span>(e.deptno)<span class=\"operator\">/</span><span class=\"operator\">/</span>忽略右表(t_emp)的<span class=\"keyword\">NULL</span>记录</span><br><span class=\"line\"><span class=\"keyword\">FROM</span>  t_dept d <span class=\"keyword\">LEFT</span> <span class=\"keyword\">JOIN</span> t_emp e <span class=\"operator\">/</span><span class=\"operator\">/</span>保留左表(t_dept)的所有记录</span><br><span class=\"line\"><span class=\"keyword\">ON</span> d.deptno<span class=\"operator\">=</span>e.deptno</span><br><span class=\"line\"><span class=\"keyword\">GROUP</span> <span class=\"keyword\">BY</span> d.deptno;</span><br></pre></td></tr></table></figure>\n<p>◇结果：<br><img src=\"/p/1648/1626621372904-af26d4c8-739c-4c3f-9e1c-cae69f7cc554.png\" class=\"lazyload\" data-srcset=\"/p/1648/1626621372904-af26d4c8-739c-4c3f-9e1c-cae69f7cc554.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"><br> ◇ 查询每个部门的名称和部门的人数？如果没有部门的员工，部门名称用NULL代替。  </p>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\">(<span class=\"keyword\">SELECT</span>  d.dname,<span class=\"built_in\">COUNT</span>(e.deptno)</span><br><span class=\"line\"><span class=\"keyword\">FROM</span>  t_dept d <span class=\"keyword\">LEFT</span> <span class=\"keyword\">JOIN</span> t_emp e </span><br><span class=\"line\"><span class=\"keyword\">ON</span> d.deptno<span class=\"operator\">=</span>e.deptno</span><br><span class=\"line\"><span class=\"keyword\">GROUP</span> <span class=\"keyword\">BY</span> d.deptno )  </span><br><span class=\"line\">    <span class=\"keyword\">UNION</span> <span class=\"operator\">/</span><span class=\"operator\">/</span>使用<span class=\"keyword\">UNION</span>关键字进行左外连接和右外连接的合并</span><br><span class=\"line\">(<span class=\"keyword\">SELECT</span>  d.dname,<span class=\"built_in\">COUNT</span>(<span class=\"operator\">*</span>) <span class=\"operator\">/</span><span class=\"operator\">/</span>保留所有有效记录</span><br><span class=\"line\"><span class=\"keyword\">FROM</span>  t_dept d <span class=\"keyword\">RIGHT</span> <span class=\"keyword\">JOIN</span> t_emp e </span><br><span class=\"line\"><span class=\"keyword\">ON</span> d.deptno<span class=\"operator\">=</span>e.deptno</span><br><span class=\"line\"><span class=\"keyword\">GROUP</span> <span class=\"keyword\">BY</span> d.deptno )</span><br></pre></td></tr></table></figure>\n<p>◇结果：<br><img src=\"/p/1648/1626621411537-c2ca9e43-f9fc-43e4-8616-a7eff4e887a1.png\" class=\"lazyload\" data-srcset=\"/p/1648/1626621411537-c2ca9e43-f9fc-43e4-8616-a7eff4e887a1.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"><br> ◇ 查询每名员工的编号、姓名、部门、月薪、工资等级、工龄、上司 编号、上司姓名、上司部门？  </p>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">SELECT</span> e1.empno <span class=\"keyword\">AS</span> <span class=\"string\">&#x27;编号&#x27;</span>,e1.ename <span class=\"keyword\">AS</span> <span class=\"string\">&#x27;姓名&#x27;</span>,d1.dname <span class=\"keyword\">AS</span> <span class=\"string\">&#x27;部门&#x27;</span>,</span><br><span class=\"line\">e1.sal<span class=\"operator\">+</span>IFNULL(e1.comm,<span class=\"number\">0</span>) <span class=\"keyword\">AS</span> <span class=\"string\">&#x27;薪水&#x27;</span>,t.grade <span class=\"keyword\">AS</span> <span class=\"string\">&#x27;薪资等级&#x27;</span>,</span><br><span class=\"line\"><span class=\"built_in\">FLOOR</span>(DATEDIFF(NOW(),e1.hiredate)<span class=\"operator\">/</span><span class=\"number\">365</span>) <span class=\"keyword\">AS</span> <span class=\"string\">&#x27;工龄&#x27;</span>,</span><br><span class=\"line\">e1.mgr <span class=\"keyword\">AS</span> <span class=\"string\">&#x27;上司编号&#x27;</span>,e2.ename <span class=\"keyword\">AS</span> <span class=\"string\">&#x27;上司姓名&#x27;</span>,d2.dname <span class=\"keyword\">AS</span> <span class=\"string\">&#x27;上司部门&#x27;</span> </span><br><span class=\"line\"><span class=\"keyword\">FROM</span> t_emp e1 <span class=\"keyword\">LEFT</span> <span class=\"keyword\">JOIN</span> t_dept d1 <span class=\"keyword\">ON</span> e1.deptno<span class=\"operator\">=</span>d1.deptno</span><br><span class=\"line\"><span class=\"keyword\">LEFT</span> <span class=\"keyword\">JOIN</span> t_emp e2 <span class=\"keyword\">ON</span> e1.mgr<span class=\"operator\">=</span>e2.empno</span><br><span class=\"line\"><span class=\"keyword\">LEFT</span> <span class=\"keyword\">JOIN</span> t_salgrade t <span class=\"keyword\">ON</span> e1.sal <span class=\"keyword\">BETWEEN</span> t.losal <span class=\"keyword\">AND</span> t.hisal</span><br><span class=\"line\"><span class=\"keyword\">LEFT</span> <span class=\"keyword\">JOIN</span> t_dept d2 <span class=\"keyword\">ON</span> e2.deptno<span class=\"operator\">=</span>d2.deptno;</span><br></pre></td></tr></table></figure>\n<p>◇结果：<br><img src=\"/p/1648/1626664826083-f96e349d-cc41-40fc-8a9f-0b996022332a.png\" class=\"lazyload\" data-srcset=\"/p/1648/1626664826083-f96e349d-cc41-40fc-8a9f-0b996022332a.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"></p>\n<p> ◇ UNION关键字可以将多个查询语句的结果集进行合并 ,结果集字段名称、个数需要相同</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\">( 查询语句 ) <span class=\"keyword\">UNION</span> ( 查询语句 ) <span class=\"keyword\">UNION</span> ( 查询语句 ) ……</span><br></pre></td></tr></table></figure>\n<h3 id=\"外连接的注意事项\"><a href=\"#外连接的注意事项\" class=\"headerlink\" title=\"外连接的注意事项\"></a>外连接的注意事项</h3><p> ◇ 内连接只保留符合条件的记录，所以查询条件写在ON子句和 WHERE子句中的效果是相同的。但是外连接里，条件写在WHERE 子句里，不合符条件的记录是会被过滤掉的,而不是保留下来。<br>①<br>使用ON子句</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">SELECT</span> e.ename,d,dname,d.deptno</span><br><span class=\"line\"><span class=\"keyword\">FROM</span> t_emp e</span><br><span class=\"line\"><span class=\"keyword\">LEFT</span> <span class=\"keyword\">JOIN</span> t_dept d <span class=\"keyword\">ON</span> e.deptno <span class=\"operator\">=</span> d.deptno</span><br><span class=\"line\"><span class=\"keyword\">AND</span> e.deptno<span class=\"operator\">=</span><span class=\"number\">10</span>;</span><br></pre></td></tr></table></figure>\n<p>结果：<br><img src=\"/p/1648/1626665352162-b0b6a378-88e3-4711-9b18-ee194cf32151.png\" class=\"lazyload\" data-srcset=\"/p/1648/1626665352162-b0b6a378-88e3-4711-9b18-ee194cf32151.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"></p>\n<p>发现所有记录都被保留，但不符合条件的记录为空<br>②使用WHERE子句</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">SELECT</span> e.ename,d,dname,d.deptno</span><br><span class=\"line\"><span class=\"keyword\">FROM</span> t_emp e</span><br><span class=\"line\"><span class=\"keyword\">LEFT</span> <span class=\"keyword\">JOIN</span> t_dept d <span class=\"keyword\">ON</span> e.deptno <span class=\"operator\">=</span> d.deptno</span><br><span class=\"line\"><span class=\"keyword\">WHERE</span> e.deptno<span class=\"operator\">=</span><span class=\"number\">10</span>;</span><br></pre></td></tr></table></figure>\n<p>结果：<br><img src=\"/p/1648/1626665474286-a40128b4-d895-4759-86f7-d68289ac14ba.png\" class=\"lazyload\" data-srcset=\"/p/1648/1626665474286-a40128b4-d895-4759-86f7-d68289ac14ba.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"></p>\n<h2 id=\"数据操作语言：子查询\"><a href=\"#数据操作语言：子查询\" class=\"headerlink\" title=\"数据操作语言：子查询\"></a>数据操作语言：子查询</h2><h3 id=\"子查询简介\"><a href=\"#子查询简介\" class=\"headerlink\" title=\"子查询简介\"></a>子查询简介</h3><p> ◇ 子查询是一种查询中嵌套查询的语句<br> ◇ 查询底薪超过公司平均底薪的员工的信息  </p>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">SELECT</span> empno,ename,sal</span><br><span class=\"line\"><span class=\"keyword\">FROM</span> t_emp</span><br><span class=\"line\"><span class=\"keyword\">WHERE</span> sal<span class=\"operator\">&gt;=</span>(<span class=\"keyword\">SELECT</span> <span class=\"built_in\">AVG</span>(sal) <span class=\"keyword\">FROM</span> t_emp);</span><br></pre></td></tr></table></figure>\n<h3 id=\"子查询的分类\"><a href=\"#子查询的分类\" class=\"headerlink\" title=\"子查询的分类\"></a>子查询的分类</h3><p> ◇ 子查询可以写在三个地方：WHERE子句、FROM子句、SELECT子 句，但是只有FROM子句子查询是最可取的   </p>\n<h3 id=\"WHERE子查询\"><a href=\"#WHERE子查询\" class=\"headerlink\" title=\"WHERE子查询\"></a>WHERE子查询</h3><p> ◇ 这种子查询最简单，最容易理解，但是却是效率很低的子查询<br> ◇ 查询底薪超过公司平均底薪的员工的信息<br><img src=\"/p/1648/1626670116652-f8ce1b67-2d79-462d-902f-12c22d33e139.png\" class=\"lazyload\" data-srcset=\"/p/1648/1626670116652-f8ce1b67-2d79-462d-902f-12c22d33e139.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"></p>\n<h3 id=\"用表连接替代WHERE子查询\"><a href=\"#用表连接替代WHERE子查询\" class=\"headerlink\" title=\"用表连接替代WHERE子查询\"></a>用表连接替代WHERE子查询</h3><p> ◇ 表连接的优点是子查询只执行一次，查询效率特别高  </p>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">SELECT</span> e2.empno,e2.ename</span><br><span class=\"line\"><span class=\"keyword\">FROM</span> t_emp e1 <span class=\"keyword\">JOIN</span> t_emp e2</span><br><span class=\"line\"><span class=\"keyword\">ON</span> e1.deptno <span class=\"operator\">=</span> e2.deptno</span><br><span class=\"line\"><span class=\"keyword\">AND</span> e2.ename<span class=\"operator\">!=</span>&quot;FORD&quot;</span><br><span class=\"line\"><span class=\"keyword\">AND</span> e1.ename<span class=\"operator\">=</span>&quot;FORD&quot;;</span><br></pre></td></tr></table></figure>\n<h3 id=\"FROM子查询\"><a href=\"#FROM子查询\" class=\"headerlink\" title=\"FROM子查询\"></a>FROM子查询</h3><p> ◇ 这种子查询只会执行一次，所以查询效率很高，把子查询写在FROM子句中<br> ◇ 查询底薪超过公司平均底薪的员工的信息 </p>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">SELECT</span> e.empno,e.ename,e.sal,t.avg</span><br><span class=\"line\"><span class=\"keyword\">FROM</span> t_emp e <span class=\"keyword\">JOIN</span> </span><br><span class=\"line\">(<span class=\"keyword\">SELECT</span> deptno,<span class=\"built_in\">AVG</span>(sal) <span class=\"keyword\">as</span> avg</span><br><span class=\"line\"><span class=\"keyword\">FROM</span> t_emp <span class=\"keyword\">GROUP</span> <span class=\"keyword\">BY</span> deptno) t</span><br><span class=\"line\"><span class=\"keyword\">ON</span> e.deptno<span class=\"operator\">=</span>t.deptno <span class=\"keyword\">AND</span> e.sal<span class=\"operator\">&gt;=</span>t.avg;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h3 id=\"SELECT子查询\"><a href=\"#SELECT子查询\" class=\"headerlink\" title=\"SELECT子查询\"></a>SELECT子查询</h3><p> ◇ 这种子查询每输出一条记录的时候都要执行一次，查询效率很低  </p>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">SELECT</span> e.empno,e.ename,(<span class=\"keyword\">SELECT</span> dname <span class=\"keyword\">FROM</span> t_dept <span class=\"keyword\">WHERE</span> deptno<span class=\"operator\">=</span>e.deptno)</span><br><span class=\"line\"><span class=\"keyword\">FROM</span> t_emp e;</span><br></pre></td></tr></table></figure>\n<h3 id=\"相关子查询\"><a href=\"#相关子查询\" class=\"headerlink\" title=\"相关子查询\"></a>相关子查询</h3><p>◇ 查询语句执行的时候要多次的依赖于子查询的结果，这类子查询被 称作相关子查询<br>◇ WHERE子查询和SELECT子查询都属于相关子查询<br>◇ 因为相关子查询要反复多次执行，所以应该避免使用  </p>\n<h3 id=\"单行子查询和多行子查询\"><a href=\"#单行子查询和多行子查询\" class=\"headerlink\" title=\"单行子查询和多行子查询\"></a>单行子查询和多行子查询</h3><p>◇ 单行子查询的结果集只有一条记录，多行子查询结果集有多行记录<br>◇ 多行子查询只能出现在WHERE子句和FROM子句中<br>◇ 子查询一般先写出子查询语句<br>◇ 如何用子查询查找FORD和MARTIN两个人的同事？  </p>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">SELECT</span> </span><br><span class=\"line\"><span class=\"keyword\">FROM</span> t_emp</span><br><span class=\"line\"><span class=\"keyword\">WHERE</span> </span><br><span class=\"line\">deptno <span class=\"keyword\">IN</span> <span class=\"operator\">/</span><span class=\"operator\">/</span>这里子查询结果集为多行记录，所以不能用&quot;=&quot;,而用&quot;IN&quot;表示等于其中一条记录即可</span><br><span class=\"line\">(<span class=\"keyword\">SELECT</span> deptno <span class=\"keyword\">FROM</span> t_emp <span class=\"keyword\">WHERE</span> ename <span class=\"keyword\">IN</span>(&quot;FORD&quot;,&quot;MARTIN&quot;))</span><br><span class=\"line\"><span class=\"keyword\">AND</span> ename <span class=\"keyword\">NOT</span> <span class=\"keyword\">IN</span>(&quot;FORD&quot;,&quot;MARTIN&quot;);</span><br></pre></td></tr></table></figure>\n<h3 id=\"WHERE子句中的多行子查询\"><a href=\"#WHERE子句中的多行子查询\" class=\"headerlink\" title=\"WHERE子句中的多行子查询\"></a>WHERE子句中的多行子查询</h3><p>◇ WHERE子句中，可以使用IN、ALL、ANY、EXISTS关键字来处理多行表达式结果集的条件判断<br>◇ 查询比FORD和MARTIN底薪都高的员工信息？  </p>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">SELECT</span> ename</span><br><span class=\"line\"><span class=\"keyword\">FROM</span> t_emp</span><br><span class=\"line\"><span class=\"keyword\">WHERE</span> sal<span class=\"operator\">&gt;=</span><span class=\"keyword\">ALL</span></span><br><span class=\"line\">(<span class=\"keyword\">SELECT</span> sal <span class=\"keyword\">FROM</span> t_emp <span class=\"keyword\">WHERE</span> ename <span class=\"keyword\">IN</span>(&quot;FORD&quot;,&quot;MARTIN&quot;))</span><br><span class=\"line\"><span class=\"keyword\">AND</span> ename <span class=\"keyword\">NOT</span> <span class=\"keyword\">IN</span>(&quot;FORD&quot;,&quot;MARTIN&quot;);</span><br></pre></td></tr></table></figure>\n<h3 id=\"EXISTS关键字\"><a href=\"#EXISTS关键字\" class=\"headerlink\" title=\"EXISTS关键字\"></a>EXISTS关键字</h3><p> ◇ EXISTS关键字是把原来在子查询之外的条件判断，写到了子查询的里面。  </p>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">SELECT</span> …… <span class=\"keyword\">FROM</span> 表名 <span class=\"keyword\">WHERE</span> [<span class=\"keyword\">NOT</span>] <span class=\"keyword\">EXISTS</span> ( 子查询 ) ;</span><br></pre></td></tr></table></figure>\n<p> ◇ 查询工资等级3和4级的员工信息？  </p>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">SELECT</span> empno,ename,sal</span><br><span class=\"line\"><span class=\"keyword\">FROM</span> t_emp</span><br><span class=\"line\"><span class=\"keyword\">WHERE</span> <span class=\"keyword\">EXISTS</span>(</span><br><span class=\"line\"><span class=\"keyword\">SELECT</span> grade <span class=\"keyword\">FROM</span> t_salgrade</span><br><span class=\"line\"><span class=\"keyword\">WHERE</span> sal <span class=\"keyword\">BETWEEN</span> losal <span class=\"keyword\">AND</span> hisal</span><br><span class=\"line\"><span class=\"keyword\">AND</span> grade <span class=\"keyword\">IN</span>(<span class=\"number\">3</span>,<span class=\"number\">4</span>)</span><br><span class=\"line\">);</span><br></pre></td></tr></table></figure>\n\n","categories":["Java数据库","MySQL基础"],"tags":["数据库"]},{"title":"测试文章","url":"/p/1023.html","content":"<h2 id=\"测试标题\"><a href=\"#测试标题\" class=\"headerlink\" title=\"测试标题\"></a>测试标题</h2><p>这是一个测试页面,以下内容为余华的《活着》<img src=\"https://img1.baidu.com/it/u=4151257971,460772575&fm=26&fmt=auto\" class=\"lazyload\" data-srcset=\"https://img1.baidu.com/it/u=4151257971,460772575&fm=26&fmt=auto\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"art\"></p>\n<hr>\n<p> &emsp;&emsp; 我比现在年轻十岁的时候，获得了一个游手好闲的职业，去乡间收集民间歌谣。那一年的整个夏天，我如同一只乱飞的麻雀，游荡在知了和阳光充斥的村舍田野。<br> &emsp;&emsp; 我喜欢喝农民那种带有苦味的茶水，他们的茶桶就放在田埂的树下，我毫无顾忌地拿起漆满茶垢的茶碗舀水喝，还把自己的水壶灌满，与田里干活的男人说上几句废话，在姑娘因我而起的窃窃私笑里扬长而去。我曾经和一位守着瓜田的老人聊了整整一个下午，这是我有生以来瓜吃得最多的一次，当我站起来告辞时，突然发现自己像个孕妇一样步履艰难了。然后我与一位当上了祖母的女人坐在门槛上，她编着草鞋为我唱了一支《十月怀胎》。我最喜欢的是傍晚来到时，坐在农民的屋前，看着他们将提上的井水泼.在地上，压住蒸腾的尘土，夕阳的光芒在树梢上照射下来，拿一把他们递过来的扇子，尝尝他们和盐一样咸的咸菜，看看几个年轻女人，和男人们说着话。<br> &emsp;&emsp; 我头戴宽边草帽，脚上穿着拖鞋，一条毛巾挂在身后的皮带上，让它像尾巴似的拍打着我的屁股。我整日张大嘴巴打着呵欠，散漫地走在田间小道上，我的拖鞋吧哒吧哒，把那些小道弄得尘土飞扬，仿佛是车轮滚滚而过时的情景。<br> &emsp;&emsp; 我到处游荡，已经弄不清楚哪些村庄我曾经去过，哪些我没有去过。我走近一个村子时，常会听到孩子的喊叫：     </p>\n<p> &emsp;&emsp; “那个老打呵欠的人又来啦。”</p>\n<p><code>print &quot;hello world&quot;</code></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">for(int i=0;i=100;i++)&#123;</span><br><span class=\"line\">     cout&lt;&lt;&quot;这是第&quot;&lt;&lt;i+1&lt;&lt;&quot;次&quot;&lt;&lt;循环&lt;&lt;endl;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n","categories":["分类测试"],"tags":["测试标签"]},{"title":"RabbitMQ入门","url":"/p/ef1a.html","content":"<h2 id=\"课程简介\"><a href=\"#课程简介\" class=\"headerlink\" title=\"课程简介\"></a>课程简介</h2><ol>\n<li>初识RabbitMQ，使用Erlang语言； </li>\n<li>RabbitMQ的安装和启动 </li>\n<li>RabbitMQ管理后台  </li>\n<li>实战案例演示 </li>\n<li>交换机工作模式  fanout、direct、topic、headers</li>\n<li>Spring Boot整合RabbitMQ  <h2 id=\"RabbitMQ\"><a href=\"#RabbitMQ\" class=\"headerlink\" title=\"RabbitMQ\"></a>RabbitMQ</h2><h3 id=\"RabbitMQ简介\"><a href=\"#RabbitMQ简介\" class=\"headerlink\" title=\"RabbitMQ简介\"></a>RabbitMQ简介</h3>◇核心思想：接收并转发消息。你可以把它想象成一个邮局<br><img src=\"/p/ef1a/1636948836013-8a24cfff-1bce-419c-8c00-f82a7ae88a78.png\" class=\"lazyload\" data-srcset=\"/p/ef1a/1636948836013-8a24cfff-1bce-419c-8c00-f82a7ae88a78.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"><br>◇producer：消息的生产者(发送者)，<br>◇queue：保存P发过来的消息，队列可以无限延长，存储多个P的信息，同时也被多个消费者消费；<br>◇consumer：消费者，从q中获取信息</li>\n</ol>\n<h3 id=\"RabbitMQ的特点\"><a href=\"#RabbitMQ的特点\" class=\"headerlink\" title=\"RabbitMQ的特点\"></a>RabbitMQ的特点</h3><p>◇开源、跨语言<br>◇Erlang语言编写，一般用在通信行业，性能良好；<br>◇应用广泛<br>◇社区活跃、API丰富</p>\n<h2 id=\"消息队列\"><a href=\"#消息队列\" class=\"headerlink\" title=\"消息队列\"></a>消息队列</h2><h3 id=\"什么叫消息队列\"><a href=\"#什么叫消息队列\" class=\"headerlink\" title=\"什么叫消息队列\"></a>什么叫消息队列</h3><p>◇消息队列是一种先进先出的结构；Enqueue&amp;Dequeue；</p>\n<h3 id=\"消息队列的特性\"><a href=\"#消息队列的特性\" class=\"headerlink\" title=\"消息队列的特性\"></a>消息队列的特性</h3><p>◇业务无关，不需要考虑上层业务的逻辑，只做好消息转发即可；<br>◇FIFO，先进先出<br>◇容灾，对于接收的消息可以进行持久化处理，即存储下来，即便出现服务器故障，也可以在恢复服务后找到还原出队的消息；<br>◇性能良好；</p>\n<h3 id=\"为什么要用消息队列\"><a href=\"#为什么要用消息队列\" class=\"headerlink\" title=\"为什么要用消息队列\"></a>为什么要用消息队列</h3><p>◇系统解耦，在没有使用消息中间件的时候我们的消息发送是直接调用模块的方法，但是在模块比较多的时候，会调用很多模块，增加系统复杂性，而消息通过消息队列来进行转发能够有效解耦；<br>◇异步调用；假设我们有一个链路，从A调用B，调用C再调用D,因为每一个步骤都是需要时间的，所以整个链路下来花的时间较多，不过很多步骤是可以异步的；异步即我告诉你要做这件事然后不等你做完我就可以直接返回了；同步的话需要等你做完之后我才能返回；比如说点外卖的时候，作为用户我下单以后平台系统要做的事情很多，比如通知店家，骑手等；对于用户而言，不需要考虑这些系统要处理的事，所以通过消息来完成异步的调用；即当用户下单以后，系统将消息发送到消息中间件中，然后就返回消息给用户，让用户知道下单成功；然后MQ会对消息进行分发，通知商家、骑手接单，支付模块收款等；<br>◇流量削峰；有时候我们的请求量会突然上升，就叫做出现了流量高峰；消息队列会把这些大量的请求存储在队列里面，然后以我们能够接受的速度发送给我们；相当于对高流量做一下缓冲；</p>\n<h2 id=\"AMQP协议\"><a href=\"#AMQP协议\" class=\"headerlink\" title=\"AMQP协议\"></a>AMQP协议</h2><p>◇ Advanced Message Queuing Protocol<br><img src=\"/p/ef1a/1636966039817-3852b10f-3a92-4d47-8097-ab691f9ed195.png\" class=\"lazyload\" data-srcset=\"/p/ef1a/1636966039817-3852b10f-3a92-4d47-8097-ab691f9ed195.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"><br>◇左侧的publisher即对应生产者，Consumer对应消费者；右边一大块是指RabbitMQ的服务器(Server)；Virtual host虚拟主机，一个RabbitMQ可以给很多的完全独立的用户提供服务，那么每一个用户就可以利用虚拟主机来划分，它们之间是互不影响的；在虚拟主机里面有一个Exchange,是交换机的意思；交换机会与下面的消息队列MQ连通，它们是一个绑定的关系；</p>\n<h2 id=\"RabbitMQ核心概念\"><a href=\"#RabbitMQ核心概念\" class=\"headerlink\" title=\"RabbitMQ核心概念\"></a>RabbitMQ核心概念</h2><p>◇RabbitMQ的整体架构图<br><img src=\"/p/ef1a/1636966789125-6b5d1068-08dc-442b-b12c-ded43f46c103.png\" class=\"lazyload\" data-srcset=\"/p/ef1a/1636966789125-6b5d1068-08dc-442b-b12c-ded43f46c103.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"><br>◇Server：服务<br>◇connection：与server建立连接，封装了socket协议相关部分逻辑；<br>◇ channel：信道，Channel是我们与RabbitMQ打交道的最重要的一个接口，我们大部分的业务操作是在Channel这个接口中完成的，包括定义Queue、定义Exchange、绑定Queue与Exchange、发布消息等。如果每一次访问RabbitMQ都建立一个Connection，在消息量大的时候建立TCP Connection的开销将是巨大的，效率也较低。Channel是在connection内部建立的逻辑连接，如果应用程序支持多线程，通常每个thread创建单独的channel进行通讯，AMQP method包含了channel id帮助客户端和message broker识别channel，所以channel之间是完全隔离的。Channel作为轻量级的Connection极大减少了操作系统建立TCP connection的开销；<br>◇ message：消息，在RabbitMQ中消息由properties(对消息进行额外的修饰，如消息的优先级，队列的延迟或者消息的其他属性)和body(消息的实体)组成 ；<br>◇ virtual host：虚拟主机，作用是顶层隔离，比如说有A、B两个项目，必须先指定把消息投递到A还是B，也就是说投递到A的虚拟主机还是B的虚拟主机，这是最顶层的隔离然后才会包含后面交换机的内容。同一个虚拟主机下，不能有重复的交换机和queue，如果是不同的虚拟主机，则可以有相同的交换机和queue；<br>◇ Exchange：交换机，接收生产者的消息的，然后根据指定的路由器去把消息转发到所绑定的队列上<br>◇ binding：绑定交换机和队列<br>◇ routing key：路由键，路由规则，虚拟机可以用它来确定这个消息如何进行一个路由<br>◇ queue：队列，消费者只需要监听队列来消费消息，不需要关注消息来自于哪个Exchange<br>◇ Exchange和Message Queue存在着绑定的关系，一个 Exchage可以绑定多个消息队列  </p>\n<h2 id=\"消息的流转过程\"><a href=\"#消息的流转过程\" class=\"headerlink\" title=\"消息的流转过程\"></a>消息的流转过程</h2><p><img src=\"/p/ef1a/1636967373386-5d044d36-ad4f-4946-93b9-f5b41530633d.png\" class=\"lazyload\" data-srcset=\"/p/ef1a/1636967373386-5d044d36-ad4f-4946-93b9-f5b41530633d.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"><br>◇最开始是生产者产生一个消息，然后放到Exchange中去，Exchange下有三个MQ，在绑定的时候需要指定一个路由键；假设Exchange和Qi使用的路由键是Ki；那么在生产者发送消息的时候就需要指定一个路由键，比如说消息的路由键是K1，那么Exchange就把消息发送给Q1(左起第一个队列)；对于消费者而言，会监听消息，一旦MQ中有了从交换机发送过来的消息消费者就会提取到消息并且进行后续的处理；</p>\n<h2 id=\"RabbitMQ的安装和启动\"><a href=\"#RabbitMQ的安装和启动\" class=\"headerlink\" title=\"RabbitMQ的安装和启动\"></a>RabbitMQ的安装和启动</h2><h3 id=\"安装Erlang语言\"><a href=\"#安装Erlang语言\" class=\"headerlink\" title=\"安装Erlang语言\"></a>安装Erlang语言</h3><p>◇方法一：安装erlang-rpm包，该包经过RabbitMQ官方处理，去掉了一些无用的依赖；</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">#配置源</span><br><span class=\"line\">vim /etc/yum.repos.d/rabbitmq_erlang.repo</span><br><span class=\"line\">    #在配置文件中</span><br><span class=\"line\">    [rabbitmq-erlang]</span><br><span class=\"line\">    name=rabbitmq-erlang</span><br><span class=\"line\">    baseurl=https:<span class=\"comment\">//dl.bintray.com/rabbitmq-erlang/rpm/erlang/22/el/7</span></span><br><span class=\"line\">    gpgcheck=<span class=\"number\">1</span></span><br><span class=\"line\">    gpgkey=https:<span class=\"comment\">//dl.bintray.com/rabbitmq/Keys/rabbitmq-release-signing-key.asc</span></span><br><span class=\"line\">    repo_gpgcheck=<span class=\"number\">0</span></span><br><span class=\"line\">    enabled=<span class=\"number\">1</span></span><br><span class=\"line\">#:wq退出保存</span><br><span class=\"line\">#进行清理</span><br><span class=\"line\">yum clean all</span><br><span class=\"line\">#下载所需要的缓存</span><br><span class=\"line\">yum makecache</span><br><span class=\"line\">#进行安装</span><br><span class=\"line\">yum install erlang</span><br><span class=\"line\">#确认源是<span class=\"string\">&quot;rabbitmq_erlang&quot;</span></span><br><span class=\"line\">   Y</span><br><span class=\"line\">#确认安装</span><br><span class=\"line\">   Y</span><br><span class=\"line\">#查看版本</span><br><span class=\"line\">erl -version</span><br><span class=\"line\">#进入语言环境</span><br><span class=\"line\">erl</span><br><span class=\"line\">ctrl+c退出</span><br></pre></td></tr></table></figure>\n<p>◇方法二：使用Erlang Solutions源安装完整的版本；<br>◇方法三： 使用EPEL(“Extra Packages for Enterprise Linux”)进行安装， 版本可能不合适 ；</p>\n<h3 id=\"安装RabbitMQ\"><a href=\"#安装RabbitMQ\" class=\"headerlink\" title=\"安装RabbitMQ\"></a>安装RabbitMQ</h3><figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">#导入密钥</span><br><span class=\"line\">rpm --<span class=\"keyword\">import</span> https:<span class=\"comment\">//www.rabbitmq.com/rabbitmq-release-signing-key.asc</span></span><br><span class=\"line\"></span><br><span class=\"line\">#下载rpm安装包：</span><br><span class=\"line\">wget https:<span class=\"comment\">//dl.bintray.com/rabbitmq/all/rabbitmq-server/3.8.2/rabbitmq-server-3.8.2-1.el7.noarch.rpm</span></span><br><span class=\"line\">#如果速度比较慢，就用：</span><br><span class=\"line\">wget https:<span class=\"comment\">//github.com/rabbitmq/rabbitmq-server/releases/download/v3.8.2/rabbitmq-server-3.8.2-1.el7.noarch.rpm</span></span><br><span class=\"line\">#下载完成后，安装：</span><br><span class=\"line\">yum install rabbitmq-server-<span class=\"number\">3.8</span><span class=\"number\">.2</span>-<span class=\"number\">1.</span>el7.noarch.rpm</span><br><span class=\"line\">#一路Y</span><br><span class=\"line\">#如果出现解压错误，说明下载了多次，用ls -la看一下有几个文件，</span><br><span class=\"line\">#如果有多个安装包，要把多余的删掉，把正确的改名为rabbitmq-server-<span class=\"number\">3.8</span><span class=\"number\">.2</span>-<span class=\"number\">1.</span>el7.noarch.rpm，再执行yum install来安装</span><br></pre></td></tr></table></figure>\n<h3 id=\"启动RabbitMQ\"><a href=\"#启动RabbitMQ\" class=\"headerlink\" title=\"启动RabbitMQ\"></a>启动RabbitMQ</h3><p>◇RabbitMQ常用命令</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">#启动RabbitMQ</span><br><span class=\"line\">systemctl start rabbitmq-server</span><br><span class=\"line\">#看看端口有没有起来，查看状态</span><br><span class=\"line\">rabbitmqctl status </span><br><span class=\"line\">#要检查RabbitMQ服务器的状态，请运行：</span><br><span class=\"line\">systemctl status rabbitmq-server</span><br><span class=\"line\">#开启web管理界面</span><br><span class=\"line\">rabbitmq-plugins enable rabbitmq_management</span><br><span class=\"line\"></span><br><span class=\"line\">#停止RabbitMQ</span><br><span class=\"line\">rabbitmqctl stop</span><br><span class=\"line\">#设置开机启动</span><br><span class=\"line\">systemctl enable rabbitmq-server </span><br></pre></td></tr></table></figure>\n<h2 id=\"RabbitMQ管理后台\"><a href=\"#RabbitMQ管理后台\" class=\"headerlink\" title=\"RabbitMQ管理后台\"></a>RabbitMQ管理后台</h2><p>◇启动管理后台： rabbitmq-plugins enable rabbitmq_management<br>◇新建用户:  rabbitmqctl add_user admin password //用户名：admin；密码：password;可自定义<br>◇设置用户权限:  rabbitmqctl set_user_tags admin administrator  //将admin用户设为管理员<br>◇浏览器登录管理后台： ip+默认端口15672;    192.168.222.133:15762;<br>◇Info下的disc表示RabbitMQ默认采用磁盘存储；交换机是RabbitMQ默认生成的；<br>◇在Admin界面添加用户：Add a user； Montioring：可以登录控制台，也可以看到RabbitMQ的相关节点信息，如进程数，内存使用情况等等；但新建用户，创建管理员这些就没有权限；None：权限最低，就是普通的生产者，消费者；<br>◇默认会有一个虚拟主机；点击虚拟主机的name可以给虚拟主机添加管理员用户；</p>\n<h2 id=\"案例演示\"><a href=\"#案例演示\" class=\"headerlink\" title=\"案例演示\"></a>案例演示</h2><h3 id=\"新建项目\"><a href=\"#新建项目\" class=\"headerlink\" title=\"新建项目\"></a>新建项目</h3><p>◇创建maven项目，命名为rabbitmq<br>◇导入依赖</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">&lt;dependencies&gt;</span><br><span class=\"line\">    <span class=\"comment\">//rabbitmq客户端依赖</span></span><br><span class=\"line\">    &lt;dependency&gt;</span><br><span class=\"line\">      &lt;groupId&gt;com.rabbitmq&lt;/groupId&gt;</span><br><span class=\"line\">      &lt;artifactId&gt;amqp-client&lt;/artifactId&gt;</span><br><span class=\"line\">      &lt;version&gt;<span class=\"number\">5.8</span><span class=\"number\">.0</span>&lt;/version&gt;</span><br><span class=\"line\">    &lt;/dependency&gt;</span><br><span class=\"line\">    <span class=\"comment\">//记录日志的依赖</span></span><br><span class=\"line\">    &lt;dependency&gt;</span><br><span class=\"line\">      &lt;groupId&gt;org.slf4j&lt;/groupId&gt;</span><br><span class=\"line\">      &lt;artifactId&gt;slf4j-nop&lt;/artifactId&gt;</span><br><span class=\"line\">      &lt;version&gt;<span class=\"number\">1.7</span><span class=\"number\">.29</span>&lt;/version&gt;</span><br><span class=\"line\">    &lt;/dependency&gt;</span><br><span class=\"line\">  &lt;/dependencies&gt;</span><br></pre></td></tr></table></figure>\n<p>◇新建helloworld包，创建类Send；</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> helloworld;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.Channel;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.Connection;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.ConnectionFactory;</span><br><span class=\"line\"><span class=\"comment\">/*hello world 的发送类，连接到RabbitMQ服务端，然后发送一条消息，最后退出*/</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Send</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">//指定队列名字,在接收的时候也要使用此队列</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> <span class=\"keyword\">static</span> String QUEUE_NAME = <span class=\"string\">&quot;hello&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] argv)</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">//创建连接工厂</span></span><br><span class=\"line\">        ConnectionFactory factory = <span class=\"keyword\">new</span> ConnectionFactory();</span><br><span class=\"line\">        <span class=\"comment\">//设置 RabbitMQ 地址,即服务端IP;用户名;密码</span></span><br><span class=\"line\">        factory.setHost(<span class=\"string\">&quot;xxx.xx.xxx.xxx&quot;</span>);</span><br><span class=\"line\">        factory.setUsername(<span class=\"string\">&quot;admin&quot;</span>);</span><br><span class=\"line\">        factory.setPassword(<span class=\"string\">&quot;password&quot;</span>);</span><br><span class=\"line\">        <span class=\"comment\">//建立连接</span></span><br><span class=\"line\">        Connection connection = factory.newConnection();</span><br><span class=\"line\">        <span class=\"comment\">//获得信道</span></span><br><span class=\"line\">        Channel channel = connection.createChannel();</span><br><span class=\"line\">        <span class=\"comment\">//声明队列(队列名，队列是否需要持久，是否独有，是否自动删除，参数填null即可)</span></span><br><span class=\"line\">          <span class=\"comment\">//持久即服务重启后是否还保存此队列，独有即此队列是否仅被当前连接使用</span></span><br><span class=\"line\">        channel.queueDeclare(QUEUE_NAME, <span class=\"keyword\">false</span>, <span class=\"keyword\">false</span>, <span class=\"keyword\">false</span>, <span class=\"keyword\">null</span>);</span><br><span class=\"line\">        <span class=\"comment\">//发布消息</span></span><br><span class=\"line\">        String message = <span class=\"string\">&quot;Hello World!&quot;</span>;</span><br><span class=\"line\">           <span class=\"comment\">//(交换机&#x27;这里忽略&#x27;，路由键：队列名，消息配置：null，消息体：需要声明编码方式)</span></span><br><span class=\"line\">       忽略交换机名字的话,RabbitMQ会使用默认的交换机根据队列的名字QUEUE_NAME作为路由键进行查找</span><br><span class=\"line\">        channel.basicPublish(<span class=\"string\">&quot;&quot;</span>, QUEUE_NAME, <span class=\"keyword\">null</span>, message.getBytes(<span class=\"string\">&quot;UTF-8&quot;</span>));</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;发送了消息：&quot;</span> + message);</span><br><span class=\"line\">        <span class=\"comment\">//关闭连接</span></span><br><span class=\"line\">        channel.close();<span class=\"comment\">//关闭信道</span></span><br><span class=\"line\">        connection.close();<span class=\"comment\">//关闭连接</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>◇创建接收消息类Recv</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> helloworld;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.AMQP;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.Channel;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.Connection;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.ConnectionFactory;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.DefaultConsumer;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.Envelope;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.io.IOException;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//接收消息并打印，持续运行</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Recv</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> <span class=\"keyword\">static</span> String QUEUE_NAME = <span class=\"string\">&quot;hello&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] argv)</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</span><br><span class=\"line\">        ConnectionFactory factory = <span class=\"keyword\">new</span> ConnectionFactory();</span><br><span class=\"line\">        factory.setHost(<span class=\"string\">&quot;xxx.xx.xxx.xxx&quot;</span>);</span><br><span class=\"line\">        factory.setUsername(<span class=\"string\">&quot;admin&quot;</span>);</span><br><span class=\"line\">        factory.setPassword(<span class=\"string\">&quot;password&quot;</span>);</span><br><span class=\"line\">        <span class=\"comment\">//建立连接</span></span><br><span class=\"line\">        Connection connection = factory.newConnection();</span><br><span class=\"line\">        <span class=\"comment\">//获得信道</span></span><br><span class=\"line\">        Channel channel = connection.createChannel();</span><br><span class=\"line\">        <span class=\"comment\">//声明队列</span></span><br><span class=\"line\">        channel.queueDeclare(QUEUE_NAME, <span class=\"keyword\">false</span>, <span class=\"keyword\">false</span>, <span class=\"keyword\">false</span>, <span class=\"keyword\">null</span>);</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;开始接收消息&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//消费信息(队列名，是否自动确认收到，处理消息函数)</span></span><br><span class=\"line\">        channel.basicConsume(QUEUE_NAME, <span class=\"keyword\">true</span>, <span class=\"keyword\">new</span> DefaultConsumer(channel) &#123;</span><br><span class=\"line\">            <span class=\"comment\">//收到信息后会执行的函数</span></span><br><span class=\"line\">            <span class=\"meta\">@Override</span></span><br><span class=\"line\">            <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">handleDelivery</span><span class=\"params\">(String consumerTag, Envelope envelope,</span></span></span><br><span class=\"line\"><span class=\"params\"><span class=\"function\">                    AMQP.BasicProperties properties, <span class=\"keyword\">byte</span>[] body)</span><span class=\"comment\">//重写handleDelivery方法</span></span></span><br><span class=\"line\"><span class=\"function\">                    <span class=\"keyword\">throws</span> IOException </span>&#123;</span><br><span class=\"line\">                String message = <span class=\"keyword\">new</span> String(body, <span class=\"string\">&quot;UTF-8&quot;</span>);<span class=\"comment\">//实例化消息</span></span><br><span class=\"line\">                System.out.println(<span class=\"string\">&quot;收到消息：&quot;</span> + message);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"多个消费者\"><a href=\"#多个消费者\" class=\"headerlink\" title=\"多个消费者\"></a>多个消费者</h3><p>◇创建新的包workqueues,新建NewTask类发送多个消息</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> workqueues;</span><br><span class=\"line\"><span class=\"comment\">//任务由所耗时，多个任务</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">NewTask</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> String TASK_QUEUE_NAME = <span class=\"string\">&quot;task_queue&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] argv)</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</span><br><span class=\"line\">        ConnectionFactory factory = <span class=\"keyword\">new</span> ConnectionFactory();</span><br><span class=\"line\">        <span class=\"comment\">//factory.setHost(&quot;localhost&quot;);若是在本机的话，不需要设置用户名和密码</span></span><br><span class=\"line\">        factory.setHost(<span class=\"string\">&quot;xxx.xx.xxx.xxx&quot;</span>);</span><br><span class=\"line\">        factory.setUsername(<span class=\"string\">&quot;admin&quot;</span>);</span><br><span class=\"line\">        factory.setPassword(<span class=\"string\">&quot;password&quot;</span>);</span><br><span class=\"line\">        Connection connection = factory.newConnection();</span><br><span class=\"line\">        Channel channel = connection.createChannel();</span><br><span class=\"line\"></span><br><span class=\"line\">        channel.queueDeclare(TASK_QUEUE_NAME, <span class=\"keyword\">true</span>, <span class=\"keyword\">false</span>, <span class=\"keyword\">false</span>, <span class=\"keyword\">null</span>);</span><br><span class=\"line\">        <span class=\"comment\">//构建多个消息</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">10</span>; i++) &#123;</span><br><span class=\"line\">            String message;</span><br><span class=\"line\">            message = i + <span class=\"string\">&quot;....&quot;</span>;</span><br><span class=\"line\">            <span class=\"comment\">//发送消息</span></span><br><span class=\"line\">            channel.basicPublish(<span class=\"string\">&quot;&quot;</span>, TASK_QUEUE_NAME, <span class=\"keyword\">null</span>, message.getBytes(<span class=\"string\">&quot;UTF-8&quot;</span>));</span><br><span class=\"line\">            System.out.println(<span class=\"string\">&quot; [x] Sent &#x27;&quot;</span> + message + <span class=\"string\">&quot;&#x27;&quot;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        channel.close();</span><br><span class=\"line\">        connection.close();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>◇创建Worker类接收消息</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> workqueues;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.*;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.io.IOException;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//接收前面的批量消息</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Worker</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> String TASK_QUEUE_NAME = <span class=\"string\">&quot;task_queue&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] argv)</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</span><br><span class=\"line\">        ConnectionFactory factory = <span class=\"keyword\">new</span> ConnectionFactory();</span><br><span class=\"line\">        factory.setHost(<span class=\"string\">&quot;xxx.xx.xxx.xxx&quot;</span>);</span><br><span class=\"line\">        factory.setUsername(<span class=\"string\">&quot;admin&quot;</span>);</span><br><span class=\"line\">        factory.setPassword(<span class=\"string\">&quot;password&quot;</span>);</span><br><span class=\"line\">        Connection connection = factory.newConnection();</span><br><span class=\"line\">        Channel channel = connection.createChannel();</span><br><span class=\"line\">        <span class=\"comment\">//声明队列</span></span><br><span class=\"line\">        channel.queueDeclare(TASK_QUEUE_NAME, <span class=\"keyword\">true</span>, <span class=\"keyword\">false</span>, <span class=\"keyword\">false</span>, <span class=\"keyword\">null</span>);</span><br><span class=\"line\">        <span class=\"comment\">//System.out.println(&quot; [*] Waiting for messages. To exit press CTRL+C&quot;);</span></span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;开始接收消息&quot;</span>);</span><br><span class=\"line\">        channel.basicConsume(TASK_QUEUE_NAME, <span class=\"keyword\">true</span>, <span class=\"keyword\">new</span> DefaultConsumer(channel) &#123;</span><br><span class=\"line\">            <span class=\"meta\">@Override</span></span><br><span class=\"line\">            <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">handleDelivery</span><span class=\"params\">(String consumerTag, Envelope envelope,</span></span></span><br><span class=\"line\"><span class=\"params\"><span class=\"function\">                    AMQP.BasicProperties properties, <span class=\"keyword\">byte</span>[] body)</span> <span class=\"keyword\">throws</span> IOException </span>&#123;</span><br><span class=\"line\">                String message = <span class=\"keyword\">new</span> String(body, <span class=\"string\">&quot;UTF-8&quot;</span>);</span><br><span class=\"line\">                System.out.println(<span class=\"string\">&quot;收到了消息&quot;</span>+message);</span><br><span class=\"line\">                <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                    doWork(message);</span><br><span class=\"line\">                &#125; <span class=\"keyword\">finally</span> &#123;</span><br><span class=\"line\">                    System.out.println(<span class=\"string\">&quot;消息处理完毕&quot;</span>);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/*执行任务方法;定义消费特点:如果字符为&quot;.&quot;则处理时间为1s,这样设计为后续消息区分做铺垫*/</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">doWork</span><span class=\"params\">(String task)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">char</span> ch : task.toCharArray()) &#123;<span class=\"comment\">//遍历字符数组</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (ch == <span class=\"string\">&#x27;.&#x27;</span>) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                    Thread.sleep(<span class=\"number\">1000</span>);</span><br><span class=\"line\">                &#125; <span class=\"keyword\">catch</span> (InterruptedException _ignored) &#123;</span><br><span class=\"line\">                    Thread.currentThread().interrupt();</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>◇上述方法处理消息会比较慢，我们可以在执行一个worker类，即让两个worker去接收消息；需要先进行配置:Edit Configurations-&gt;Allow parallerl run(允许并行执行); 这样两个worker就会平均的接收消息，即有10条消息，每个消费者会接收到5条；<br>◇下面考虑每条消息的处理时间不同的情况如何合理的给worker分配压力；<br>◇在发送消息的时候修改为</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">10</span>; i++) &#123;</span><br><span class=\"line\">            String message;</span><br><span class=\"line\">            <span class=\"keyword\">if</span>(i%<span class=\"number\">2</span>==<span class=\"number\">0</span>)&#123;</span><br><span class=\"line\">               message = i + <span class=\"string\">&quot;....&quot;</span>;</span><br><span class=\"line\">            &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">               message = String.valueOf(i);<span class=\"comment\">//把int类型的i字符串化;</span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            </span><br><span class=\"line\">            <span class=\"comment\">//发送消息</span></span><br><span class=\"line\">            channel.basicPublish(<span class=\"string\">&quot;&quot;</span>, TASK_QUEUE_NAME, <span class=\"keyword\">null</span>, message.getBytes(<span class=\"string\">&quot;UTF-8&quot;</span>));</span><br><span class=\"line\">            System.out.println(<span class=\"string\">&quot; [x] Sent &#x27;&quot;</span> + message + <span class=\"string\">&quot;&#x27;&quot;</span>);</span><br><span class=\"line\">        &#125;</span><br></pre></td></tr></table></figure>\n<p>◇在这种情况下，如果运行两个worker的话，就会造成双方压力不同；那么如何实现公平派遣呢？<br>◇实现公平派遣需要加入消息确认机制，让RabbitMQ知道这个消息处理完毕，然后再去分配新任务；<br>◇对消费者进行改造</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> workqueues;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.*;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.io.IOException;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//接收前面的批量消息</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Worker</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> String TASK_QUEUE_NAME = <span class=\"string\">&quot;task_queue&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] argv)</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</span><br><span class=\"line\">        ConnectionFactory factory = <span class=\"keyword\">new</span> ConnectionFactory();</span><br><span class=\"line\">        factory.setHost(<span class=\"string\">&quot;xxx.xx.xxx.xxx&quot;</span>);</span><br><span class=\"line\">        factory.setUsername(<span class=\"string\">&quot;admin&quot;</span>);</span><br><span class=\"line\">        factory.setPassword(<span class=\"string\">&quot;password&quot;</span>);</span><br><span class=\"line\">        Connection connection = factory.newConnection();</span><br><span class=\"line\">        Channel channel = connection.createChannel();</span><br><span class=\"line\">        <span class=\"comment\">//声明队列</span></span><br><span class=\"line\">        channel.queueDeclare(TASK_QUEUE_NAME, <span class=\"keyword\">true</span>, <span class=\"keyword\">false</span>, <span class=\"keyword\">false</span>, <span class=\"keyword\">null</span>);</span><br><span class=\"line\">        <span class=\"comment\">//System.out.println(&quot; [*] Waiting for messages. To exit press CTRL+C&quot;);</span></span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;开始接收消息&quot;</span>);</span><br><span class=\"line\">        channel.basicQos(<span class=\"number\">1</span>);<span class=\"comment\">//在消费消息之前,设置希望处理的消息数量</span></span><br><span class=\"line\">        <span class=\"comment\">//消费消息,将自动确认接收改为false</span></span><br><span class=\"line\">        channel.basicConsume(TASK_QUEUE_NAME, <span class=\"keyword\">false</span>, <span class=\"keyword\">new</span> DefaultConsumer(channel) &#123;</span><br><span class=\"line\">            <span class=\"meta\">@Override</span></span><br><span class=\"line\">            <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">handleDelivery</span><span class=\"params\">(String consumerTag, Envelope envelope,</span></span></span><br><span class=\"line\"><span class=\"params\"><span class=\"function\">                    AMQP.BasicProperties properties, <span class=\"keyword\">byte</span>[] body)</span> <span class=\"keyword\">throws</span> IOException </span>&#123;</span><br><span class=\"line\">                String message = <span class=\"keyword\">new</span> String(body, <span class=\"string\">&quot;UTF-8&quot;</span>);</span><br><span class=\"line\">                System.out.println(<span class=\"string\">&quot;收到了消息&quot;</span>+message);</span><br><span class=\"line\">                <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                    doWork(message);</span><br><span class=\"line\">                &#125; <span class=\"keyword\">finally</span> &#123;</span><br><span class=\"line\">                    System.out.println(<span class=\"string\">&quot;消息处理完毕&quot;</span>);</span><br><span class=\"line\">                    <span class=\"comment\">//确认接收完消息(模板,是否同时确认多个消息)</span></span><br><span class=\"line\">                    channel.basicAck(envelope.getDeliveryTag(), <span class=\"keyword\">false</span>);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/*执行任务方法;定义消费特点:如果字符为&quot;.&quot;则处理时间为1s,这样设计为后续消息区分做铺垫*/</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">doWork</span><span class=\"params\">(String task)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">char</span> ch : task.toCharArray()) &#123;<span class=\"comment\">//遍历字符数组</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (ch == <span class=\"string\">&#x27;.&#x27;</span>) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                    Thread.sleep(<span class=\"number\">1000</span>);</span><br><span class=\"line\">                &#125; <span class=\"keyword\">catch</span> (InterruptedException _ignored) &#123;</span><br><span class=\"line\">                    Thread.currentThread().interrupt();</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"交换机工作模式\"><a href=\"#交换机工作模式\" class=\"headerlink\" title=\"交换机工作模式\"></a>交换机工作模式</h2><h3 id=\"fanout模式\"><a href=\"#fanout模式\" class=\"headerlink\" title=\"fanout模式\"></a>fanout模式</h3><p>◇ fanout：广播，这种模式只需要将队列绑定到交换机上即可， 是不需要设置路由键的<br><img src=\"/p/ef1a/1637064167756-57971c5b-5a5d-4ac5-8eb0-4ff4886608de.png\" class=\"lazyload\" data-srcset=\"/p/ef1a/1637064167756-57971c5b-5a5d-4ac5-8eb0-4ff4886608de.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"><br>◇最左侧是一个P，即生产者；然后是X交换机；由于是fanout模式，只要绑定了这些队列，后续凡是送到这个交换机X的消息X都会分发到与其绑定的队列中；比如说，我们有两个程序，第一个程序是负责发送日志消息，第二个负责接收；假设日志需要保存到文件中也需要打印到屏幕上，则有多处地方使用了日志消息，即形成了一对多的关系，则使用fanout模式的交换机；<br><strong>代码演示</strong><br>◇新建fanout包，在包下创建EmitLog日志类</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> fanout;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//发送日志信息</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">EmitLog</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//定义交换机的名字</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> String EXCHANGE_NAME = <span class=\"string\">&quot;logs&quot;</span>;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] argv)</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</span><br><span class=\"line\">        ConnectionFactory factory = <span class=\"keyword\">new</span> ConnectionFactory();</span><br><span class=\"line\">        factory.setHost(<span class=\"string\">&quot;localhost&quot;</span>);</span><br><span class=\"line\">        Connection connection = factory.newConnection();</span><br><span class=\"line\">        Channel channel = connection.createChannel();</span><br><span class=\"line\">        <span class=\"comment\">//声明交换机(交换机名字,交换机类型)</span></span><br><span class=\"line\">        channel.exchangeDeclare(EXCHANGE_NAME, BuiltinExchangeType.FANOUT);</span><br><span class=\"line\"></span><br><span class=\"line\">        String message = <span class=\"string\">&quot;info: Hello World!&quot;</span>;</span><br><span class=\"line\">        <span class=\"comment\">//发送消息</span></span><br><span class=\"line\">        channel.basicPublish(EXCHANGE_NAME, <span class=\"string\">&quot;&quot;</span>, <span class=\"keyword\">null</span>, message.getBytes(<span class=\"string\">&quot;UTF-8&quot;</span>));</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;发送了消息&quot;</span>+message);</span><br><span class=\"line\">        channel.close();</span><br><span class=\"line\">        connection.close();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>◇创建接收类ReceiveLogs，有多个接收者去接收一样的消息;对于日志而言，只对当前发生的事感兴趣，对以前的日志没有必要保存，有很高的时效性，可能保存不超过3天就删除了；那么我们可以创建全新的空队列，让RabbitMQ自动生成队列的名字，并且此队列是非持久的，会自动删除的；即当接收者不复存在的时候，队列也会被删除，来节省我们的空间；如下图所示<br><img src=\"/p/ef1a/1637065115512-1776acf2-32dc-4403-8a0d-5de585db90e8.png\" class=\"lazyload\" data-srcset=\"/p/ef1a/1637065115512-1776acf2-32dc-4403-8a0d-5de585db90e8.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"><br>◇执行多个ReceiveLogs模拟多个消费者</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> fanout;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.*;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.io.IOException;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ReceiveLogs</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> String EXCHANGE_NAME = <span class=\"string\">&quot;logs&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] argv)</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</span><br><span class=\"line\">        ConnectionFactory factory = <span class=\"keyword\">new</span> ConnectionFactory();</span><br><span class=\"line\">        factory.setHost(<span class=\"string\">&quot;localhost&quot;</span>);</span><br><span class=\"line\">        Connection connection = factory.newConnection();</span><br><span class=\"line\">        Channel channel = connection.createChannel();</span><br><span class=\"line\"></span><br><span class=\"line\">        channel.exchangeDeclare(EXCHANGE_NAME, BuiltinExchangeType.FANOUT);</span><br><span class=\"line\">        <span class=\"comment\">//通过getQueue()方法可以得到一个非持久的空队列</span></span><br><span class=\"line\">        String queueName = channel.queueDeclare().getQueue();</span><br><span class=\"line\">        <span class=\"comment\">//将队列绑定到交换机上,路由键为空;</span></span><br><span class=\"line\">        channel.queueBind(queueName, EXCHANGE_NAME, <span class=\"string\">&quot;&quot;</span>);</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;开始接收消息&quot;</span>);</span><br><span class=\"line\">        Consumer consumer = <span class=\"keyword\">new</span> DefaultConsumer(channel) &#123;</span><br><span class=\"line\">            <span class=\"meta\">@Override</span></span><br><span class=\"line\">            <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">handleDelivery</span><span class=\"params\">(String consumerTag, Envelope envelope,</span></span></span><br><span class=\"line\"><span class=\"params\"><span class=\"function\">                    AMQP.BasicProperties properties, <span class=\"keyword\">byte</span>[] body)</span> <span class=\"keyword\">throws</span> IOException </span>&#123;</span><br><span class=\"line\">                String message = <span class=\"keyword\">new</span> String(body, <span class=\"string\">&quot;UTF-8&quot;</span>);</span><br><span class=\"line\">                System.out.println(<span class=\"string\">&quot;收到消息&quot;</span> + message);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;;</span><br><span class=\"line\">        <span class=\"comment\">//消费消息</span></span><br><span class=\"line\">        channel.basicConsume(queueName, <span class=\"keyword\">true</span>, consumer);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"direct模式\"><a href=\"#direct模式\" class=\"headerlink\" title=\"direct模式\"></a>direct模式</h3><p>◇ direct：直接，根据 RoutingKey 匹配消息路由到指定的队列<br><img src=\"/p/ef1a/1637065419610-cbebc186-6d43-4c93-abc2-66e96e14e007.png\" class=\"lazyload\" data-srcset=\"/p/ef1a/1637065419610-cbebc186-6d43-4c93-abc2-66e96e14e007.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"><br>◇应用场景：比如对于日志而言，为了节省空间我们不一定要把所有的日志都存储下来，我们的日志会分为不同的等级，磁盘只存储error类型的日志；那么这样就不能再使用fanout的交换机，因为这样它会把所有日志无差别的保存下来；我们的要求是只存储error类型日志，但是需要打印全部类型的日志到前台；即对应不同的消费者接受不一样的消息；<br>◇允许把相同的路由键绑定到不同的消息队列中，如下图<br><img src=\"/p/ef1a/1637065758191-7c11dffc-1920-423a-867b-d885f2aa819c.png\" class=\"lazyload\" data-srcset=\"/p/ef1a/1637065758191-7c11dffc-1920-423a-867b-d885f2aa819c.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"><br>◇在实际的生产中，C1接受error类型用于存储，C2接受所有类型用于打印，如下图<br><img src=\"/p/ef1a/1637065834878-74011671-eb9b-4749-a575-f1fdc60a5218.png\" class=\"lazyload\" data-srcset=\"/p/ef1a/1637065834878-74011671-eb9b-4749-a575-f1fdc60a5218.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"><br><strong>代码演示</strong><br><strong>◇</strong>新建包direct包，创建EmitLogDirect日志类</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> direct;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.BuiltinExchangeType;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.ConnectionFactory;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.Connection;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.Channel;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">EmitLogDirect</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> String EXCHANGE_NAME = <span class=\"string\">&quot;direct_logs&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] argv)</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        ConnectionFactory factory = <span class=\"keyword\">new</span> ConnectionFactory();</span><br><span class=\"line\">        factory.setHost(<span class=\"string\">&quot;localhost&quot;</span>);</span><br><span class=\"line\">        Connection connection = factory.newConnection();</span><br><span class=\"line\">        Channel channel = connection.createChannel();</span><br><span class=\"line\"></span><br><span class=\"line\">        channel.exchangeDeclare(EXCHANGE_NAME, BuiltinExchangeType.DIRECT);</span><br><span class=\"line\"></span><br><span class=\"line\">        String message = <span class=\"string\">&quot;Hello World!&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        String severity = <span class=\"string\">&quot;info&quot;</span>;</span><br><span class=\"line\">        channel.basicPublish(EXCHANGE_NAME, severity, <span class=\"keyword\">null</span>, message.getBytes(<span class=\"string\">&quot;UTF-8&quot;</span>));</span><br><span class=\"line\">        severity = <span class=\"string\">&quot;warning&quot;</span>;</span><br><span class=\"line\">        channel.basicPublish(EXCHANGE_NAME, severity, <span class=\"keyword\">null</span>, message.getBytes(<span class=\"string\">&quot;UTF-8&quot;</span>));</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;发送了消息&quot;</span> + message + <span class=\"string\">&quot;等级为:&quot;</span>+severity);</span><br><span class=\"line\">        severity = <span class=\"string\">&quot;error&quot;</span>;</span><br><span class=\"line\">        channel.basicPublish(EXCHANGE_NAME, severity, <span class=\"keyword\">null</span>, message.getBytes(<span class=\"string\">&quot;UTF-8&quot;</span>));</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;发送了消息&quot;</span> + message + <span class=\"string\">&quot;等级为:&quot;</span>+severity);</span><br><span class=\"line\"></span><br><span class=\"line\">        channel.close();</span><br><span class=\"line\">        connection.close();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>◇新建接收者类ReceiveLogsDirect1</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> direct;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.*;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.io.IOException;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ReceiveLogsDirect1</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> String EXCHANGE_NAME = <span class=\"string\">&quot;direct_logs&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] argv)</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</span><br><span class=\"line\">        ConnectionFactory factory = <span class=\"keyword\">new</span> ConnectionFactory();</span><br><span class=\"line\">        factory.setHost(<span class=\"string\">&quot;localhost&quot;</span>);</span><br><span class=\"line\">        Connection connection = factory.newConnection();</span><br><span class=\"line\">        Channel channel = connection.createChannel();</span><br><span class=\"line\"></span><br><span class=\"line\">        channel.exchangeDeclare(EXCHANGE_NAME, BuiltinExchangeType.DIRECT);</span><br><span class=\"line\">        <span class=\"comment\">//生成一个随机的临时的queue</span></span><br><span class=\"line\">        String queueName = channel.queueDeclare().getQueue();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//一个交换机同时绑定三个queue</span></span><br><span class=\"line\">        channel.queueBind(queueName, EXCHANGE_NAME, <span class=\"string\">&quot;info&quot;</span>);</span><br><span class=\"line\">        channel.queueBind(queueName, EXCHANGE_NAME, <span class=\"string\">&quot;warning&quot;</span>);</span><br><span class=\"line\">        channel.queueBind(queueName, EXCHANGE_NAME, <span class=\"string\">&quot;error&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;开始接收消息&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        Consumer consumer = <span class=\"keyword\">new</span> DefaultConsumer(channel) &#123;</span><br><span class=\"line\">            <span class=\"meta\">@Override</span></span><br><span class=\"line\">            <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">handleDelivery</span><span class=\"params\">(String consumerTag, Envelope envelope,</span></span></span><br><span class=\"line\"><span class=\"params\"><span class=\"function\">                    AMQP.BasicProperties properties, <span class=\"keyword\">byte</span>[] body)</span> <span class=\"keyword\">throws</span> IOException </span>&#123;</span><br><span class=\"line\">                String message = <span class=\"keyword\">new</span> String(body, <span class=\"string\">&quot;UTF-8&quot;</span>);</span><br><span class=\"line\">                System.out.println(<span class=\"string\">&quot;收到消息&quot;</span>+message);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;;</span><br><span class=\"line\">        channel.basicConsume(queueName, <span class=\"keyword\">true</span>, consumer);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>◇创建接收类ReceiveLogsDirect2，只接收error类型的日志；</p>\n<h3 id=\"topic模式\"><a href=\"#topic模式\" class=\"headerlink\" title=\"topic模式\"></a>topic模式</h3><p>◇ topic：生产者指定 RoutingKey 消息根据消费端指定的队列通过模糊匹配的方式进行相应转发；<br>◇*可以代替一个单词，#可以代替0个或者多个单词；<br><img src=\"/p/ef1a/1637066701851-8ab3afb1-92e6-42b2-82e9-a73bb57af8e8.png\" class=\"lazyload\" data-srcset=\"/p/ef1a/1637066701851-8ab3afb1-92e6-42b2-82e9-a73bb57af8e8.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"><br>◇上图有三个维度：速度，颜色，种类；Q1对颜色为橙色的动物都感兴趣；Q2对种类为兔子的感兴趣以及有关懒惰动物的一切；<br><strong>代码演示</strong><br>◇新建包topic,创建类EmitLogTopic发送消息</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> topic;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">EmitLogTopic</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> String EXCHANGE_NAME = <span class=\"string\">&quot;topic_logs&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] argv)</span> </span>&#123;</span><br><span class=\"line\">        Connection connection = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">        Channel channel = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            ConnectionFactory factory = <span class=\"keyword\">new</span> ConnectionFactory();</span><br><span class=\"line\">            factory.setHost(<span class=\"string\">&quot;localhost&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">            connection = factory.newConnection();</span><br><span class=\"line\">            channel = connection.createChannel();</span><br><span class=\"line\"></span><br><span class=\"line\">            channel.exchangeDeclare(EXCHANGE_NAME, BuiltinExchangeType.TOPIC);</span><br><span class=\"line\"></span><br><span class=\"line\">            String message = <span class=\"string\">&quot;Animal World&quot;</span>;</span><br><span class=\"line\">            <span class=\"comment\">//数组来表示不同类型的动物</span></span><br><span class=\"line\">            String[] routingKeys = <span class=\"keyword\">new</span> String[<span class=\"number\">9</span>];</span><br><span class=\"line\">            routingKeys[<span class=\"number\">0</span>] = <span class=\"string\">&quot;quick.orange.rabbit&quot;</span>;</span><br><span class=\"line\">            routingKeys[<span class=\"number\">1</span>] = <span class=\"string\">&quot;lazy.orange.elephant&quot;</span>;</span><br><span class=\"line\">            routingKeys[<span class=\"number\">2</span>] = <span class=\"string\">&quot;quick.orange.fox&quot;</span>;</span><br><span class=\"line\">            routingKeys[<span class=\"number\">3</span>] = <span class=\"string\">&quot;lazy.brown.fox&quot;</span>;</span><br><span class=\"line\">            routingKeys[<span class=\"number\">4</span>] = <span class=\"string\">&quot;lazy.pink.rabbit&quot;</span>;</span><br><span class=\"line\">            routingKeys[<span class=\"number\">5</span>] = <span class=\"string\">&quot;quick.brown.fox&quot;</span>;</span><br><span class=\"line\">            routingKeys[<span class=\"number\">6</span>] = <span class=\"string\">&quot;orange&quot;</span>;<span class=\"comment\">//测试单个属性</span></span><br><span class=\"line\">            routingKeys[<span class=\"number\">7</span>] = <span class=\"string\">&quot;quick.orange.male.rabbit&quot;</span>;<span class=\"comment\">//增加无关属性male</span></span><br><span class=\"line\">            routingKeys[<span class=\"number\">8</span>] = <span class=\"string\">&quot;lazy.orange.male.rabbit&quot;</span>;</span><br><span class=\"line\">            <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; routingKeys.length; i++) &#123;</span><br><span class=\"line\">                channel.basicPublish(EXCHANGE_NAME, routingKeys[i], <span class=\"keyword\">null</span>,</span><br><span class=\"line\">                        message.getBytes(<span class=\"string\">&quot;UTF-8&quot;</span>));</span><br><span class=\"line\">                System.out.println(<span class=\"string\">&quot;发送了&quot;</span>+message+<span class=\"string\">&quot;路由键为:&quot;</span>+routingKeys[i]);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</span><br><span class=\"line\">            e.printStackTrace();</span><br><span class=\"line\">        &#125; <span class=\"keyword\">finally</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (connection != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                    connection.close();</span><br><span class=\"line\">                &#125; <span class=\"keyword\">catch</span> (Exception ignore) &#123;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>◇新建接收者ReceiveLogsTopic1</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> topic;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.*;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.io.IOException;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ReceiveLogsTopic1</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> String EXCHANGE_NAME = <span class=\"string\">&quot;topic_logs&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] argv)</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</span><br><span class=\"line\">        ConnectionFactory factory = <span class=\"keyword\">new</span> ConnectionFactory();</span><br><span class=\"line\">        factory.setHost(<span class=\"string\">&quot;localhost&quot;</span>);</span><br><span class=\"line\">        Connection connection = factory.newConnection();</span><br><span class=\"line\">        Channel channel = connection.createChannel();</span><br><span class=\"line\"></span><br><span class=\"line\">        channel.exchangeDeclare(EXCHANGE_NAME, BuiltinExchangeType.TOPIC);</span><br><span class=\"line\">        String queueName = channel.queueDeclare().getQueue();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//指定routingKey</span></span><br><span class=\"line\">        String routingKey = <span class=\"string\">&quot;*.orange.*&quot;</span>;</span><br><span class=\"line\">        channel.queueBind(queueName, EXCHANGE_NAME, routingKey);</span><br><span class=\"line\"></span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;开始接收消息&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        Consumer consumer = <span class=\"keyword\">new</span> DefaultConsumer(channel) &#123;</span><br><span class=\"line\">            <span class=\"meta\">@Override</span></span><br><span class=\"line\">            <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">handleDelivery</span><span class=\"params\">(String consumerTag, Envelope envelope,</span></span></span><br><span class=\"line\"><span class=\"params\"><span class=\"function\">                    AMQP.BasicProperties properties, <span class=\"keyword\">byte</span>[] body)</span> <span class=\"keyword\">throws</span> IOException </span>&#123;</span><br><span class=\"line\">                String message = <span class=\"keyword\">new</span> String(body, <span class=\"string\">&quot;UTF-8&quot;</span>);</span><br><span class=\"line\">                System.out.println(<span class=\"string\">&quot;收到消息:&quot;</span>+message+<span class=\"string\">&quot;路由键为:&quot;</span>+envelope.getRoutingKey());</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;;</span><br><span class=\"line\">        channel.basicConsume(queueName, <span class=\"keyword\">true</span>, consumer);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>◇创建第二个接收者</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">String routingKey1 = <span class=\"string\">&quot;*.*.rabbit&quot;</span>;</span><br><span class=\"line\">channel.queueBind(queueName, EXCHANGE_NAME, routingKey1);</span><br><span class=\"line\"></span><br><span class=\"line\">String routingKey2 = <span class=\"string\">&quot;lazy.#&quot;</span>;</span><br><span class=\"line\">channel.queueBind(queueName, EXCHANGE_NAME, routingKey2);</span><br></pre></td></tr></table></figure>\n<h3 id=\"headers模式\"><a href=\"#headers模式\" class=\"headerlink\" title=\"headers模式\"></a>headers模式</h3><p>◇ headers：头交换机（headers exchange）使用多个消息属性来代替路由键建立路由规则。通过判断消息头的值能否与指定的绑定相匹配来确立路由规则。头交换机可以视为直连交换机的另一种表现形式。头交换机能够像直连交换机一样工作，不同之处在于头交换机的路由规则是建立在头属性值之上，而不是路由键。路由键必须是一个字符串，而头属性值则没有这个约束，它们甚至可以是整数或者哈希值（字典）等。在消息的properties中设置头信息。</p>\n<h2 id=\"Spring-Boot整合RabbitMQ\"><a href=\"#Spring-Boot整合RabbitMQ\" class=\"headerlink\" title=\"Spring Boot整合RabbitMQ\"></a>Spring Boot整合RabbitMQ</h2><p>◇创建两个SpringBoot项目-&gt;Add as Maven Project-&gt;一个Consumer-&gt;一个Producer；</p>\n<h3 id=\"生产者\"><a href=\"#生产者\" class=\"headerlink\" title=\"生产者\"></a>生产者</h3><p>◇对配置文件进行修改；把springboot版本改为2.2.2.1；引入RabbitMQ所需的依赖</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">&lt;dependency&gt;</span><br><span class=\"line\">  &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class=\"line\">  &lt;artifactId&gt;spring-boot-starter-amqp&lt;/artifactId&gt;</span><br><span class=\"line\">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>\n<p>◇配置生产者的application.properties文件</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">server.port=<span class=\"number\">8080</span></span><br><span class=\"line\">spring.application.name=producer</span><br><span class=\"line\"></span><br><span class=\"line\">spring.rabbitmq.addresses=<span class=\"string\">&#x27;ip地址&#x27;</span>:<span class=\"number\">5672</span></span><br><span class=\"line\">spring.rabbitmq.username=admin</span><br><span class=\"line\">spring.rabbitmq.password=password</span><br><span class=\"line\">spring.rabbitmq.virtual-host=/</span><br><span class=\"line\">spring.rabbitmq.connection-timeout=<span class=\"number\">15000</span>  超时时间</span><br></pre></td></tr></table></figure>\n<p>◇新建一个配置类(声明交换机，队列等)</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.lcg.springbootrabbitmqproducer;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.amqp.core.Binding;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.amqp.core.BindingBuilder;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.amqp.core.Queue;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.amqp.core.TopicExchange;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.context.annotation.Bean;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.context.annotation.Configuration;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 描述：     rabbitmq配置类</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"meta\">@Configuration</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">TopicRabbitConfig</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> Queue <span class=\"title\">queue1</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> Queue(<span class=\"string\">&quot;queue1&quot;</span>);<span class=\"comment\">//队列</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> Queue <span class=\"title\">queue2</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> Queue(<span class=\"string\">&quot;queue2&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"function\">TopicExchange <span class=\"title\">exchange</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> TopicExchange(<span class=\"string\">&quot;bootExchange&quot;</span>);<span class=\"comment\">//交换机</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"function\">Binding <span class=\"title\">bingdingExchangeMessage1</span><span class=\"params\">(Queue queue1, TopicExchange exchange)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">//交换机和队列绑定</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> BindingBuilder.bind(queue1).to(exchange).with(<span class=\"string\">&quot;dog.red&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"function\">Binding <span class=\"title\">bingdingExchangeMessage2</span><span class=\"params\">(Queue queue2, TopicExchange exchange)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> BindingBuilder.bind(queue2).to(exchange).with(<span class=\"string\">&quot;dog.#&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>◇发送消息类</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.lcg.springbootrabbitmqproducer;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.amqp.core.AmqpTemplate;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.stereotype.Component;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 描述：     发送消息</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"meta\">@Component</span><span class=\"comment\">//把普通的java对象实例化到spring容器中，相当于配置文件中的&lt;bean id=&quot;&quot; class=&quot;&quot;/&gt;</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MsgSender</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> AmqpTemplate rabbitmqTemplate;<span class=\"comment\">//引入Amqp协议</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">send1</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        String message = <span class=\"string\">&quot;This is message 1, routing key is dog.red&quot;</span>;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;发送了：&quot;</span>+message);</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.rabbitmqTemplate.convertAndSend(<span class=\"string\">&quot;bootExchange&quot;</span>, <span class=\"string\">&quot;dog.red&quot;</span>, message);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">send2</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        String message = <span class=\"string\">&quot;This is message 2, routing key is dog.black&quot;</span>;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;发送了：&quot;</span>+message);</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.rabbitmqTemplate.convertAndSend(<span class=\"string\">&quot;bootExchange&quot;</span>, <span class=\"string\">&quot;dog.black&quot;</span>, message);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>◇增加测试类</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.lcg.springbootrabbitmqproducer;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> org.junit.jupiter.api.Test;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.boot.test.context.SpringBootTest;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@SpringBootTest</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">SpringBootRabbitmqProducerApplicationTests</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"meta\">@Autowired</span></span><br><span class=\"line\">\tMsgSender msgSender;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"meta\">@Test</span></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">send1</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">\t\tmsgSender.send1();</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"meta\">@Test</span></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">send2</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">\t\tmsgSender.send2();</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"消费者\"><a href=\"#消费者\" class=\"headerlink\" title=\"消费者\"></a>消费者</h3><p>◇更改springboot版本，引入RabbitMQ依赖；<br>◇增加配置，和生产者一样的配置内容，但是端口不一样，这里改为8081<br>◇新建类Receiver1接收消息</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.lcg.springbootrabbitmqconsumer;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.amqp.rabbit.annotation.RabbitHandler;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.amqp.rabbit.annotation.RabbitListener;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.stereotype.Component;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 描述：     消费者1</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"meta\">@Component</span></span><br><span class=\"line\"><span class=\"meta\">@RabbitListener(queues = &quot;queue1&quot;)</span> <span class=\"comment\">//利用注解指定队列</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Receiver1</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@RabbitHandler</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">process</span><span class=\"params\">(String message)</span> </span>&#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;Receiver1: &quot;</span> + message);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>◇Receiver2绑定queue2<br>​</p>\n","categories":["分布式与微服务"],"tags":["RabbitMQ"]},{"title":"递归逆置链表","url":"/p/bac2.html","content":"<h4 id=\"实验内容\"><a href=\"#实验内容\" class=\"headerlink\" title=\"实验内容\"></a>实验内容</h4><p>  对于一个不带头结点的单链表，设计递归算法逆置所有结点。</p>\n<h4 id=\"实验原理\"><a href=\"#实验原理\" class=\"headerlink\" title=\"实验原理\"></a>实验原理</h4><p>  <strong>1.递归介绍</strong></p>\n<p>​        程序调用自身的编程技巧称为递归；一个过程或函数在其定义或说明中有直接或间接调用自身的一种方法，它通常把一个大型复杂的问题层层转化为一个与原问题相似的规模较小的问题来求解，递归策略只需少量的程序就可描述出解题过程所需要的多次重复计算，大大地减少了程序的代码量。递归的能力在于用有限的语句来定义对象的无限集合。递归必须具备两个条件，一个是<wavy>调用自己</wavy>，一个是有<wavy>终止条件</wavy>。这两个条件必须同时具备，且一个都不能少。并且终止条件必须是在递归最开始的地方如下面的代码一样:</p>\n<figure class=\"highlight c\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">recursion</span><span class=\"params\">(参数<span class=\"number\">0</span>)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (终止条件) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    recursion(参数<span class=\"number\">1</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><strong>2.逆置方法</strong></p>\n<p>​        对于单链表的递归逆置虽然只有几行代码，但刚开始接触可能会有点绕，所以我尽可能详细的把思路理出来；</p>\n<p>​        对于有n个结点的链表的逆置，利用递归的思想可以先将前n-1个结点逆置；当链表为空或者链表只有一个结点的时候终止递归；每一次调用逆置函数R()完成后返回链表已经逆置完成的部分的第一个结点(设为newNode)；因为在当前结点(设为p)前面的结点都已经完成了逆置，所以当前结点指向的下一个结点(p-&gt;next)，成为了已经逆置完成的部分的最后一个结点；如果要进行逆置的话，当前结点应该要变成最后一个结点；所以将p-&gt;next的下一个结点设置为当前结点，即指向p：<strong>p-&gt;next</strong>-&gt;next=<strong>p</strong>;  p变为最后一个结点后，其下一个结点为空，即p-&gt;next=NULL;这样就完成了以当前结点为第一个结点的链表部分的逆置，返回当前的第一个结点，继续进行逆置，直到所有递归函数调用完毕；</p>\n<p>​        我们来看一个例子，比如要对链表a-&gt;b-&gt;c-&gt;d进行逆置；调用逆置函数R(a),R(a)中会递归调用R(a-&gt;next)即R(b),而R(b)中又会调用R(b-&gt;next)即R(c);这样依次下来：（递归完成部分加粗显示，按照调用完成的顺序）</p>\n<p>①R(d),对d进行逆置，由于d-&gt;next为空，所以直接返回d;此时有newNode=d, a-&gt;b-&gt;c-&gt;<strong>d-&gt;NULL</strong>;</p>\n<p>②R(c),对c-&gt;d进行逆置,当前结点为c，要进行逆置，c应该为最后一个结点，则有：c-&gt;next(d)-&gt;next=c;c-&gt;next=NULL; 此时有newNode=d,<strong>d-&gt;c-&gt;NULL</strong>; a-&gt;b-&gt;c-&gt;NULL;注意这里没有任何结点指向d了，因为已经将c-&gt;next设置为空；</p>\n<p>③R(b),对b-&gt;c-&gt;d进行逆置，由于c-&gt;d部分已经逆置成<strong>d-&gt;c-&gt;NULL</strong>了，所以只需要将b设置为最后一个结点即可；b-&gt;next(c)-&gt;next=b; b-&gt;next=NULL;返回d；此时有newNode=d,<strong>d-&gt;c-&gt;b-&gt;NULL</strong>; a-&gt;b-&gt;NULL;</p>\n<p>④R(a),对a-&gt;b-&gt;c-&gt;d进行逆置,由于b-&gt;c-&gt;d部分已经逆置成<strong>d-&gt;c-&gt;b-&gt;NULL</strong>，所以像③一样，a-&gt;next(b)-&gt;next=a, a-&gt;next=NULL;至此，所有的递归函数都已经调用完毕；得到了newNode=d，<strong>d-&gt;c-&gt;b-&gt;a-&gt;NULL</strong>完成了所有节点的逆置；</p>\n<h4 id=\"代码演示\"><a href=\"#代码演示\" class=\"headerlink\" title=\"代码演示\"></a>代码演示</h4><div class=\"tabs\" id=\"tab-id\"><ul class=\"nav-tabs\"><li class=\"tab active\"><a class=\"#tab-id-1\">完整代码</a></li><li class=\"tab\"><a class=\"#tab-id-2\">运行结果</a></li></ul><div class=\"tab-content\"><div class=\"tab-pane active\" id=\"tab-id-1\"><figure class=\"highlight c++\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span><span class=\"meta-string\">&lt;iostream&gt;</span></span></span><br><span class=\"line\"><span class=\"keyword\">using</span> <span class=\"keyword\">namespace</span> std;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">typedef</span> <span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">Node</span> &#123;</span></span><br><span class=\"line\">\t<span class=\"keyword\">int</span> data;</span><br><span class=\"line\">\t<span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">Node</span>* <span class=\"title\">next</span>;</span></span><br><span class=\"line\">&#125; LinkNode;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\">LinkNode* <span class=\"title\">CreateList</span><span class=\"params\">(<span class=\"keyword\">int</span> a[],<span class=\"keyword\">int</span> n)</span> </span>&#123;</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> (n &lt; <span class=\"number\">0</span>)</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> <span class=\"literal\">NULL</span>;</span><br><span class=\"line\">\tLinkNode* head = <span class=\"keyword\">new</span> <span class=\"built_in\">LinkNode</span>();</span><br><span class=\"line\">\tLinkNode* p = <span class=\"keyword\">new</span> <span class=\"built_in\">LinkNode</span>();</span><br><span class=\"line\">\tp = head;</span><br><span class=\"line\">\thead-&gt;data = a[<span class=\"number\">0</span>];</span><br><span class=\"line\">\t<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>;</span><br><span class=\"line\">\t<span class=\"keyword\">for</span> (i = <span class=\"number\">1</span>; i &lt; n; i++) &#123;</span><br><span class=\"line\">\t\tLinkNode* node = <span class=\"keyword\">new</span> <span class=\"built_in\">LinkNode</span>();</span><br><span class=\"line\">\t\tnode-&gt;data = a[i];</span><br><span class=\"line\">\t\tp-&gt;next = node;</span><br><span class=\"line\">\t\tp = node;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tp-&gt;next = <span class=\"literal\">NULL</span>;  <span class=\"comment\">// 尾结点next域置为空</span></span><br><span class=\"line\">\t<span class=\"keyword\">return</span> head;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">DispList</span><span class=\"params\">(LinkNode* ln)</span> </span>&#123;</span><br><span class=\"line\">\tcout &lt;&lt; <span class=\"string\">&quot; &quot;</span>;</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> (ln != <span class=\"literal\">NULL</span>) &#123;</span><br><span class=\"line\">\t\tcout &lt;&lt; ln-&gt;data;</span><br><span class=\"line\">\t\t<span class=\"built_in\">DispList</span>(ln-&gt;next);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\">LinkNode* <span class=\"title\">Release</span><span class=\"params\">(LinkNode* ln)</span> </span>&#123;</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> (ln == <span class=\"literal\">NULL</span> || ln-&gt;next == <span class=\"literal\">NULL</span>)</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> ln;</span><br><span class=\"line\">\t<span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\tLinkNode* newNode = <span class=\"built_in\">Release</span>(ln-&gt;next);</span><br><span class=\"line\">\t\tln-&gt;next-&gt;next = ln;<span class=\"comment\">//将当前结点接在逆置完成部分的最后结点后面,使其成为最后结点</span></span><br><span class=\"line\">\t\tln-&gt;next = <span class=\"literal\">NULL</span>;<span class=\"comment\">//逆置后，最后一个结点的下一个结点为空</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> newNode;<span class=\"comment\">//返回逆置完成部分的第一个结点      </span></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">main</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">\t<span class=\"keyword\">int</span> a[] = &#123;<span class=\"number\">0</span>,<span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">3</span>,<span class=\"number\">4</span>,<span class=\"number\">5</span>,<span class=\"number\">6</span>,<span class=\"number\">7</span>,<span class=\"number\">8</span>,<span class=\"number\">9</span>&#125;;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> n = <span class=\"built_in\"><span class=\"keyword\">sizeof</span></span>(a) / <span class=\"built_in\"><span class=\"keyword\">sizeof</span></span>(a[<span class=\"number\">0</span>]);</span><br><span class=\"line\">\tLinkNode* L, *N;</span><br><span class=\"line\">\tL = <span class=\"built_in\">CreateList</span>(a,n);</span><br><span class=\"line\">\tcout &lt;&lt; <span class=\"string\">&quot;初始链表:&quot;</span> &lt;&lt; endl;</span><br><span class=\"line\">\t<span class=\"built_in\">DispList</span>(L);</span><br><span class=\"line\">\tcout &lt;&lt; endl;</span><br><span class=\"line\">\tcout &lt;&lt; <span class=\"string\">&quot;逆置链表:&quot;</span> &lt;&lt; endl;</span><br><span class=\"line\">\tN = <span class=\"built_in\">Release</span>(L);</span><br><span class=\"line\">\t<span class=\"built_in\">DispList</span>(N);</span><br><span class=\"line\">\tcout &lt;&lt; endl;</span><br><span class=\"line\">\t<span class=\"keyword\">delete</span> L;</span><br><span class=\"line\">\t<span class=\"keyword\">delete</span> N;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div><div class=\"tab-pane\" id=\"tab-id-2\"><p><img src=\"https://s2.loli.net/2021/12/09/bSlnhdWxo7vPZ6G.png\" class=\"lazyload\" data-srcset=\"https://s2.loli.net/2021/12/09/bSlnhdWxo7vPZ6G.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\"></p></div></div></div>\n\n","categories":["数据结构"],"tags":["递归"]},{"title":"线程池","url":"/p/e2.html","content":"<h2 id=\"多线程与分布式课程介绍\"><a href=\"#多线程与分布式课程介绍\" class=\"headerlink\" title=\"多线程与分布式课程介绍\"></a>多线程与分布式课程介绍</h2><p>◇线程池的基本使用、特点、注意点<br>◇ThreadLocal的基本使用，原理和注意事项<br>◇分布式基础、核心概念<br>◇docker的下载、安装和基本命令<br>◇独立制作docker容器<br>◇Nginx的安装、基本使用和常用命令<br>◇使用Nginx搭建文件服务<br>◇消息队列RabbitMQ的核心概念queue、message和exchange<br>◇RabbitMQ的四种交换机模式<br>◇Spring Boot整合RabbitMQ案例</p>\n<h2 id=\"线程池-治理线程的最大法宝\"><a href=\"#线程池-治理线程的最大法宝\" class=\"headerlink\" title=\"线程池-治理线程的最大法宝\"></a>线程池-治理线程的最大法宝</h2><p>◇线程池的自我介绍<br>◇创建和停止线程池<br>◇常见线程池的特点和用法<br>◇任务太多、怎么拒绝？<br>◇钩子方法，给线程池加点料<br>◇实现原理、源码分析<br>◇使用线程池的注意点</p>\n<h2 id=\"线程池的自我介绍\"><a href=\"#线程池的自我介绍\" class=\"headerlink\" title=\"线程池的自我介绍\"></a>线程池的自我介绍</h2><p>◇线程池的重要性，工作、面试<br>◇什么是”池”<br>          –软件中的”池”，可以理解为计划经济；资源是有限的，需要合理分配线程；<br>◇如果不使用线程池，每个任务都新开一个线程处理；多个任务的话用for循环创建线程；<br>◇创建线程的方式</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> threadpool;</span><br><span class=\"line\"><span class=\"comment\">//每个任务创建一个线程</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">EveryTaskThread</span></span>&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span></span>&#123;</span><br><span class=\"line\">        Thread thread = <span class=\"keyword\">new</span> Thread(<span class=\"keyword\">new</span> Task());</span><br><span class=\"line\">        thread.start();<span class=\"comment\">//启动线程</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">   <span class=\"keyword\">static</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Task</span> <span class=\"keyword\">implements</span> <span class=\"title\">Runnable</span></span>&#123;<span class=\"comment\">//创建一个任务</span></span><br><span class=\"line\">         <span class=\"meta\">@Override</span></span><br><span class=\"line\">        <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">()</span></span>&#123; <span class=\"comment\">//重写run方法</span></span><br><span class=\"line\">           System.out.pringln(<span class=\"string\">&quot;执行任务&quot;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//循环创建</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ForLoop</span></span>&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span></span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">for</span>(<span class=\"keyword\">int</span> i=<span class=\"number\">0</span>;i&lt;<span class=\"number\">10</span>;i++)&#123;</span><br><span class=\"line\">            Thread thread = <span class=\"keyword\">new</span> Thread(<span class=\"keyword\">new</span> Task());</span><br><span class=\"line\">            thread.start();<span class=\"comment\">//启动线程</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">   <span class=\"keyword\">static</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Task</span> <span class=\"keyword\">implements</span> <span class=\"title\">Runnable</span></span>&#123;<span class=\"comment\">//创建一个任务</span></span><br><span class=\"line\">         <span class=\"meta\">@Override</span></span><br><span class=\"line\">        <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">()</span></span>&#123; <span class=\"comment\">//重写run方法</span></span><br><span class=\"line\">           System.out.pringln(<span class=\"string\">&quot;执行任务&quot;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>◇如果任务数量过于庞大，使用上面的方法显然开销太大了；我们希望有固定数量的线程，来执行者1000个线程，这样就避免了反复创建并销毁线程所带来的开销问题；</p>\n<h2 id=\"为什么要使用线程池\"><a href=\"#为什么要使用线程池\" class=\"headerlink\" title=\"为什么要使用线程池\"></a>为什么要使用线程池</h2><p>◇问题一：反复创建线程开销大<br>◇问题二：过多的线程会占用太多内存<br>◇解决以上两个问题的思路<br>   • 用少量的线程——避免内存占用过多<br>   • 让这部分线程都保持工作，且可以反复执行任务——避免生命周期的损耗  </p>\n<h2 id=\"线程池的好处\"><a href=\"#线程池的好处\" class=\"headerlink\" title=\"线程池的好处\"></a>线程池的好处</h2><p>◇加快响应速度<br>◇合理利用CPU和内存<br>◇统一管理 </p>\n<h2 id=\"线程池适合应用的场合\"><a href=\"#线程池适合应用的场合\" class=\"headerlink\" title=\"线程池适合应用的场合\"></a>线程池适合应用的场合</h2><p>◇服务器接收到大量请求时，使用线程池技术是非常合适的，它可 以大大减少线程的创建和销毁次数，提高服务器的工作效率<br>◇实际上，在开发中，如果需要创建5个以上的线程，那么就可以使 用线程池来管理  </p>\n<h2 id=\"创建线程池\"><a href=\"#创建线程池\" class=\"headerlink\" title=\"创建线程池\"></a>创建线程池</h2><p>◇线程池构造方法的参数<br>◇线程池应该手动创建还是自动创建 ，手动创建更加灵活；<br>◇线程池里的线程数量设定为多少比较合适？<br>◇停止线程池的正确方法  </p>\n<h3 id=\"线程池构造方法的参数\"><a href=\"#线程池构造方法的参数\" class=\"headerlink\" title=\"线程池构造方法的参数\"></a>线程池构造方法的参数</h3><p><img src=\"/p/e2/1635821818102-e8427fd8-15a5-44ac-8330-43018cf99992.png\" class=\"lazyload\" data-srcset=\"/p/e2/1635821818102-e8427fd8-15a5-44ac-8330-43018cf99992.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"></p>\n<h3 id=\"参数中的corePoolSize和maxPoolSize\"><a href=\"#参数中的corePoolSize和maxPoolSize\" class=\"headerlink\" title=\"参数中的corePoolSize和maxPoolSize\"></a>参数中的corePoolSize和maxPoolSize</h3><p>◇corePoolSize指的是核心线程数 </p>\n<ul>\n<li>线程池在完成初始化后，默认情况下，线程池中并没有任何线程,线程池会等待有任务到来时,再创建新线程去执行任务<br>◇最大量maxPoolSize </li>\n<li>在核心线程数的基础上，额外增加的线程数的上限  <h3 id=\"corePoolSize和maxPoolSize\"><a href=\"#corePoolSize和maxPoolSize\" class=\"headerlink\" title=\"corePoolSize和maxPoolSize\"></a>corePoolSize和maxPoolSize</h3><img src=\"/p/e2/1635842042382-04e08aec-05d8-41fc-b65c-a2729498e9e4.png\" class=\"lazyload\" data-srcset=\"/p/e2/1635842042382-04e08aec-05d8-41fc-b65c-a2729498e9e4.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"><br>◇从左开始看，当任务进来后就会创建线程一直到达到Current size后；任务会依次使用初始化时的核心线程数来执行任务，一般情况不会突破这个数量；如果任务过多，就会存储到队列中去，等核心线程有剩余后再出队去处理；如果队列满了，并且核心线程数量都在被使用，这样线程池就会在核心线程数的基础上增加新的线程来处理任务，线程数量最多扩展到Max pool size；</li>\n</ul>\n<h3 id=\"添加线程规则\"><a href=\"#添加线程规则\" class=\"headerlink\" title=\"添加线程规则\"></a>添加线程规则</h3><ol>\n<li>如果线程数小于corePoolSize，即使其他工作线程处于空闲状态，也会创建一个新线程来运行新任务。 </li>\n<li>如果线程数等于（或大于）corePoolSize但少于 maximumPoolSize，则将任务放入队列。 </li>\n<li>如果队列已满，并且线程数小于maxPoolSize，则创建一个新线程来运行任务。</li>\n<li>如果队列已满，并且线程数大于或等于maxPoolSize，则拒绝该任务。<br><img src=\"/p/e2/1635842986310-604d18cd-edc9-4d12-9153-c775dcc1af5f.png\" class=\"lazyload\" data-srcset=\"/p/e2/1635842986310-604d18cd-edc9-4d12-9153-c775dcc1af5f.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"><br>◇是否需要增加线程的判断顺序是： • corePoolSize • workQueue • maxPoolSize  <h3 id=\"举例说明\"><a href=\"#举例说明\" class=\"headerlink\" title=\"举例说明\"></a>举例说明</h3>◇线程池：核心池大小为5，最大池大小为10，队列为100。<br>◇因为线程中的请求最多会创建5个，然后任务将被添加到队列 中，直到达到100。当队列已满时，将创建最新的线程 maxPoolSize，最多到10个线程，如果再来任务，就拒绝。<h3 id=\"增减线程的特点\"><a href=\"#增减线程的特点\" class=\"headerlink\" title=\"增减线程的特点\"></a>增减线程的特点</h3></li>\n<li>通过设置corePoolSize和maximumPoolSize 相同，就可以创建固定 大小的线程池。 </li>\n<li>线程池希望保持较少的线程数，并且只有在负载变得很大时才增加它。 </li>\n<li>通过设置maximumPoolSize为很高的值，例如 Integer.MAX_VALUE， 可以允许线程池容纳任意数量的并发任务。 </li>\n<li>只有在队列填满时才创建多于corePoolSize的线程，如果使用的是无 界队列（例如LinkedBlockingQueue），那么线程数就不会超过 corePoolSize。    <h3 id=\"keepAliveTime\"><a href=\"#keepAliveTime\" class=\"headerlink\" title=\"keepAliveTime\"></a>keepAliveTime</h3>◇如果线程池当前的线程数多于corePoolSize，那么如果多余的线程空闲时间超过keepAliveTime，它们就会被终止 <h3 id=\"ThreadFactory-用来创建线程\"><a href=\"#ThreadFactory-用来创建线程\" class=\"headerlink\" title=\"ThreadFactory 用来创建线程\"></a>ThreadFactory 用来创建线程</h3>◇新的线程是由ThreadFactory创建的，默认使用 Executors.defaultThreadFactory()<br>◇创建出来的线程都在同一个线程组，拥有同样的 NORM_PRIORITY优先级并且都不是守护线程。<br>◇如果自己指定ThreadFactory，那么就可以改变线程名、线程 组、优先级、是否是守护线程等。<br>◇通常使用默认的ThreadFactory就可以了 <h3 id=\"工作队列\"><a href=\"#工作队列\" class=\"headerlink\" title=\"工作队列\"></a>工作队列</h3>◇有3种最常见的队列类型： </li>\n</ol>\n<ol>\n<li>直接交接：SynchronousQueue ；如果任务不是特别多的话，只是把任务通过这个队列进行简单的中转，交到线程去处理的话就可以使用该队列；这个队列本身内部是没有容量的，里面不能存储任务，任务过多的话就不能够缓冲，所以使用时要把初始线程数设置大一点；</li>\n<li>无界队列：LinkedBlockingQueue ；无界队列不会被塞满，使用无界队列可以防止流量突增带来的影响；但也有风险：比如说我们任务处理的速度跟不上任务提交的速度，那么无界队列的任务会越来越多可能会造成内存浪费或者内存溢出(OOM)异常；</li>\n<li>有界的队列：ArrayBlockingQueue ;可以设置队列的大小；<h3 id=\"线程池应该手动创建还是自动创建\"><a href=\"#线程池应该手动创建还是自动创建\" class=\"headerlink\" title=\"线程池应该手动创建还是自动创建\"></a>线程池应该手动创建还是自动创建</h3>◇手动创建更好，因为这样可以更加明确线程池的运行规则，避免资源耗尽的风险<br>◇ 自动创建线程池（即直接调用JDK封装好的构造方法） 可能带来哪些问题？<br>◇newFixedThreadPool<br><img src=\"/p/e2/1635851277065-f8655ce5-99ce-4ba0-89cc-7a76064ceac1.png\" class=\"lazyload\" data-srcset=\"/p/e2/1635851277065-f8655ce5-99ce-4ba0-89cc-7a76064ceac1.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"><pre><code>   • 容易造成大量内存占用，可能会导致OOM \n</code></pre>\n</li>\n</ol>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> threadpool;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.concurrent.ExecutorService;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.concurrent.Executors;</span><br><span class=\"line\"><span class=\"comment\">//演示如何创建newFixedThreadPool 线程池</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">TestClass</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">//线程数量固定为4，使用无限大的队列</span></span><br><span class=\"line\">        ExecutorService executorService = Executors.newFixedThreadPool(<span class=\"number\">4</span>);</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">1000</span>; i++) &#123;</span><br><span class=\"line\">            executorService.execute(<span class=\"keyword\">new</span> Task());</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">//创建任务</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Task</span> <span class=\"keyword\">implements</span> <span class=\"title\">Runnable</span></span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            Thread.sleep(<span class=\"number\">500</span>);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (InterruptedException e) &#123;</span><br><span class=\"line\">            e.printStackTrace();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        System.out.println(Thread.currentThread());</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>◇为了便于演示，应该将内存设置的小一点: 在编辑运行中设置VM options：-Xmx8m  -Xms8m</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 描述：     演示newFixedThreadPool出错的情况</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">FixedThreadPoolOOM</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> ExecutorService executorService = Executors.newFixedThreadPool(<span class=\"number\">1</span>);</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; Integer.MAX_VALUE; i++) &#123;</span><br><span class=\"line\">            executorService.execute(<span class=\"keyword\">new</span> SubThread());</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">SubThread</span> <span class=\"keyword\">implements</span> <span class=\"title\">Runnable</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">      <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">          Thread.sleep(<span class=\"number\">1000000000</span>);<span class=\"comment\">//一直在睡眠中,即任务一个都不能执行;这样能有效的将队列填满</span></span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (InterruptedException e) &#123;</span><br><span class=\"line\">            e.printStackTrace();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>◇newSingleThreadExecutor<br>          • 当请求堆积的时候，可能会占用大量的内存  </p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//单个线程，只有一个线程的线程池；核心数量和最大数量都设置为1;</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">SingleThreadExecutor</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> </span>&#123;</span><br><span class=\"line\">        ExecutorService executorService = Executors.newSingleThreadExecutor();</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">1000</span>; i++) &#123;</span><br><span class=\"line\">            executorService.execute(<span class=\"keyword\">new</span> Task());</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>◇newCachedThreadPool  可以缓存线程池 ；特点：具有自动回收多余线程的功能(时间是60s)<br><img src=\"/p/e2/1635850199652-2ed87a22-2ed4-4fdb-a107-3c73a1037f3f.png\" class=\"lazyload\" data-srcset=\"/p/e2/1635850199652-2ed87a22-2ed4-4fdb-a107-3c73a1037f3f.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"><br>◇使用了直接交换的队列，线程池设置的线程最大数为整形的最大值；<br>          • 弊端在于第二个参数maximumPoolSize被设置为了 Integer.MAX_VALUE，这可能会创建数量非常多的线程， 甚至导致OOM </p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">ExecutorService executorService = Executors.newCachedThreadPool();</span><br></pre></td></tr></table></figure>\n<p>◇newScheduledThreadPool；支持定时及周期性任务执行的线程池；<br>          • 原因和newCachedThreadPool一样  </p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">ScheduledExecutorService threadPool = Executors.newScheduledThreadPool(<span class=\"number\">10</span>);<span class=\"comment\">//设置核心数量</span></span><br><span class=\"line\"><span class=\"comment\">//threadPool.schedule(new Task(), 5, TimeUnit.SECONDS);//任务,延迟时间,时间单位</span></span><br><span class=\"line\"><span class=\"comment\">//开始执行与1s,然后每隔3S执行一次</span></span><br><span class=\"line\">threadPool.scheduleAtFixedRate(<span class=\"keyword\">new</span> Task(), <span class=\"number\">1</span>, <span class=\"number\">3</span>, TimeUnit.SECONDS);</span><br></pre></td></tr></table></figure>\n<p>◇正确的创建线程池的方法：根据不同的业务场景，设置线程池参数 ；<br>◇以上4种线程池的构造方法的参数<br><img src=\"/p/e2/1635851363010-1f49bdf6-5b10-4aba-82bc-a69c3f184465.png\" class=\"lazyload\" data-srcset=\"/p/e2/1635851363010-1f49bdf6-5b10-4aba-82bc-a69c3f184465.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"></p>\n<h3 id=\"线程池里的线程数量设定为多少比较合适？\"><a href=\"#线程池里的线程数量设定为多少比较合适？\" class=\"headerlink\" title=\"线程池里的线程数量设定为多少比较合适？\"></a>线程池里的线程数量设定为多少比较合适？</h3><p>◇CPU密集型（加密、计算hash等）：最佳线程数为CPU核心数的1-2倍左右。<br>◇耗时IO型（读写数据库、文件、网络读写等）：最佳线程数一 般会大于CPU核心数很多倍 参考Brain Goetz推荐的计算方法： 线程数=CPU核心数*（1+平均等待时间/平均工作时间）</p>\n<h3 id=\"阻塞队列分析\"><a href=\"#阻塞队列分析\" class=\"headerlink\" title=\"阻塞队列分析\"></a>阻塞队列分析</h3><p>◇FixedThreadPool和SingleThreadExecutor的Queue是LinkedBlockingQueue?<br> 是因为由于线程数量是有限的，所以不得不用一个很大甚至无限大的队列来存储任务；<br>◇CachedThreadPool使用的Queue是SynchronousQueue？<br>         SynchronousQueue队列内部是不存储的，而刚好CachedThreadPool的线程数量很多，不需要队列来存储任务；<br>◇ScheduledThreadPool来说，它使用的是延迟队列 DelayedWorkQueue<br>◇workStealingPool是JDK1.8加入的；该线程池和之前的都有很大不同，适用于能够产生子任务的任务；如二叉树的遍历；该线程池拥有窃取能力，即线程之间会进行合作；用它执行的任务最好不要加锁，这样更加高效的进行并行执行；执行的顺序不能保障；实际开发中很少用到；  </p>\n<h2 id=\"停止线程池\"><a href=\"#停止线程池\" class=\"headerlink\" title=\"停止线程池\"></a>停止线程池</h2><h3 id=\"停止线程池的正确方法\"><a href=\"#停止线程池的正确方法\" class=\"headerlink\" title=\"停止线程池的正确方法\"></a>停止线程池的正确方法</h3><p>1、shutdown；实际上运行该方法后线程池不一定停止，这个方法事实上只是初始化关闭的过程；因为在线程池被关闭的时候有线程中正在被执行的任务和在存储队列中的任务；所以不是一个命令想停就停的；shutdown方法执行后即通知要关闭线程池，然后拒绝所有新的任务，但线程池会把正在执行的以及还在队列中等待的任务执行完后才关闭；<br>2、isShutdown ；判断线程池是否停止，并不是完全停止，而是指是否执行了shutdown方法；</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ShutDown</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> <span class=\"keyword\">throws</span> InterruptedException </span>&#123;</span><br><span class=\"line\">        ExecutorService executorService = Executors.newFixedThreadPool(<span class=\"number\">10</span>);</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">1000</span>; i++) &#123;</span><br><span class=\"line\">            executorService.execute(<span class=\"keyword\">new</span> ShutDownTask());</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        Thread.sleep(<span class=\"number\">1500</span>);<span class=\"comment\">//休眠1.5s</span></span><br><span class=\"line\">        System.out.println(executorService.isShutdown());<span class=\"comment\">//判断是否停止</span></span><br><span class=\"line\">        executorService.shutdown();<span class=\"comment\">//停止线程池</span></span><br><span class=\"line\">        System.out.println(executorService.isShutdown());</span><br><span class=\"line\">        executorService.execute(<span class=\"keyword\">new</span> ShutDownTask());<span class=\"comment\">//添加新任务</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p><img src=\"/p/e2/1635924704169-81d440ab-77b7-4c41-b13e-89e26bc7ca02.png\" class=\"lazyload\" data-srcset=\"/p/e2/1635924704169-81d440ab-77b7-4c41-b13e-89e26bc7ca02.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"><br>可以看出，在成功执行shutdown方法后，添加新任务会出现异常，但原先正在执行或者在等待中的任务会被执行；<br>3、isTerminated ;用来判断线程是否完全终止，即线程池里的任务是否执行完毕；<br>4、awaitTermination；用来测试在一段时间内线程池是否会完全关闭；返回只有三种情况，在返回之前该方法是阻塞的：①所有任务都执行完毕；②达到等待的时间；③等待过程中被中断</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">executorService.awaitTermination(<span class=\"number\">3L</span>, TimeUnit.SECONDS);<span class=\"comment\">//(时间,时间单位)</span></span><br></pre></td></tr></table></figure>\n<p>5、shutdownNow ；立刻关闭线程池，用中断的信号触发正在执行的任务；而在队列里的任务直接加入列表中作为返回对象返回；</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">List&lt;Runnable&gt; runnableList = executorService.shutdownNow();</span><br></pre></td></tr></table></figure>\n<h3 id=\"任务太多，怎么拒绝？\"><a href=\"#任务太多，怎么拒绝？\" class=\"headerlink\" title=\"任务太多，怎么拒绝？\"></a>任务太多，怎么拒绝？</h3><p>◇拒绝时机<br>1.当Executor关闭时，提交新任务会被拒绝。<br>2.以及当Executor对最大线程和工作队列容量使用有限边界并且已经饱和时<br><img src=\"/p/e2/1635992390343-f02ff24f-35fc-4fa8-9dc7-63249937d254.png\" class=\"lazyload\" data-srcset=\"/p/e2/1635992390343-f02ff24f-35fc-4fa8-9dc7-63249937d254.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"></p>\n<h3 id=\"四种拒绝策略\"><a href=\"#四种拒绝策略\" class=\"headerlink\" title=\"四种拒绝策略\"></a>四种拒绝策略</h3><p>◇AbortPolicy；直接抛出异常，终端可以得知任务未提交成功<br>◇DiscardPolicy；将任务丢弃，但不通知到终端；<br>◇DiscardOldestPolicy ；丢弃最旧的任务，腾出空间存放新提交的任务<br>◇CallerRunsPolicy ；让提交任务的线程去执行任务，优点是避免任务损失、可以降低提交任务的速度；</p>\n<h3 id=\"钩子方法，给线程池加点料\"><a href=\"#钩子方法，给线程池加点料\" class=\"headerlink\" title=\"钩子方法，给线程池加点料\"></a>钩子方法，给线程池加点料</h3><p>◇每个任务执行前后增加执行钩子函数能够起到暂停恢复线程池的作用；<br>◇日志、统计<br>◇代码演示 </p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 演示每个任务执行前后放钩子函数</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">PauseableThreadPool</span> <span class=\"keyword\">extends</span> <span class=\"title\">ThreadPoolExecutor</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">//为了保证布尔值的并发修改是安全的，给其上一把锁；</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> ReentrantLock lock = <span class=\"keyword\">new</span> ReentrantLock();</span><br><span class=\"line\">    <span class=\"comment\">//休眠线程</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> Condition unpaused = lock.newCondition();</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">boolean</span> isPaused;<span class=\"comment\">//标记位，线程池是否暂停；</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">PauseableThreadPool</span><span class=\"params\">(<span class=\"keyword\">int</span> corePoolSize, <span class=\"keyword\">int</span> maximumPoolSize, <span class=\"keyword\">long</span> keepAliveTime, TimeUnit unit, BlockingQueue&lt;Runnable&gt; workQueue)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">super</span>(corePoolSize, maximumPoolSize, keepAliveTime, unit, workQueue);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">PauseableThreadPool</span><span class=\"params\">(<span class=\"keyword\">int</span> corePoolSize, <span class=\"keyword\">int</span> maximumPoolSize, <span class=\"keyword\">long</span> keepAliveTime, TimeUnit unit, BlockingQueue&lt;Runnable&gt; workQueue, ThreadFactory threadFactory)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">super</span>(corePoolSize, maximumPoolSize, keepAliveTime, unit, workQueue, threadFactory);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">PauseableThreadPool</span><span class=\"params\">(<span class=\"keyword\">int</span> corePoolSize, <span class=\"keyword\">int</span> maximumPoolSize, <span class=\"keyword\">long</span> keepAliveTime, TimeUnit unit, BlockingQueue&lt;Runnable&gt; workQueue, RejectedExecutionHandler handler)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">super</span>(corePoolSize, maximumPoolSize, keepAliveTime, unit, workQueue, handler);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">PauseableThreadPool</span><span class=\"params\">(<span class=\"keyword\">int</span> corePoolSize, <span class=\"keyword\">int</span> maximumPoolSize, <span class=\"keyword\">long</span> keepAliveTime, TimeUnit unit, BlockingQueue&lt;Runnable&gt; workQueue, ThreadFactory threadFactory, RejectedExecutionHandler handler)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">super</span>(corePoolSize, maximumPoolSize, keepAliveTime, unit, workQueue, threadFactory, handler);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title\">beforeExecute</span><span class=\"params\">(Thread t, Runnable r)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">super</span>.beforeExecute(t, r);</span><br><span class=\"line\">        lock.lock();</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">while</span> (isPaused) &#123;<span class=\"comment\">//是暂停</span></span><br><span class=\"line\">                unpaused.await();<span class=\"comment\">//休眠线程</span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;<span class=\"keyword\">catch</span> (InterruptedException e) &#123;</span><br><span class=\"line\">                e.printStackTrace();</span><br><span class=\"line\">        &#125;<span class=\"keyword\">finally</span> &#123;</span><br><span class=\"line\">            lock.unlock();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//暂停方法</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">pause</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        lock.lock();</span><br><span class=\"line\">        <span class=\"keyword\">try</span>&#123;</span><br><span class=\"line\">            isPaused=<span class=\"keyword\">true</span>;</span><br><span class=\"line\">        &#125;<span class=\"keyword\">finally</span> &#123;</span><br><span class=\"line\">            lock.unlock();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">//恢复方法</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">resume</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        lock.lock();</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            isPaused=<span class=\"keyword\">false</span>;</span><br><span class=\"line\">            unpaused.signalAll();<span class=\"comment\">//唤醒所有线程</span></span><br><span class=\"line\">        &#125; <span class=\"keyword\">finally</span> &#123;</span><br><span class=\"line\">            lock.unlock();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> <span class=\"keyword\">throws</span> InterruptedException </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">//新建线程池</span></span><br><span class=\"line\">        PauseableThreadPool pauseableThreadPool =</span><br><span class=\"line\">                <span class=\"keyword\">new</span> PauseableThreadPool(<span class=\"number\">10</span>, <span class=\"number\">20</span>, <span class=\"number\">10l</span>, TimeUnit.SECONDS,</span><br><span class=\"line\">                        <span class=\"keyword\">new</span> LinkedBlockingQueue&lt;&gt;());</span><br><span class=\"line\">        Runnable runnable = <span class=\"keyword\">new</span> Runnable()&#123;</span><br><span class=\"line\">            <span class=\"meta\">@Override</span></span><br><span class=\"line\">            <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">                System.out.println(<span class=\"string\">&quot;线程被执行&quot;</span>);</span><br><span class=\"line\">                <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                    Thread.sleep(<span class=\"number\">10</span>);</span><br><span class=\"line\">                &#125; <span class=\"keyword\">catch</span> (InterruptedException e) &#123;</span><br><span class=\"line\">                    e.printStackTrace();</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">1000</span>; i++) &#123;</span><br><span class=\"line\">            pauseableThreadPool.execute(runnable);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        Thread.sleep(<span class=\"number\">1500</span>);</span><br><span class=\"line\">        pauseableThreadPool.pause();<span class=\"comment\">//暂停线程池</span></span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;线程池已被暂停&quot;</span>);</span><br><span class=\"line\">        Thread.sleep(<span class=\"number\">1500</span>);</span><br><span class=\"line\">        pauseableThreadPool.resume();<span class=\"comment\">//恢复线程池</span></span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;线程池已恢复&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p><img src=\"/p/e2/1635994280012-49add18a-327b-41bf-9ffa-72cdbafcfd1d.png\" class=\"lazyload\" data-srcset=\"/p/e2/1635994280012-49add18a-327b-41bf-9ffa-72cdbafcfd1d.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"></p>\n<h2 id=\"线程池实现原理、源码分析\"><a href=\"#线程池实现原理、源码分析\" class=\"headerlink\" title=\"线程池实现原理、源码分析\"></a>线程池实现原理、源码分析</h2><p>◇线程池组成部分<br>• 线程池管理器<br>• 工作线程<br>• 任务队列<br>• 任务接口（Task)<br><img src=\"/p/e2/1636025851901-0b01f52d-319f-47ed-98ab-0ce5ad9e19ea.png\" class=\"lazyload\" data-srcset=\"/p/e2/1636025851901-0b01f52d-319f-47ed-98ab-0ce5ad9e19ea.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"></p>\n<h3 id=\"Executor家族\"><a href=\"#Executor家族\" class=\"headerlink\" title=\"Executor家族\"></a>Executor家族</h3><p>◇线程池、ThreadPoolExecutor、ExecutorService、Executor、 Executors等这么多和线程池相关的类，都是什么关系？<br>◇关系如下图，△代表继承；<br><img src=\"/p/e2/1636025983241-e054df24-725b-4ef5-81ca-c9091b694c57.png\" class=\"lazyload\" data-srcset=\"/p/e2/1636025983241-e054df24-725b-4ef5-81ca-c9091b694c57.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"><br>◇Executor是一个接口，只有一个方法， void execute()用来执行；<br>◇ExecutorService也是一个接口，继承了Executor；增加了shutdown等方法；<br>◇Executors是一个工具类，有很多方法用来创建各种线程池等；</p>\n<h3 id=\"线程池实现任务复用的原理\"><a href=\"#线程池实现任务复用的原理\" class=\"headerlink\" title=\"线程池实现任务复用的原理\"></a>线程池实现任务复用的原理</h3><p>◇核心：相同的线程执行不同任务；线程池对线程进行了包装，不需要重复的启动线程；只是启动已有的固定数量的线程即可；在线程池中的线程，不同于普通的线程，它里面的Run方法会不停的检测有没有新的任务进来，有的话就会执行任务的run方法，也就是把这些任务串联起来；线程池让这些固定的线程从任务队列中把任务取出来并且执行；<br>◇源码分析：<a href=\"https://blog.csdn.net/ctwctw/article/details/117407152\">runWorker()方法</a>；</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">final</span> <span class=\"keyword\">void</span> <span class=\"title\">runWorker</span><span class=\"params\">(Worker w)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// 获取当前线程对象的引用</span></span><br><span class=\"line\">    Thread wt = Thread.currentThread();</span><br><span class=\"line\">    <span class=\"comment\">// 获取worker的firstTask</span></span><br><span class=\"line\">    Runnable task = w.firstTask;</span><br><span class=\"line\">    <span class=\"comment\">// 获取完之后把worker的firstTask置为null 防止下次获取到</span></span><br><span class=\"line\">    w.firstTask = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">\t<span class=\"comment\">//这里不是解锁，而是为了设置state = 0 以及 ExclusiveOwnerThread = null</span></span><br><span class=\"line\">    <span class=\"comment\">//因为起始状态state = -1,(在前面的源码中,详见链接)。不允许任何线程抢占锁，这里就是初始化操作</span></span><br><span class=\"line\">    w.unlock(); </span><br><span class=\"line\">    <span class=\"comment\">// 如果发生异常 当前线程突然退出 该值为true </span></span><br><span class=\"line\">    <span class=\"keyword\">boolean</span> completedAbruptly = <span class=\"keyword\">true</span>;</span><br><span class=\"line\">    <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 如果firstTask获取getTask能获取到任务 则进行内层逻辑, 如果getTask返回null则循环退出了就要</span></span><br><span class=\"line\">        <span class=\"keyword\">while</span> (task != <span class=\"keyword\">null</span> || (task = getTask()) != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">            <span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">            * worker设置独占锁</span></span><br><span class=\"line\"><span class=\"comment\">            * shutdown 时会判断当前worker的状态，根据独占锁的状态来判断worker是否在处理任务是否工作</span></span><br><span class=\"line\"><span class=\"comment\">            */</span></span><br><span class=\"line\">            w.lock();</span><br><span class=\"line\">            <span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">            * 3个判断</span></span><br><span class=\"line\"><span class=\"comment\">            * 1、runStateAtLeast(ctl.get(), STOP)为真说明当前状态大于等于STOP 此时需要给他一个中断信号</span></span><br><span class=\"line\"><span class=\"comment\">            * 2、wt.isInterrupted()查看当前是否设置中断状态如果为false则说明为设置中断状态</span></span><br><span class=\"line\"><span class=\"comment\">            * 3、Thread.interrupted() &amp;&amp; runStateAtLeast(ctl.get(), STOP) 获取当前中断状态且清除中断状态 </span></span><br><span class=\"line\"><span class=\"comment\">            *    这个判断为真的话说明当前被设置了中断状态(有可能是线程池执行的业务代码设置的，然后重置了)且当前状态变成了大于等于STOP的状态了</span></span><br><span class=\"line\"><span class=\"comment\">            * </span></span><br><span class=\"line\"><span class=\"comment\">            * 整个判断为真的两种情况</span></span><br><span class=\"line\"><span class=\"comment\">            * 1、如果当前线程大于等于STOP 且未设置中断状态 整个判断为true 第一个runStateAtLeast(ctl.get(), STOP)为true !wt.isInterrupted()为true</span></span><br><span class=\"line\"><span class=\"comment\">            * 2、第一次判断的时候不大于STOP 且当前设置了中断状态(Thread.interrupted()把中断状态又刷新了) 且设置完了之后线程池状态大于等于STOP了</span></span><br><span class=\"line\"><span class=\"comment\">            *    Thread.interrupted() &amp;&amp; runStateAtLeast(ctl.get(), STOP) 为true !wt.isInterrupted()为true</span></span><br><span class=\"line\"><span class=\"comment\">            *</span></span><br><span class=\"line\"><span class=\"comment\">            * 结合if判断里面的代码来看 </span></span><br><span class=\"line\"><span class=\"comment\">            * 也就是说如果线程池状态大于等于STOP则设置当前线程的中断状态</span></span><br><span class=\"line\"><span class=\"comment\">            * 如果线程池状态小于STOP则清除中断状态</span></span><br><span class=\"line\"><span class=\"comment\">            */</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> ((runStateAtLeast(ctl.get(), STOP) || </span><br><span class=\"line\">                        (Thread.interrupted() &amp;&amp; runStateAtLeast(ctl.get(), STOP))) </span><br><span class=\"line\">                    &amp;&amp; !wt.isInterrupted())</span><br><span class=\"line\">                <span class=\"comment\">// 设置中断状态</span></span><br><span class=\"line\">                wt.interrupt();</span><br><span class=\"line\">            <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                <span class=\"comment\">// 钩子方法留给子类实现</span></span><br><span class=\"line\">                beforeExecute(wt, task);</span><br><span class=\"line\">                <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                    <span class=\"comment\">// task可能是FutureTask或者普通Runnable/Callable接口实现类</span></span><br><span class=\"line\">                    task.run();</span><br><span class=\"line\">                    <span class=\"comment\">// 钩子方法 留给子类实现</span></span><br><span class=\"line\">                    afterExecute(task, <span class=\"keyword\">null</span>);</span><br><span class=\"line\">                &#125; <span class=\"keyword\">catch</span> (Throwable ex) &#123;</span><br><span class=\"line\">                    afterExecute(task, ex);</span><br><span class=\"line\">                    <span class=\"keyword\">throw</span> ex;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125; <span class=\"keyword\">finally</span> &#123;</span><br><span class=\"line\">                <span class=\"comment\">// 局部task设置为null</span></span><br><span class=\"line\">                task = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">                <span class=\"comment\">// 完成数量加1</span></span><br><span class=\"line\">                w.completedTasks++;</span><br><span class=\"line\">                <span class=\"comment\">// 使用unlock 释放独占锁</span></span><br><span class=\"line\">                w.unlock();</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">// getTask的返回为null 会走到这行 表示这次不是异常退出</span></span><br><span class=\"line\">        completedAbruptly = <span class=\"keyword\">false</span>;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">finally</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">        * 执行线程退出逻辑</span></span><br><span class=\"line\"><span class=\"comment\">        * 如果completedAbruptly是true说明是task.run()方法有异常 先catch后又抛了出来 在执行完了w.unlock();走到了这里</span></span><br><span class=\"line\"><span class=\"comment\">        * 如果是false则说明是拿不到任务走到了这里</span></span><br><span class=\"line\"><span class=\"comment\">        */</span></span><br><span class=\"line\">        processWorkerExit(w, completedAbruptly);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h3 id=\"线程池状态\"><a href=\"#线程池状态\" class=\"headerlink\" title=\"线程池状态\"></a>线程池状态</h3><p><img src=\"/p/e2/1636027655828-77b68220-efa0-4e22-a52c-d460823e8abf.png\" class=\"lazyload\" data-srcset=\"/p/e2/1636027655828-77b68220-efa0-4e22-a52c-d460823e8abf.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"></p>\n<h3 id=\"使用线程池的注意点\"><a href=\"#使用线程池的注意点\" class=\"headerlink\" title=\"使用线程池的注意点\"></a>使用线程池的注意点</h3><p>◇避免任务堆积<br>◇避免线程数过度增加<br>◇排查线程泄漏，即任务结束后线程却回收不了</p>\n<h3 id=\"线程工厂\"><a href=\"#线程工厂\" class=\"headerlink\" title=\"线程工厂\"></a>线程工厂</h3><p>线程工厂为线程设置了如下内容：</p>\n<ul>\n<li>默认名字（pool-线程池自增编号-thread-线程的自增编号）</li>\n<li>非守护线程</li>\n<li>默认优先级</li>\n<li>默认线程组</li>\n</ul>\n","categories":["分布式与微服务"],"tags":["线程"]},{"title":"项目介绍及基础实现","url":"/p/2f49.html","content":"<h2 id=\"课程介绍\"><a href=\"#课程介绍\" class=\"headerlink\" title=\"课程介绍\"></a>课程介绍</h2><p>◇需求说明与环境准备<br>◇开发基于RABC的访问控制模块<br>◇开发多级请假审批流程  </p>\n<h2 id=\"办公自动化OA系统\"><a href=\"#办公自动化OA系统\" class=\"headerlink\" title=\"办公自动化OA系统\"></a>办公自动化OA系统</h2><p>◇办公自动化系统(Office Automation)是替代传统办公的解决方案<br>◇OA系统是利用软件技术构建的单位内部办公平台,用于辅助办公<br>◇利用OA系统可将办公数据数字化,可极大提高办公流程执行效率，项目完整代码见<a href=\"https://github.com/618dt/JavaPractice/tree/main/oa\">oa</a></p>\n<h2 id=\"需求介绍\"><a href=\"#需求介绍\" class=\"headerlink\" title=\"需求介绍\"></a>需求介绍</h2><p>◇办公OA系统要求采用多用户B/S架构设计开发<br>◇HR为每一位员工分配系统账户,员工用此账户登录系统<br>◇公司采用分级定岗,从1-8依次提升,不同岗位薪资水平不同<br>◇6级(含)以下员工为业务岗,对应人员执行公司业务事宜<br>◇7-8级为管理岗,其中7级为部门经理,8级为总经理<br>◇业务岗与管理岗员工可用系统功能不同,要求允许灵活配置<br> 需求介绍-请假流程<br>◇公司所有员工都可以使用”请假申请”功能申请休假<br>◇请假时间少于72小时,部门经理审批后直接通过<br>◇请假时间大于72小时,部门经理审批后还需总经理进行审批<br>◇部门经理只允许批准本部门员工申请<br>◇部门经理请假需直接由总经理审批<br>◇总经理提起请假申请,系统自动批准通过<br><img src=\"/p/2f49/1629078647393-4553179d-4d5e-4bdb-a5e7-5754c0f49278.png\" class=\"lazyload\" data-srcset=\"/p/2f49/1629078647393-4553179d-4d5e-4bdb-a5e7-5754c0f49278.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"></p>\n<h2 id=\"搭建基础架构\"><a href=\"#搭建基础架构\" class=\"headerlink\" title=\"搭建基础架构\"></a>搭建基础架构</h2><h3 id=\"框架-amp-组件\"><a href=\"#框架-amp-组件\" class=\"headerlink\" title=\"框架&amp;组件\"></a>框架&amp;组件</h3><p>◇MySQL 8                 ◇Mybatis 3.5<br>◇Alibaba Druid         ◇Servlet 3.1<br>◇Freemarker 2.3       ◇LayUI 2.5  </p>\n<h3 id=\"搭建数据库\"><a href=\"#搭建数据库\" class=\"headerlink\" title=\"搭建数据库\"></a>搭建数据库</h3><p>◇新建数据库lcg-oa，字符集选择utf8m4，排序规则默认</p>\n<h3 id=\"创建Maven工程\"><a href=\"#创建Maven工程\" class=\"headerlink\" title=\"创建Maven工程\"></a>创建Maven工程</h3><p>◇新建maven项目oa，JDK选择1.8<br>◇进行工程设置以便将项目发布到服务器上：File-&gt;Project Structure-&gt;Modules-&gt;+-&gt;Web-&gt;Path:改为oa\\src\\main\\webapp\\WEB-INF\\web.xml;version:3.1; Web Resource Directory:选中webapp目录-&gt;Create Artifact-&gt;OK<br>◇配置Tomcat:在工具栏上点击Add Configuration-&gt;+-&gt;Tomcat Server-&gt;Local(用本地的Tomcat来运行)-&gt;勾选After lanuch自动打开浏览器-&gt;HTTP port :80-&gt;Deployment(运行部署配置)-&gt;+-&gt;Artifact-&gt;Application context(应用上下文):/  -&gt;Apply-&gt;OK-&gt;下方为弹出Web面板</p>\n<h3 id=\"配置文件\"><a href=\"#配置文件\" class=\"headerlink\" title=\"配置文件\"></a>配置文件</h3><p>◇pom.xml配置</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"code\"><pre><span class=\"line\">//使用阿里云镜像仓库提高下载速度</span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">repositories</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">repository</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">id</span>&gt;</span>aliyun<span class=\"tag\">&lt;/<span class=\"name\">id</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">name</span>&gt;</span>aliyun<span class=\"tag\">&lt;/<span class=\"name\">name</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">url</span>&gt;</span>https://maven.aliyun.com/repository/public<span class=\"tag\">&lt;/<span class=\"name\">url</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">repository</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">repositories</span>&gt;</span></span><br><span class=\"line\">//项目依赖</span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">dependencies</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.mybatis<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>mybatis<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>3.5.3<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>mysql<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>mysql-connector-java<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>8.0.19<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.alibaba<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span>  //阿里巴巴连接池</span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>druid<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.1.14<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>junit<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span>      //单元测试</span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>junit<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>4.12<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>ch.qos.logback<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span> //集成日志</span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>logback-classic<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.2.3<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>◇mybatis核心配置文件：在resource目录下创建mybatis-config.xml</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE <span class=\"meta-keyword\">configuration</span></span></span><br><span class=\"line\"><span class=\"meta\">        <span class=\"meta-keyword\">PUBLIC</span> <span class=\"meta-string\">&quot;-//mybatis.org//DTD Config 3.0//EN&quot;</span></span></span><br><span class=\"line\"><span class=\"meta\">        <span class=\"meta-string\">&quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">configuration</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">settings</span>&gt;</span></span><br><span class=\"line\">        <span class=\"comment\">&lt;!--开启驼峰命名转换 form_id -&gt; formId--&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">setting</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;mapUnderscoreToCamelCase&quot;</span> <span class=\"attr\">value</span>=<span class=\"string\">&quot;true&quot;</span>/&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">settings</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">environments</span> <span class=\"attr\">default</span>=<span class=\"string\">&quot;dev&quot;</span>&gt;</span></span><br><span class=\"line\">        <span class=\"comment\">&lt;!--开发环境配置--&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">environment</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;dev&quot;</span>&gt;</span></span><br><span class=\"line\">            <span class=\"comment\">&lt;!--事务管理器采用JDBC方式--&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">transactionManager</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;JDBC&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">transactionManager</span>&gt;</span></span><br><span class=\"line\">            <span class=\"comment\">&lt;!--利用Mybatis自带连接池管理连接</span></span><br><span class=\"line\"><span class=\"comment\">            &lt;dataSource type=&quot;POOLED&quot;&gt;--&gt;</span></span><br><span class=\"line\">            <span class=\"comment\">&lt;!--MyBatis与Druid的整合--&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">dataSource</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;com.lcg.oa.datasource.DruidDataSourceFactory&quot;</span>&gt;</span></span><br><span class=\"line\">                <span class=\"comment\">&lt;!--JDBC连接属性--&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;driverClassName&quot;</span> <span class=\"attr\">value</span>=<span class=\"string\">&quot;com.mysql.cj.jdbc.Driver&quot;</span>/&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;url&quot;</span> //连接字符串<span class=\"attr\">lcg-oa</span>是数据库名</span></span><br><span class=\"line\"><span class=\"tag\">                     <span class=\"attr\">value</span>=<span class=\"string\">&quot;jdbc:mysql://localhost:3306/lcg-oa ? useSSL=false<span class=\"symbol\">&amp;amp;</span></span></span></span><br><span class=\"line\"><span class=\"string\"><span class=\"tag\">                     useUnicode=true<span class=\"symbol\">&amp;amp;</span>characterEncoding=UTF-8<span class=\"symbol\">&amp;amp;</span></span></span></span><br><span class=\"line\"><span class=\"string\"><span class=\"tag\">                     serverTimezone=Asia/Shanghai<span class=\"symbol\">&amp;amp;</span>allowPublicKeyRetrieval=true&quot;</span>/&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;username&quot;</span> <span class=\"attr\">value</span>=<span class=\"string\">&quot;root&quot;</span>/&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;password&quot;</span> <span class=\"attr\">value</span>=<span class=\"string\">&quot;www.LCG.com&quot;</span>/&gt;</span></span><br><span class=\"line\">                <span class=\"comment\">&lt;!--连接池初始连接数--&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;initialSize&quot;</span> <span class=\"attr\">value</span>=<span class=\"string\">&quot;10&quot;</span>/&gt;</span></span><br><span class=\"line\">                <span class=\"comment\">&lt;!--连接池最大连接数--&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;maxActive&quot;</span> <span class=\"attr\">value</span>=<span class=\"string\">&quot;20&quot;</span>/&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">dataSource</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">environment</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">environments</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">mappers</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">mapper</span> <span class=\"attr\">resource</span>=<span class=\"string\">&quot;mappers/test.xml&quot;</span>/&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">mappers</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p> ◇java目录下创建com.lcg.oa.utils.MybatisUtils工具类用于对Mybatis进行加载，SessionFactory对象的创建等初始化工作</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> org.apache.ibatis.io.Resources;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.apache.ibatis.session.SqlSession;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.apache.ibatis.session.SqlSessionFactory;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.apache.ibatis.session.SqlSessionFactoryBuilder;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.io.IOException;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.io.Reader;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.function.Function;</span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MybatisUtils</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">//利用static(静态)属于类不属于对象,且全局唯一</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> SqlSessionFactory sqlSessionFactory = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">    <span class=\"comment\">//利用静态块在初始化类时实例化sqlSessionFactory</span></span><br><span class=\"line\">    <span class=\"keyword\">static</span>&#123;</span><br><span class=\"line\">        Reader reader = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">        <span class=\"keyword\">try</span>&#123;</span><br><span class=\"line\">            reader = Resources.getResourceAsReader(<span class=\"string\">&quot;mybatis-config.xml&quot;</span>);</span><br><span class=\"line\">            sqlSessionFactory = <span class=\"keyword\">new</span> SqlSessionFactoryBuilder().build(reader);</span><br><span class=\"line\">        &#125;<span class=\"keyword\">catch</span>(IOException e)&#123;</span><br><span class=\"line\">            <span class=\"comment\">//初始化错误时,通过抛出异常ExceptionInInitializerError通知调用者</span></span><br><span class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> ExceptionInInitializerError(e);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 执行SELECT查询SQL</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> func 要执行查询语句的代码块</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> 查询结果</span></span><br><span class=\"line\"><span class=\"comment\">     *具体的查询交给Function实现，在进行查询之前对sqlSession进行了打开和自动关闭</span></span><br><span class=\"line\"><span class=\"comment\">     *Function&lt;T,R&gt;函数式接口，对应一个输入且需要返回数据的功能代码</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> Object <span class=\"title\">executeQuery</span><span class=\"params\">(Function&lt;SqlSession,Object&gt; func)</span></span>&#123;</span><br><span class=\"line\">        SqlSession sqlSession = sqlSessionFactory.openSession();</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            <span class=\"comment\">//apply方法用于返回函数执行的结果</span></span><br><span class=\"line\">            Object obj = func.apply(sqlSession);</span><br><span class=\"line\">            <span class=\"keyword\">return</span> obj;</span><br><span class=\"line\">        &#125;<span class=\"keyword\">finally</span> &#123;</span><br><span class=\"line\">            sqlSession.close();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 执行INSERT/UPDATE/DELETE写操作SQL</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> func 要执行的写操作代码块</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> 写操作后返回的结果</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> Object <span class=\"title\">executeUpdate</span><span class=\"params\">(Function&lt;SqlSession,Object&gt; func)</span></span>&#123;</span><br><span class=\"line\">        SqlSession sqlSession = sqlSessionFactory.openSession(<span class=\"keyword\">false</span>);</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            Object obj = func.apply(sqlSession);</span><br><span class=\"line\">            sqlSession.commit();</span><br><span class=\"line\">            <span class=\"keyword\">return</span> obj;</span><br><span class=\"line\">        &#125;<span class=\"keyword\">catch</span> (RuntimeException e)&#123;</span><br><span class=\"line\">            sqlSession.rollback();</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> e;</span><br><span class=\"line\">        &#125;<span class=\"keyword\">finally</span>&#123;</span><br><span class=\"line\">            sqlSession.close();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>◇解决<img src=\"/p/2f49/1629083017280-f122b9d6-77bf-4a8c-90de-abdfa7304826.png\" class=\"lazyload\" data-srcset=\"/p/2f49/1629083017280-f122b9d6-77bf-4a8c-90de-abdfa7304826.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\">问题；函数式接口需要jdk1.8版本以上，但maven中统一按照1.5版本进行编译，因此需要在pom.xml配置文件中进行相关设置；在build块中，用于描述当前程序构建的各种细节；在build块中对maven的编译插件进行设置</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">build</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">plugins</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\">                <span class=\"comment\">&lt;!--利用Maven编译插件将编译级别提高至1.8,解决lambda表达式错误--&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.apache.maven.plugins<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">                <span class=\"comment\">&lt;!--maven-compiler-plugin是Maven自带的编译插件--&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>maven-compiler-plugin<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>3.3<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">configuration</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"comment\">&lt;!--检查源码采用1.8规则,默认为1.5--&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">source</span>&gt;</span>1.8<span class=\"tag\">&lt;/<span class=\"name\">source</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"comment\">&lt;!--按1.8规则生成字节码--&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">target</span>&gt;</span>1.8<span class=\"tag\">&lt;/<span class=\"name\">target</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;/<span class=\"name\">configuration</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">plugins</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">build</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>◇mybatis执行sql的时候要有对应的mapper.xml文件，并且在核心配置文件(mybatis-config.xml)中进行配置；在resource目录下创建mappers目录用于存放此类文件，在其中创建一个test.xml文件进行测试</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE <span class=\"meta-keyword\">mapper</span> <span class=\"meta-keyword\">PUBLIC</span> <span class=\"meta-string\">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span> </span></span><br><span class=\"line\"><span class=\"meta\"><span class=\"meta-string\">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">mapper</span> <span class=\"attr\">namespace</span>=<span class=\"string\">&quot;test&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">select</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;sample&quot;</span> <span class=\"attr\">resultType</span>=<span class=\"string\">&quot;String&quot;</span>&gt;</span></span><br><span class=\"line\">        select &#x27;success&#x27;  //不从任何表中获取数据，只是返回success字符串</span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">select</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">mapper</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">//核心配置文件配置</span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">mappers</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">mapper</span> <span class=\"attr\">resource</span>=<span class=\"string\">&quot;mappers/test.xml&quot;</span>/&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">mappers</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">//测试类进行测试，引用lambada表达式</span><br><span class=\"line\">public class MybatisUtilsTestor &#123;</span><br><span class=\"line\">    @Test</span><br><span class=\"line\">    public void testcase1()&#123;</span><br><span class=\"line\">        String result = (String)MybatisUtils.executeQuery(sqlSession-&gt;&#123;</span><br><span class=\"line\">            String out = (String)sqlSession.selectOne(&quot;test.sample&quot;);</span><br><span class=\"line\">            return out;</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">        System.out.println(result);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    @Test</span><br><span class=\"line\">    public void testcase2()&#123;</span><br><span class=\"line\">        String result = (String) MybatisUtils.executeQuery(</span><br><span class=\"line\">                sqlSession -&gt; sqlSession.selectOne(&quot;test.sample&quot;));</span><br><span class=\"line\">        System.out.println(result);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"连接池设置\"><a href=\"#连接池设置\" class=\"headerlink\" title=\"连接池设置\"></a>连接池设置</h3><p>◇oa目录下创建子包datasource，在其下创建类DruidDataSourceFactory(数据源工厂类)<br>◇执行顺序：首先通过构造方法创建空的数据源对象，然后调用setProperties方法读取xml文件<br>并对刚才实例化的数据源进行属性设置；如果在获取数据源的时候必须要进行额外操作，则应重写<br>getDataSource方法</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> com.alibaba.druid.pool.DruidDataSource;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.apache.ibatis.datasource.unpooled.UnpooledDataSourceFactory;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> javax.sql.DataSource;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.sql.SQLException;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">DruidDataSourceFactory</span> <span class=\"keyword\">extends</span> <span class=\"title\">UnpooledDataSourceFactory</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">DruidDataSourceFactory</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.dataSource = <span class=\"keyword\">new</span> DruidDataSource();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * DataSource是javax.sql包提供的接口，用来说明所有的数据源都要实现这个接口</span></span><br><span class=\"line\"><span class=\"comment\">     * DruidDataSource当然也实现了这个接口；这样，当需要更换数据库连接池时，只需要</span></span><br><span class=\"line\"><span class=\"comment\">     * 实例化不同的DataSource实现类即可</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@Override</span><span class=\"comment\">//进行重写代码：code-&gt;override 是否进行重写视连接池的类型而定</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> DataSource <span class=\"title\">getDataSource</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            ((DruidDataSource)<span class=\"keyword\">this</span>.dataSource).init();<span class=\"comment\">//初始化Druid数据源</span></span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (SQLException e) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> RuntimeException(e);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.dataSource;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"整合Freemarker\"><a href=\"#整合Freemarker\" class=\"headerlink\" title=\"整合Freemarker\"></a>整合Freemarker</h3><p>◇pom.xml增加依赖</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">&lt;!--Freemarker依赖--&gt;</span><br><span class=\"line\">       &lt;dependency&gt;</span><br><span class=\"line\">           &lt;groupId&gt;org.freemarker&lt;/groupId&gt;</span><br><span class=\"line\">           &lt;artifactId&gt;freemarker&lt;/artifactId&gt;</span><br><span class=\"line\">           &lt;version&gt;<span class=\"number\">2.3</span><span class=\"number\">.29</span>&lt;/version&gt;</span><br><span class=\"line\">       &lt;/dependency&gt;</span><br><span class=\"line\">       &lt;!--servlet-api--&gt;</span><br><span class=\"line\">       &lt;dependency&gt;</span><br><span class=\"line\">           &lt;groupId&gt;javax.servlet&lt;/groupId&gt;</span><br><span class=\"line\">           &lt;artifactId&gt;javax.servlet-api&lt;/artifactId&gt;</span><br><span class=\"line\">           &lt;version&gt;<span class=\"number\">3.1</span><span class=\"number\">.0</span>&lt;/version&gt;</span><br><span class=\"line\">           &lt;!--依赖只参与编译测试,不进行发布--&gt;</span><br><span class=\"line\">           &lt;scope&gt;provided&lt;/scope&gt;</span><br><span class=\"line\">       &lt;/dependency&gt;</span><br></pre></td></tr></table></figure>\n<p>◇web.xml进行配置servlet</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">&lt;servlet&gt;</span><br><span class=\"line\">       &lt;!--FreemakrerServlet用于读取解析ftl文件--&gt;</span><br><span class=\"line\">       &lt;servlet-name&gt;freemakrer&lt;/servlet-name&gt;</span><br><span class=\"line\">       &lt;servlet-<span class=\"class\"><span class=\"keyword\">class</span>&gt;<span class=\"title\">freemarker</span>.<span class=\"title\">ext</span>.<span class=\"title\">servlet</span>.<span class=\"title\">FreemarkerServlet</span>&lt;/<span class=\"title\">servlet</span>-<span class=\"title\">class</span>&gt;</span></span><br><span class=\"line\"><span class=\"class\">       &lt;!-- 定义模板的存储路径 --&gt;</span></span><br><span class=\"line\"><span class=\"class\">       &lt;<span class=\"title\">init</span>-<span class=\"title\">param</span>&gt;</span></span><br><span class=\"line\"><span class=\"class\">           &lt;<span class=\"title\">param</span>-<span class=\"title\">name</span>&gt;<span class=\"title\">TemplatePath</span>&lt;/<span class=\"title\">param</span>-<span class=\"title\">name</span>&gt;</span></span><br><span class=\"line\"><span class=\"class\">           &lt;<span class=\"title\">param</span>-<span class=\"title\">value</span>&gt;/<span class=\"title\">WEB</span>-<span class=\"title\">INF</span>/<span class=\"title\">ftl</span>&lt;/<span class=\"title\">param</span>-<span class=\"title\">value</span>&gt;</span></span><br><span class=\"line\"><span class=\"class\">       &lt;/<span class=\"title\">init</span>-<span class=\"title\">param</span>&gt;</span></span><br><span class=\"line\"><span class=\"class\">       &lt;<span class=\"title\">init</span>-<span class=\"title\">param</span>&gt;</span></span><br><span class=\"line\"><span class=\"class\">           &lt;!--<span class=\"title\">default_encoding</span>用于设置读取<span class=\"title\">ftl</span>文件时采用的字符集,进而避免中文乱码的产生--&gt;</span></span><br><span class=\"line\"><span class=\"class\">           &lt;<span class=\"title\">param</span>-<span class=\"title\">name</span>&gt;<span class=\"title\">default_encoding</span>&lt;/<span class=\"title\">param</span>-<span class=\"title\">name</span>&gt;</span></span><br><span class=\"line\"><span class=\"class\">           &lt;<span class=\"title\">param</span>-<span class=\"title\">value</span>&gt;<span class=\"title\">UTF</span>-8&lt;/<span class=\"title\">param</span>-<span class=\"title\">value</span>&gt;</span></span><br><span class=\"line\"><span class=\"class\">       &lt;/<span class=\"title\">init</span>-<span class=\"title\">param</span>&gt;</span></span><br><span class=\"line\"><span class=\"class\">   &lt;/<span class=\"title\">servlet</span>&gt;</span></span><br><span class=\"line\"><span class=\"class\">   &lt;<span class=\"title\">servlet</span>-<span class=\"title\">mapping</span>&gt;</span></span><br><span class=\"line\"><span class=\"class\">       &lt;<span class=\"title\">servlet</span>-<span class=\"title\">name</span>&gt;<span class=\"title\">freemakrer</span>&lt;/<span class=\"title\">servlet</span>-<span class=\"title\">name</span>&gt;</span></span><br><span class=\"line\"><span class=\"class\">       &lt;<span class=\"title\">url</span>-<span class=\"title\">pattern</span>&gt;*.<span class=\"title\">ftl</span>&lt;/<span class=\"title\">url</span>-<span class=\"title\">pattern</span>&gt;</span></span><br><span class=\"line\"><span class=\"class\">   &lt;/<span class=\"title\">servlet</span>-<span class=\"title\">mapping</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>◇在WEB-INF目录下创建ftl目录，然后将test.html移入并改为test.ftl (freemarker脚本)</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">&lt;!DOCTYPE html&gt;</span><br><span class=\"line\">&lt;html lang=<span class=\"string\">&quot;en&quot;</span>&gt;</span><br><span class=\"line\">&lt;head&gt;</span><br><span class=\"line\">    &lt;meta charset=<span class=\"string\">&quot;UTF-8&quot;</span>&gt;</span><br><span class=\"line\">    &lt;title&gt;LCG&lt;/title&gt;</span><br><span class=\"line\">&lt;/head&gt;</span><br><span class=\"line\">&lt;body&gt;</span><br><span class=\"line\"> &lt;h1&gt;$&#123;result&#125;&lt;/h1&gt;<span class=\"comment\">//数据库查询结果</span></span><br><span class=\"line\">&lt;/body&gt;</span><br><span class=\"line\">&lt;/html&gt;</span><br></pre></td></tr></table></figure>\n<p>◇在com.lcg.oa.test下创建一个TestServlet</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@WebServlet(name = &quot;TestServlet&quot;,urlPatterns = &quot;/test&quot;)</span><span class=\"comment\">//映射地址</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">TestServlet</span> <span class=\"keyword\">extends</span> <span class=\"title\">HttpServlet</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title\">doPost</span><span class=\"params\">(HttpServletRequest request, HttpServletResponse response)</span> <span class=\"keyword\">throws</span> ServletException, IOException </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title\">doGet</span><span class=\"params\">(HttpServletRequest request, HttpServletResponse response)</span> <span class=\"keyword\">throws</span> ServletException, IOException </span>&#123;</span><br><span class=\"line\">        String result = (String)MybatisUtils.executeQuery(sqlSession-&gt;sqlSession.selectOne(<span class=\"string\">&quot;test.sample&quot;</span>));</span><br><span class=\"line\">        request.setAttribute(<span class=\"string\">&quot;result&quot;</span>,request);</span><br><span class=\"line\">        <span class=\"comment\">//请求转发</span></span><br><span class=\"line\">        request.getRequestDispatcher(<span class=\"string\">&quot;test.ftl&quot;</span>).forward(request,response);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>◇在运行测试前还需进行相关设置：File-&gt;Project Structure-&gt;Artifacts-&gt;将右侧Maven资源全选右键-&gt;Put into-&gt;OK<br>◇配置日志文件logback.xml</p>\n<h2 id=\"开发基于RBAC的权限控制模块\"><a href=\"#开发基于RBAC的权限控制模块\" class=\"headerlink\" title=\"开发基于RBAC的权限控制模块\"></a>开发基于RBAC的权限控制模块</h2><h3 id=\"RBAC-基于角色的访问控制\"><a href=\"#RBAC-基于角色的访问控制\" class=\"headerlink\" title=\"RBAC-基于角色的访问控制\"></a>RBAC-基于角色的访问控制</h3><p>◇Role-Based Access Control<br>◇基于角色权限控制(RBAC)是面向企业安全策略的访问控制方式<br>◇RBAC核心思想是将控制访问的资源(功能或者特定资料等)与角色(Role)进行绑定<br>◇系统的用户(User)与角色(Role)再进行绑定,用户便拥有对应权限  </p>\n<h3 id=\"RBAC底层设计\"><a href=\"#RBAC底层设计\" class=\"headerlink\" title=\"RBAC底层设计\"></a>RBAC底层设计</h3><p><img src=\"/p/2f49/1629192797971-cd125468-ee9d-4f8a-a083-a800853972cb.png\" class=\"lazyload\" data-srcset=\"/p/2f49/1629192797971-cd125468-ee9d-4f8a-a083-a800853972cb.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"></p>\n<h3 id=\"创建数据库表\"><a href=\"#创建数据库表\" class=\"headerlink\" title=\"创建数据库表\"></a>创建数据库表</h3><p>◇角色表，表名：模块名_具体表名 sys_role<br><img src=\"/p/2f49/1629203711258-089bc764-c434-4933-acbe-d85d034be818.png\" class=\"lazyload\" data-srcset=\"/p/2f49/1629203711258-089bc764-c434-4933-acbe-d85d034be818.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"><img src=\"/p/2f49/1629204606757-07b14e75-04d6-47ef-8ea2-a966cdc645cc.png\" class=\"lazyload\" data-srcset=\"/p/2f49/1629204606757-07b14e75-04d6-47ef-8ea2-a966cdc645cc.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"><br>◇资源表sys_node<br><img src=\"/p/2f49/1629204453547-3d5d55a3-5ac9-4bfa-a015-119d1bf80b41.png\" class=\"lazyload\" data-srcset=\"/p/2f49/1629204453547-3d5d55a3-5ac9-4bfa-a015-119d1bf80b41.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"><img src=\"/p/2f49/1629205041804-b52055e5-70f2-462f-8286-9e16273e3edc.png\" class=\"lazyload\" data-srcset=\"/p/2f49/1629205041804-b52055e5-70f2-462f-8286-9e16273e3edc.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"><br>◇关联表sys_role_node<br><img src=\"/p/2f49/1629205018455-8a722cb7-2f30-42a2-bc24-6e48d8ef7913.png\" class=\"lazyload\" data-srcset=\"/p/2f49/1629205018455-8a722cb7-2f30-42a2-bc24-6e48d8ef7913.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"><img src=\"/p/2f49/1629205194942-4ead9aee-f85c-4198-a365-48da65f5757c.png\" class=\"lazyload\" data-srcset=\"/p/2f49/1629205194942-4ead9aee-f85c-4198-a365-48da65f5757c.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"></p>\n<p>◇其他表的创建(此处省略)</p>\n<h2 id=\"基于LayUI开发登录页\"><a href=\"#基于LayUI开发登录页\" class=\"headerlink\" title=\"基于LayUI开发登录页\"></a>基于LayUI开发登录页</h2><h3 id=\"LayUI前端框架\"><a href=\"#LayUI前端框架\" class=\"headerlink\" title=\"LayUI前端框架\"></a>LayUI前端框架</h3><p>◇<a href=\"https://www.layui.com/\">官方网站</a><br>◇在webapp目录下创建resources文件夹(用来存放web应用所有相关的引用资源) 将layui文件夹粘贴到其下</p>\n<h3 id=\"开发登录页面\"><a href=\"#开发登录页面\" class=\"headerlink\" title=\"开发登录页面\"></a>开发登录页面</h3><p>◇在webapp目录下新建login.html<br>◇进行项目热部署：Tomcat-&gt;Edit Configurations-&gt;On ‘Update’ action:改为Update classes and resources-&gt;ok<br>然后按shift+F9就能进行热部署了</p>\n<h3 id=\"开发后台与数据库交互\"><a href=\"#开发后台与数据库交互\" class=\"headerlink\" title=\"开发后台与数据库交互\"></a>开发后台与数据库交互</h3><p>◇创建实体类User<br>◇创建sql语句的xml文件user.xml</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE <span class=\"meta-keyword\">mapper</span> <span class=\"meta-keyword\">PUBLIC</span> <span class=\"meta-string\">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span> <span class=\"meta-string\">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">mapper</span> <span class=\"attr\">namespace</span>=<span class=\"string\">&quot;usermapper&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">select</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;selectByUsername&quot;</span> <span class=\"attr\">parameterType</span>=<span class=\"string\">&quot;String&quot;</span> <span class=\"attr\">resultType</span>=<span class=\"string\">&quot;com.lcg.oa.entity.User&quot;</span>&gt;</span></span><br><span class=\"line\">        select * from sys_user where username = #&#123;value&#125;</span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">select</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>◇每次增加mapper后必须到mybatis-config中进行配置</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">mapper</span> <span class=\"attr\">resource</span>=<span class=\"string\">&quot;mappers/user.xml&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>\n<p>◇创建dao完成与user表的交互</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">UserDao</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 按用户名查询用户表</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> username 用户名</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> User对象包含对应的用户信息,null则代表对象不存在</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> User <span class=\"title\">selectByUsername</span><span class=\"params\">(String username)</span></span>&#123;</span><br><span class=\"line\">        User user = (User)MybatisUtils.executeQuery(sqlSession -&gt; sqlSession.selectOne(<span class=\"string\">&quot;usermapper.selectByUsername&quot;</span> , username));</span><br><span class=\"line\">        <span class=\"keyword\">return</span> user;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>◇创建Service</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">UserService</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> UserDao userDao =<span class=\"keyword\">new</span> UserDao();<span class=\"comment\">//记得实例化，否则出现空指针异常</span></span><br><span class=\"line\">        <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 根据前台输入进行登录校验</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> username 前台输入的用户名</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> password 前台输入的密码</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> 校验通过后,包含对应用户数据的User实体类</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@throws</span> BussinessException L001-用户名不存在,L002-密码错误</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> User <span class=\"title\">checkLogin</span><span class=\"params\">(String username,String password)</span></span>&#123;</span><br><span class=\"line\">        User user = userDao.selectByUsername(username);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (user == <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">            <span class=\"comment\">//抛出用户不存在异常</span></span><br><span class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> BussinessException(<span class=\"string\">&quot;L001&quot;</span>, <span class=\"string\">&quot;用户名不存在&quot;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!password.equals(user.getPassword())) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> BussinessException(<span class=\"string\">&quot;L002&quot;</span>, <span class=\"string\">&quot;密码错误&quot;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> user;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>◇自定义异常</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 业务逻辑异常，继承自运行时异常</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">BussinessException</span> <span class=\"keyword\">extends</span> <span class=\"title\">RuntimeException</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> String code;<span class=\"comment\">//异常编码，异常的以为标识</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> String message;<span class=\"comment\">//异常的具体文本消息</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">BussinessException</span><span class=\"params\">(String code, String msg)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">super</span>(code + <span class=\"string\">&quot;:&quot;</span> + msg);</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.code=code;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.message=msg;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">getCode</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> code;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">setCode</span><span class=\"params\">(String code)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.code = code;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">getMessage</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> message;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">setMessage</span><span class=\"params\">(String message)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.message = message;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>◇箭头指向需要测试的类名，Ctrl+Shift+T 生成测试用例类，将需要测试的方法进行勾选<br>◇空指针异常：在出错代码处做一个断点，可以找出具体哪个对象为空，有时候出现空指针可能是对象没有实例化，在创建时new 类名()即可;</p>\n<h3 id=\"与前台联通\"><a href=\"#与前台联通\" class=\"headerlink\" title=\"与前台联通\"></a>与前台联通</h3><p>◇创建控制器controller</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@WebServlet(name = &quot;LoginServlet&quot;, urlPatterns = &quot;/check_login&quot;)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">LoginServlet</span> <span class=\"keyword\">extends</span> <span class=\"title\">HttpServlet</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">//日志文件 LoginServlet.class即LoginServlet类的类对象;(对象有实例对象和类对象两种)</span></span><br><span class=\"line\">    Logger logger = LoggerFactory.getLogger(LoginServlet.class);</span><br><span class=\"line\">    <span class=\"keyword\">private</span> UserService userService = <span class=\"keyword\">new</span> UserService();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title\">doPost</span><span class=\"params\">(HttpServletRequest request, HttpServletResponse response)</span> </span></span><br><span class=\"line\"><span class=\"function\">        <span class=\"keyword\">throws</span> ServletException, IOException </span>&#123;</span><br><span class=\"line\">        request.setCharacterEncoding(<span class=\"string\">&quot;utf-8&quot;</span>);</span><br><span class=\"line\">        response.setContentType(<span class=\"string\">&quot;text/html;charset=utf-8&quot;</span>);</span><br><span class=\"line\">        <span class=\"comment\">//接收用户输入</span></span><br><span class=\"line\">        String username = request.getParameter(<span class=\"string\">&quot;username&quot;</span>);</span><br><span class=\"line\">        String password = request.getParameter(<span class=\"string\">&quot;password&quot;</span>);</span><br><span class=\"line\">        <span class=\"comment\">//保存输出的内容</span></span><br><span class=\"line\">        Map&lt;String, Object&gt; result = <span class=\"keyword\">new</span> HashMap&lt;&gt;();</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            <span class=\"comment\">//调用业务逻辑</span></span><br><span class=\"line\">            User user = userService.checkLogin(username, password);</span><br><span class=\"line\">            <span class=\"comment\">//返回项</span></span><br><span class=\"line\">            result.put(<span class=\"string\">&quot;code&quot;</span>, <span class=\"string\">&quot;0&quot;</span>);</span><br><span class=\"line\">            result.put(<span class=\"string\">&quot;message&quot;</span>, <span class=\"string\">&quot;success&quot;</span>);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (BussinessException e) &#123;</span><br><span class=\"line\">            logger.error(e.getMessage(), e);</span><br><span class=\"line\">            result.put(<span class=\"string\">&quot;code&quot;</span>, e.getCode());</span><br><span class=\"line\">            result.put(<span class=\"string\">&quot;message&quot;</span>, e.getMessage());</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</span><br><span class=\"line\">            logger.error(e.getMessage(), e);</span><br><span class=\"line\">            <span class=\"comment\">//由于系统自带异常没有code，用e.getClass().getSimpleName()得到的类名来充当</span></span><br><span class=\"line\">            result.put(<span class=\"string\">&quot;code&quot;</span>, e.getClass().getSimpleName());</span><br><span class=\"line\">            result.put(<span class=\"string\">&quot;message&quot;</span>, e.getMessage());</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">//返回对应结果</span></span><br><span class=\"line\">        String json = JSON.toJSONString(result);</span><br><span class=\"line\">        response.getWriter().println(json);<span class=\"comment\">//向客户端返回</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title\">doGet</span><span class=\"params\">(HttpServletRequest request, HttpServletResponse response)</span> </span></span><br><span class=\"line\"><span class=\"function\">        <span class=\"keyword\">throws</span> ServletException, IOException </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>◇pom.xml加载fastjson依赖，并加入发布的项目中</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">&lt;dependency&gt;</span><br><span class=\"line\">    &lt;groupId&gt;com.alibaba&lt;/groupId&gt;</span><br><span class=\"line\">    &lt;artifactId&gt;fastjson&lt;/artifactId&gt;</span><br><span class=\"line\">    &lt;version&gt;<span class=\"number\">1.2</span><span class=\"number\">.62</span>&lt;/version&gt;</span><br><span class=\"line\">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>\n<p>◇修改login.html文件增加提交数据功能<br><img src=\"/p/2f49/1629385897890-60923e74-375b-4921-b681-576d7d53d36c.png\" class=\"lazyload\" data-srcset=\"/p/2f49/1629385897890-60923e74-375b-4921-b681-576d7d53d36c.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"></p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">&lt;div <span class=\"class\"><span class=\"keyword\">class</span></span>=<span class=\"string\">&quot;oa-container&quot;</span>&gt;</span><br><span class=\"line\">    &lt;h1 style=<span class=\"string\">&quot;text-align: center;margin-bottom: 20px&quot;</span>&gt;交通控股办公OA系统&lt;/h1&gt;</span><br><span class=\"line\">    &lt;form <span class=\"class\"><span class=\"keyword\">class</span></span>=<span class=\"string\">&quot;layui-form&quot;</span>&gt;</span><br><span class=\"line\">        &lt;div <span class=\"class\"><span class=\"keyword\">class</span></span>=<span class=\"string\">&quot;layui-form-item&quot;</span>&gt;</span><br><span class=\"line\">            &lt;input type=<span class=\"string\">&quot;text&quot;</span> id=<span class=\"string\">&quot;username&quot;</span> lay-verify=<span class=\"string\">&quot;required&quot;</span> name=<span class=\"string\">&quot;username&quot;</span> placeholder=<span class=\"string\">&quot;请输入用户名&quot;</span> autocomplete=<span class=\"string\">&quot;off&quot;</span> <span class=\"class\"><span class=\"keyword\">class</span></span>=<span class=\"string\">&quot;layui-input&quot;</span> &gt;</span><br><span class=\"line\">        &lt;/div&gt;</span><br><span class=\"line\">        &lt;div <span class=\"class\"><span class=\"keyword\">class</span></span>=<span class=\"string\">&quot;layui-form-item&quot;</span>&gt;</span><br><span class=\"line\">            &lt;input type=<span class=\"string\">&quot;password&quot;</span> id=<span class=\"string\">&quot;password&quot;</span> lay-verify=<span class=\"string\">&quot;required&quot;</span> name=<span class=\"string\">&quot;password&quot;</span> placeholder=<span class=\"string\">&quot;请输入密码&quot;</span> autocomplete=<span class=\"string\">&quot;off&quot;</span> <span class=\"class\"><span class=\"keyword\">class</span></span>=<span class=\"string\">&quot;layui-input&quot;</span> &gt;</span><br><span class=\"line\">        &lt;/div&gt;</span><br><span class=\"line\">        &lt;div <span class=\"class\"><span class=\"keyword\">class</span></span>=<span class=\"string\">&quot;layui-form-item&quot;</span>&gt;</span><br><span class=\"line\">            &lt;!--lay-filter即layui专属的id，autocomple表示是否显示历史输入--&gt;</span><br><span class=\"line\">            &lt;button <span class=\"class\"><span class=\"keyword\">class</span></span>=<span class=\"string\">&quot;layui-btn layui-btn-fluid&quot;</span> lay-submit lay-filter=<span class=\"string\">&quot;login&quot;</span>&gt;登录&lt;/button&gt;</span><br><span class=\"line\">        &lt;/div&gt;</span><br><span class=\"line\">    &lt;/form&gt;</span><br><span class=\"line\">&lt;/div&gt;</span><br><span class=\"line\">&lt;script src=<span class=\"string\">&quot;/resources/layui/layui.all.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class=\"line\">&lt;script&gt;</span><br><span class=\"line\">    <span class=\"comment\">// 表单提交事件</span></span><br><span class=\"line\">    <span class=\"comment\">/*on代表捕捉事件，里面参数为submit即提交事件，login表示绑定哪个提交按钮才会触发这段代码*/</span></span><br><span class=\"line\">    layui.form.on(<span class=\"string\">&quot;submit(login)&quot;</span> , function(formdata)&#123;<span class=\"comment\">//data参数包含了当前表单的数据</span></span><br><span class=\"line\">        console.log(formdata);</span><br><span class=\"line\">        <span class=\"comment\">//发送ajax请求进行登录校验</span></span><br><span class=\"line\">        layui.$.ajax(&#123;</span><br><span class=\"line\">            url : <span class=\"string\">&quot;/check_login&quot;</span>,</span><br><span class=\"line\">            data : formdata.field, <span class=\"comment\">//提交表单数据</span></span><br><span class=\"line\">            type : <span class=\"string\">&quot;post&quot;</span>,</span><br><span class=\"line\">            dataType : <span class=\"string\">&quot;json&quot;</span> ,</span><br><span class=\"line\">            success : function(json)&#123;</span><br><span class=\"line\">                console.log(json);</span><br><span class=\"line\">                <span class=\"keyword\">if</span>(json.code == <span class=\"string\">&quot;0&quot;</span>)&#123; <span class=\"comment\">//登录校验成功</span></span><br><span class=\"line\">                    layui.layer.msg(<span class=\"string\">&quot;登录成功&quot;</span>);</span><br><span class=\"line\">                &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">                    layui.layer.msg(json.message);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;)</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;<span class=\"comment\">//submit提交事件返回true则表单提交,false则阻止表单提交</span></span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">&lt;/script&gt;</span><br><span class=\"line\">    </span><br></pre></td></tr></table></figure>\n<h3 id=\"开发功能首页\"><a href=\"#开发功能首页\" class=\"headerlink\" title=\"开发功能首页\"></a>开发功能首页</h3><figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">&lt;!DOCTYPE html&gt;</span><br><span class=\"line\">&lt;html lang=<span class=\"string\">&quot;en&quot;</span>&gt;</span><br><span class=\"line\">&lt;head&gt;</span><br><span class=\"line\">    &lt;meta charset=<span class=\"string\">&quot;UTF-8&quot;</span>&gt;</span><br><span class=\"line\">    &lt;title&gt;交通控股OA系统&lt;/title&gt;</span><br><span class=\"line\">    &lt;meta name=<span class=\"string\">&quot;viewport&quot;</span> content=<span class=\"string\">&quot;width=device-width, initial-scale=1, maximum-scale=1&quot;</span>&gt;</span><br><span class=\"line\">    &lt;link rel=<span class=\"string\">&quot;stylesheet&quot;</span> href=<span class=\"string\">&quot;/resources/layui/css/layui.css&quot;</span>&gt;</span><br><span class=\"line\">&lt;/head&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;body <span class=\"class\"><span class=\"keyword\">class</span></span>=<span class=\"string\">&quot;layui-layout-body&quot;</span>&gt;</span><br><span class=\"line\">&lt;!-- Layui后台布局CSS --&gt;</span><br><span class=\"line\">&lt;div <span class=\"class\"><span class=\"keyword\">class</span></span>=<span class=\"string\">&quot;layui-layout layui-layout-admin&quot;</span>&gt;</span><br><span class=\"line\">    &lt;!--头部导航栏--&gt;</span><br><span class=\"line\">    &lt;div <span class=\"class\"><span class=\"keyword\">class</span></span>=<span class=\"string\">&quot;layui-header&quot;</span>&gt;</span><br><span class=\"line\">        &lt;!--系统标题--&gt;</span><br><span class=\"line\">        &lt;div <span class=\"class\"><span class=\"keyword\">class</span></span>=<span class=\"string\">&quot;layui-logo&quot;</span> style=<span class=\"string\">&quot;font-size:18px&quot;</span>&gt;交通控股OA系统&lt;/div&gt;</span><br><span class=\"line\">        &lt;!--右侧当前用户信息--&gt;</span><br><span class=\"line\">        &lt;ul <span class=\"class\"><span class=\"keyword\">class</span></span>=<span class=\"string\">&quot;layui-nav layui-layout-right&quot;</span>&gt;</span><br><span class=\"line\">            &lt;li <span class=\"class\"><span class=\"keyword\">class</span></span>=<span class=\"string\">&quot;layui-nav-item&quot;</span>&gt;</span><br><span class=\"line\">                &lt;a href=<span class=\"string\">&quot;javascript:void(0)&quot;</span>&gt;</span><br><span class=\"line\">                    &lt;!--图标--&gt;</span><br><span class=\"line\">                    &lt;span <span class=\"class\"><span class=\"keyword\">class</span></span>=<span class=\"string\">&quot;layui-icon layui-icon-user&quot;</span> style=<span class=\"string\">&quot;font-size: 20px&quot;</span>&gt;</span><br><span class=\"line\">                    &lt;/span&gt;</span><br><span class=\"line\">                    &lt;!--用户信息--&gt;</span><br><span class=\"line\">                    姓名[部门-职务]</span><br><span class=\"line\">                &lt;/a&gt;</span><br><span class=\"line\">            &lt;/li&gt;</span><br><span class=\"line\">            &lt;!--注销按钮--&gt;</span><br><span class=\"line\">            &lt;li <span class=\"class\"><span class=\"keyword\">class</span></span>=<span class=\"string\">&quot;layui-nav-item&quot;</span>&gt;&lt;a href=<span class=\"string\">&quot;#&quot;</span>&gt;注销&lt;/a&gt;&lt;/li&gt;</span><br><span class=\"line\">        &lt;/ul&gt;</span><br><span class=\"line\">    &lt;/div&gt;</span><br><span class=\"line\">    &lt;!--左侧菜单栏--&gt;</span><br><span class=\"line\">    &lt;div <span class=\"class\"><span class=\"keyword\">class</span></span>=<span class=\"string\">&quot;layui-side layui-bg-black&quot;</span>&gt;</span><br><span class=\"line\">        &lt;!--可滚动菜单--&gt;</span><br><span class=\"line\">        &lt;div <span class=\"class\"><span class=\"keyword\">class</span></span>=<span class=\"string\">&quot;layui-side-scroll&quot;</span>&gt;</span><br><span class=\"line\">            &lt;!--可折叠导航栏--&gt;</span><br><span class=\"line\">            &lt;ul <span class=\"class\"><span class=\"keyword\">class</span></span>=<span class=\"string\">&quot;layui-nav layui-nav-tree&quot;</span>&gt;</span><br><span class=\"line\">                &lt;!--父节点--&gt;</span><br><span class=\"line\">                &lt;li <span class=\"class\"><span class=\"keyword\">class</span></span>=<span class=\"string\">&quot;layui-nav-item layui-nav-itemed&quot;</span>&gt;</span><br><span class=\"line\">                    &lt;a href=<span class=\"string\">&quot;javascript:void(0)&quot;</span>&gt;模块<span class=\"number\">1</span>&lt;/a&gt;</span><br><span class=\"line\">                    &lt;dl <span class=\"class\"><span class=\"keyword\">class</span></span>=<span class=\"string\">&quot;layui-nav-child module&quot;</span> data-node-id=<span class=\"string\">&quot;1&quot;</span>&gt;&lt;/dl&gt;</span><br><span class=\"line\">                &lt;/li&gt;</span><br><span class=\"line\">                &lt;!--子节点--&gt;</span><br><span class=\"line\">                &lt;dd <span class=\"class\"><span class=\"keyword\">class</span></span>=<span class=\"string\">&quot;function&quot;</span> data-parent-id=<span class=\"string\">&quot;1&quot;</span>&gt;</span><br><span class=\"line\">                    &lt;a href=<span class=\"string\">&quot;javascript:void(0)&quot;</span> target=<span class=\"string\">&quot;ifmMain&quot;</span>&gt;功能<span class=\"number\">1</span>&lt;/a&gt;</span><br><span class=\"line\">                &lt;/dd&gt;</span><br><span class=\"line\">                &lt;dd <span class=\"class\"><span class=\"keyword\">class</span></span>=<span class=\"string\">&quot;function&quot;</span> data-parent-id=<span class=\"string\">&quot;1&quot;</span>&gt;</span><br><span class=\"line\">                    &lt;a href=<span class=\"string\">&quot;javascript:void(0)&quot;</span> target=<span class=\"string\">&quot;ifmMain&quot;</span>&gt;功能<span class=\"number\">2</span>&lt;/a&gt;</span><br><span class=\"line\">                &lt;/dd&gt;</span><br><span class=\"line\">                &lt;dd <span class=\"class\"><span class=\"keyword\">class</span></span>=<span class=\"string\">&quot;function&quot;</span> data-parent-id=<span class=\"string\">&quot;1&quot;</span>&gt;</span><br><span class=\"line\">                    &lt;a href=<span class=\"string\">&quot;javascript:void(0)&quot;</span> target=<span class=\"string\">&quot;ifmMain&quot;</span>&gt;功能<span class=\"number\">3</span>&lt;/a&gt;</span><br><span class=\"line\">                &lt;/dd&gt;</span><br><span class=\"line\">                &lt;li <span class=\"class\"><span class=\"keyword\">class</span></span>=<span class=\"string\">&quot;layui-nav-item layui-nav-itemed&quot;</span>&gt;</span><br><span class=\"line\">                    &lt;a href=<span class=\"string\">&quot;javascript:void(0)&quot;</span>&gt;模块<span class=\"number\">2</span>&lt;/a&gt;</span><br><span class=\"line\">                    &lt;dl <span class=\"class\"><span class=\"keyword\">class</span></span>=<span class=\"string\">&quot;layui-nav-child module&quot;</span> data-node-id=<span class=\"string\">&quot;2&quot;</span>&gt;&lt;/dl&gt;</span><br><span class=\"line\">                &lt;/li&gt;</span><br><span class=\"line\">                &lt;dd <span class=\"class\"><span class=\"keyword\">class</span></span>=<span class=\"string\">&quot;function&quot;</span> data-parent-id=<span class=\"string\">&quot;2&quot;</span>&gt;</span><br><span class=\"line\">                    &lt;a href=<span class=\"string\">&quot;javascript:void(0)&quot;</span> target=<span class=\"string\">&quot;ifmMain&quot;</span>&gt;功能<span class=\"number\">3</span>&lt;/a&gt;</span><br><span class=\"line\">                &lt;/dd&gt;</span><br><span class=\"line\">                &lt;dd <span class=\"class\"><span class=\"keyword\">class</span></span>=<span class=\"string\">&quot;function&quot;</span> data-parent-id=<span class=\"string\">&quot;2&quot;</span>&gt;</span><br><span class=\"line\">                    &lt;a href=<span class=\"string\">&quot;javascript:void(0)&quot;</span> target=<span class=\"string\">&quot;ifmMain&quot;</span>&gt;功能<span class=\"number\">4</span>&lt;/a&gt;</span><br><span class=\"line\">                &lt;/dd&gt;</span><br><span class=\"line\">                &lt;dd <span class=\"class\"><span class=\"keyword\">class</span></span>=<span class=\"string\">&quot;function&quot;</span> data-parent-id=<span class=\"string\">&quot;2&quot;</span>&gt;</span><br><span class=\"line\">                    &lt;a href=<span class=\"string\">&quot;javascript:void(0)&quot;</span> target=<span class=\"string\">&quot;ifmMain&quot;</span>&gt;功能<span class=\"number\">5</span>&lt;/a&gt;</span><br><span class=\"line\">                &lt;/dd&gt;</span><br><span class=\"line\">            &lt;/ul&gt;</span><br><span class=\"line\">        &lt;/div&gt;</span><br><span class=\"line\">    &lt;/div&gt;</span><br><span class=\"line\">    &lt;!--主体部分采用iframe嵌入其他页面--&gt;</span><br><span class=\"line\">    &lt;div <span class=\"class\"><span class=\"keyword\">class</span></span>=<span class=\"string\">&quot;layui-body&quot;</span> style=<span class=\"string\">&quot;overflow-y: hidden&quot;</span>&gt;</span><br><span class=\"line\">        &lt;iframe name=<span class=\"string\">&quot;ifmMain&quot;</span> style=<span class=\"string\">&quot;border: 0px;width: 100%;height: 100%&quot;</span>&gt;&lt;/iframe&gt;</span><br><span class=\"line\">    &lt;/div&gt;</span><br><span class=\"line\">    &lt;!--版权信息--&gt;</span><br><span class=\"line\">    &lt;div <span class=\"class\"><span class=\"keyword\">class</span></span>=<span class=\"string\">&quot;layui-footer&quot;</span>&gt;</span><br><span class=\"line\">        Copyright © gamest. All Rights Reserved.</span><br><span class=\"line\">    &lt;/div&gt;</span><br><span class=\"line\">&lt;/div&gt;</span><br><span class=\"line\">&lt;!--LayUI JS文件--&gt;</span><br><span class=\"line\">&lt;script src=<span class=\"string\">&quot;/resources/layui/layui.all.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class=\"line\">&lt;script&gt;</span><br><span class=\"line\">    <span class=\"comment\">//将所有功能根据parent_id移动到指定模块下</span></span><br><span class=\"line\">    layui.$(<span class=\"string\">&quot;.function&quot;</span>).each(function () &#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> func = layui.$(<span class=\"keyword\">this</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> parentId = func.data(<span class=\"string\">&quot;parent-id&quot;</span>);</span><br><span class=\"line\">        layui.$(<span class=\"string\">&quot;dl[data-node-id=&quot;</span> + parentId + <span class=\"string\">&quot;]&quot;</span>).append(func);</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">    <span class=\"comment\">//刷新折叠菜单</span></span><br><span class=\"line\">    layui.element.render(<span class=\"string\">&#x27;nav&#x27;</span>);</span><br><span class=\"line\">&lt;/script&gt;</span><br><span class=\"line\">&lt;/body&gt;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n","categories":["Java数据库","OA系统项目"],"tags":["MyBaits"]},{"title":"项目完整实现","url":"/p/d371.html","content":"<h2 id=\"动态显示功能菜单\"><a href=\"#动态显示功能菜单\" class=\"headerlink\" title=\"动态显示功能菜单\"></a>动态显示功能菜单</h2><h3 id=\"第一部分：实现底层\"><a href=\"#第一部分：实现底层\" class=\"headerlink\" title=\"第一部分：实现底层\"></a>第一部分：实现底层</h3><p>◇sql语句</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">-- 如何获取编号为 1的用户拥有哪些功能？</span></span><br><span class=\"line\"><span class=\"keyword\">SELECT</span> <span class=\"keyword\">DISTINCT</span> n.<span class=\"operator\">*</span> </span><br><span class=\"line\"><span class=\"keyword\">FROM</span></span><br><span class=\"line\">\tsys_role_user ru,</span><br><span class=\"line\">\tsys_role_node rn,</span><br><span class=\"line\">\tsys_node n </span><br><span class=\"line\"><span class=\"keyword\">WHERE</span></span><br><span class=\"line\">\tru.role_id <span class=\"operator\">=</span> rn.role_id </span><br><span class=\"line\">\t<span class=\"keyword\">AND</span> rn.node_id <span class=\"operator\">=</span> n.node_id </span><br><span class=\"line\">\t<span class=\"keyword\">AND</span> user_id <span class=\"operator\">=</span> <span class=\"number\">1</span> </span><br><span class=\"line\"><span class=\"keyword\">ORDER</span> <span class=\"keyword\">BY</span></span><br><span class=\"line\">\tn.node_code</span><br></pre></td></tr></table></figure>\n<p>◇创建与数据库对应的Node节点类</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\">public class Node &#123;</span><br><span class=\"line\">    private Long nodeId;</span><br><span class=\"line\">    private <span class=\"type\">Integer</span> nodeType;</span><br><span class=\"line\">    private String nodeName;</span><br><span class=\"line\">    private String url;</span><br><span class=\"line\">    private <span class=\"type\">Integer</span> nodeCode;</span><br><span class=\"line\">    private Long parentId;</span><br><span class=\"line\">    ...</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n<p>◇创建rbac.xml</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"operator\">&lt;</span>mapper namespace<span class=\"operator\">=</span>&quot;rbacmapper&quot;<span class=\"operator\">&gt;</span></span><br><span class=\"line\">    <span class=\"operator\">&lt;</span><span class=\"operator\">!</span><span class=\"comment\">--获取用户编号对应的功能列表--&gt;</span></span><br><span class=\"line\">    <span class=\"operator\">&lt;</span><span class=\"keyword\">select</span> id<span class=\"operator\">=</span>&quot;selectNodeByUserId&quot; parameterType<span class=\"operator\">=</span>&quot;Long&quot; resultType<span class=\"operator\">=</span>&quot;com.lcg.oa.entity.Node&quot;<span class=\"operator\">&gt;</span></span><br><span class=\"line\">        <span class=\"keyword\">select</span> <span class=\"keyword\">distinct</span> n.<span class=\"operator\">*</span></span><br><span class=\"line\">        <span class=\"keyword\">from</span></span><br><span class=\"line\">        sys_role_user ru , sys_role_node rn , sys_node n</span><br><span class=\"line\">        <span class=\"keyword\">where</span></span><br><span class=\"line\">        ru.role_id <span class=\"operator\">=</span> rn.role_id <span class=\"keyword\">and</span> user_id <span class=\"operator\">=</span> #&#123;<span class=\"keyword\">value</span>&#125; <span class=\"keyword\">and</span> rn.node_id <span class=\"operator\">=</span> n.node_id</span><br><span class=\"line\">        <span class=\"keyword\">order</span> <span class=\"keyword\">by</span> n.node_code</span><br><span class=\"line\">    <span class=\"operator\">&lt;</span><span class=\"operator\">/</span><span class=\"keyword\">select</span><span class=\"operator\">&gt;</span></span><br><span class=\"line\"><span class=\"operator\">&lt;</span><span class=\"operator\">/</span>mapper<span class=\"operator\">&gt;</span></span><br></pre></td></tr></table></figure>\n<p>◇创建dao对sql语句进行调用</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\">public class RbacDao &#123;</span><br><span class=\"line\">    public List<span class=\"operator\">&lt;</span>Node<span class=\"operator\">&gt;</span> selectNodeByUserId(Long userId) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> (List)MybatisUtils.executeQuery(</span><br><span class=\"line\">                sqlSession <span class=\"operator\">-</span><span class=\"operator\">&gt;</span> sqlSession.selectList(</span><br><span class=\"line\">                        &quot;rbacmapper.selectNodeByUserId&quot;, userId));</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>◇在UserService中进行dao的调用</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\">private RbacDao rbacDao <span class=\"operator\">=</span> <span class=\"keyword\">new</span> RbacDao();</span><br><span class=\"line\">public List<span class=\"operator\">&lt;</span>Node<span class=\"operator\">&gt;</span> selectNodeByUserId(Long userId) &#123;</span><br><span class=\"line\">        List<span class=\"operator\">&lt;</span>Node<span class=\"operator\">&gt;</span> nodeList <span class=\"operator\">=</span> rbacDao.selectNodeByUserId(userId);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> nodeList;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n<p>◇进行测试</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"variable\">@Test</span></span><br><span class=\"line\">   public void selectNodeByUserId()&#123;</span><br><span class=\"line\">       List<span class=\"operator\">&lt;</span>Node<span class=\"operator\">&gt;</span> nodeList <span class=\"operator\">=</span> userService.selectNodeByUserId(<span class=\"number\">2</span>l);<span class=\"operator\">/</span><span class=\"operator\">/</span>l表示长整型</span><br><span class=\"line\">       System.out.println(nodeList);</span><br><span class=\"line\">   &#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"第二部分：实现跳转\"><a href=\"#第二部分：实现跳转\" class=\"headerlink\" title=\"第二部分：实现跳转\"></a>第二部分：实现跳转</h3><p>◇更改LonginServlet增加返回项</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\">result.put(&quot;redirect_url&quot;, &quot;/index&quot;);</span><br></pre></td></tr></table></figure>\n<p>◇更改login.html用于接收新加的返回项</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"operator\">/</span><span class=\"operator\">/</span>跳转url</span><br><span class=\"line\">window.location.href<span class=\"operator\">=</span>json.redirect_url;</span><br></pre></td></tr></table></figure>\n<p>◇创建IndexServlet,并将index.html改为index.ftl</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"variable\">@WebServlet</span>(name <span class=\"operator\">=</span> &quot;IndexServlet&quot;, urlPatterns <span class=\"operator\">=</span> &quot;/index&quot;)</span><br><span class=\"line\">public class IndexServlet extends HttpServlet &#123;</span><br><span class=\"line\">    private UserService userService <span class=\"operator\">=</span> <span class=\"keyword\">new</span> UserService();</span><br><span class=\"line\">    protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException &#123;</span><br><span class=\"line\">        HttpSession session <span class=\"operator\">=</span> request.getSession();</span><br><span class=\"line\">        <span class=\"keyword\">User</span> <span class=\"keyword\">user</span> <span class=\"operator\">=</span> (<span class=\"keyword\">User</span>)session.getAttribute(&quot;login_user&quot;);</span><br><span class=\"line\">        List<span class=\"operator\">&lt;</span>Node<span class=\"operator\">&gt;</span> nodeList <span class=\"operator\">=</span> userService.selectNodeByUserId(user.getUserId());</span><br><span class=\"line\">        request.setAttribute(&quot;node_list&quot;,nodeList);</span><br><span class=\"line\">        request.getRequestDispatcher(&quot;/index.ftl&quot;).forward(request,response);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>◇如何把在登录页面login的用户登录信息保存，并用于后面的功能区分？方法是使用范围更广的session对象<br>即在LonginServlet中进行如下更改：</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"operator\">/</span><span class=\"operator\">/</span>调用业务逻辑</span><br><span class=\"line\"><span class=\"keyword\">User</span> <span class=\"keyword\">user</span> <span class=\"operator\">=</span> userService.checkLogin(username, password);</span><br><span class=\"line\">HttpSession session <span class=\"operator\">=</span> request.getSession();</span><br><span class=\"line\"><span class=\"operator\">/</span><span class=\"operator\">/</span>向session存入登录用户信息,属性名:login_user</span><br><span class=\"line\">session.setAttribute(&quot;login_user&quot; , <span class=\"keyword\">user</span>);</span><br></pre></td></tr></table></figure>\n<p>◇修改index.ftl实现动态显示功能</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!--可折叠导航栏--&gt;</span></span><br><span class=\"line\">           <span class=\"tag\">&lt;<span class=\"name\">ul</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;layui-nav layui-nav-tree&quot;</span>&gt;</span></span><br><span class=\"line\">               &lt;#list node_list as node&gt;</span><br><span class=\"line\">                   &lt;#if node.nodeType == 1&gt;</span><br><span class=\"line\">                       <span class=\"comment\">&lt;!--父节点 模块 自定义属性：data-node-id--&gt;</span></span><br><span class=\"line\">                       <span class=\"tag\">&lt;<span class=\"name\">li</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;layui-nav-item layui-nav-itemed&quot;</span>&gt;</span></span><br><span class=\"line\">                           <span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">href</span>=<span class=\"string\">&quot;javascript:void(0)&quot;</span>&gt;</span>$&#123;node.nodeName&#125;<span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span></span><br><span class=\"line\">                           <span class=\"tag\">&lt;<span class=\"name\">dl</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;layui-nav-child module&quot;</span> <span class=\"attr\">data-node-id</span>=<span class=\"string\">&quot;$&#123;node.nodeId&#125;&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">dl</span>&gt;</span></span><br><span class=\"line\">                       <span class=\"tag\">&lt;/<span class=\"name\">li</span>&gt;</span></span><br><span class=\"line\">                   &lt;/#if&gt;</span><br><span class=\"line\">                   &lt;#if node.nodeType == 2&gt;</span><br><span class=\"line\">                       <span class=\"comment\">&lt;!--子节点 功能 自定义属性：data-parent-id--&gt;</span></span><br><span class=\"line\">                       <span class=\"tag\">&lt;<span class=\"name\">dd</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;function&quot;</span> <span class=\"attr\">data-parent-id</span>=<span class=\"string\">&quot;$&#123;node.parentId&#125;&quot;</span>&gt;</span></span><br><span class=\"line\">                           <span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">href</span>=<span class=\"string\">&quot;javascript:void(0)&quot;</span> <span class=\"attr\">target</span>=<span class=\"string\">&quot;ifmMain&quot;</span>&gt;</span>$&#123;node.nodeName&#125;<span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span></span><br><span class=\"line\">                       <span class=\"tag\">&lt;/<span class=\"name\">dd</span>&gt;</span></span><br><span class=\"line\">                   &lt;/#if&gt;</span><br><span class=\"line\">               &lt;/#list&gt;</span><br><span class=\"line\">           <span class=\"tag\">&lt;/<span class=\"name\">ul</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"Xml配置下实现Mapper接口\"><a href=\"#Xml配置下实现Mapper接口\" class=\"headerlink\" title=\"Xml配置下实现Mapper接口\"></a>Xml配置下实现Mapper接口</h2><p>◇创建员工实体类</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"code\"><pre><span class=\"line\">public class Employee &#123;</span><br><span class=\"line\">    private Long employeeId;</span><br><span class=\"line\">    private String name;</span><br><span class=\"line\">    private Long departmentId;</span><br><span class=\"line\">    private String title;</span><br><span class=\"line\">    private Integer level;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>◇创建dao接口</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">interface</span> <span class=\"title\">EmployeeDao</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> Employee <span class=\"title\">selectById</span><span class=\"params\">(Long employeeId)</span></span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>◇创建mapper与接口对应</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"code\"><pre><span class=\"line\">...</span><br><span class=\"line\">    <span class=\"comment\">&lt;!--namespace与包名要一致--&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">mapper</span> <span class=\"attr\">namespace</span>=<span class=\"string\">&quot;com.lcg.oa.dao.EmployeeDao&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!--id与方法名对应 parameterType与方法参数类型一致</span></span><br><span class=\"line\"><span class=\"comment\">     resultType与方法返回类型一致--&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">select</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;selectById&quot;</span> <span class=\"attr\">parameterType</span>=<span class=\"string\">&quot;Long&quot;</span> <span class=\"attr\">resultType</span>=<span class=\"string\">&quot;com.lcg.oa.entity.Employee&quot;</span>&gt;</span></span><br><span class=\"line\">        select * from adm_employee where employee_id = #&#123;value&#125;</span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">select</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>◇创建员工service (<a href=\"https://blog.csdn.net/lbllol365\">getMapper的原理</a>)</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">EmployeeService</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 按编号查找员工</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> employeeId 员工编号</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> 员工对象，不存在时返回null</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> Employee <span class=\"title\">selectById</span><span class=\"params\">(Long employeeId)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> (Employee) MybatisUtils.executeQuery(sqlSession-&gt;&#123;</span><br><span class=\"line\">            <span class=\"comment\">//匹配相关的Mapper,sql语句原理可网上搜getMapper</span></span><br><span class=\"line\">            <span class=\"comment\">//这里传入一个类对象后,就会得到一个可用的Dao接口</span></span><br><span class=\"line\">            EmployeeDao employeeDao = sqlSession.getMapper(EmployeeDao.class);</span><br><span class=\"line\">            <span class=\"keyword\">return</span> employeeDao.selectById(employeeId);</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>◇修改indexservlet</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@WebServlet(name = &quot;IndexServlet&quot;, urlPatterns = &quot;/index&quot;)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">IndexServlet</span> <span class=\"keyword\">extends</span> <span class=\"title\">HttpServlet</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> UserService userService = <span class=\"keyword\">new</span> UserService();</span><br><span class=\"line\">    <span class=\"keyword\">private</span> EmployeeService employeeService = <span class=\"keyword\">new</span> EmployeeService();</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title\">doPost</span><span class=\"params\">(HttpServletRequest request, HttpServletResponse response)</span> <span class=\"keyword\">throws</span> ServletException, IOException </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title\">doGet</span><span class=\"params\">(HttpServletRequest request, HttpServletResponse response)</span> <span class=\"keyword\">throws</span> ServletException, IOException </span>&#123;</span><br><span class=\"line\">        HttpSession session = request.getSession();</span><br><span class=\"line\">        <span class=\"comment\">//得到当前登录用户对象</span></span><br><span class=\"line\">        User user = (User)session.getAttribute(<span class=\"string\">&quot;login_user&quot;</span>);</span><br><span class=\"line\">        Employee employee = employeeService.selectById(user.getEmployeeId());</span><br><span class=\"line\">        <span class=\"comment\">//获取登录用户可用功能模块列表</span></span><br><span class=\"line\">        List&lt;Node&gt; nodeList = userService.selectNodeByUserId(user.getUserId());</span><br><span class=\"line\">        <span class=\"comment\">//放入请求属性</span></span><br><span class=\"line\">        request.setAttribute(<span class=\"string\">&quot;node_list&quot;</span>,nodeList);</span><br><span class=\"line\">        <span class=\"comment\">//放入session，范围更大,生命周期更长</span></span><br><span class=\"line\">        session.setAttribute(<span class=\"string\">&quot;current_employee&quot;</span>,employee);</span><br><span class=\"line\">        <span class=\"comment\">//请求发至ftl进行展现</span></span><br><span class=\"line\">        request.getRequestDispatcher(<span class=\"string\">&quot;/index.ftl&quot;</span>).forward(request,response);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>◇修改首页</p>\n<figure class=\"highlight html\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!--用户信息--&gt;</span></span><br><span class=\"line\">$&#123;current_employee.name&#125;[部门-$&#123;current_employee.title&#125;]</span><br></pre></td></tr></table></figure>\n<p>◇要想获取到部门，由于涉及到另外一张表，则按上面流程开发即可</p>\n<h2 id=\"基于MD5算法对密码进行加密\"><a href=\"#基于MD5算法对密码进行加密\" class=\"headerlink\" title=\"基于MD5算法对密码进行加密\"></a>基于MD5算法对密码进行加密</h2><h3 id=\"MD5摘要算法\"><a href=\"#MD5摘要算法\" class=\"headerlink\" title=\"MD5摘要算法\"></a>MD5摘要算法</h3><p>◇MD5信息摘要算法广泛使用的密码散列函数<br>◇MD5可以产生出一个128位的散列值用于唯一标识源数据<br>◇项目中通常使用MD5作为敏感数据的加密算法</p>\n<h3 id=\"MD5特点\"><a href=\"#MD5特点\" class=\"headerlink\" title=\"MD5特点\"></a>MD5特点</h3><p>◇压缩性,MD5生成的摘要长度固定<br>◇抗修改,源数据哪怕有一个字节变化,MD5也会有巨大差异<br>◇不可逆,无法通过MD5反向推算源数据  </p>\n<h3 id=\"Apache-Commons-Codec\"><a href=\"#Apache-Commons-Codec\" class=\"headerlink\" title=\"Apache Commons Codec\"></a>Apache Commons Codec</h3><p>◇Commons-Codec是Apache提供的编码/解码组件<br>◇通过Commons-Codec可轻易生成源数据的MD5摘要<br>◇MD5摘要方法: String md5 = DigestUtils.md5Hex(源数据)<br>◇增加依赖并放入发布的工程中</p>\n<h3 id=\"使用方法\"><a href=\"#使用方法\" class=\"headerlink\" title=\"使用方法\"></a>使用方法</h3><p>◇增加依赖并放入发布的工程中</p>\n<figure class=\"highlight html\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>commons-codec<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>commons-codec<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.14<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>◇新增工具类</p>\n<figure class=\"highlight html\"><table><tr><td class=\"code\"><pre><span class=\"line\">public class MD5Utils &#123;</span><br><span class=\"line\">    public static String md5Digest(String source) &#123;</span><br><span class=\"line\">        return DigestUtils.md5Hex(source);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>◇进行测试</p>\n<figure class=\"highlight html\"><table><tr><td class=\"code\"><pre><span class=\"line\">@Test</span><br><span class=\"line\">public void md5Digest() &#123;</span><br><span class=\"line\">    System.out.println(MD5Utils.md5Digest(&quot;test&quot;));</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"敏感数据”加盐”混淆\"><a href=\"#敏感数据”加盐”混淆\" class=\"headerlink\" title=\"敏感数据”加盐”混淆\"></a>敏感数据”加盐”混淆</h3><p>◇防止MD5被通过穷举法解密<br>◇加盐方法</p>\n<figure class=\"highlight html\"><table><tr><td class=\"code\"><pre><span class=\"line\">/**</span><br><span class=\"line\"> * 对源数据加盐混淆后生成MD5摘要</span><br><span class=\"line\"> * @param source 源数据</span><br><span class=\"line\"> * @param salt 盐值</span><br><span class=\"line\"> * @return MD5摘要</span><br><span class=\"line\"> */</span><br><span class=\"line\">public static String md5Digest(String source, Integer salt) &#123;</span><br><span class=\"line\">    char[] ca = source.toCharArray();//字符数组</span><br><span class=\"line\">    for (int i = 0; i &lt; ca.length; i++) &#123;</span><br><span class=\"line\">        ca[i] = (char)(ca[i] + salt);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    String target = new String(ca);</span><br><span class=\"line\">    String md5 = DigestUtils.md5Hex(target);</span><br><span class=\"line\">    return md5;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>◇修改数据库sys_user表，添加salt字段,并将密码替换为加密后的MD5<br>◇修改UserServlet</p>\n<figure class=\"highlight html\"><table><tr><td class=\"code\"><pre><span class=\"line\">//对前台输入的密码加盐混淆后生成MD5，与保存在数据库中的MD5密码进行比对</span><br><span class=\"line\">        String md5 = MD5Utils.md5Digest(password, user.getSalt());</span><br><span class=\"line\">        if (!md5.equals(user.getPassword())) &#123;</span><br><span class=\"line\">            throw new BussinessException(&quot;L002&quot;, &quot;密码错误&quot;);</span><br><span class=\"line\">        &#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"实现注销功能\"><a href=\"#实现注销功能\" class=\"headerlink\" title=\"实现注销功能\"></a>实现注销功能</h2><p>◇即将保存在session中的用户登录信息清空<br>◇创建servlet</p>\n<figure class=\"highlight html\"><table><tr><td class=\"code\"><pre><span class=\"line\">@WebServlet(name = &quot;LogoutServlet&quot;,urlPatterns = &quot;/logout&quot;)</span><br><span class=\"line\">public class LogoutServlet extends HttpServlet &#123;</span><br><span class=\"line\">    protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException &#123;</span><br><span class=\"line\">        request.getSession().invalidate();//将当前会话清空</span><br><span class=\"line\">        response.sendRedirect(&quot;/login.html&quot;);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>◇修改index.ftl的注销按钮</p>\n<figure class=\"highlight html\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!--注销按钮--&gt;</span></span><br><span class=\"line\"> <span class=\"tag\">&lt;<span class=\"name\">li</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;layui-nav-item&quot;</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">href</span>=<span class=\"string\">&quot;/logout&quot;</span>&gt;</span>注销<span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">li</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"开发多级审批流程\"><a href=\"#开发多级审批流程\" class=\"headerlink\" title=\"开发多级审批流程\"></a>开发多级审批流程</h2><h3 id=\"请假流程\"><a href=\"#请假流程\" class=\"headerlink\" title=\"请假流程\"></a>请假流程</h3><p><img src=\"/p/d371/1629534603151-e5acea37-c1d7-4d81-a00c-44dc5aed535d.png\" class=\"lazyload\" data-srcset=\"/p/d371/1629534603151-e5acea37-c1d7-4d81-a00c-44dc5aed535d.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"></p>\n<h3 id=\"工作流程表设计\"><a href=\"#工作流程表设计\" class=\"headerlink\" title=\"工作流程表设计\"></a>工作流程表设计</h3><p><img src=\"/p/d371/1629534801614-f5435e56-73a6-4b7b-96d5-cf14aa718c9a.png\" class=\"lazyload\" data-srcset=\"/p/d371/1629534801614-f5435e56-73a6-4b7b-96d5-cf14aa718c9a.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"></p>\n<h3 id=\"设计约束\"><a href=\"#设计约束\" class=\"headerlink\" title=\"设计约束\"></a>设计约束</h3><p>◇每一个请假单对应一个审批流程<br>◇请假单创建后,按业务规则生成部门经理、总经理审批任务<br>◇审批任务的经办人只能审批自己辖区内的请假申请<br>◇所有审批任务”通过”,代表请假已经批准<br>◇任意审批任务”驳回”操作,其余审批任务取消,请假申请被驳回<br>◇请假流程中任意节点产生的操作都要生成对应的系统通知  </p>\n<h3 id=\"新建数据库表\"><a href=\"#新建数据库表\" class=\"headerlink\" title=\"新建数据库表\"></a>新建数据库表</h3><p>◇请假单表<br><img src=\"/p/d371/1629535785248-df741014-3be2-491a-a49e-5cae76b65c01.png\" class=\"lazyload\" data-srcset=\"/p/d371/1629535785248-df741014-3be2-491a-a49e-5cae76b65c01.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"><br>◇处理流程表<br><img src=\"/p/d371/1629536465016-6c9047ef-981f-45f7-9667-771b7d355182.png\" class=\"lazyload\" data-srcset=\"/p/d371/1629536465016-6c9047ef-981f-45f7-9667-771b7d355182.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"><br>◇通知表<br><img src=\"/p/d371/1629549863768-811195fc-df94-4f7d-93a1-b1321685b5cb.png\" class=\"lazyload\" data-srcset=\"/p/d371/1629549863768-811195fc-df94-4f7d-93a1-b1321685b5cb.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"></p>\n<h2 id=\"实现Dao与数据交互\"><a href=\"#实现Dao与数据交互\" class=\"headerlink\" title=\"实现Dao与数据交互\"></a>实现Dao与数据交互</h2><h3 id=\"创建表的实体类\"><a href=\"#创建表的实体类\" class=\"headerlink\" title=\"创建表的实体类\"></a>创建表的实体类</h3><p>◇LeaveForm.class<br>◇ProcessFlow.class<br>◇Notice.class</p>\n<h3 id=\"创建Dao接口\"><a href=\"#创建Dao接口\" class=\"headerlink\" title=\"创建Dao接口\"></a>创建Dao接口</h3><p>◇LeaveFormDao</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">interface</span> <span class=\"title\">LeaveFormDao</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">insert</span><span class=\"params\">(LeaveForm form)</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> List&lt;Map&gt; <span class=\"title\">selectByParams</span><span class=\"params\">(<span class=\"meta\">@Param(&quot;pf_state&quot;)</span> String pfState, <span class=\"meta\">@Param(&quot;pf_operator_id&quot;)</span> Long operatorId)</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> LeaveForm <span class=\"title\">selectById</span><span class=\"params\">(Long formId)</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">update</span><span class=\"params\">(LeaveForm form)</span></span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>◇ProcessFlowDao</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">interface</span> <span class=\"title\">ProcessFlowDao</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">insert</span><span class=\"params\">(ProcessFlow processFlow)</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">update</span><span class=\"params\">(ProcessFlow processFlow)</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> List&lt;ProcessFlow&gt; <span class=\"title\">selectByFormId</span><span class=\"params\">(Long formId)</span></span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>◇NoticeDao</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">interface</span> <span class=\"title\">NoticeDao</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">insert</span><span class=\"params\">(Notice notice)</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> List&lt;Notice&gt; <span class=\"title\">selectByReceiverId</span><span class=\"params\">(Long receiverId)</span></span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"创建对应的mapper\"><a href=\"#创建对应的mapper\" class=\"headerlink\" title=\"创建对应的mapper\"></a>创建对应的mapper</h3><p>◇leave_form.xml</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">mapper</span> <span class=\"attr\">namespace</span>=<span class=\"string\">&quot;com.lcg.oa.dao.LeaveFormDao&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!--useGeneratedKeys是否使用自增主键；keyProperty实体中的主键；keyColumn数据库表中的主键--&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">insert</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;insert&quot;</span> <span class=\"attr\">parameterType</span>=<span class=\"string\">&quot;com.lcg.oa.entity.LeaveForm&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">useGeneratedKeys</span>=<span class=\"string\">&quot;true&quot;</span> <span class=\"attr\">keyProperty</span>=<span class=\"string\">&quot;formId&quot;</span> <span class=\"attr\">keyColumn</span>=<span class=\"string\">&quot;from_id&quot;</span>&gt;</span></span><br><span class=\"line\">        INSERT INTO adm_leave_form( employee_id, form_type, start_time, end_time, reason, create_time, state)</span><br><span class=\"line\">        VALUES ( #&#123;employeeId&#125;, #&#123;formType&#125;, #&#123;startTime&#125;, #&#123;endTime&#125;, #&#123;reason&#125;, #&#123;createTime&#125;, #&#123;state&#125;)</span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">insert</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>◇process_flow.xml</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">mapper</span> <span class=\"attr\">namespace</span>=<span class=\"string\">&quot;com.lcg.oa.dao.ProcessFlowDao&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">insert</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;insert&quot;</span> <span class=\"attr\">parameterType</span>=<span class=\"string\">&quot;com.lcg.oa.entity.ProcessFlow&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">            <span class=\"attr\">useGeneratedKeys</span>=<span class=\"string\">&quot;true&quot;</span> <span class=\"attr\">keyColumn</span>=<span class=\"string\">&quot;process_id&quot;</span> <span class=\"attr\">keyProperty</span>=<span class=\"string\">&quot;processId&quot;</span>&gt;</span></span><br><span class=\"line\">      INSERT INTO adm_process_flow(form_id, operator_id, action, result, reason, create_time , audit_time , order_no , state,is_last)</span><br><span class=\"line\">      VALUES (#&#123;formId&#125;, #&#123;operatorId&#125;, #&#123;action&#125;, #&#123;result&#125;, #&#123;reason&#125;, #&#123;createTime&#125; , #&#123;auditTime&#125; , #&#123;orderNo&#125; , #&#123;state&#125; , #&#123;isLast&#125;);</span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">insert</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">update</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;update&quot;</span> <span class=\"attr\">parameterType</span>=<span class=\"string\">&quot;com.lcg.oa.entity.ProcessFlow&quot;</span>&gt;</span></span><br><span class=\"line\">      UPDATE adm_process_flow SET form_id = #&#123;formId&#125;, operator_id = #&#123;operatorId&#125;, action = #&#123;action&#125;, result = #&#123;result&#125;, reason = #&#123;reason&#125;, create_time = #&#123;createTime&#125;, audit_time = #&#123;auditTime&#125;, order_no = #&#123;orderNo&#125;, state = #&#123;state&#125;, is_last = #&#123;isLast&#125;</span><br><span class=\"line\">      WHERE process_id = #&#123;processId&#125;</span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">update</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">select</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;selectByFormId&quot;</span> <span class=\"attr\">parameterType</span>=<span class=\"string\">&quot;Long&quot;</span> <span class=\"attr\">resultType</span>=<span class=\"string\">&quot;com.lcg.oa.entity.ProcessFlow&quot;</span>&gt;</span></span><br><span class=\"line\">        select * from adm_process_flow where form_id = #&#123;value&#125; order by order_no</span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">select</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>◇notice.xml</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">mapper</span> <span class=\"attr\">namespace</span>=<span class=\"string\">&quot;com.lcg.oa.dao.NoticeDao&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">insert</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;insert&quot;</span> <span class=\"attr\">parameterType</span>=<span class=\"string\">&quot;com.lcg.oa.entity.Notice&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">            <span class=\"attr\">useGeneratedKeys</span>=<span class=\"string\">&quot;true&quot;</span> <span class=\"attr\">keyProperty</span>=<span class=\"string\">&quot;noticeId&quot;</span> <span class=\"attr\">keyColumn</span>=<span class=\"string\">&quot;notice_id&quot;</span>&gt;</span></span><br><span class=\"line\">        INSERT INTO sys_notice( receiver_id, content, create_time) VALUES (#&#123;receiverId&#125;, #&#123;content&#125;, #&#123;createTime&#125;)</span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">insert</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">select</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;selectByReceiverId&quot;</span> <span class=\"attr\">parameterType</span>=<span class=\"string\">&quot;Long&quot;</span> <span class=\"attr\">resultType</span>=<span class=\"string\">&quot;com.lcg.oa.entity.Notice&quot;</span>&gt;</span></span><br><span class=\"line\">        select * from sys_notice where receiver_id = #&#123;value&#125; order by create_time desc limit 0,100</span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">select</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"开发请假申请功能\"><a href=\"#开发请假申请功能\" class=\"headerlink\" title=\"开发请假申请功能\"></a>开发请假申请功能</h2><h3 id=\"前期准备\"><a href=\"#前期准备\" class=\"headerlink\" title=\"前期准备\"></a>前期准备</h3><p>◇EmployeeDao增加代码</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">    * 根据传入员工对象获取上级主管对象</span></span><br><span class=\"line\"><span class=\"comment\">    * <span class=\"doctag\">@param</span> employee 员工对象</span></span><br><span class=\"line\"><span class=\"comment\">    * <span class=\"doctag\">@return</span> 上级主管对象</span></span><br><span class=\"line\"><span class=\"comment\">    */</span></span><br><span class=\"line\">   <span class=\"function\"><span class=\"keyword\">public</span> Employee <span class=\"title\">selectLeader</span><span class=\"params\">(<span class=\"meta\">@Param(&quot;emp&quot;)</span> Employee employee)</span></span>;</span><br></pre></td></tr></table></figure>\n<p>◇在employee.xml中增加对应的sql语句</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">&lt;select id=<span class=\"string\">&quot;selectLeader&quot;</span> parameterType=<span class=\"string\">&quot;com.lcg.oa.entity.Employee&quot;</span> resultType=<span class=\"string\">&quot;com.lcg.oa.entity.Employee&quot;</span>&gt;</span><br><span class=\"line\">        select * from adm_employee</span><br><span class=\"line\">        where </span><br><span class=\"line\">        &lt;<span class=\"keyword\">if</span> test=<span class=\"string\">&quot;emp.level&amp;lt;7&quot;</span>&gt; &lt;!--<span class=\"string\">&#x27;&lt;&#x27;</span>的转义--&gt;</span><br><span class=\"line\">            level = <span class=\"number\">7</span> and department_id = #&#123;emp.departmentId&#125;</span><br><span class=\"line\">        &lt;/<span class=\"keyword\">if</span>&gt;</span><br><span class=\"line\">        &lt;<span class=\"keyword\">if</span> test=<span class=\"string\">&quot;emp.level == 7&quot;</span>&gt; </span><br><span class=\"line\">            level = <span class=\"number\">8</span></span><br><span class=\"line\">        &lt;/<span class=\"keyword\">if</span>&gt;</span><br><span class=\"line\">        &lt;<span class=\"keyword\">if</span> test=<span class=\"string\">&quot;emp.level == 8&quot;</span>&gt;</span><br><span class=\"line\">            employee_id = #&#123;emp.employeeId&#125;</span><br><span class=\"line\">        &lt;/<span class=\"keyword\">if</span>&gt;</span><br><span class=\"line\">    &lt;/select&gt;</span><br></pre></td></tr></table></figure>\n<p>◇新增业务常量，用来保存指定时间之类的数据</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">BussinessConstants</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">int</span> MANAGER_AUDIT_HOURS=<span class=\"number\">36</span>;<span class=\"comment\">//总经理请假审批时间阈值</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"创建service\"><a href=\"#创建service\" class=\"headerlink\" title=\"创建service\"></a>创建service</h3><p>◇请假单流程服务LeaveFormService</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">LeaveFormService</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 创建请假单</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> form 前端输入的请假单数据</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> 持久化后的请假单对象</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> LeaveForm <span class=\"title\">createLeaveForm</span><span class=\"params\">(LeaveForm form)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">//1.持久化form表单数据,8级以下员工表单状态为processing,8级(总经理)状态为approved</span></span><br><span class=\"line\">        <span class=\"comment\">//2.增加第一条流程数据,说明表单已提交,状态为complete</span></span><br><span class=\"line\">        <span class=\"comment\">//3.分情况创建其余流程数据</span></span><br><span class=\"line\">        <span class=\"comment\">//3.1 7级以下员工,生成部门经理审批任务,请假时间大于72小时,还需生成总经理审批任务</span></span><br><span class=\"line\">        <span class=\"comment\">//3.2 7级员工,生成总经理审批任务</span></span><br><span class=\"line\">        <span class=\"comment\">//3.3 8级员工,生成总经理审批任务,系统自动通过</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"创建控制器\"><a href=\"#创建控制器\" class=\"headerlink\" title=\"创建控制器\"></a>创建控制器</h3><p>◇LeaveFormServlet</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@WebServlet(name = &quot;LeaveFormServlet&quot;,urlPatterns = &quot;/leave/*&quot;)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">LeaveFormServlet</span> <span class=\"keyword\">extends</span> <span class=\"title\">HttpServlet</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> LeaveFormService leaveFormService = <span class=\"keyword\">new</span> LeaveFormService();</span><br><span class=\"line\">    <span class=\"keyword\">private</span> Logger logger = LoggerFactory.getLogger(LeaveFormServlet.class);</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title\">doPost</span><span class=\"params\">(HttpServletRequest request, HttpServletResponse response)</span> <span class=\"keyword\">throws</span> ServletException, IOException </span>&#123;</span><br><span class=\"line\">        </span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title\">doGet</span><span class=\"params\">(HttpServletRequest request, HttpServletResponse response)</span> <span class=\"keyword\">throws</span> ServletException, IOException </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.doPost(request,response);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 创建请假单</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> request</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> response</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@throws</span> ServletException</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@throws</span> IOException</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">create</span><span class=\"params\">(HttpServletRequest request, HttpServletResponse response)</span> <span class=\"keyword\">throws</span> ServletException, IOException </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">//1. 接收各项请假单数据</span></span><br><span class=\"line\">        ...</span><br><span class=\"line\">            <span class=\"comment\">//2. 调用业务逻辑方法</span></span><br><span class=\"line\">            ...</span><br><span class=\"line\">        <span class=\"comment\">//3. 组织响应数据</span></span><br><span class=\"line\">            ...</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"实现请假申请功能\"><a href=\"#实现请假申请功能\" class=\"headerlink\" title=\"实现请假申请功能\"></a>实现请假申请功能</h2><p> ◇表单html文件部分代码 </p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">&lt;script&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">var</span> layDate = layui.laydate; <span class=\"comment\">//Layui日期选择框JS对象</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> layForm = layui.form; <span class=\"comment\">//layui表单对象</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> $ = layui.$; <span class=\"comment\">//jQuery对象</span></span><br><span class=\"line\">        <span class=\"comment\">//日期时间范围</span></span><br><span class=\"line\">        layDate.render(&#123;</span><br><span class=\"line\">            elem: <span class=\"string\">&#x27;#daterange&#x27;</span> <span class=\"comment\">//表示将id为daterange的文本框渲染成日期选择框</span></span><br><span class=\"line\">            ,type: <span class=\"string\">&#x27;datetime&#x27;</span>  <span class=\"comment\">//日期+时间</span></span><br><span class=\"line\">            ,range: <span class=\"keyword\">true</span></span><br><span class=\"line\">            ,format: <span class=\"string\">&#x27;yyyy年M月d日H时&#x27;</span></span><br><span class=\"line\">            ,done: function(value, start, end)&#123;<span class=\"comment\">//自动触发事件</span></span><br><span class=\"line\">                <span class=\"comment\">//选择日期后出发的时间,设置startTime与endTime隐藏域,按照服务器要求的格式</span></span><br><span class=\"line\">                <span class=\"keyword\">var</span> startTime = start.year + <span class=\"string\">&quot;-&quot;</span> + start.month + <span class=\"string\">&quot;-&quot;</span> + start.date + <span class=\"string\">&quot;-&quot;</span> + start.hours;</span><br><span class=\"line\">                <span class=\"keyword\">var</span> endTime = end.year + <span class=\"string\">&quot;-&quot;</span> + end.month + <span class=\"string\">&quot;-&quot;</span> + end.date + <span class=\"string\">&quot;-&quot;</span> + end.hours;</span><br><span class=\"line\">                console.info(<span class=\"string\">&quot;请假开始时间&quot;</span>,startTime);</span><br><span class=\"line\">                $(<span class=\"string\">&quot;#startTime&quot;</span>).val(startTime);</span><br><span class=\"line\">                console.info(<span class=\"string\">&quot;请假结束时间&quot;</span>,endTime);</span><br><span class=\"line\">                $(<span class=\"string\">&quot;#endTime&quot;</span>).val(endTime);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//表单提交时间,data.field由Layui提供可以获取表单所有数据，并封装成键值对</span></span><br><span class=\"line\">        layForm.on(<span class=\"string\">&#x27;submit(sub)&#x27;</span>, function(data)&#123;</span><br><span class=\"line\">            console.info(<span class=\"string\">&quot;向服务器提交的表单数据&quot;</span>,data.field);</span><br><span class=\"line\">            $.post(<span class=\"string\">&quot;/leave/create&quot;</span>,data.field,function (json) &#123;</span><br><span class=\"line\">                console.info(json);</span><br><span class=\"line\">                <span class=\"keyword\">if</span>(json.code == <span class=\"string\">&quot;0&quot;</span>)&#123;</span><br><span class=\"line\">                    <span class=\"comment\">/*SweetAlert2确定对话框*/</span></span><br><span class=\"line\">                    swal(&#123;</span><br><span class=\"line\">                        type: <span class=\"string\">&#x27;success&#x27;</span>,</span><br><span class=\"line\">                        html: <span class=\"string\">&quot;&lt;h2&gt;请假单已提交,等待上级审批&lt;/h2&gt;&quot;</span>,</span><br><span class=\"line\">                        confirmButtonText: <span class=\"string\">&quot;确定&quot;</span></span><br><span class=\"line\">                    &#125;).then(function (result) &#123;<span class=\"comment\">//点击确定后的触发事件</span></span><br><span class=\"line\">                        window.location.href=<span class=\"string\">&quot;/forward/notice&quot;</span>;<span class=\"comment\">//跳转到指定路径</span></span><br><span class=\"line\">                    &#125;);</span><br><span class=\"line\">                &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">                    swal(&#123;</span><br><span class=\"line\">                        type: <span class=\"string\">&#x27;warning&#x27;</span>,</span><br><span class=\"line\">                        html: <span class=\"string\">&quot;&lt;h2&gt;&quot;</span> + json.message + <span class=\"string\">&quot;&lt;/h2&gt;&quot;</span>,</span><br><span class=\"line\">                        confirmButtonText: <span class=\"string\">&quot;确定&quot;</span></span><br><span class=\"line\">                    &#125;);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;,<span class=\"string\">&quot;json&quot;</span>);</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;/script&gt;</span><br></pre></td></tr></table></figure>\n\n<p>◇<a href=\"https://sweetalert.js.org/\">sweetalert官网</a>,用来美化对话框<br>◇新增控制器ForwardServlet，通用的页面跳转的servlet，可以支持跳转多个页面</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@WebServlet(name = &quot;ForwardServlet&quot;,urlPatterns = &quot;/forward/*&quot;)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ForwardServlet</span> <span class=\"keyword\">extends</span> <span class=\"title\">HttpServlet</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title\">doGet</span><span class=\"params\">(HttpServletRequest request, HttpServletResponse response)</span> <span class=\"keyword\">throws</span> ServletException, IOException </span>&#123;</span><br><span class=\"line\">        String uri = request.getRequestURI();</span><br><span class=\"line\">        <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">         * /forward/form</span></span><br><span class=\"line\"><span class=\"comment\">         * /forward/a/b/c/form</span></span><br><span class=\"line\"><span class=\"comment\">         */</span></span><br><span class=\"line\">        String subUri = uri.substring(<span class=\"number\">1</span>);<span class=\"comment\">// forward/form; forward/a/b/c/form</span></span><br><span class=\"line\">        String page = subUri.substring(subUri.indexOf(<span class=\"string\">&quot;/&quot;</span>));<span class=\"comment\">// /form; /a/b/c/form</span></span><br><span class=\"line\">        request.getRequestDispatcher(page+<span class=\"string\">&quot;.ftl&quot;</span>).forward(request,response);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>◇将数据库node表的url填上<br><img src=\"/p/d371/1629643640665-e8f0db6d-9480-4d4c-ac94-20b31826033a.png\" class=\"lazyload\" data-srcset=\"/p/d371/1629643640665-e8f0db6d-9480-4d4c-ac94-20b31826033a.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"><br>◇修改index.ftl,将href改为${node.url}</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">&lt;a href=<span class=\"string\">&quot;$&#123;node.url&#125;&quot;</span> target=<span class=\"string\">&quot;ifmMain&quot;</span>&gt;$&#123;node.nodeName&#125;&lt;/a&gt;</span><br></pre></td></tr></table></figure>\n<h2 id=\"请假审批功能\"><a href=\"#请假审批功能\" class=\"headerlink\" title=\"请假审批功能\"></a>请假审批功能</h2><h3 id=\"新增sql语句\"><a href=\"#新增sql语句\" class=\"headerlink\" title=\"新增sql语句\"></a>新增sql语句</h3><p>◇在leave_form.xml中新增查询，多个参数（工作流程任务状态；经办人）查询请假单，由于查询的字段来自不同的表，所以返回类型也是map而非某个实体类</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">select</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;selectByParams&quot;</span> <span class=\"attr\">parameterType</span>=<span class=\"string\">&quot;java.util.Map&quot;</span> <span class=\"attr\">resultType</span>=<span class=\"string\">&quot;java.util.Map&quot;</span>&gt;</span></span><br><span class=\"line\">    select f.* ,e.name , d.*</span><br><span class=\"line\">    from</span><br><span class=\"line\">      adm_leave_form f,adm_process_flow pf , adm_employee e , adm_department d</span><br><span class=\"line\">    where</span><br><span class=\"line\">      f.form_id = pf.form_id</span><br><span class=\"line\">      and f.employee_id = e.employee_id</span><br><span class=\"line\">      and e.department_id = d.department_id</span><br><span class=\"line\">      and pf.state = #&#123;pf_state&#125; and pf.operator_id = #&#123;pf_operator_id&#125;</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">select</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>◇在Dao中增加相应的接口对应</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//多个参数采用注解形式说明其在xml中的参数类型,名称须一致</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> List&lt;Map&gt; <span class=\"title\">selectByParams</span><span class=\"params\">(<span class=\"meta\">@Param(&quot;pf_state&quot;)</span> String pfState, </span></span></span><br><span class=\"line\"><span class=\"params\"><span class=\"function\">                                <span class=\"meta\">@Param(&quot;pf_operator_id&quot;)</span> Long operatorId)</span></span>;</span><br></pre></td></tr></table></figure>\n<h3 id=\"修改Service\"><a href=\"#修改Service\" class=\"headerlink\" title=\"修改Service\"></a>修改Service</h3><p>◇在LeaveFormService中新增方法用来获取请假单</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">    * 获取指定任务状态及指定经办人对应的请假单列表</span></span><br><span class=\"line\"><span class=\"comment\">    * <span class=\"doctag\">@param</span> pfState ProcessFlow任务状态</span></span><br><span class=\"line\"><span class=\"comment\">    * <span class=\"doctag\">@param</span> operatorId 经办人编号</span></span><br><span class=\"line\"><span class=\"comment\">    * <span class=\"doctag\">@return</span> 请假单及相关数据列表</span></span><br><span class=\"line\"><span class=\"comment\">    */</span></span><br><span class=\"line\">   <span class=\"function\"><span class=\"keyword\">public</span> List&lt;Map&gt; <span class=\"title\">getLeaveFormList</span><span class=\"params\">(String pfState, Long operatorId)</span> </span>&#123;</span><br><span class=\"line\">       <span class=\"keyword\">return</span> (List&lt;Map&gt;) MybatisUtils.executeQuery(sqlSession-&gt;&#123;</span><br><span class=\"line\">           LeaveFormDao dao = sqlSession.getMapper(LeaveFormDao.class);</span><br><span class=\"line\">           List&lt;Map&gt; formList = dao.selectByParams(pfState, operatorId);</span><br><span class=\"line\">           <span class=\"keyword\">return</span> formList;</span><br><span class=\"line\">       &#125;);</span><br><span class=\"line\">   &#125;</span><br></pre></td></tr></table></figure>\n<p>◇在Servlet中对service进行调用</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">if</span> (methodName.equals(<span class=\"string\">&quot;create&quot;</span>)) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">this</span>.create(request,response);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (methodName.equals(<span class=\"string\">&quot;list&quot;</span>)) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">this</span>.getLeaveFormList(request, response);</span><br><span class=\"line\">        &#125; </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 查询需要审核的请假单列表</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> request</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> response</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@throws</span> ServletException</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@throws</span> IOException</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">getLeaveFormList</span><span class=\"params\">(HttpServletRequest request, HttpServletResponse response)</span> <span class=\"keyword\">throws</span> ServletException, IOException </span>&#123;</span><br><span class=\"line\">        User user = (User) request.getSession().getAttribute(<span class=\"string\">&quot;login_user&quot;</span>);</span><br><span class=\"line\">        List&lt;Map&gt; formList = leaveFormService.getLeaveFormList(<span class=\"string\">&quot;process&quot;</span>, user.getEmployeeId());</span><br><span class=\"line\">        Map result = <span class=\"keyword\">new</span> HashMap();</span><br><span class=\"line\">        <span class=\"comment\">//4个属性满足layUI数据表格的要求</span></span><br><span class=\"line\">        result.put(<span class=\"string\">&quot;code&quot;</span>, <span class=\"string\">&quot;0&quot;</span>);<span class=\"comment\">//表示服务器端处理成功</span></span><br><span class=\"line\">        result.put(<span class=\"string\">&quot;msg&quot;</span>, <span class=\"string\">&quot;&quot;</span>);<span class=\"comment\">//服务器返回的具体文本消息</span></span><br><span class=\"line\">        result.put(<span class=\"string\">&quot;count&quot;</span>, formList.size());<span class=\"comment\">//所有数据的总数</span></span><br><span class=\"line\">        result.put(<span class=\"string\">&quot;data&quot;</span>, formList);<span class=\"comment\">//显示的对象列表</span></span><br><span class=\"line\">        String json = JSON.toJSONString(result);</span><br><span class=\"line\">        response.getWriter().println(json);</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"新增ftl文件用来审批\"><a href=\"#新增ftl文件用来审批\" class=\"headerlink\" title=\"新增ftl文件用来审批\"></a>新增ftl文件用来审批</h3><p>◇部分代码</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">&lt;script&gt;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> $ = layui.$;</span><br><span class=\"line\">    <span class=\"comment\">//将毫秒数转换为&quot;yyyy-MM-dd HH时&quot;字符串格式</span></span><br><span class=\"line\">    <span class=\"function\">function <span class=\"title\">formatDate</span><span class=\"params\">(time)</span></span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> newDate = <span class=\"keyword\">new</span> Date(time);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> newDate.getFullYear() + <span class=\"string\">&quot;-&quot;</span> +</span><br><span class=\"line\">            (newDate.getMonth() + <span class=\"number\">1</span>) + <span class=\"string\">&quot;-&quot;</span> + newDate.getDate()</span><br><span class=\"line\">            + <span class=\"string\">&quot; &quot;</span> + newDate.getHours() + <span class=\"string\">&quot;时&quot;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">// 将table渲染为数据表格</span></span><br><span class=\"line\">    layui.table.render(&#123;</span><br><span class=\"line\">        elem : <span class=\"string\">&quot;#grdFormList&quot;</span> , <span class=\"comment\">//选择器</span></span><br><span class=\"line\">        id : <span class=\"string\">&quot;grdFormList&quot;</span> , <span class=\"comment\">//id</span></span><br><span class=\"line\">        url : <span class=\"string\">&quot;/leave/list&quot;</span> , <span class=\"comment\">//ajax请求url</span></span><br><span class=\"line\">        page : <span class=\"keyword\">false</span> , <span class=\"comment\">//是否分页 true-是 false-否</span></span><br><span class=\"line\">        cols :[[ <span class=\"comment\">//列描述</span></span><br><span class=\"line\">            &#123;title : <span class=\"string\">&quot;&quot;</span> , width:<span class=\"number\">70</span> , style : <span class=\"string\">&quot;height:60px&quot;</span> , type:<span class=\"string\">&quot;numbers&quot;</span>&#125;, <span class=\"comment\">// numbers代表序号列</span></span><br><span class=\"line\">            &#123;field : <span class=\"string\">&quot;create_time&quot;</span> , title : <span class=\"string\">&quot;申请时间&quot;</span> , width : <span class=\"number\">150</span> , templet: function (d) &#123;</span><br><span class=\"line\">                <span class=\"comment\">//templet代表对数据进行加工后再显示</span></span><br><span class=\"line\">                <span class=\"keyword\">return</span> formatDate(d.create_time)</span><br><span class=\"line\">            &#125;&#125;,</span><br><span class=\"line\">            &#123;field : <span class=\"string\">&quot;form_type&quot;</span> , title : <span class=\"string\">&quot;类型&quot;</span> , width : <span class=\"number\">100</span> , templet: function(d)&#123;</span><br><span class=\"line\">                <span class=\"keyword\">switch</span> (d.form_type) &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">case</span> <span class=\"number\">1</span>:</span><br><span class=\"line\">                        <span class=\"keyword\">return</span> <span class=\"string\">&quot;事假&quot;</span>;</span><br><span class=\"line\">                    <span class=\"keyword\">case</span> <span class=\"number\">2</span>:</span><br><span class=\"line\">                        <span class=\"keyword\">return</span> <span class=\"string\">&quot;病假&quot;</span>;</span><br><span class=\"line\">                    <span class=\"keyword\">case</span> <span class=\"number\">3</span>:</span><br><span class=\"line\">                        <span class=\"keyword\">return</span> <span class=\"string\">&quot;工伤假&quot;</span>;</span><br><span class=\"line\">                    <span class=\"keyword\">case</span> <span class=\"number\">4</span>:</span><br><span class=\"line\">                        <span class=\"keyword\">return</span> <span class=\"string\">&quot;婚假&quot;</span>;</span><br><span class=\"line\">                    <span class=\"keyword\">case</span> <span class=\"number\">5</span>:</span><br><span class=\"line\">                        <span class=\"keyword\">return</span> <span class=\"string\">&quot;产假&quot;</span>;</span><br><span class=\"line\">                    <span class=\"keyword\">case</span> <span class=\"number\">6</span>:</span><br><span class=\"line\">                        <span class=\"keyword\">return</span> <span class=\"string\">&quot;丧假&quot;</span>;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;&#125;,</span><br><span class=\"line\">            &#123;field : <span class=\"string\">&quot;department_name&quot;</span> , title : <span class=\"string\">&quot;部门&quot;</span> , width : <span class=\"number\">100</span>&#125;,</span><br><span class=\"line\">            &#123;field : <span class=\"string\">&quot;name&quot;</span> , title : <span class=\"string\">&quot;员工&quot;</span> , width : <span class=\"number\">100</span>&#125;,</span><br><span class=\"line\">            &#123;field : <span class=\"string\">&quot;start_time&quot;</span> , title : <span class=\"string\">&quot;起始时间&quot;</span> , width : <span class=\"number\">150</span>, templet: function (d) &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">return</span> formatDate(d.start_time)</span><br><span class=\"line\">                &#125;&#125;,</span><br><span class=\"line\">            &#123;field : <span class=\"string\">&quot;end_time&quot;</span> , title : <span class=\"string\">&quot;结束时间&quot;</span> , width : <span class=\"number\">150</span> , templet: function (d) &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">return</span> formatDate(d.end_time)</span><br><span class=\"line\">                &#125;&#125;,</span><br><span class=\"line\">            &#123;field : <span class=\"string\">&quot;reason&quot;</span> , title : <span class=\"string\">&quot;请假原因&quot;</span> , width : <span class=\"number\">350</span> &#125;,</span><br><span class=\"line\">            &#123;title : <span class=\"string\">&quot;&quot;</span> , width:<span class=\"number\">150</span> ,type:<span class=\"string\">&quot;space&quot;</span> , templet : function(d)&#123;</span><br><span class=\"line\">                <span class=\"keyword\">var</span> strRec = JSON.stringify(d);</span><br><span class=\"line\">                console.info(<span class=\"string\">&quot;请假单数据&quot;</span>, strRec);</span><br><span class=\"line\">                <span class=\"comment\">//将请假单数据存放至data-laf属性中</span></span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"string\">&quot;&lt;button class=&#x27;layui-btn layui-btn-danger layui-btn-sm btn-audit&#x27; data-laf=&quot;</span> + strRec + <span class=\"string\">&quot; &gt;审批&lt;/button&gt;&quot;</span>;</span><br><span class=\"line\">            &#125;&#125;</span><br><span class=\"line\">        ]]</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 绑定每一行的审批按钮</span></span><br><span class=\"line\">    $(document).on(<span class=\"string\">&quot;click&quot;</span> , <span class=\"string\">&quot;.btn-audit&quot;</span> , function()&#123;</span><br><span class=\"line\">        <span class=\"comment\">//初始化表单</span></span><br><span class=\"line\">        $(<span class=\"string\">&quot;#divDialog form&quot;</span>)[<span class=\"number\">0</span>].reset();</span><br><span class=\"line\">        $(<span class=\"string\">&quot;#divDialog form form-item-value&quot;</span>).text(<span class=\"string\">&quot;&quot;</span>);</span><br><span class=\"line\">        <span class=\"comment\">//获取当前点击按钮的请假单数据,回填至显示项</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> laf = $(<span class=\"keyword\">this</span>).data(<span class=\"string\">&quot;laf&quot;</span>);</span><br><span class=\"line\">        $(<span class=\"string\">&quot;#dname&quot;</span>).text(laf.department_name);</span><br><span class=\"line\">        $(<span class=\"string\">&quot;#name&quot;</span>).text(laf.name);</span><br><span class=\"line\">        $(<span class=\"string\">&quot;#startTime&quot;</span>).text(formatDate(laf.start_time));</span><br><span class=\"line\">        $(<span class=\"string\">&quot;#endTime&quot;</span>).text(formatDate(laf.end_time));</span><br><span class=\"line\">        $(<span class=\"string\">&quot;#reason&quot;</span>).text(laf.reason);</span><br><span class=\"line\">        $(<span class=\"string\">&quot;#formId&quot;</span>).val(laf.form_id);</span><br><span class=\"line\">        <span class=\"comment\">//弹出layui对话框</span></span><br><span class=\"line\">        layui.layer.open(&#123;</span><br><span class=\"line\">            type : <span class=\"string\">&quot;1&quot;</span> , <span class=\"comment\">//页面层</span></span><br><span class=\"line\">            title : <span class=\"string\">&quot;请假审批&quot;</span> , <span class=\"comment\">//标题</span></span><br><span class=\"line\">            content : $(<span class=\"string\">&quot;#divDialog&quot;</span>) , <span class=\"comment\">//指定对话框容器对象</span></span><br><span class=\"line\">            area : [<span class=\"string\">&quot;500px&quot;</span> , <span class=\"string\">&quot;400px&quot;</span>] , <span class=\"comment\">//尺寸</span></span><br><span class=\"line\">            end : function()&#123; <span class=\"comment\">//销毁后触发事件</span></span><br><span class=\"line\">                $(<span class=\"string\">&quot;#divDialog&quot;</span>).hide();</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;)</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 提交审批数据</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    layui.form.on(<span class=\"string\">&quot;submit(audit)&quot;</span> , function(data)&#123;</span><br><span class=\"line\">        $.ajax(&#123;</span><br><span class=\"line\">            url : <span class=\"string\">&quot;/leave/audit&quot;</span>, <span class=\"comment\">//审核URL</span></span><br><span class=\"line\">            data : data.field ,</span><br><span class=\"line\">            type : <span class=\"string\">&quot;post&quot;</span> ,</span><br><span class=\"line\">            success: function (json) &#123;</span><br><span class=\"line\">                <span class=\"comment\">//关闭所有layui对话框</span></span><br><span class=\"line\">                layui.layer.closeAll();</span><br><span class=\"line\">                <span class=\"comment\">//显示处理结果</span></span><br><span class=\"line\">                <span class=\"keyword\">if</span>(json.code == <span class=\"string\">&quot;ok&quot;</span>)&#123;</span><br><span class=\"line\">                    swal(&#123;</span><br><span class=\"line\">                        type: <span class=\"string\">&#x27;success&#x27;</span>,</span><br><span class=\"line\">                        html: <span class=\"string\">&quot;&lt;h2&gt;请假已审批完毕&lt;/h2&gt;&quot;</span>,</span><br><span class=\"line\">                        confirmButtonText: <span class=\"string\">&quot;确定&quot;</span></span><br><span class=\"line\">                    &#125;).then(function (result) &#123;</span><br><span class=\"line\">                        window.location.href=<span class=\"string\">&quot;/forward/notice&quot;</span>;</span><br><span class=\"line\">                    &#125;);</span><br><span class=\"line\">                &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">                    swal(&#123;</span><br><span class=\"line\">                        type: <span class=\"string\">&#x27;warning&#x27;</span>,</span><br><span class=\"line\">                        html: <span class=\"string\">&quot;&lt;h2&gt;&quot;</span> + json.msg + <span class=\"string\">&quot;&lt;/h2&gt;&quot;</span>,</span><br><span class=\"line\">                        confirmButtonText: <span class=\"string\">&quot;确定&quot;</span></span><br><span class=\"line\">                    &#125;);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;)</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;/script&gt;</span><br></pre></td></tr></table></figure>\n<p>◇出现错误：Page template not found<br>可能是ftl文件没有找到；解决方法：重启Tomcat或者将ftl文件删除后重新创建再重启Tomcat</p>\n<h2 id=\"实现审批业务逻辑\"><a href=\"#实现审批业务逻辑\" class=\"headerlink\" title=\"实现审批业务逻辑\"></a>实现审批业务逻辑</h2><h3 id=\"审批流程可能出现的三种情况\"><a href=\"#审批流程可能出现的三种情况\" class=\"headerlink\" title=\"审批流程可能出现的三种情况\"></a>审批流程可能出现的三种情况</h3><p>①需要总经理审批的，中间节点处理完成，并且部门经理审批通过，则后续节点reday-&gt;process<br>②中间节点有驳回，则后续所有节点变为cancel<br>③如果当前节点是最后一个，无论审批通过还是拒绝，执行完以后整个流程都会结束，所有节点状态都变为complete，同时表单状态变为处理结果</p>\n<h3 id=\"代码实现\"><a href=\"#代码实现\" class=\"headerlink\" title=\"代码实现\"></a>代码实现</h3><p>–在process_flow.xml中新增查询语句，通过FormId查询所有的处理表单数据，并且新增更新语句，用来更新任务状态</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">update</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;update&quot;</span> <span class=\"attr\">parameterType</span>=<span class=\"string\">&quot;com.lcg.oa.entity.ProcessFlow&quot;</span>&gt;</span></span><br><span class=\"line\">      UPDATE adm_process_flow SET form_id = #&#123;formId&#125;, operator_id = #&#123;operatorId&#125;, action = #&#123;action&#125;, result = #&#123;result&#125;, reason = #&#123;reason&#125;, create_time = #&#123;createTime&#125;, audit_time = #&#123;auditTime&#125;, order_no = #&#123;orderNo&#125;, state = #&#123;state&#125;, is_last = #&#123;isLast&#125;</span><br><span class=\"line\">      WHERE process_id = #&#123;processId&#125;</span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">update</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">select</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;selectByFormId&quot;</span> <span class=\"attr\">parameterType</span>=<span class=\"string\">&quot;Long&quot;</span> <span class=\"attr\">resultType</span>=<span class=\"string\">&quot;com.lcg.oa.entity.ProcessFlow&quot;</span>&gt;</span></span><br><span class=\"line\">        select * from adm_process_flow where form_id = #&#123;value&#125; order by order_no</span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">select</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>–在接口中将刚才新增的两条查询语句的方法写上</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> LeaveForm <span class=\"title\">selectById</span><span class=\"params\">(Long formId)</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">update</span><span class=\"params\">(LeaveForm form)</span></span>;</span><br></pre></td></tr></table></figure>\n<p>–在leave_form.xml在新增sql语句</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">&lt;select id=<span class=\"string\">&quot;selectById&quot;</span> parameterType=<span class=\"string\">&quot;Long&quot;</span> resultType=<span class=\"string\">&quot;com.imooc.oa.entity.LeaveForm&quot;</span>&gt;</span><br><span class=\"line\">        select * from adm_leave_form where form_id = #&#123;value&#125;</span><br><span class=\"line\">    &lt;/select&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">    &lt;update id=<span class=\"string\">&quot;update&quot;</span> parameterType=<span class=\"string\">&quot;com.imooc.oa.entity.LeaveForm&quot;</span>&gt;</span><br><span class=\"line\">        UPDATE adm_leave_form SET employee_id = #&#123;employeeId&#125; , form_type = #&#123;formType&#125;, start_time = #&#123;startTime&#125;, end_time = #&#123;endTime&#125;, reason = #&#123;reason&#125;, state = #&#123;state&#125; ,create_time = #&#123;createTime&#125; WHERE form_id = #&#123;formId&#125;</span><br><span class=\"line\">    &lt;/update&gt;</span><br></pre></td></tr></table></figure>\n<p>–在LeaveForm中新增对应的方法</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> LeaveForm <span class=\"title\">selectById</span><span class=\"params\">(Long formId)</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">update</span><span class=\"params\">(LeaveForm form)</span></span>;</span><br></pre></td></tr></table></figure>\n<p>–在LeaveFormService中新增方法，部分代码</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 审核请假单</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> formId 表单编号</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> operatorId 经办人(当前登录员工)</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> result 审批结果</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> reason 审批意见</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">audit</span><span class=\"params\">(Long formId , Long operatorId , String result , String reason)</span></span>&#123;</span><br><span class=\"line\">        MybatisUtils.executeUpdate(sqlSession-&gt;&#123;</span><br><span class=\"line\">            <span class=\"comment\">//1.无论同意/驳回，当前任务状态变更为complete</span></span><br><span class=\"line\">            <span class=\"comment\">//2.如果当前任务是最后一个节点，代表流程结束，更新请假单状态为对应的approve/refused</span></span><br><span class=\"line\">            <span class=\"comment\">//3.如果当前任务不是最后一个节点且审批通过，那下一个节点的状态：ready-&gt;process</span></span><br><span class=\"line\">            <span class=\"comment\">//4.如果当前任务不是最后一个节点且审批驳回，则后续所有任务状态变为cancel，请假单状态变为refused</span></span><br><span class=\"line\">        &#125;)</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"完整实现请假审批\"><a href=\"#完整实现请假审批\" class=\"headerlink\" title=\"完整实现请假审批\"></a>完整实现请假审批</h3><p>◇在LeaveFormServlet中新建方法用来处理审批操作</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 处理审批操作</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> request</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> response</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@throws</span> ServletException</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@throws</span> IOException</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">audit</span><span class=\"params\">(HttpServletRequest request, HttpServletResponse response)</span> <span class=\"keyword\">throws</span> ServletException, IOException </span>&#123;</span><br><span class=\"line\">        String formId = request.getParameter(<span class=\"string\">&quot;formId&quot;</span>);</span><br><span class=\"line\">        String result = request.getParameter(<span class=\"string\">&quot;result&quot;</span>);</span><br><span class=\"line\">        String reason = request.getParameter(<span class=\"string\">&quot;reason&quot;</span>);</span><br><span class=\"line\">        User user = (User)request.getSession().getAttribute(<span class=\"string\">&quot;login_user&quot;</span>);</span><br><span class=\"line\">        Map mpResult = <span class=\"keyword\">new</span> HashMap();</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            leaveFormService.audit(Long.parseLong(formId), user.getEmployeeId(), result, reason);</span><br><span class=\"line\">            mpResult.put(<span class=\"string\">&quot;code&quot;</span>, <span class=\"string\">&quot;0&quot;</span>);</span><br><span class=\"line\">            mpResult.put(<span class=\"string\">&quot;message&quot;</span>, <span class=\"string\">&quot;success&quot;</span>);</span><br><span class=\"line\">        &#125;<span class=\"keyword\">catch</span>(Exception e)&#123;</span><br><span class=\"line\">            logger.error(<span class=\"string\">&quot;请假单审核失败&quot;</span>,e);</span><br><span class=\"line\">            mpResult.put(<span class=\"string\">&quot;code&quot;</span>, e.getClass().getSimpleName());</span><br><span class=\"line\">            mpResult.put(<span class=\"string\">&quot;message&quot;</span>, e.getMessage());</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        String json = JSON.toJSONString(mpResult);</span><br><span class=\"line\">        response.getWriter().println(json);</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n<p>◇url绑定</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (methodName.equals(<span class=\"string\">&quot;audit&quot;</span>)) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">this</span>.audit(request, response);</span><br><span class=\"line\">        &#125;</span><br></pre></td></tr></table></figure>\n<p>◇修改audit.ftl，新增dataType；</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">url : <span class=\"string\">&quot;/leave/audit&quot;</span>, <span class=\"comment\">//审核URL</span></span><br><span class=\"line\">            data : data.field ,</span><br><span class=\"line\">            type : <span class=\"string\">&quot;post&quot;</span> ,</span><br><span class=\"line\">            dataType :<span class=\"string\">&quot;json&quot;</span>, <span class=\"comment\">//服务器返回类型为json字符串</span></span><br></pre></td></tr></table></figure>\n<p>◇将成功的判断条件由”ok”改为<strong>if</strong>(json.<strong>code <strong>== <strong>“0”</strong>){<em>//0，代表成功，与后台一致</em><br>◇将提示信息由</strong>html</strong>: **”</p><h2>“ **+ json.msg + <strong>“</strong></h2>“,改为 json.**message **<p></p>\n<h2 id=\"开发系统通知功能\"><a href=\"#开发系统通知功能\" class=\"headerlink\" title=\"开发系统通知功能\"></a>开发系统通知功能</h2><h3 id=\"创建系统消息\"><a href=\"#创建系统消息\" class=\"headerlink\" title=\"创建系统消息\"></a>创建系统消息</h3><p>◇消息的触发时机：①当员工提交请假申请时；②当请假流程中间节点发生变化时<br>◇部分代码<br>–请假申请时</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"> <span class=\"comment\">//String.format用于输出指定格式的字符串</span></span><br><span class=\"line\"> String noticeContent = String.format(<span class=\"string\">&quot;您的请假申请[%s-%s]已提交，请等待上机审批.&quot;</span></span><br><span class=\"line\">        ,sdf.format(form.getStartTime()), sdf.format(form.getEndTime()));</span><br><span class=\"line\">noticeDao.insert(<span class=\"keyword\">new</span> Notice(employee.getEmployeeId(),noticeContent));<span class=\"comment\">//存放数据库</span></span><br><span class=\"line\"><span class=\"comment\">//通知部门经理审批</span></span><br><span class=\"line\">noticeContent = String.format(<span class=\"string\">&quot;%s-%s提起请假申请[%s-%s],请尽快审批&quot;</span></span><br><span class=\"line\">        ,employee.getTitle(),employee.getName(),sdf.format(form.getStartTime())</span><br><span class=\"line\">         ,sdf.format(form.getEndTime()));</span><br><span class=\"line\"> noticeDao.insert(<span class=\"keyword\">new</span> Notice(dmanger.getEmployeeId(),noticeContent));</span><br></pre></td></tr></table></figure>\n<p>–审批直接完成时</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//2.如果当前任务是最后一个节点，代表流程结束，更新请假单状态为对应的approve/refused</span></span><br><span class=\"line\">LeaveFormDao leaveFormDao = sqlSession.getMapper(LeaveFormDao.class);</span><br><span class=\"line\">LeaveForm form = leaveFormDao.selectById(formId);</span><br><span class=\"line\">SimpleDateFormat sdf = <span class=\"keyword\">new</span> SimpleDateFormat(<span class=\"string\">&quot;yyyy-MM-dd-HH时&quot;</span>);</span><br><span class=\"line\">EmployeeDao employeeDao = sqlSession.getMapper(EmployeeDao.class);</span><br><span class=\"line\">Employee employee = employeeDao.selectById(form.getEmployeeId());<span class=\"comment\">//表单提交人信息</span></span><br><span class=\"line\">Employee operator = employeeDao.selectById(operatorId);<span class=\"comment\">//任务经办人信息</span></span><br><span class=\"line\">NoticeDao noticeDao = sqlSession.getMapper(NoticeDao.class);</span><br><span class=\"line\"><span class=\"keyword\">if</span> (process.getIsLast() == <span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">    form.setState(result);<span class=\"comment\">//approve|refused</span></span><br><span class=\"line\">    leaveFormDao.update(form);</span><br><span class=\"line\">    String strResult = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (result.equals(<span class=\"string\">&quot;approve&quot;</span>)) &#123;</span><br><span class=\"line\">        strResult = <span class=\"string\">&quot;批准&quot;</span>;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (result.equals(<span class=\"string\">&quot;refused&quot;</span>)) &#123;</span><br><span class=\"line\">        strResult = <span class=\"string\">&quot;驳回&quot;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    String noticeContent = </span><br><span class=\"line\">        String.format(<span class=\"string\">&quot;您的请假申请[%s-%s]%s%s已%s,审批意见:%S,审批流程已结束&quot;</span></span><br><span class=\"line\">        ,sdf.format(form.getStartTime()), sdf.format(form.getEndTime())</span><br><span class=\"line\">        ,operator.getTitle(),operator.getName(),strResult,reason);<span class=\"comment\">//发给表单提交人的通知</span></span><br><span class=\"line\">    noticeDao.insert(<span class=\"keyword\">new</span> Notice(form.getEmployeeId(),noticeContent));</span><br><span class=\"line\">    <span class=\"comment\">//发给审批人的通知</span></span><br><span class=\"line\">    noticeContent = </span><br><span class=\"line\">        String.format(<span class=\"string\">&quot;%s-%s提起请假申请[%s-%s]您已%s,审批意见:%s,审批流程已结束&quot;</span> ,</span><br><span class=\"line\">         employee.getTitle() , employee.getName() , sdf.format( form.getStartTime()) </span><br><span class=\"line\">          , sdf.format(form.getEndTime()), strResult , reason);</span><br><span class=\"line\">    noticeDao.insert(<span class=\"keyword\">new</span> Notice(operator.getEmployeeId(),noticeContent));</span><br></pre></td></tr></table></figure>\n<p>–审批还需要总经理处理时</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//3.如果当前任务不是最后一个节点且审批通过</span></span><br><span class=\"line\"> <span class=\"keyword\">if</span> (result.equals(<span class=\"string\">&quot;approved&quot;</span>)) &#123;</span><br><span class=\"line\"><span class=\"comment\">//消息1: 通知表单提交人,部门经理已经审批通过,交由上级继续审批</span></span><br><span class=\"line\">String noticeContent1 = </span><br><span class=\"line\">    String.format(<span class=\"string\">&quot;您的请假申请[%s-%s]%s%s已批准,审批意见:%s ,请继续等待上级审批&quot;</span> ,</span><br><span class=\"line\">                  sdf.format(form.getStartTime()) , sdf.format(form.getEndTime()),</span><br><span class=\"line\">                  operator.getTitle() , operator.getName(),reason);</span><br><span class=\"line\">noticeDao.insert(<span class=\"keyword\">new</span> Notice(form.getEmployeeId(),noticeContent1));</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//消息2: 通知总经理有新的审批任务</span></span><br><span class=\"line\">String noticeContent2 = </span><br><span class=\"line\">    String.format(<span class=\"string\">&quot;%s-%s提起请假申请[%s-%s],请尽快审批&quot;</span> ,</span><br><span class=\"line\">         employee.getTitle() , employee.getName() , sdf.format( form.getStartTime())</span><br><span class=\"line\">                  , sdf.format(form.getEndTime()));</span><br><span class=\"line\">noticeDao.insert(<span class=\"keyword\">new</span> Notice(readyProcess.getOperatorId(),noticeContent2));</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//消息3: 通知部门经理(当前经办人),员工的申请单你已批准,交由上级继续审批</span></span><br><span class=\"line\">String noticeContent3 =</span><br><span class=\"line\">    String.format(<span class=\"string\">&quot;%s-%s提起请假申请[%s-%s]您已批准,审批意见:%s,申请转至上级领导继续审批&quot;</span> ,</span><br><span class=\"line\">         employee.getTitle() , employee.getName()</span><br><span class=\"line\">           , sdf.format( form.getStartTime()) , sdf.format(form.getEndTime()), reason);</span><br><span class=\"line\">noticeDao.insert(<span class=\"keyword\">new</span> Notice(operator.getEmployeeId(),noticeContent3));</span><br><span class=\"line\"> &#125;<span class=\"keyword\">else</span> <span class=\"keyword\">if</span>(result.equals(<span class=\"string\">&quot;refused&quot;</span>)) &#123;</span><br><span class=\"line\">     <span class=\"comment\">//4.如果当前任务不是最后一个节点且审批驳回</span></span><br><span class=\"line\">     <span class=\"keyword\">for</span>(ProcessFlow p:readyList)&#123;</span><br><span class=\"line\">         p.setState(<span class=\"string\">&quot;cancel&quot;</span>);</span><br><span class=\"line\">         processFlowDao.update(p);</span><br><span class=\"line\">     &#125;</span><br><span class=\"line\">     form.setState(<span class=\"string\">&quot;refused&quot;</span>);</span><br><span class=\"line\">     leaveFormDao.update(form);</span><br><span class=\"line\">     <span class=\"comment\">//消息1: 通知申请人表单已被驳回</span></span><br><span class=\"line\">     String noticeContent1 = </span><br><span class=\"line\">         String.format(<span class=\"string\">&quot;您的请假申请[%s-%s]%s%s已驳回,审批意见:%s,审批流程已结束&quot;</span> ,</span><br><span class=\"line\">                       sdf.format(form.getStartTime()) , sdf.format(form.getEndTime()),</span><br><span class=\"line\">                       operator.getTitle() , operator.getName(),reason);</span><br><span class=\"line\">     noticeDao.insert(<span class=\"keyword\">new</span> Notice(form.getEmployeeId(),noticeContent1));</span><br><span class=\"line\"></span><br><span class=\"line\">     <span class=\"comment\">//消息2: 通知经办人表单&quot;您已驳回&quot;</span></span><br><span class=\"line\">     String noticeContent2 = </span><br><span class=\"line\">         String.format(<span class=\"string\">&quot;%s-%s提起请假申请[%s-%s]您已驳回,审批意见:%s,审批流程已结束&quot;</span> ,</span><br><span class=\"line\">     employee.getTitle() , employee.getName() , sdf.format( form.getStartTime()) </span><br><span class=\"line\">                       , sdf.format(form.getEndTime()), reason);</span><br><span class=\"line\">     noticeDao.insert(<span class=\"keyword\">new</span> Notice(operator.getEmployeeId(),noticeContent2));</span><br><span class=\"line\">                &#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"显示系统消息\"><a href=\"#显示系统消息\" class=\"headerlink\" title=\"显示系统消息\"></a>显示系统消息</h3><p>◇在notice.xml中新增查询语句</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">&lt;select id=<span class=\"string\">&quot;selectByReceiverId&quot;</span> parameterType=<span class=\"string\">&quot;Long&quot;</span> resultType=<span class=\"string\">&quot;com.lcg.oa.entity.Notice&quot;</span>&gt;</span><br><span class=\"line\">        select * from sys_notice where receiver_id = #&#123;value&#125; order by create_time desc limit <span class=\"number\">0</span>,<span class=\"number\">100</span></span><br><span class=\"line\">    &lt;/select&gt;</span><br></pre></td></tr></table></figure>\n<p>◇在dao中进行定义</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> List&lt;Notice&gt; <span class=\"title\">selectByReceiverId</span><span class=\"params\">(Long receiverId)</span></span>;</span><br></pre></td></tr></table></figure>\n<p>◇新增NoticeService</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 消息服务</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">NoticeService</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 查询指定员工的系统消息</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> receiverId</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> 最近100条消息列表</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> List&lt;Notice&gt; <span class=\"title\">getNoticeList</span><span class=\"params\">(Long receiverId)</span></span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> (List)MybatisUtils.executeQuery(sqlSession -&gt; &#123;</span><br><span class=\"line\">            NoticeDao noticeDao = sqlSession.getMapper(NoticeDao.class);</span><br><span class=\"line\">            <span class=\"keyword\">return</span> noticeDao.selectByReceiverId(receiverId);</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>◇创建NoticeServlet向客户端返回数据</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@WebServlet(name = &quot;NoticeServlet&quot; , urlPatterns = &quot;/notice/list&quot;)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">NoticeServlet</span> <span class=\"keyword\">extends</span> <span class=\"title\">HttpServlet</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> NoticeService noticeService = <span class=\"keyword\">new</span> NoticeService();</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title\">doPost</span><span class=\"params\">(HttpServletRequest request, HttpServletResponse response)</span> <span class=\"keyword\">throws</span> ServletException, IOException </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title\">doGet</span><span class=\"params\">(HttpServletRequest request, HttpServletResponse response)</span> <span class=\"keyword\">throws</span> ServletException, IOException </span>&#123;</span><br><span class=\"line\">        User user = (User)request.getSession().getAttribute(<span class=\"string\">&quot;login_user&quot;</span>);</span><br><span class=\"line\">        List&lt;Notice&gt; noticeList = noticeService.getNoticeList(user.getEmployeeId());</span><br><span class=\"line\">        Map result = <span class=\"keyword\">new</span> HashMap&lt;&gt;();</span><br><span class=\"line\">        result.put(<span class=\"string\">&quot;code&quot;</span>, <span class=\"string\">&quot;0&quot;</span>);</span><br><span class=\"line\">        result.put(<span class=\"string\">&quot;msg&quot;</span>, <span class=\"string\">&quot;&quot;</span>);</span><br><span class=\"line\">        result.put(<span class=\"string\">&quot;count&quot;</span>, noticeList.size());</span><br><span class=\"line\">        result.put(<span class=\"string\">&quot;data&quot;</span>, noticeList);</span><br><span class=\"line\">        String json = JSON.toJSONString(result);</span><br><span class=\"line\">        response.setContentType(<span class=\"string\">&quot;text/html;charset=utf-8&quot;</span>);</span><br><span class=\"line\">        response.getWriter().println(json);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>◇notice.ftl页面部分代码</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">&lt;script&gt;</span><br><span class=\"line\">    layui.table.render(&#123;</span><br><span class=\"line\">        elem : <span class=\"string\">&quot;#grdNoticeList&quot;</span> ,</span><br><span class=\"line\">        id : <span class=\"string\">&quot;grdNoticeList&quot;</span> ,</span><br><span class=\"line\">        url : <span class=\"string\">&quot;/notice/list&quot;</span> ,<span class=\"comment\">//请求数据的地址</span></span><br><span class=\"line\">        page : <span class=\"keyword\">false</span> ,</span><br><span class=\"line\">        cols :[[</span><br><span class=\"line\">            &#123;field : <span class=\"string\">&quot;&quot;</span> , title : <span class=\"string\">&quot;序号&quot;</span> , width:<span class=\"string\">&quot;10%&quot;</span> , style : <span class=\"string\">&quot;height:60px&quot;</span> , type:<span class=\"string\">&quot;numbers&quot;</span>&#125;,</span><br><span class=\"line\">            &#123;field : <span class=\"string\">&quot;create_time&quot;</span> , title : <span class=\"string\">&quot;通知时间&quot;</span> , width : <span class=\"string\">&quot;20%&quot;</span> , templet: function (d) &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">var</span> newDate = <span class=\"keyword\">new</span> Date(d.createTime);</span><br><span class=\"line\">                    <span class=\"keyword\">return</span> newDate.getFullYear() + <span class=\"string\">&quot;-&quot;</span> +</span><br><span class=\"line\">                        (newDate.getMonth() + <span class=\"number\">1</span>) + <span class=\"string\">&quot;-&quot;</span> + newDate.getDate()</span><br><span class=\"line\">                        + <span class=\"string\">&quot; &quot;</span> + newDate.getHours() + <span class=\"string\">&quot;:&quot;</span> + newDate.getMinutes() + <span class=\"string\">&quot;:&quot;</span> + newDate.getSeconds();</span><br><span class=\"line\">                &#125;&#125;,</span><br><span class=\"line\">            &#123;field : <span class=\"string\">&quot;content&quot;</span> , title : <span class=\"string\">&quot;通知内容&quot;</span> , width : <span class=\"string\">&quot;60%&quot;</span>&#125;</span><br><span class=\"line\">        ]]</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;/script&gt;</span><br></pre></td></tr></table></figure>\n<p>◇修改index.ftl使用户一登录就能看到通知消息，即将首页内置框架绑定到notice上</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">&lt;!--主体部分采用iframe嵌入其他页面--&gt;</span><br><span class=\"line\">   &lt;div <span class=\"class\"><span class=\"keyword\">class</span></span>=<span class=\"string\">&quot;layui-body&quot;</span> style=<span class=\"string\">&quot;overflow-y: hidden&quot;</span>&gt;</span><br><span class=\"line\">       &lt;iframe name=<span class=\"string\">&quot;ifmMain&quot;</span> src=<span class=\"string\">&quot;/forward/notice&quot;</span> style=<span class=\"string\">&quot;...&quot;</span>&gt;&lt;/iframe&gt;</span><br><span class=\"line\">   &lt;/div&gt;</span><br></pre></td></tr></table></figure>\n\n\n\n\n","categories":["Java数据库","OA系统项目"],"tags":["MyBaits"]},{"title":"医点通项目介绍","url":"/p/ea75.html","content":"<h2 id=\"一、项目简介与特点\"><a href=\"#一、项目简介与特点\" class=\"headerlink\" title=\"一、项目简介与特点\"></a>一、项目简介与特点</h2><h3 id=\"1-项目简介\"><a href=\"#1-项目简介\" class=\"headerlink\" title=\"1.项目简介\"></a>1.项目简介</h3><p>​    ◇医点通预约挂号系统是一项便民服务系统,一点即通,方便患者挂号就医!</p>\n<p>​    ◇<a href=\"https://www.yuque.com/u21068845/qxdaub\">项目开发笔记</a></p>\n<p>​    ◇<a href=\"https://github.com/618dt/Hospital\">项目完整代码</a></p>\n<h3 id=\"2-项目特点\"><a href=\"#2-项目特点\" class=\"headerlink\" title=\"2.项目特点\"></a>2.项目特点</h3><ul>\n<li>友好的代码结构及注释，便于阅读及二次开发</li>\n<li>实现前后端分离，请求接口封装，错误码统一处理</li>\n<li>前端采用Element-ui框架，极大的提高了开发效率</li>\n<li>引入swagger文档支持，方便编写API接口文档</li>\n<li>项目采用分布式架构，每个子项目可独立部署，扩展灵活，易于维护</li>\n<li>使用NoSQL型数据库，将医院等不需要经常写操作的信息存储在MongoDB中，提高数据的查询速度</li>\n<li>使用SpringCloudGateway进行统一网关校验和请求转发，并解决跨域问题<h3 id=\"3-项目业务流程\"><a href=\"#3-项目业务流程\" class=\"headerlink\" title=\"3.项目业务流程\"></a>3.项目业务流程</h3>◇项目业务流程如图：<br><img src=\"/p/ea75/1646032002195-72f9eee8-5c59-459a-8a96-f42ce5d4e009.png\" class=\"lazyload\" data-srcset=\"/p/ea75/1646032002195-72f9eee8-5c59-459a-8a96-f42ce5d4e009.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"></li>\n</ul>\n<h2 id=\"二、项目模块介绍\"><a href=\"#二、项目模块介绍\" class=\"headerlink\" title=\"二、项目模块介绍\"></a>二、项目模块介绍</h2><h3 id=\"1-项目模块组成\"><a href=\"#1-项目模块组成\" class=\"headerlink\" title=\"1.项目模块组成\"></a>1.项目模块组成</h3><p>◇如下图所示，整个项目（appointment-parent）由多个子项目（service,common等）聚合而成，每个子项目各是一个独立可部署的JavaWeb项目（可以放到Tomcat中运行），各项目通过SpringCloud实现项目间服务调用，使得整个项目可以实现分布式部署。这种架构是分布式Java项目常采用的架构模型。<br><img src=\"/p/ea75/1645796126400-bcfa17df-bfea-49c0-a3e3-e8fd342ebdc8.png\" class=\"lazyload\" data-srcset=\"/p/ea75/1645796126400-bcfa17df-bfea-49c0-a3e3-e8fd342ebdc8.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"><br>◇其中common模块包括了项目所需的基础工具类，如全局异常类，统一返回结果状态信息类，Redis配置类，service模块所需的服务类等。hospital-manage是医院系统模块。service是各个微服务的父模块，包含了cmn数据字典服务，医院服务，短信服务，订单服务等。service_client模块包含了远程服务提供者提供者的服务接口。service_gateway是网关模块，配置有请求的统一转发，请求过滤等信息。</p>\n<h3 id=\"2-项目服务架构\"><a href=\"#2-项目服务架构\" class=\"headerlink\" title=\"2.项目服务架构\"></a>2.项目服务架构</h3><p>◇项目微服务架构图如下<br><img src=\"/p/ea75/1646033456298-faa05956-b620-48d1-9758-dba5e702dea8.png\" class=\"lazyload\" data-srcset=\"/p/ea75/1646033456298-faa05956-b620-48d1-9758-dba5e702dea8.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"></p>\n<h2 id=\"三、项目主要技术\"><a href=\"#三、项目主要技术\" class=\"headerlink\" title=\"三、项目主要技术\"></a>三、项目主要技术</h2><h3 id=\"1-前端技术\"><a href=\"#1-前端技术\" class=\"headerlink\" title=\"1.前端技术\"></a>1.前端技术</h3><p>◇<a href=\"https://cn.vuejs.org/index.html\">Vue.js</a>：是一套用于构建用户界面的渐进式JavaScript框架。 与其它大型框架不同的是，Vue 被设计为可以自底向上逐层应用。Vue 的核心库只关注视图层，不仅易于上手，还便于与第三方库或既有项目整合。另一方面，当与现代化的工具链以及各种支持类库结合使用时，Vue 也完全能够为复杂的单页应用（<a href=\"https://baike.baidu.com/item/SPA/17536313\">SPA</a>）提供驱动。<br>◇<a href=\"https://element.eleme.cn/#/zh-CN\">Element-ui</a>：网站快速成型工具，一套为开发者、设计师和产品经理准备的基于 Vue 2.0 的桌面端组件库。<br>◇<a href=\"https://www.nuxtjs.cn/\">Nuxt.js</a>：基于 Vue.js 的轻量级应用框架,可用来创建服务端渲染 (SSR) 应用,也可充当静态站点引擎生成静态站点应用,具有优雅的代码结构分层和热加载等特性。</p>\n<h3 id=\"2-后端技术\"><a href=\"#2-后端技术\" class=\"headerlink\" title=\"2.后端技术\"></a>2.后端技术</h3><h4 id=\"2-1-开发框架\"><a href=\"#2-1-开发框架\" class=\"headerlink\" title=\"2.1 开发框架\"></a>2.1 开发框架</h4><p>◇<a href=\"https://start.spring.io/\">SpringBoot</a>：简化spring的搭建和开发过程的全新框架。<br>◇<a href=\"https://baomidou.com/\">MyBatis-Plus</a>：一个<a href=\"https://mybatis.org/mybatis-3/\">MyBatis</a>的增强工具，在 MyBatis 的基础上只做增强不做改变，为简化开发、提高效率而生。</p>\n<h4 id=\"2-2-数据库\"><a href=\"#2-2-数据库\" class=\"headerlink\" title=\"2.2 数据库\"></a>2.2 数据库</h4><p>◇<a href=\"https://www.mongodb.com/\">MongoDB</a>：一个跨平台的，面向文档的数据库，是当前 NoSQL 数据库产品中最热门的一种。<br>◇<a href=\"https://www.mysql.com/\">MySQL</a>：关系型数据库。<br>◇<a href=\"https://redis.io/\">Redis</a>：一个基于内存的高性能key-value数据库。</p>\n<h4 id=\"2-3-SpringCloud微服务\"><a href=\"#2-3-SpringCloud微服务\" class=\"headerlink\" title=\"2.3 SpringCloud微服务\"></a>2.3 SpringCloud微服务</h4><p>◇<a href=\"https://nacos.io/zh-cn/docs/quick-start.html\">Nacos</a>：使用 Nacos 简化服务发现、配置管理、服务治理及管理的解决方案，让微服务的发现、管理、共享、组合更加容易。<br>◇<a href=\"https://spring.io/projects/spring-cloud-gateway\">Gateway</a>：为微服务架构提供一种简单而有效的统一的API路由管理方式。<br>◇<a href=\"https://spring.io/projects/spring-cloud-openfeign\">Feign</a>：一个声明式的Web服务客户端，使用Feign可使得Web服务客户端的写入更加方便。</p>\n<h4 id=\"2-4-其他\"><a href=\"#2-4-其他\" class=\"headerlink\" title=\"2.4 其他\"></a>2.4 其他</h4><p>◇消息中间件<a href=\"https://www.rabbitmq.com/\">RabbitMQ</a>：一个开源的AMQP实现，服务器端用Erlang语言编写，支持多种客户端，如：Python、Ruby、.NET、Java、JMS、C、PHP、ActionScript、XMPP、STOMP等，支持AJAX。用于在分布式系统中存储转发消息，在易用性、扩展性、高可用性等方面表现不俗。<br>◇Api接口文档工具<a href=\"https://swagger.io/\">Swagger</a>：一款RESTFUL接口的文档在线自动生成+功能测试功能软件。</p>\n<h2 id=\"四、项目主要功能\"><a href=\"#四、项目主要功能\" class=\"headerlink\" title=\"四、项目主要功能\"></a>四、项目主要功能</h2><h3 id=\"1-用户模块\"><a href=\"#1-用户模块\" class=\"headerlink\" title=\"1.用户模块\"></a>1.用户模块</h3><h4 id=\"1-1-登录注册以及认证\"><a href=\"#1-1-登录注册以及认证\" class=\"headerlink\" title=\"1.1 登录注册以及认证\"></a>1.1 登录注册以及认证</h4><p>◇用户首页，可以根据医院名称进行模糊查询，输入文字后可根据文字模糊查询出医院列表显示在下拉框中，点击可跳转至医院页面进行预约挂号。<br><img src=\"/p/ea75/1645848378064-376da2a5-bb38-47e1-b66f-817e09887a76.png\" class=\"lazyload\" data-srcset=\"/p/ea75/1645848378064-376da2a5-bb38-47e1-b66f-817e09887a76.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"><br>◇用户注册功能，可以使用邮箱和微信登录。<br><img src=\"/p/ea75/1645848554735-d1d00e1e-5593-4f4d-8de2-cc15c850f0b9.png\" class=\"lazyload\" data-srcset=\"/p/ea75/1645848554735-d1d00e1e-5593-4f4d-8de2-cc15c850f0b9.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"><br><img src=\"/p/ea75/1645848532112-11c06114-0ef0-4ba4-9d5c-088cf1a0bf3c.png\" class=\"lazyload\" data-srcset=\"/p/ea75/1645848532112-11c06114-0ef0-4ba4-9d5c-088cf1a0bf3c.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"><br>◇登录成功后默认用户名为邮箱号，需要进行实名认证才能挂号。<img src=\"/p/ea75/1645849579723-0e8294d2-51bd-4820-81f1-1a3822898ea5.png\" class=\"lazyload\" data-srcset=\"/p/ea75/1645849579723-0e8294d2-51bd-4820-81f1-1a3822898ea5.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"><br>◇用户实名认证功能，通过填写姓名，证件信息以及证件照方式进行实名认证，由平台管理员进行认证审批。<br><img src=\"/p/ea75/1645850174586-36b13918-81b2-40dd-84af-cc5af2067d47.png\" class=\"lazyload\" data-srcset=\"/p/ea75/1645850174586-36b13918-81b2-40dd-84af-cc5af2067d47.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"></p>\n<h4 id=\"1-2-用户就诊人管理\"><a href=\"#1-2-用户就诊人管理\" class=\"headerlink\" title=\"1.2 用户就诊人管理\"></a>1.2 用户就诊人管理</h4><p>◇用户就诊人管理，用户能够对就诊人进行基本的增删改查操作。<br><img src=\"/p/ea75/1645851170039-13512702-62f8-4507-8913-5c1f19ddca23.png\" class=\"lazyload\" data-srcset=\"/p/ea75/1645851170039-13512702-62f8-4507-8913-5c1f19ddca23.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"><br>◇添加就诊人的相关信息。<br><img src=\"/p/ea75/1645851321787-bfb725df-9a46-4b87-b59b-35a84649a4af.png\" class=\"lazyload\" data-srcset=\"/p/ea75/1645851321787-bfb725df-9a46-4b87-b59b-35a84649a4af.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"><br>◇实现省市区三级联动下拉框以便就诊人选择住址<img src=\"/p/ea75/1645851481528-59663a73-f4b7-4b57-b25f-1fbb31ed2e70.png\" class=\"lazyload\" data-srcset=\"/p/ea75/1645851481528-59663a73-f4b7-4b57-b25f-1fbb31ed2e70.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"></p>\n<h4 id=\"1-3-预约挂号功能\"><a href=\"#1-3-预约挂号功能\" class=\"headerlink\" title=\"1.3 预约挂号功能\"></a>1.3 预约挂号功能</h4><p>◇预约挂号功能，能够根据自身情况选择对应的医院科室进行预约挂号。<br><img src=\"/p/ea75/1645851076761-33ed8ac3-282e-4766-a21c-939356597052.png\" class=\"lazyload\" data-srcset=\"/p/ea75/1645851076761-33ed8ac3-282e-4766-a21c-939356597052.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"><br>◇点击剩余按钮后进入确认挂号页面，选择就诊人进行预约挂号。<br><img src=\"/p/ea75/1645851700157-b3f19c99-600b-43e7-ad63-b09a9470a54a.png\" class=\"lazyload\" data-srcset=\"/p/ea75/1645851700157-b3f19c99-600b-43e7-ad63-b09a9470a54a.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"><br>◇当点击确认挂号后能够收到邮件提醒，预约成功后不进行支付可以直接取消。<br><img src=\"/p/ea75/1645861133423-78d4bcb1-3a74-4c03-bad1-5fb7b3e1d445.png\" class=\"lazyload\" data-srcset=\"/p/ea75/1645861133423-78d4bcb1-3a74-4c03-bad1-5fb7b3e1d445.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"><br>◇预约成功跳转到待支付页面。<br><img src=\"/p/ea75/1645852676324-b396e243-17d8-407d-abcf-5d25dd8742aa.png\" class=\"lazyload\" data-srcset=\"/p/ea75/1645852676324-b396e243-17d8-407d-abcf-5d25dd8742aa.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"><br>◇使用微信支付<img src=\"/p/ea75/1645852702905-5e0507a6-a190-4348-a7f4-c4e98c44c6b9.png\" class=\"lazyload\" data-srcset=\"/p/ea75/1645852702905-5e0507a6-a190-4348-a7f4-c4e98c44c6b9.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"><br>◇支付成功后订单状态变为已支付。<br><img src=\"/p/ea75/1645852803503-4d2d84c4-475b-4377-86ad-06261ec0e2e6.png\" class=\"lazyload\" data-srcset=\"/p/ea75/1645852803503-4d2d84c4-475b-4377-86ad-06261ec0e2e6.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"><br>◇支付成功后取消预约能够进行全额退款，取消预约后也会有邮件提醒。<br><img src=\"/p/ea75/1645857008975-26865b8c-2324-48b8-b741-484c9d542dec.png\" class=\"lazyload\" data-srcset=\"/p/ea75/1645857008975-26865b8c-2324-48b8-b741-484c9d542dec.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"Screenshot_20220226_141911_com.tencent.mm.png\"></p>\n<h3 id=\"2-平台管理模块\"><a href=\"#2-平台管理模块\" class=\"headerlink\" title=\"2.平台管理模块\"></a>2.平台管理模块</h3><h4 id=\"2-1-医院设置管理功能\"><a href=\"#2-1-医院设置管理功能\" class=\"headerlink\" title=\"2.1 医院设置管理功能\"></a>2.1 医院设置管理功能</h4><p>◇查看医院设置列表；能够进行分页显示，以及按医院名称，医院编号条件查询；医院设置即对平台上的医院进行相关信息的设置，如医院的api基础路径，用于和医院系统交互；医院方的联系人等；以及对医院的锁定删除等功能。<br><img src=\"/p/ea75/1645800514957-52204880-53d8-484b-a323-79067e7fc769.png\" class=\"lazyload\" data-srcset=\"/p/ea75/1645800514957-52204880-53d8-484b-a323-79067e7fc769.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"><br>◇医院设置添加<img src=\"/p/ea75/1645800626630-99025846-2d27-4fcb-b7e7-6ad6a2fb0fa2.png\" class=\"lazyload\" data-srcset=\"/p/ea75/1645800626630-99025846-2d27-4fcb-b7e7-6ad6a2fb0fa2.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"><br>◇医院设置修改，点击医院设置列表的修改操作就会跳转到编辑页面，并将数据回填。<img src=\"/p/ea75/1645800658163-9e50629d-8a7f-4d12-9f20-29255f65eae2.png\" class=\"lazyload\" data-srcset=\"/p/ea75/1645800658163-9e50629d-8a7f-4d12-9f20-29255f65eae2.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"><br>◇医院列表<br><img src=\"/p/ea75/1645846066005-25f3ea6f-4701-4b44-9fc6-12949cfd5dcb.png\" class=\"lazyload\" data-srcset=\"/p/ea75/1645846066005-25f3ea6f-4701-4b44-9fc6-12949cfd5dcb.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"><br>◇查看医院详情<br><img src=\"/p/ea75/1645846228516-f88570a6-88b6-4221-bf7d-022f996cb126.png\" class=\"lazyload\" data-srcset=\"/p/ea75/1645846228516-f88570a6-88b6-4221-bf7d-022f996cb126.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"><br>◇点击排班可以按日期、科室显示相关排班信息。<br><img src=\"/p/ea75/1645846159147-0985aab6-f80b-455b-a0c7-67d922121766.png\" class=\"lazyload\" data-srcset=\"/p/ea75/1645846159147-0985aab6-f80b-455b-a0c7-67d922121766.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"></p>\n<h4 id=\"2-2-数据字典\"><a href=\"#2-2-数据字典\" class=\"headerlink\" title=\"2.2 数据字典\"></a>2.2 数据字典</h4><p>◇数据字典树形懒加载<br><img src=\"/p/ea75/1645846326135-aa5adeea-d77d-40cd-b23c-c808a241089f.png\" class=\"lazyload\" data-srcset=\"/p/ea75/1645846326135-aa5adeea-d77d-40cd-b23c-c808a241089f.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"></p>\n<h4 id=\"2-2-用户管理功能\"><a href=\"#2-2-用户管理功能\" class=\"headerlink\" title=\"2.2 用户管理功能\"></a>2.2 用户管理功能</h4><p>◇用户列表<br><img src=\"/p/ea75/1645846715543-c24e6ed8-f597-46b8-864d-fb49b2ff1144.png\" class=\"lazyload\" data-srcset=\"/p/ea75/1645846715543-c24e6ed8-f597-46b8-864d-fb49b2ff1144.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"><br>◇用户审批列表<br><img src=\"/p/ea75/1645850460179-24293546-ab4b-4d36-a62d-a711542881c6.png\" class=\"lazyload\" data-srcset=\"/p/ea75/1645850460179-24293546-ab4b-4d36-a62d-a711542881c6.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"><br>◇用户信息查看<br><img src=\"/p/ea75/1645846971306-247df992-7478-4962-a481-535730228710.png\" class=\"lazyload\" data-srcset=\"/p/ea75/1645846971306-247df992-7478-4962-a481-535730228710.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"></p>\n<h4 id=\"2-3-订单查看及统计功能\"><a href=\"#2-3-订单查看及统计功能\" class=\"headerlink\" title=\"2.3 订单查看及统计功能\"></a>2.3 订单查看及统计功能</h4><p>◇平台能够查看所有的订单信息并且对订单数据进行统计。<br><img src=\"/p/ea75/1645959395125-c2fab051-87a4-4f55-97e3-754e43cd26b2.png\" class=\"lazyload\" data-srcset=\"/p/ea75/1645959395125-c2fab051-87a4-4f55-97e3-754e43cd26b2.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"><br><img src=\"/p/ea75/1645941809992-a033e8bc-8fe1-4d74-9751-8d7de2ccac5b.png\" class=\"lazyload\" data-srcset=\"/p/ea75/1645941809992-a033e8bc-8fe1-4d74-9751-8d7de2ccac5b.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"></p>\n<h3 id=\"3-医院系统模块\"><a href=\"#3-医院系统模块\" class=\"headerlink\" title=\"3.医院系统模块\"></a>3.医院系统模块</h3><p>◇医院设置功能;设置医院的编码、医院签名和统一预约挂号平台的基础路径；医院签名用于和挂号平台进行校验，基础路径即调用平台相关的接口路径。<br><img src=\"/p/ea75/1645799932699-12c569b8-3d34-4137-a63e-065b1c9d0a2c.png\" class=\"lazyload\" data-srcset=\"/p/ea75/1645799932699-12c569b8-3d34-4137-a63e-065b1c9d0a2c.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"><br>◇医院信息及上传医院信息功能，通过JSON数据的方式上传医院信息；若要修改医院信息，在医院编号不变的情况下重新添加数据即可。<br><img src=\"/p/ea75/1645800177789-2ca6bdfc-1b20-44ce-9d3b-687190928669.png\" class=\"lazyload\" data-srcset=\"/p/ea75/1645800177789-2ca6bdfc-1b20-44ce-9d3b-687190928669.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"><br><img src=\"/p/ea75/1645800316594-c4540778-12cc-48aa-bedf-5e6f625f2eb3.png\" class=\"lazyload\" data-srcset=\"/p/ea75/1645800316594-c4540778-12cc-48aa-bedf-5e6f625f2eb3.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"><br>◇科室列表与上传科室功能；上传科室的方式也是通过JSON数据上传。<br><img src=\"/p/ea75/1645800351792-d8b7cfa4-658c-49b3-a2b2-90013520e9ea.png\" class=\"lazyload\" data-srcset=\"/p/ea75/1645800351792-d8b7cfa4-658c-49b3-a2b2-90013520e9ea.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"><br>◇医院排班列表以及上传排班功能和前面类似。</p>\n<h2 id=\"五、项目运行\"><a href=\"#五、项目运行\" class=\"headerlink\" title=\"五、项目运行\"></a>五、项目运行</h2><h3 id=\"1-虚拟机\"><a href=\"#1-虚拟机\" class=\"headerlink\" title=\"1.虚拟机\"></a>1.虚拟机</h3><p>◇启动虚拟机，在虚拟机中运行nacos、redis、mongoDB，rabbitMQ；</p>\n<figure class=\"highlight properties\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#启动nacos,目录:cd /usr/local/Nacos/nacos/bin</span></span><br><span class=\"line\"><span class=\"meta\">[root@master</span> <span class=\"string\">bin]# sh startup.sh -m standalone</span></span><br><span class=\"line\"><span class=\"meta\">/usr/java/jdk8u282-b08/bin/java</span>  <span class=\"string\">-Xms512m -Xmx512m -Xmn256m -Dnacos.standalone=true -Djava.ext.dirs=/usr/java/jdk8u282-b08/jre/lib/ext:/usr/java/jdk8u282-b08/lib/ext:/usr/local/Nacos/nacos/plugins/cmdb:/usr/local/Nacos/nacos/plugins/mysql -Xloggc:/usr/local/Nacos/nacos/logs/nacos_gc.log -verbose:gc -XX:+PrintGCDetails -XX:+PrintGCDateStamps -XX:+PrintGCTimeStamps -XX:+UseGCLogFileRotation -XX:NumberOfGCLogFiles=10 -XX:GCLogFileSize=100M -Dnacos.home=/usr/local/Nacos/nacos -Dloader.path=/usr/local/Nacos/nacos/plugins/health -jar /usr/local/Nacos/nacos/target/nacos-server.jar  --spring.config.location=classpath:/,classpath:/config/,file:./,file:./config/,file:/usr/local/Nacos/nacos/conf/ --logging.config=/usr/local/Nacos/nacos/conf/nacos-logback.xml --server.max-http-header-size=524288</span></span><br><span class=\"line\"><span class=\"attr\">nacos</span> <span class=\"string\">is starting with standalone</span></span><br><span class=\"line\"><span class=\"attr\">nacos</span> <span class=\"string\">is starting，you can check the /usr/local/Nacos/nacos/logs/start.out</span></span><br><span class=\"line\"><span class=\"comment\">#启动redis,目录:cd /usr/local/redis-5.0.0/bin</span></span><br><span class=\"line\"><span class=\"meta\">[root@master</span> <span class=\"string\">bin]# ./redis-server redis.conf</span></span><br><span class=\"line\"><span class=\"attr\">1917</span>:<span class=\"string\">C 20 Feb 2022 18:06:36.715 # oO0OoO0OoO0Oo Redis is starting oO0OoO0OoO0Oo</span></span><br><span class=\"line\"><span class=\"attr\">1917</span>:<span class=\"string\">C 20 Feb 2022 18:06:36.715 # Redis version=5.0.0, bits=64, commit=00000000, modified=0, pid=1917, just started</span></span><br><span class=\"line\"><span class=\"attr\">1917</span>:<span class=\"string\">C 20 Feb 2022 18:06:36.715 # Configuration loaded</span></span><br><span class=\"line\"><span class=\"comment\">#启动mongoDB和rabbitMQ</span></span><br><span class=\"line\"><span class=\"comment\">#启动docker 任意目录</span></span><br><span class=\"line\"><span class=\"meta\">[root@master</span> <span class=\"string\">bin]# systemctl start docker</span></span><br><span class=\"line\"><span class=\"comment\">#进入mongoDB</span></span><br><span class=\"line\"><span class=\"meta\">[root@master</span> <span class=\"string\">bin]# docker exec -it mymongo /bin/bash</span></span><br><span class=\"line\"><span class=\"meta\">root@d9a024b9bffc</span>:<span class=\"string\">/# mongo</span></span><br><span class=\"line\"><span class=\"meta\">&gt;</span> <span class=\"string\">show dbs</span></span><br><span class=\"line\"><span class=\"attr\">admin</span>             <span class=\"string\">0.000GB</span></span><br><span class=\"line\"><span class=\"attr\">appointment_hosp</span>  <span class=\"string\">0.001GB</span></span><br><span class=\"line\"><span class=\"attr\">config</span>            <span class=\"string\">0.000GB</span></span><br><span class=\"line\"><span class=\"attr\">local</span>             <span class=\"string\">0.000GB</span></span><br><span class=\"line\"><span class=\"attr\">test</span>              <span class=\"string\">0.000GB</span></span><br><span class=\"line\"><span class=\"meta\">&gt;</span> <span class=\"string\"></span></span><br><span class=\"line\"><span class=\"comment\">#rabbitmq</span></span><br><span class=\"line\"><span class=\"meta\">[root@master</span> <span class=\"string\">bin]# docker run -d -p 5672:5672 -p 15672:15672 --name rabbitmq rabbitmq:management</span></span><br><span class=\"line\"><span class=\"attr\">a4f4c63a827bc83627289f42cada49f12f8d2d7c69af07be80e74ca12cb4ab0a</span></span><br><span class=\"line\"><span class=\"comment\">#docker ps -a 查看容器列表; docker start xxxxxx --启动已经建立的容器号</span></span><br><span class=\"line\"><span class=\"meta\">[root@master</span> <span class=\"string\">bin]# </span></span><br></pre></td></tr></table></figure>\n<p>◇如果Xshell突然连接不上虚拟机查看22端口是否放行</p>\n<figure class=\"highlight properties\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#启动防火墙</span></span><br><span class=\"line\"><span class=\"meta\">[root@master</span> <span class=\"string\">bin]# systemctl start firewalld</span></span><br><span class=\"line\"><span class=\"comment\">#查看端口8848是否放行,no表示未放行</span></span><br><span class=\"line\"><span class=\"meta\">[root@master</span> <span class=\"string\">bin]# firewall-cmd --query-port=20/tcp</span></span><br><span class=\"line\"><span class=\"attr\">no</span></span><br><span class=\"line\"><span class=\"comment\">#放行8848端口</span></span><br><span class=\"line\"><span class=\"meta\">[root@master</span> <span class=\"string\">bin]# firewall-cmd --add-port=20/tcp --permanent</span></span><br><span class=\"line\"><span class=\"attr\">success</span></span><br><span class=\"line\"><span class=\"comment\">#重启防火墙服务</span></span><br><span class=\"line\"><span class=\"meta\">[root@master</span> <span class=\"string\">bin]# firewall-cmd --reload</span></span><br><span class=\"line\"><span class=\"attr\">success</span></span><br><span class=\"line\"><span class=\"meta\">[root@master</span> <span class=\"string\">bin]# </span></span><br></pre></td></tr></table></figure>\n<p>◇或者是因为使用任务管理器强制退出VM时，导致虚拟机网络配置被重置，需要重新配置网络；具体方法见<a href=\"https://blog.csdn.net/rao991207823/article/details/102877118\">Centos7虚拟机安装</a>，本机的配置文件为ens32；</p>\n<h3 id=\"2-后端项目\"><a href=\"#2-后端项目\" class=\"headerlink\" title=\"2.后端项目\"></a>2.后端项目</h3><p>◇运行service模块中各个子模块的启动类；运行hospital-manage模块的启动类；<br>◇解决端口占用(在cmd中)</p>\n<figure class=\"highlight properties\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#查看占用端口的进程号</span></span><br><span class=\"line\"><span class=\"attr\">C</span>:<span class=\"string\">\\Users\\ASUS&gt;netstat -ano|findstr &quot;8201&quot;</span></span><br><span class=\"line\">  <span class=\"attr\">TCP</span>    <span class=\"string\">0.0.0.0:8201           0.0.0.0:0              LISTENING       16488</span></span><br><span class=\"line\">  <span class=\"attr\">TCP</span>    <span class=\"string\">[::]:8201              [::]:0                 LISTENING       16488</span></span><br><span class=\"line\"><span class=\"comment\">#查看进程详情</span></span><br><span class=\"line\"><span class=\"meta\">tasklist|findstr</span> <span class=\"string\">16488</span></span><br><span class=\"line\"><span class=\"comment\">#终止进程  /F 指定强制终止进程,/T 终止指定的进程和由它启用的子进程</span></span><br><span class=\"line\"><span class=\"attr\">C</span>:<span class=\"string\">\\Users\\ASUS&gt;taskkill /pid 16488 /F</span></span><br><span class=\"line\"><span class=\"meta\">成功</span>: <span class=\"string\">已终止 PID 为 16488 的进程。</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"3-前端项目\"><a href=\"#3-前端项目\" class=\"headerlink\" title=\"3.前端项目\"></a>3.前端项目</h3><p>◇启动命令:npm run dev</p>\n<p><img src=\"/p/ea75/image-20220228223215283.png\" class=\"lazyload\" data-srcset=\"/p/ea75/image-20220228223215283.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image-20220228223215283\"></p>\n<h2 id=\"六、BUG修改\"><a href=\"#六、BUG修改\" class=\"headerlink\" title=\"六、BUG修改\"></a>六、BUG修改</h2><h3 id=\"1-用户前端页面报错\"><a href=\"#1-用户前端页面报错\" class=\"headerlink\" title=\"1.用户前端页面报错\"></a>1.用户前端页面报错</h3><p>◇打开用户前端页面报错如下，<br><img src=\"/p/ea75/1645498796901-14977c39-accf-426d-9b79-9b67ff1a83f7.png\" class=\"lazyload\" data-srcset=\"/p/ea75/1645498796901-14977c39-accf-426d-9b79-9b67ff1a83f7.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"><br>◇报错原因，因为在用户前端的首页index.vue中数据是异步渲染的，报错是因为没有获取到数据，检查后发现是因为后台网关服务模块没有启动；</p>\n<h3 id=\"2-阿里云oss上传文件\"><a href=\"#2-阿里云oss上传文件\" class=\"headerlink\" title=\"2.阿里云oss上传文件\"></a>2.阿里云oss上传文件</h3><p>◇获取不到阿里云oss上传文件的url，需要设置跨域规则；<br><img src=\"/p/ea75/1645750849434-28ef8c12-296b-4d58-888f-7abca5fbefe0.png\" class=\"lazyload\" data-srcset=\"/p/ea75/1645750849434-28ef8c12-296b-4d58-888f-7abca5fbefe0.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"></p>\n<h3 id=\"3-请求医院接口报错\"><a href=\"#3-请求医院接口报错\" class=\"headerlink\" title=\"3.请求医院接口报错\"></a>3.请求医院接口报错</h3><p><img src=\"/p/ea75/1645755033752-05371c24-d801-4185-8a36-83673bbdca59.png\" class=\"lazyload\" data-srcset=\"/p/ea75/1645755033752-05371c24-d801-4185-8a36-83673bbdca59.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"><br>◇原因，医院系统的端口为9998；在数据库中将端口改为9998即可；</p>\n<h3 id=\"4-调用OrderMapper接口方法报错\"><a href=\"#4-调用OrderMapper接口方法报错\" class=\"headerlink\" title=\"4.调用OrderMapper接口方法报错\"></a>4.调用OrderMapper接口方法报错</h3><p>◇在统计预约挂号信息时，service-order模块报错如下，提示找不到OrderMapper；</p>\n<figure class=\"highlight properties\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">org.apache.ibatis.binding.BindingException</span>: <span class=\"string\">Invalid bound statement (not found): </span></span><br><span class=\"line\"><span class=\"attr\">com.lcg.appointment.order.mapper.OrderMapper.selectOrderCount</span></span><br></pre></td></tr></table></figure>\n\n<p>◇当仔细比对相关路径后，发现还是报错；查看<a href=\"https://blog.csdn.net/weixin_43654123/article/details/121469145\">博客</a>发现是因为mybatis的配置文件默认应当放入resource目录下，但是这里将配置文件放在了java目录下，所以无法导出配置文件，进而在target文件夹中没有mapper的配置文件；</p>\n<p><img src=\"/p/ea75/1645938655960-5f029006-c7e0-41e5-805b-cd256d874ea7.png\" class=\"lazyload\" data-srcset=\"/p/ea75/1645938655960-5f029006-c7e0-41e5-805b-cd256d874ea7.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"><br>◇解决方法，需要手动配置资源过滤，让它把java目录下的properties和xml等配置文件的过滤开启，使它们能够被导出，统一在service模块下的pom.xml配置文件中开启过滤；</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!--在build中配置resource,来防止资源导出失败问题--&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">build</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">plugins</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">plugins</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">resources</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">resource</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">directory</span>&gt;</span>src/main/java<span class=\"tag\">&lt;/<span class=\"name\">directory</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">includes</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">include</span>&gt;</span>**/*.yml<span class=\"tag\">&lt;/<span class=\"name\">include</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">include</span>&gt;</span>**/*.properties<span class=\"tag\">&lt;/<span class=\"name\">include</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">include</span>&gt;</span>**/*.xml<span class=\"tag\">&lt;/<span class=\"name\">include</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">includes</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">filtering</span>&gt;</span>false<span class=\"tag\">&lt;/<span class=\"name\">filtering</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">resource</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">resource</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">directory</span>&gt;</span>src/main/resources<span class=\"tag\">&lt;/<span class=\"name\">directory</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">includes</span>&gt;</span> <span class=\"tag\">&lt;<span class=\"name\">include</span>&gt;</span>**/*.yml<span class=\"tag\">&lt;/<span class=\"name\">include</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">include</span>&gt;</span>**/*.properties<span class=\"tag\">&lt;/<span class=\"name\">include</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">include</span>&gt;</span>**/*.xml<span class=\"tag\">&lt;/<span class=\"name\">include</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">includes</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">filtering</span>&gt;</span>false<span class=\"tag\">&lt;/<span class=\"name\">filtering</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">resource</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">resources</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">build</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>◇配置好后，clean一下service-order模块<img src=\"/p/ea75/1645939173770-82d79ae5-b86e-44f4-ad08-22ca792f3f99.png\" class=\"lazyload\" data-srcset=\"/p/ea75/1645939173770-82d79ae5-b86e-44f4-ad08-22ca792f3f99.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"><br>◇然后重新启动order模块，可以看到mapper配置文件存在了<br><img src=\"/p/ea75/1645939480775-ff963827-f869-4636-b9e6-f6072b442fa8.png\" class=\"lazyload\" data-srcset=\"/p/ea75/1645939480775-ff963827-f869-4636-b9e6-f6072b442fa8.png\" srcset=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=\" alt=\"image.png\"></p>\n<h3 id=\"5-Feign调用报错\"><a href=\"#5-Feign调用报错\" class=\"headerlink\" title=\"5.Feign调用报错\"></a>5.Feign调用报错</h3><p>◇Feign调用时报错，需要在统计模块中远程调用订单模块接口获取订单列表，测试时发现如下错误；</p>\n<figure class=\"highlight properties\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">feign.codec.DecodeException</span>: <span class=\"string\">Type definition error: [simple type, class com.baomidou.mybatisplus.core.metadata.IPage]; nested exception is com.fasterxml.jackson.databind.exc.InvalidDefinitionException: Cannot construct instance of `com.baomidou.mybatisplus.core.metadata.IPage` (no Creators, like default construct, exist): abstract types either need to be mapped to concrete types, have custom deserializer, or contain additional type information</span></span><br><span class=\"line\"> <span class=\"attr\">at</span> <span class=\"string\">[Source: (PushbackInputStream); line: 1, column: 1]</span></span><br></pre></td></tr></table></figure>\n<p>◇报错原因，feign返回复杂对象时需要有无参构造函数，而在MyBatis-Plus中，IPage是接口，而Page是其实现类，所以解决方法是将IPage接口对象转换为Page。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@PostMapping(&quot;inner/&#123;page&#125;/&#123;limit&#125;&quot;)</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> Page&lt;OrderInfo&gt; <span class=\"title\">OrderList</span><span class=\"params\">(<span class=\"meta\">@PathVariable</span> Long page, <span class=\"meta\">@PathVariable</span> Long limit, <span class=\"meta\">@RequestBody</span> OrderQueryVo orderQueryVo)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">//设置分页参数:页号,每页记录数</span></span><br><span class=\"line\">    Page&lt;OrderInfo&gt; pageParam = <span class=\"keyword\">new</span> Page&lt;&gt;(page,limit);</span><br><span class=\"line\">    IPage&lt;OrderInfo&gt; pageModel = orderService.selectPage(pageParam, orderQueryVo);</span><br><span class=\"line\">    <span class=\"comment\">/*远程服务调用需要返回Page类型*/</span></span><br><span class=\"line\">    BeanUtils.copyProperties(pageModel,pageParam);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> pageParam;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n","categories":["Java开发"],"tags":["项目"]}]